# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to you under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# Tests planner rules related to Join.
#
# Ensure that tests occur in alphabetical order:
# // lint: sort where '^[#] test'
#

!use scott
!set outputformat mysql

# testAddRedundantSemiJoinRule -------------------------------------------------
# JOIN_ADD_REDUNDANT_SEMI_JOIN adds a SemiJoin as a pre-filter to improve
# performance.

select 1 from emp inner join dept on emp.deptno = dept.deptno;
+--------+
| EXPR$0 |
+--------+
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
+--------+
(14 rows)

!ok
LogicalProject(EXPR$0=[1])
  LogicalJoin(condition=[=($7, $9)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
!sub-plan "NONE"
LogicalProject(EXPR$0=[1])
  LogicalJoin(condition=[=($7, $9)], joinType=[inner], semiJoinDone=[true])
    LogicalJoin(condition=[=($7, $9)], joinType=[semi])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
!sub-plan "NONE, JOIN_ADD_REDUNDANT_SEMI_JOIN"

# testExtractJoinFilterRule ---------------------------------------------------
# JOIN_EXTRACT_FILTER moves a join condition into a Filter above a cross join.

select 1 from emp inner join dept on emp.deptno=dept.deptno;
+--------+
| EXPR$0 |
+--------+
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
|      1 |
+--------+
(14 rows)

!ok
LogicalProject(EXPR$0=[1])
  LogicalJoin(condition=[=($7, $9)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
!sub-plan "NONE"
LogicalProject(EXPR$0=[1])
  LogicalFilter(condition=[=($7, $9)])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
!sub-plan "NONE, JOIN_EXTRACT_FILTER"

# End join.iq
