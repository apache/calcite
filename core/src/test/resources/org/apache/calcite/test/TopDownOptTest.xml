<?xml version="1.0" ?>
<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one or more
  ~ contributor license agreements.  See the NOTICE file distributed with
  ~ this work for additional information regarding copyright ownership.
  ~ The ASF licenses this file to you under the Apache License, Version 2.0
  ~ (the "License"); you may not use this file except in compliance with
  ~ the License.  You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<Root>
  <TestCase name="testSortAgg">
    <Resource name="sql">
      <![CDATA[select mgr, count(*) from sales.emp
group by mgr order by mgr desc nulls last limit 5]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[5])
  LogicalAggregate(group=[{0}], EXPR$1=[COUNT()])
    LogicalProject(MGR=[$3])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableLimit(fetch=[5])
  EnumerableSortedAggregate(group=[{3}], EXPR$1=[COUNT()])
    EnumerableSort(sort0=[$3], dir0=[DESC-nulls-last])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProject">
    <Resource name="sql">
      <![CDATA[select mgr from sales.emp order by mgr desc nulls last]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[DESC-nulls-last])
  LogicalProject(MGR=[$3])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(MGR=[$3])
  EnumerableSort(sort0=[$3], dir0=[DESC-nulls-last])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProjectDerive2">
    <Resource name="sql">
      <![CDATA[select distinct ename, sal*-2, mgr
from (select ename, mgr, sal from sales.emp order by ename, mgr, sal limit 100) t]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1, 2}])
  LogicalProject(ENAME=[$0], EXPR$1=[*($2, -2)], MGR=[$1])
    LogicalSort(sort0=[$0], sort1=[$1], sort2=[$2], dir0=[ASC], dir1=[ASC], dir2=[ASC], fetch=[100])
      LogicalProject(ENAME=[$1], MGR=[$3], SAL=[$5])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSortedAggregate(group=[{0, 1, 2}])
  EnumerableSort(sort0=[$0], sort1=[$1], sort2=[$2], dir0=[ASC], dir1=[ASC], dir2=[ASC])
    EnumerableProject(ENAME=[$0], EXPR$1=[*($2, -2)], MGR=[$1])
      EnumerableLimit(fetch=[100])
        EnumerableProject(ENAME=[$1], MGR=[$3], SAL=[$5])
          EnumerableSort(sort0=[$1], sort1=[$3], sort2=[$5], dir0=[ASC], dir1=[ASC], dir2=[ASC])
            EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProjectOnRexCall">
    <Resource name="sql">
      <![CDATA[select ename, sal * -1 as sal, mgr from
sales.emp order by ename desc, sal desc, mgr desc nulls last]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], sort1=[$1], sort2=[$2], dir0=[DESC], dir1=[DESC], dir2=[DESC-nulls-last])
  LogicalProject(ENAME=[$1], SAL=[*($5, -1)], MGR=[$3])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSort(sort0=[$0], sort1=[$1], sort2=[$2], dir0=[DESC], dir1=[DESC], dir2=[DESC-nulls-last])
  EnumerableProject(ENAME=[$1], SAL=[*($5, -1)], MGR=[$3])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProjectDeriveOnRexCall">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, sal * -1 as sal, max_job from
(select ename, sal, max(job) as max_job from sales.emp group by ename, sal) t) r
join sales.bonus s on r.sal=s.sal and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], SAL=[$1], MAX_JOB=[$2], ENAME0=[$3], JOB=[$4], SAL0=[$5], COMM=[$6])
  LogicalJoin(condition=[AND(=($1, $5), =($0, $3))], joinType=[inner])
    LogicalProject(ENAME=[$0], SAL=[*($1, -1)], MAX_JOB=[$2])
      LogicalAggregate(group=[{0, 1}], MAX_JOB=[MAX($2)])
        LogicalProject(ENAME=[$1], SAL=[$5], JOB=[$2])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableMergeJoin(condition=[AND(=($1, $5), =($0, $3))], joinType=[inner])
  EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
    EnumerableProject(ENAME=[$0], SAL=[*($1, -1)], MAX_JOB=[$2])
      EnumerableSortedAggregate(group=[{1, 5}], MAX_JOB=[MAX($2)])
        EnumerableSort(sort0=[$1], sort1=[$5], dir0=[ASC], dir1=[ASC])
          EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableSort(sort0=[$2], sort1=[$0], dir0=[ASC], dir1=[ASC])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProjectWhenCastLeadingToMonotonic">
    <Resource name="sql">
      <![CDATA[select deptno from sales.emp order by cast(deptno as float) desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$1], dir0=[DESC])
  LogicalProject(DEPTNO=[$7], EXPR$1=[CAST($7):FLOAT NOT NULL])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(DEPTNO=[$7], EXPR$1=[CAST($7):FLOAT NOT NULL])
  EnumerableSort(sort0=[$7], dir0=[DESC])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProjectWhenCastLeadingToNonMonotonic">
    <Resource name="sql">
      <![CDATA[select deptno from sales.emp order by cast(deptno as varchar) desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$1], dir0=[DESC])
  LogicalProject(DEPTNO=[$7], EXPR$1=[CAST($7):VARCHAR NOT NULL])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSort(sort0=[$1], dir0=[DESC])
  EnumerableProject(DEPTNO=[$7], EXPR$1=[CAST($7):VARCHAR NOT NULL])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProjectDeriveWhenCastLeadingToNonMonotonic">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, cast(job as numeric) as job, max_sal + 1 from
(select ename, job, max(sal) as max_sal from sales.emp group by ename, job) t) r
join sales.bonus s on r.job=s.job and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], JOB=[$1], EXPR$2=[$2], ENAME0=[$4], JOB0=[$5], SAL=[$6], COMM=[$7])
  LogicalJoin(condition=[AND(=($3, $8), =($0, $4))], joinType=[inner])
    LogicalProject(ENAME=[$0], JOB=[CAST($1):DECIMAL(19, 0) NOT NULL], EXPR$2=[+($2, 1)], JOB0=[CAST(CAST($1):DECIMAL(19, 0) NOT NULL):DECIMAL(19, 19) NOT NULL])
      LogicalAggregate(group=[{0, 1}], MAX_SAL=[MAX($2)])
        LogicalProject(ENAME=[$1], JOB=[$2], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(ENAME=[$0], JOB=[$1], SAL=[$2], COMM=[$3], JOB0=[CAST($1):DECIMAL(19, 19) NOT NULL])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(ENAME=[$0], JOB=[$1], EXPR$2=[$2], ENAME0=[$4], JOB0=[$5], SAL=[$6], COMM=[$7])
  EnumerableMergeJoin(condition=[AND(=($3, $8), =($0, $4))], joinType=[inner])
    EnumerableSort(sort0=[$3], sort1=[$0], dir0=[ASC], dir1=[ASC])
      EnumerableProject(ENAME=[$0], JOB=[CAST($1):DECIMAL(19, 0) NOT NULL], EXPR$2=[+($2, 1)], JOB0=[CAST(CAST($1):DECIMAL(19, 0) NOT NULL):DECIMAL(19, 19) NOT NULL])
        EnumerableSortedAggregate(group=[{1, 2}], MAX_SAL=[MAX($5)])
          EnumerableSort(sort0=[$1], sort1=[$2], dir0=[ASC], dir1=[ASC])
            EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
    EnumerableSort(sort0=[$4], sort1=[$0], dir0=[ASC], dir1=[ASC])
      EnumerableProject(ENAME=[$0], JOB=[$1], SAL=[$2], COMM=[$3], JOB0=[CAST($1):DECIMAL(19, 19) NOT NULL])
        EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProjectDeriveWhenCastLeadingToMonotonic">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, cast(job as varchar) as job, max_sal + 1 from
(select ename, job, max(sal) as max_sal from sales.emp group by ename, job) t) r
join sales.bonus s on r.job=s.job and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], JOB=[$1], EXPR$2=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
  LogicalJoin(condition=[AND(=($1, $7), =($0, $3))], joinType=[inner])
    LogicalProject(ENAME=[$0], JOB=[CAST($1):VARCHAR NOT NULL], EXPR$2=[+($2, 1)])
      LogicalAggregate(group=[{0, 1}], MAX_SAL=[MAX($2)])
        LogicalProject(ENAME=[$1], JOB=[$2], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(ENAME=[$0], JOB=[$1], SAL=[$2], COMM=[$3], JOB0=[CAST($1):VARCHAR NOT NULL])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(ENAME=[$0], JOB=[$1], EXPR$2=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
  EnumerableMergeJoin(condition=[AND(=($1, $7), =($0, $3))], joinType=[inner])
    EnumerableProject(ENAME=[$0], JOB=[CAST($1):VARCHAR NOT NULL], EXPR$2=[+($2, 1)])
      EnumerableSortedAggregate(group=[{1, 2}], MAX_SAL=[MAX($5)])
        EnumerableSort(sort0=[$2], sort1=[$1], dir0=[ASC], dir1=[ASC])
          EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
    EnumerableProject(ENAME=[$0], JOB=[$1], SAL=[$2], COMM=[$3], JOB0=[CAST($1):VARCHAR NOT NULL])
      EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
        EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProjectDerive3">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, cast(job as varchar) as job, sal + 1 from
(select ename, job, sal from sales.emp limit 100) t) r
join sales.bonus s on r.job=s.job and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], JOB=[$1], EXPR$2=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
  LogicalJoin(condition=[AND(=($1, $7), =($0, $3))], joinType=[inner])
    LogicalProject(ENAME=[$0], JOB=[CAST($1):VARCHAR NOT NULL], EXPR$2=[+($2, 1)])
      LogicalSort(fetch=[100])
        LogicalProject(ENAME=[$1], JOB=[$2], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(ENAME=[$0], JOB=[$1], SAL=[$2], COMM=[$3], JOB0=[CAST($1):VARCHAR NOT NULL])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(ENAME=[$0], JOB=[$1], EXPR$2=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
  EnumerableMergeJoin(condition=[AND(=($1, $7), =($0, $3))], joinType=[inner])
    EnumerableProject(ENAME=[$0], JOB=[CAST($1):VARCHAR NOT NULL], EXPR$2=[+($2, 1)])
      EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
        EnumerableLimit(fetch=[100])
          EnumerableProject(ENAME=[$1], JOB=[$2], SAL=[$5])
            EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
    EnumerableProject(ENAME=[$0], JOB=[$1], SAL=[$2], COMM=[$3], JOB0=[CAST($1):VARCHAR NOT NULL])
      EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
        EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProjectDerive4">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, cast(job as bigint) as job, sal + 1 from
(select ename, job, sal from sales.emp limit 100) t) r
join sales.bonus s on r.job=s.job and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], JOB=[$1], EXPR$2=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
  LogicalJoin(condition=[AND(=($1, $7), =($0, $3))], joinType=[inner])
    LogicalProject(ENAME=[$0], JOB=[CAST($1):BIGINT NOT NULL], EXPR$2=[+($2, 1)])
      LogicalSort(fetch=[100])
        LogicalProject(ENAME=[$1], JOB=[$2], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(ENAME=[$0], JOB=[$1], SAL=[$2], COMM=[$3], JOB0=[CAST($1):BIGINT NOT NULL])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(ENAME=[$0], JOB=[$1], EXPR$2=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
  EnumerableMergeJoin(condition=[AND(=($1, $7), =($0, $3))], joinType=[inner])
    EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
      EnumerableProject(ENAME=[$0], JOB=[CAST($1):BIGINT NOT NULL], EXPR$2=[+($2, 1)])
        EnumerableLimit(fetch=[100])
          EnumerableProject(ENAME=[$1], JOB=[$2], SAL=[$5])
            EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
    EnumerableSort(sort0=[$4], sort1=[$0], dir0=[ASC], dir1=[ASC])
      EnumerableProject(ENAME=[$0], JOB=[$1], SAL=[$2], COMM=[$3], JOB0=[CAST($1):BIGINT NOT NULL])
        EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProjectDerive5">
    <Resource name="sql">
      <![CDATA[select ename, empno*-1, job from
(select * from sales.emp order by ename, empno, job limit 10) order by ename, job]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], sort1=[$2], dir0=[ASC], dir1=[ASC])
  LogicalProject(ENAME=[$1], EXPR$1=[*($0, -1)], JOB=[$2])
    LogicalSort(sort0=[$1], sort1=[$0], sort2=[$2], dir0=[ASC], dir1=[ASC], dir2=[ASC], fetch=[10])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(ENAME=[$1], EXPR$1=[*($0, -1)], JOB=[$2])
  EnumerableSort(sort0=[$1], sort1=[$2], dir0=[ASC], dir1=[ASC])
    EnumerableLimit(fetch=[10])
      EnumerableSort(sort0=[$1], sort1=[$0], sort2=[$2], dir0=[ASC], dir1=[ASC], dir2=[ASC])
        EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProjectDerive">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, job, max_sal + 1 from
(select ename, job, max(sal) as max_sal from sales.emp group by ename, job) t) r
join sales.bonus s on r.job=s.job and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], JOB=[$1], EXPR$2=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
  LogicalJoin(condition=[AND(=($1, $4), =($0, $3))], joinType=[inner])
    LogicalProject(ENAME=[$0], JOB=[$1], EXPR$2=[+($2, 1)])
      LogicalAggregate(group=[{0, 1}], MAX_SAL=[MAX($2)])
        LogicalProject(ENAME=[$1], JOB=[$2], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableMergeJoin(condition=[AND(=($1, $4), =($0, $3))], joinType=[inner])
  EnumerableProject(ENAME=[$0], JOB=[$1], EXPR$2=[+($2, 1)])
    EnumerableSortedAggregate(group=[{1, 2}], MAX_SAL=[MAX($5)])
      EnumerableSort(sort0=[$2], sort1=[$1], dir0=[ASC], dir1=[ASC])
        EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortProjectDerive6">
    <Resource name="sql">
      <![CDATA[select comm, deptno, slacker from
(select * from sales.emp order by comm, deptno, slacker limit 10) t
order by comm, slacker]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], sort1=[$2], dir0=[ASC], dir1=[ASC])
  LogicalProject(COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalSort(sort0=[$6], sort1=[$7], sort2=[$8], dir0=[ASC], dir1=[ASC], dir2=[ASC], fetch=[10])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  EnumerableSort(sort0=[$6], sort1=[$8], dir0=[ASC], dir1=[ASC])
    EnumerableLimit(fetch=[10])
      EnumerableSort(sort0=[$6], sort1=[$7], sort2=[$8], dir0=[ASC], dir1=[ASC], dir2=[ASC])
        EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortFilter">
    <Resource name="sql">
      <![CDATA[select ename, job, mgr, max_sal from
(select ename, job, mgr, max(sal) as max_sal from sales.emp group by ename, job, mgr) as t
where max_sal > 1000
order by mgr desc, ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$2], sort1=[$0], dir0=[DESC], dir1=[ASC])
  LogicalProject(ENAME=[$0], JOB=[$1], MGR=[$2], MAX_SAL=[$3])
    LogicalFilter(condition=[>($3, 1000)])
      LogicalAggregate(group=[{0, 1, 2}], MAX_SAL=[MAX($3)])
        LogicalProject(ENAME=[$1], JOB=[$2], MGR=[$3], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableFilter(condition=[>($3, 1000)])
  EnumerableSortedAggregate(group=[{1, 2, 3}], MAX_SAL=[MAX($5)])
    EnumerableSort(sort0=[$3], sort1=[$1], sort2=[$2], dir0=[DESC], dir1=[ASC], dir2=[ASC])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortFilterDerive">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, job, max_sal from
(select ename, job, max(sal) as max_sal from sales.emp group by ename, job) t where job > 1000) r
join sales.bonus s on r.job=s.job and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], JOB=[$1], MAX_SAL=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
  LogicalJoin(condition=[AND(=($1, $4), =($0, $3))], joinType=[inner])
    LogicalProject(ENAME=[$0], JOB=[$1], MAX_SAL=[$2])
      LogicalFilter(condition=[>(CAST($1):INTEGER NOT NULL, 1000)])
        LogicalAggregate(group=[{0, 1}], MAX_SAL=[MAX($2)])
          LogicalProject(ENAME=[$1], JOB=[$2], SAL=[$5])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableMergeJoin(condition=[AND(=($1, $4), =($0, $3))], joinType=[inner])
  EnumerableSortedAggregate(group=[{1, 2}], MAX_SAL=[MAX($5)])
    EnumerableSort(sort0=[$2], sort1=[$1], dir0=[ASC], dir1=[ASC])
      EnumerableFilter(condition=[>(CAST($2):INTEGER NOT NULL, 1000)])
        EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortAggPartialKey">
    <Resource name="sql">
      <![CDATA[select mgr,deptno,comm,count(*) from sales.emp
group by mgr,deptno,comm
order by comm desc nulls last, deptno nulls first]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$2], sort1=[$1], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first])
  LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()])
    LogicalProject(MGR=[$3], DEPTNO=[$7], COMM=[$6])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(MGR=[$0], DEPTNO=[$2], COMM=[$1], EXPR$3=[$3])
  EnumerableSortedAggregate(group=[{3, 6, 7}], EXPR$3=[COUNT()])
    EnumerableSort(sort0=[$6], sort1=[$7], sort2=[$3], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first], dir2=[ASC])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortMergeJoin">
    <Resource name="sql">
      <![CDATA[select * from
sales.emp r join sales.bonus s on r.ename=s.ename and r.job=s.job
order by r.job desc nulls last, r.ename nulls first]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$2], sort1=[$1], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], ENAME0=[$9], JOB0=[$10], SAL0=[$11], COMM0=[$12])
    LogicalJoin(condition=[AND(=($1, $9), =($2, $10))], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableMergeJoin(condition=[AND(=($1, $9), =($2, $10))], joinType=[inner])
  EnumerableSort(sort0=[$2], sort1=[$1], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableSort(sort0=[$1], sort1=[$0], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortMergeJoinRight">
    <Resource name="sql">
      <![CDATA[select * from
sales.emp r join sales.bonus s on r.ename=s.ename and r.job=s.job
order by s.job desc nulls last, s.ename nulls first]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$10], sort1=[$9], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], ENAME0=[$9], JOB0=[$10], SAL0=[$11], COMM0=[$12])
    LogicalJoin(condition=[AND(=($1, $9), =($2, $10))], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableMergeJoin(condition=[AND(=($1, $9), =($2, $10))], joinType=[inner])
  EnumerableSort(sort0=[$2], sort1=[$1], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableSort(sort0=[$1], sort1=[$0], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMergeJoinDeriveLeft1">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, job, max(sal) from sales.emp group by ename, job) r
join sales.bonus s on r.job=s.job and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], JOB=[$1], EXPR$2=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
  LogicalJoin(condition=[AND(=($1, $4), =($0, $3))], joinType=[inner])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[MAX($2)])
      LogicalProject(ENAME=[$1], JOB=[$2], SAL=[$5])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableMergeJoin(condition=[AND(=($1, $4), =($0, $3))], joinType=[inner])
  EnumerableSortedAggregate(group=[{1, 2}], EXPR$2=[MAX($5)])
    EnumerableSort(sort0=[$2], sort1=[$1], dir0=[ASC], dir1=[ASC])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMergeJoinDeriveLeft2">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, job, mgr, max(sal) from sales.emp group by ename, job, mgr) r
join sales.bonus s on r.job=s.job and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], JOB=[$1], MGR=[$2], EXPR$3=[$3], ENAME0=[$4], JOB0=[$5], SAL=[$6], COMM=[$7])
  LogicalJoin(condition=[AND(=($1, $5), =($0, $4))], joinType=[inner])
    LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[MAX($3)])
      LogicalProject(ENAME=[$1], JOB=[$2], MGR=[$3], SAL=[$5])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableMergeJoin(condition=[AND(=($1, $5), =($0, $4))], joinType=[inner])
  EnumerableSortedAggregate(group=[{1, 2, 3}], EXPR$3=[MAX($5)])
    EnumerableSort(sort0=[$2], sort1=[$1], sort2=[$3], dir0=[ASC], dir1=[ASC], dir2=[ASC])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMergeJoinDeriveRight1">
    <Resource name="sql">
      <![CDATA[select * from sales.bonus s join
(select ename, job, max(sal) from sales.emp group by ename, job) r
on r.job=s.job and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], JOB=[$1], SAL=[$2], COMM=[$3], ENAME0=[$4], JOB0=[$5], EXPR$2=[$6])
  LogicalJoin(condition=[AND(=($5, $1), =($4, $0))], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[MAX($2)])
      LogicalProject(ENAME=[$1], JOB=[$2], SAL=[$5])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableMergeJoin(condition=[AND(=($1, $5), =($0, $4))], joinType=[inner])
  EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
  EnumerableSortedAggregate(group=[{1, 2}], EXPR$2=[MAX($5)])
    EnumerableSort(sort0=[$2], sort1=[$1], dir0=[ASC], dir1=[ASC])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMergeJoinDeriveRight2">
    <Resource name="sql">
      <![CDATA[select * from sales.bonus s join
(select ename, job, mgr, max(sal) from sales.emp group by ename, job, mgr) r
on r.job=s.job and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], JOB=[$1], SAL=[$2], COMM=[$3], ENAME0=[$4], JOB0=[$5], MGR=[$6], EXPR$3=[$7])
  LogicalJoin(condition=[AND(=($5, $1), =($4, $0))], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
    LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[MAX($3)])
      LogicalProject(ENAME=[$1], JOB=[$2], MGR=[$3], SAL=[$5])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableMergeJoin(condition=[AND(=($1, $5), =($0, $4))], joinType=[inner])
  EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
  EnumerableSortedAggregate(group=[{1, 2, 3}], EXPR$3=[MAX($5)])
    EnumerableSort(sort0=[$2], sort1=[$1], sort2=[$3], dir0=[ASC], dir1=[ASC], dir2=[ASC])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testHashJoinFullOuterJoinNotPushDownSort">
    <Resource name="sql">
      <![CDATA[select * from
sales.emp r full outer join sales.bonus s on r.ename=s.ename and r.job=s.job
order by r.job desc nulls last, r.ename nulls first]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$2], sort1=[$1], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], ENAME0=[$9], JOB0=[$10], SAL0=[$11], COMM0=[$12])
    LogicalJoin(condition=[AND(=($1, $9), =($2, $10))], joinType=[full])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSort(sort0=[$2], sort1=[$1], dir0=[DESC-nulls-last], dir1=[ASC-nulls-first])
  EnumerableHashJoin(condition=[AND(=($1, $9), =($2, $10))], joinType=[full])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testHashJoinLeftOuterJoinPushDownSort">
    <Resource name="sql">
      <![CDATA[select * from
(select contactno, email from customer.contact_peek) r left outer join
(select acctno, type from customer.account) s
on r.contactno=s.acctno and r.email=s.type
order by r.contactno desc, r.email desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], sort1=[$1], dir0=[DESC], dir1=[DESC])
  LogicalProject(CONTACTNO=[$0], EMAIL=[$1], ACCTNO=[$2], TYPE=[$3])
    LogicalJoin(condition=[AND(=($0, $2), =($1, $3))], joinType=[left])
      LogicalProject(CONTACTNO=[$0], EMAIL=[$3])
        LogicalTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
      LogicalProject(ACCTNO=[$0], TYPE=[$1])
        LogicalTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableHashJoin(condition=[AND(=($0, $2), =($1, $3))], joinType=[left])
  EnumerableProject(CONTACTNO=[$0], EMAIL=[$3])
    EnumerableSort(sort0=[$0], sort1=[$3], dir0=[DESC], dir1=[DESC])
      EnumerableTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
  EnumerableProject(ACCTNO=[$0], TYPE=[$1])
    EnumerableTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testHashJoinLeftOuterJoinPushDownSort2">
    <Resource name="sql">
      <![CDATA[select * from
customer.contact_peek r left outer join
customer.account s
on r.contactno=s.acctno and r.email=s.type
order by r.fname desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4], Y=[$5], unit=[$6], COORD_NE=[ROW($7, ROW($8, $9))], ACCTNO=[$10], TYPE=[$11], BALANCE=[$12])
  LogicalSort(sort0=[$1], dir0=[DESC])
    LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4], Y=[$5], unit=[$6], COORD_NE=[$7], COORD_NE8=[$8], COORD_NE9=[$9], ACCTNO=[$10], TYPE=[$11], BALANCE=[$12])
      LogicalJoin(condition=[AND(=($0, $10), =($3, $11))], joinType=[left])
        LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4.X], Y=[$4.Y], unit=[$4.unit], M=[$5.M], A=[$5.SUB.A], B=[$5.SUB.B])
          LogicalTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
        LogicalTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4], Y=[$5], unit=[$6], COORD_NE=[ROW($7, ROW($8, $9))], ACCTNO=[$10], TYPE=[$11], BALANCE=[$12])
  EnumerableHashJoin(condition=[AND(=($0, $10), =($3, $11))], joinType=[left])
    EnumerableProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4.X], Y=[$4.Y], unit=[$4.unit], M=[$5.M], A=[$5.SUB.A], B=[$5.SUB.B])
      EnumerableSort(sort0=[$1], dir0=[DESC])
        EnumerableTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
    EnumerableTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testHashJoinInnerJoinPushDownSort">
    <Resource name="sql">
      <![CDATA[select * from
(select contactno, email from customer.contact_peek) r inner join
(select acctno, type from customer.account) s
on r.contactno=s.acctno and r.email=s.type
order by r.contactno desc, r.email desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], sort1=[$1], dir0=[DESC], dir1=[DESC])
  LogicalProject(CONTACTNO=[$0], EMAIL=[$1], ACCTNO=[$2], TYPE=[$3])
    LogicalJoin(condition=[AND(=($0, $2), =($1, $3))], joinType=[inner])
      LogicalProject(CONTACTNO=[$0], EMAIL=[$3])
        LogicalTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
      LogicalProject(ACCTNO=[$0], TYPE=[$1])
        LogicalTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableHashJoin(condition=[AND(=($0, $2), =($1, $3))], joinType=[inner])
  EnumerableProject(CONTACTNO=[$0], EMAIL=[$3])
    EnumerableSort(sort0=[$0], sort1=[$3], dir0=[DESC], dir1=[DESC])
      EnumerableTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
  EnumerableProject(ACCTNO=[$0], TYPE=[$1])
    EnumerableTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testHashJoinRightOuterJoinPushDownSort">
    <Resource name="sql">
      <![CDATA[select * from
(select contactno, email from customer.contact_peek) r right outer join
(select acctno, type from customer.account) s
on r.contactno=s.acctno and r.email=s.type
order by s.acctno desc, s.type desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$2], sort1=[$3], dir0=[DESC], dir1=[DESC])
  LogicalProject(CONTACTNO=[$0], EMAIL=[$1], ACCTNO=[$2], TYPE=[$3])
    LogicalJoin(condition=[AND(=($0, $2), =($1, $3))], joinType=[right])
      LogicalProject(CONTACTNO=[$0], EMAIL=[$3])
        LogicalTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
      LogicalProject(ACCTNO=[$0], TYPE=[$1])
        LogicalTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSort(sort0=[$2], sort1=[$3], dir0=[DESC], dir1=[DESC])
  EnumerableHashJoin(condition=[AND(=($0, $2), =($1, $3))], joinType=[right])
    EnumerableProject(CONTACTNO=[$0], EMAIL=[$3])
      EnumerableTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
    EnumerableProject(ACCTNO=[$0], TYPE=[$1])
      EnumerableTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testHashJoinTraitDerivation">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, job, mgr from sales.emp order by ename desc, job desc, mgr limit 10) r
join sales.bonus s on r.ename=s.ename and r.job=s.job
order by r.ename desc, r.job desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], sort1=[$1], dir0=[DESC], dir1=[DESC])
  LogicalProject(ENAME=[$0], JOB=[$1], MGR=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
    LogicalJoin(condition=[AND(=($0, $3), =($1, $4))], joinType=[inner])
      LogicalSort(sort0=[$0], sort1=[$1], sort2=[$2], dir0=[DESC], dir1=[DESC], dir2=[ASC], fetch=[10])
        LogicalProject(ENAME=[$1], JOB=[$2], MGR=[$3])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableHashJoin(condition=[AND(=($0, $3), =($1, $4))], joinType=[inner])
  EnumerableLimit(fetch=[10])
    EnumerableProject(ENAME=[$1], JOB=[$2], MGR=[$3])
      EnumerableSort(sort0=[$1], sort1=[$2], sort2=[$3], dir0=[DESC], dir1=[DESC], dir2=[ASC])
        EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testHashJoinTraitDerivation2">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, job, mgr from sales.emp order by mgr desc limit 10) r
join sales.bonus s on r.ename=s.ename and r.job=s.job
order by r.mgr desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$2], dir0=[DESC])
  LogicalProject(ENAME=[$0], JOB=[$1], MGR=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
    LogicalJoin(condition=[AND(=($0, $3), =($1, $4))], joinType=[inner])
      LogicalSort(sort0=[$2], dir0=[DESC], fetch=[10])
        LogicalProject(ENAME=[$1], JOB=[$2], MGR=[$3])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableHashJoin(condition=[AND(=($0, $3), =($1, $4))], joinType=[inner])
  EnumerableLimit(fetch=[10])
    EnumerableProject(ENAME=[$1], JOB=[$2], MGR=[$3])
      EnumerableSort(sort0=[$3], dir0=[DESC])
        EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testHashJoinTraitDerivationNegativeCase">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, job, mgr from sales.emp order by mgr desc limit 10) r
join sales.bonus s on r.ename=s.ename and r.job=s.job
order by r.mgr]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$2], dir0=[ASC])
  LogicalProject(ENAME=[$0], JOB=[$1], MGR=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
    LogicalJoin(condition=[AND(=($0, $3), =($1, $4))], joinType=[inner])
      LogicalSort(sort0=[$2], dir0=[DESC], fetch=[10])
        LogicalProject(ENAME=[$1], JOB=[$2], MGR=[$3])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSort(sort0=[$2], dir0=[ASC])
  EnumerableHashJoin(condition=[AND(=($0, $3), =($1, $4))], joinType=[inner])
    EnumerableLimit(fetch=[10])
      EnumerableProject(ENAME=[$1], JOB=[$2], MGR=[$3])
        EnumerableSort(sort0=[$3], dir0=[DESC])
          EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNestedLoopJoinTraitDerivation">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, job, mgr from sales.emp order by ename desc, job desc, mgr limit 10) r
join sales.bonus s on r.ename>s.ename and r.job<s.job
order by r.ename desc, r.job desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], sort1=[$1], dir0=[DESC], dir1=[DESC])
  LogicalProject(ENAME=[$0], JOB=[$1], MGR=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
    LogicalJoin(condition=[AND(>($0, $3), <($1, $4))], joinType=[inner])
      LogicalSort(sort0=[$0], sort1=[$1], sort2=[$2], dir0=[DESC], dir1=[DESC], dir2=[ASC], fetch=[10])
        LogicalProject(ENAME=[$1], JOB=[$2], MGR=[$3])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableNestedLoopJoin(condition=[AND(>($0, $3), <($1, $4))], joinType=[inner])
  EnumerableLimit(fetch=[10])
    EnumerableProject(ENAME=[$1], JOB=[$2], MGR=[$3])
      EnumerableSort(sort0=[$1], sort1=[$2], sort2=[$3], dir0=[DESC], dir1=[DESC], dir2=[ASC])
        EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNestedLoopJoinTraitDerivation2">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, job, mgr from sales.emp order by mgr limit 10) r
join sales.bonus s on r.ename>s.ename and r.job<s.job
order by r.mgr]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$2], dir0=[ASC])
  LogicalProject(ENAME=[$0], JOB=[$1], MGR=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
    LogicalJoin(condition=[AND(>($0, $3), <($1, $4))], joinType=[inner])
      LogicalSort(sort0=[$2], dir0=[ASC], fetch=[10])
        LogicalProject(ENAME=[$1], JOB=[$2], MGR=[$3])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableNestedLoopJoin(condition=[AND(>($0, $3), <($1, $4))], joinType=[inner])
  EnumerableLimit(fetch=[10])
    EnumerableProject(ENAME=[$1], JOB=[$2], MGR=[$3])
      EnumerableSort(sort0=[$3], dir0=[ASC])
        EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNestedLoopJoinTraitDerivationNegativeCase">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, job, mgr from sales.emp order by mgr limit 10) r
join sales.bonus s on r.ename>s.ename and r.job<s.job
order by r.mgr desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$2], dir0=[DESC])
  LogicalProject(ENAME=[$0], JOB=[$1], MGR=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
    LogicalJoin(condition=[AND(>($0, $3), <($1, $4))], joinType=[inner])
      LogicalSort(sort0=[$2], dir0=[ASC], fetch=[10])
        LogicalProject(ENAME=[$1], JOB=[$2], MGR=[$3])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSort(sort0=[$2], dir0=[DESC])
  EnumerableNestedLoopJoin(condition=[AND(>($0, $3), <($1, $4))], joinType=[inner])
    EnumerableLimit(fetch=[10])
      EnumerableProject(ENAME=[$1], JOB=[$2], MGR=[$3])
        EnumerableSort(sort0=[$3], dir0=[ASC])
          EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNestedLoopJoinLeftOuterJoinPushDownSort">
    <Resource name="sql">
      <![CDATA[select * from
 customer.contact_peek r left outer join
customer.account s
on r.contactno>s.acctno and r.email<s.type
order by r.contactno desc, r.email desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4], Y=[$5], unit=[$6], COORD_NE=[ROW($7, ROW($8, $9))], ACCTNO=[$10], TYPE=[$11], BALANCE=[$12])
  LogicalSort(sort0=[$0], sort1=[$3], dir0=[DESC], dir1=[DESC])
    LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4], Y=[$5], unit=[$6], COORD_NE=[$7], COORD_NE8=[$8], COORD_NE9=[$9], ACCTNO=[$10], TYPE=[$11], BALANCE=[$12])
      LogicalJoin(condition=[AND(>($0, $10), <($3, $11))], joinType=[left])
        LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4.X], Y=[$4.Y], unit=[$4.unit], M=[$5.M], A=[$5.SUB.A], B=[$5.SUB.B])
          LogicalTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
        LogicalTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4], Y=[$5], unit=[$6], COORD_NE=[ROW($7, ROW($8, $9))], ACCTNO=[$10], TYPE=[$11], BALANCE=[$12])
  EnumerableNestedLoopJoin(condition=[AND(>($0, $10), <($3, $11))], joinType=[left])
    EnumerableProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4.X], Y=[$4.Y], unit=[$4.unit], M=[$5.M], A=[$5.SUB.A], B=[$5.SUB.B])
      EnumerableSort(sort0=[$0], sort1=[$3], dir0=[DESC], dir1=[DESC])
        EnumerableTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
    EnumerableTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNestedLoopJoinLeftOuterJoinPushDownSort2">
    <Resource name="sql">
      <![CDATA[select * from
 customer.contact_peek r left outer join
customer.account s
on r.contactno>s.acctno and r.email<s.type
order by r.fname desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4], Y=[$5], unit=[$6], COORD_NE=[ROW($7, ROW($8, $9))], ACCTNO=[$10], TYPE=[$11], BALANCE=[$12])
  LogicalSort(sort0=[$1], dir0=[DESC])
    LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4], Y=[$5], unit=[$6], COORD_NE=[$7], COORD_NE8=[$8], COORD_NE9=[$9], ACCTNO=[$10], TYPE=[$11], BALANCE=[$12])
      LogicalJoin(condition=[AND(>($0, $10), <($3, $11))], joinType=[left])
        LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4.X], Y=[$4.Y], unit=[$4.unit], M=[$5.M], A=[$5.SUB.A], B=[$5.SUB.B])
          LogicalTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
        LogicalTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4], Y=[$5], unit=[$6], COORD_NE=[ROW($7, ROW($8, $9))], ACCTNO=[$10], TYPE=[$11], BALANCE=[$12])
  EnumerableNestedLoopJoin(condition=[AND(>($0, $10), <($3, $11))], joinType=[left])
    EnumerableProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4.X], Y=[$4.Y], unit=[$4.unit], M=[$5.M], A=[$5.SUB.A], B=[$5.SUB.B])
      EnumerableSort(sort0=[$1], dir0=[DESC])
        EnumerableTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
    EnumerableTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNestedLoopJoinLeftOuterJoinSortKeyOnRightInput">
    <Resource name="sql">
      <![CDATA[select * from
 customer.contact_peek r left outer join
customer.account s
on r.contactno>s.acctno and r.email<s.type
order by s.acctno desc, s.type desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4], Y=[$5], unit=[$6], COORD_NE=[ROW($7, ROW($8, $9))], ACCTNO=[$10], TYPE=[$11], BALANCE=[$12])
  LogicalSort(sort0=[$10], sort1=[$11], dir0=[DESC], dir1=[DESC])
    LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4], Y=[$5], unit=[$6], COORD_NE=[$7], COORD_NE8=[$8], COORD_NE9=[$9], ACCTNO=[$10], TYPE=[$11], BALANCE=[$12])
      LogicalJoin(condition=[AND(>($0, $10), <($3, $11))], joinType=[left])
        LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4.X], Y=[$4.Y], unit=[$4.unit], M=[$5.M], A=[$5.SUB.A], B=[$5.SUB.B])
          LogicalTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
        LogicalTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4], Y=[$5], unit=[$6], COORD_NE=[ROW($7, ROW($8, $9))], ACCTNO=[$10], TYPE=[$11], BALANCE=[$12])
  EnumerableSort(sort0=[$10], sort1=[$11], dir0=[DESC], dir1=[DESC])
    EnumerableNestedLoopJoin(condition=[AND(>($0, $10), <($3, $11))], joinType=[left])
      EnumerableProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4.X], Y=[$4.Y], unit=[$4.unit], M=[$5.M], A=[$5.SUB.A], B=[$5.SUB.B])
        EnumerableTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
      EnumerableTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNestedLoopJoinRightOuterJoinSortPushDown">
    <Resource name="sql">
      <![CDATA[select r.contactno, r.email, s.acctno, s.type from
 customer.contact_peek r right outer join
customer.account s
on r.contactno>s.acctno and r.email<s.type
order by s.acctno desc, s.type desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$2], sort1=[$3], dir0=[DESC], dir1=[DESC])
  LogicalProject(CONTACTNO=[$0], EMAIL=[$3], ACCTNO=[$10], TYPE=[$11])
    LogicalJoin(condition=[AND(>($0, $10), <($3, $11))], joinType=[right])
      LogicalProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4.X], Y=[$4.Y], unit=[$4.unit], M=[$5.M], A=[$5.SUB.A], B=[$5.SUB.B])
        LogicalTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
      LogicalTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(CONTACTNO=[$0], EMAIL=[$3], ACCTNO=[$10], TYPE=[$11])
  EnumerableSort(sort0=[$10], sort1=[$11], dir0=[DESC], dir1=[DESC])
    EnumerableNestedLoopJoin(condition=[AND(>($0, $10), <($3, $11))], joinType=[right])
      EnumerableProject(CONTACTNO=[$0], FNAME=[$1], LNAME=[$2], EMAIL=[$3], X=[$4.X], Y=[$4.Y], unit=[$4.unit], M=[$5.M], A=[$5.SUB.A], B=[$5.SUB.B])
        EnumerableTableScan(table=[[CATALOG, CUSTOMER, CONTACT_PEEK]])
      EnumerableTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCorrelateInnerJoinDeriveLeft">
    <Resource name="sql">
      <![CDATA[select * from emp e
join dept d on e.deptno=d.deptno
order by e.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$1], dir0=[ASC])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], NAME=[$10])
    LogicalJoin(condition=[=($7, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
  EnumerableSort(sort0=[$1], dir0=[ASC])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableFilter(condition=[=($cor0.DEPTNO, $0)])
    EnumerableTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCorrelateInnerJoinNoDerive">
    <Resource name="sql">
      <![CDATA[select * from emp e
join dept d on e.deptno=d.deptno
order by e.ename, d.name]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$1], sort1=[$10], dir0=[ASC], dir1=[ASC])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], NAME=[$10])
    LogicalJoin(condition=[=($7, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSort(sort0=[$1], sort1=[$10], dir0=[ASC], dir1=[ASC])
  EnumerableCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
    EnumerableFilter(condition=[=($cor0.DEPTNO, $0)])
      EnumerableTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCorrelateLeftJoinDeriveLeft">
    <Resource name="sql">
      <![CDATA[select * from emp e
left join dept d on e.deptno=d.deptno
order by e.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$1], dir0=[ASC])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], NAME=[$10])
    LogicalJoin(condition=[=($7, $9)], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
  EnumerableSort(sort0=[$1], dir0=[ASC])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableFilter(condition=[=($cor0.DEPTNO, $0)])
    EnumerableTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCorrelateLeftJoinNoDerive">
    <Resource name="sql">
      <![CDATA[select * from emp e
left join dept d on e.deptno=d.deptno
order by e.ename, d.name]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$1], sort1=[$10], dir0=[ASC], dir1=[ASC])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], NAME=[$10])
    LogicalJoin(condition=[=($7, $9)], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSort(sort0=[$1], sort1=[$10], dir0=[ASC], dir1=[ASC])
  EnumerableCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
    EnumerableFilter(condition=[=($cor0.DEPTNO, $0)])
      EnumerableTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCorrelateSemiJoinDeriveLeft">
    <Resource name="sql">
      <![CDATA[select * from dept d
where exists (select 1 from emp e where e.deptno=d.deptno)
order by d.name]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$1], dir0=[ASC])
  LogicalProject(DEPTNO=[$0], NAME=[$1])
    LogicalProject(DEPTNO=[$0], NAME=[$1], DEPTNO0=[CAST($2):INTEGER], $f1=[CAST($3):BOOLEAN])
      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalAggregate(group=[{0}], agg#0=[MIN($1)])
          LogicalProject(DEPTNO=[$7], $f0=[true])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableCorrelate(correlation=[$cor2], joinType=[semi], requiredColumns=[{0}])
  EnumerableSort(sort0=[$1], dir0=[ASC])
    EnumerableTableScan(table=[[CATALOG, SALES, DEPT]])
  EnumerableFilter(condition=[=($cor2.DEPTNO, $0)])
    EnumerableProject(DEPTNO=[$7], $f0=[true])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testValuesTraitRequest">
    <Resource name="sql">
      <![CDATA[SELECT * from (values (1, 1), (2, 1), (1, 2), (2, 2))
as t(a, b) order by b, a]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
  LogicalProject(A=[$0], B=[$1])
    LogicalValues(tuples=[[{ 1, 1 }, { 2, 1 }, { 1, 2 }, { 2, 2 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableValues(tuples=[[{ 1, 1 }, { 2, 1 }, { 1, 2 }, { 2, 2 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testValuesTraitRequestNeg">
    <Resource name="sql">
      <![CDATA[SELECT * from (values (1, 1), (2, 1), (3, 2), (2, 2))
as t(a, b) order by b, a]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
  LogicalProject(A=[$0], B=[$1])
    LogicalValues(tuples=[[{ 1, 1 }, { 2, 1 }, { 3, 2 }, { 2, 2 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
  EnumerableValues(tuples=[[{ 1, 1 }, { 2, 1 }, { 3, 2 }, { 2, 2 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortCalc">
    <Resource name="sql">
      <![CDATA[select mgr from sales.emp order by mgr desc nulls last]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[DESC-nulls-last])
  LogicalProject(MGR=[$3])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableCalc(expr#0..8=[{inputs}], MGR=[$t3])
  EnumerableSort(sort0=[$3], dir0=[DESC-nulls-last])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortCalcDerive1">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, job, max_sal + 1 from
(select ename, job, max(sal) as max_sal from sales.emp group by ename, job) t) r
join sales.bonus s on r.job=s.job and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], JOB=[$1], EXPR$2=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
  LogicalJoin(condition=[AND(=($1, $4), =($0, $3))], joinType=[inner])
    LogicalProject(ENAME=[$0], JOB=[$1], EXPR$2=[+($2, 1)])
      LogicalAggregate(group=[{0, 1}], MAX_SAL=[MAX($2)])
        LogicalProject(ENAME=[$1], JOB=[$2], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableMergeJoin(condition=[AND(=($1, $4), =($0, $3))], joinType=[inner])
  EnumerableCalc(expr#0..2=[{inputs}], expr#3=[1], expr#4=[+($t2, $t3)], proj#0..1=[{exprs}], EXPR$2=[$t4])
    EnumerableSortedAggregate(group=[{1, 2}], MAX_SAL=[MAX($5)])
      EnumerableSort(sort0=[$2], sort1=[$1], dir0=[ASC], dir1=[ASC])
        EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortCalcDerive2">
    <Resource name="sql">
      <![CDATA[select distinct ename, sal*-2, mgr
from (select ename, mgr, sal from sales.emp order by ename, mgr, sal limit 100) t]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1, 2}])
  LogicalProject(ENAME=[$0], EXPR$1=[*($2, -2)], MGR=[$1])
    LogicalSort(sort0=[$0], sort1=[$1], sort2=[$2], dir0=[ASC], dir1=[ASC], dir2=[ASC], fetch=[100])
      LogicalProject(ENAME=[$1], MGR=[$3], SAL=[$5])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSortedAggregate(group=[{0, 1, 2}])
  EnumerableSort(sort0=[$0], sort1=[$1], sort2=[$2], dir0=[ASC], dir1=[ASC], dir2=[ASC])
    EnumerableCalc(expr#0..2=[{inputs}], expr#3=[-2], expr#4=[*($t2, $t3)], ENAME=[$t0], EXPR$1=[$t4], MGR=[$t1])
      EnumerableLimit(fetch=[100])
        EnumerableCalc(expr#0..8=[{inputs}], ENAME=[$t1], MGR=[$t3], SAL=[$t5])
          EnumerableSort(sort0=[$1], sort1=[$3], sort2=[$5], dir0=[ASC], dir1=[ASC], dir2=[ASC])
            EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortCalcDerive3">
    <Resource name="sql">
      <![CDATA[select * from
(select ename, cast(job as varchar) as job, sal + 1 from
(select ename, job, sal from sales.emp limit 100) t) r
join sales.bonus s on r.job=s.job and r.ename=s.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], JOB=[$1], EXPR$2=[$2], ENAME0=[$3], JOB0=[$4], SAL=[$5], COMM=[$6])
  LogicalJoin(condition=[AND(=($1, $7), =($0, $3))], joinType=[inner])
    LogicalProject(ENAME=[$0], JOB=[CAST($1):VARCHAR NOT NULL], EXPR$2=[+($2, 1)])
      LogicalSort(fetch=[100])
        LogicalProject(ENAME=[$1], JOB=[$2], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(ENAME=[$0], JOB=[$1], SAL=[$2], COMM=[$3], JOB0=[CAST($1):VARCHAR NOT NULL])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableCalc(expr#0..7=[{inputs}], proj#0..6=[{exprs}])
  EnumerableMergeJoin(condition=[AND(=($1, $7), =($0, $3))], joinType=[inner])
    EnumerableCalc(expr#0..2=[{inputs}], expr#3=[CAST($t1):VARCHAR NOT NULL], expr#4=[1], expr#5=[+($t2, $t4)], ENAME=[$t0], JOB=[$t3], EXPR$2=[$t5])
      EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
        EnumerableLimit(fetch=[100])
          EnumerableCalc(expr#0..8=[{inputs}], ENAME=[$t1], JOB=[$t2], SAL=[$t5])
            EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
    EnumerableCalc(expr#0..3=[{inputs}], expr#4=[CAST($t1):VARCHAR NOT NULL], proj#0..4=[{exprs}])
      EnumerableSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
        EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortCalcOnRexCall">
    <Resource name="sql">
      <![CDATA[select ename, sal * -1 as sal, mgr from
sales.emp order by ename desc, sal desc, mgr desc nulls last]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], sort1=[$1], sort2=[$2], dir0=[DESC], dir1=[DESC], dir2=[DESC-nulls-last])
  LogicalProject(ENAME=[$1], SAL=[*($5, -1)], MGR=[$3])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSort(sort0=[$0], sort1=[$1], sort2=[$2], dir0=[DESC], dir1=[DESC], dir2=[DESC-nulls-last])
  EnumerableCalc(expr#0..8=[{inputs}], expr#9=[-1], expr#10=[*($t5, $t9)], ENAME=[$t1], SAL=[$t10], MGR=[$t3])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortCalcWhenCastLeadingToNonMonotonic">
    <Resource name="sql">
      <![CDATA[select deptno from sales.emp order by cast(deptno as varchar) desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$1], dir0=[DESC])
  LogicalProject(DEPTNO=[$7], EXPR$1=[CAST($7):VARCHAR NOT NULL])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSort(sort0=[$1], dir0=[DESC])
  EnumerableCalc(expr#0..8=[{inputs}], expr#9=[CAST($t7):VARCHAR NOT NULL], DEPTNO=[$t7], EXPR$1=[$t9])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortCalcWhenCastLeadingToMonotonic">
    <Resource name="sql">
      <![CDATA[select cast(deptno as float) from sales.emp order by deptno desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$1], dir0=[DESC])
  LogicalProject(EXPR$0=[CAST($7):FLOAT NOT NULL], DEPTNO=[$7])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableCalc(expr#0..8=[{inputs}], expr#9=[CAST($t7):FLOAT NOT NULL], EXPR$0=[$t9], DEPTNO=[$t7])
  EnumerableSort(sort0=[$7], dir0=[DESC])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortCalcWithFilter">
    <Resource name="sql">
      <![CDATA[select ename, job, mgr, max_sal from
(select ename, job, mgr, max(sal) as max_sal from sales.emp group by ename, job, mgr) as t
where max_sal > 1000
order by mgr desc, ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$2], sort1=[$0], dir0=[DESC], dir1=[ASC])
  LogicalProject(ENAME=[$0], JOB=[$1], MGR=[$2], MAX_SAL=[$3])
    LogicalFilter(condition=[>($3, 1000)])
      LogicalAggregate(group=[{0, 1, 2}], MAX_SAL=[MAX($3)])
        LogicalProject(ENAME=[$1], JOB=[$2], MGR=[$3], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableCalc(expr#0..3=[{inputs}], expr#4=[1000], expr#5=[>($t3, $t4)], proj#0..3=[{exprs}], $condition=[$t5])
  EnumerableSortedAggregate(group=[{1, 2, 3}], MAX_SAL=[MAX($5)])
    EnumerableSort(sort0=[$3], sort1=[$1], sort2=[$2], dir0=[DESC], dir1=[ASC], dir2=[ASC])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
</Root>
