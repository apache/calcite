<?xml version="1.0" ?>
<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one or more
  ~ contributor license agreements.  See the NOTICE file distributed with
  ~ this work for additional information regarding copyright ownership.
  ~ The ASF licenses this file to you under the Apache License, Version 2.0
  ~ (the "License"); you may not use this file except in compliance with
  ~ the License.  You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<Root>
  <TestCase name="testAggregateCaseToFilterWithCustomNullAwareUdaf">
    <Resource name="sql">
      <![CDATA[select null_aware_sum(case when deptno > 10 then sal else null end)
from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[NULL_AWARE_SUM($0)])
  LogicalProject($f0=[CASE(>($7, 10), $5, null:INTEGER)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateConstantKeyRuleInVolcano">
    <Resource name="sql">
      <![CDATA[select count(*) as c
from sales.emp
where deptno = 10
group by deptno, sal]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(C=[$2])
  LogicalAggregate(group=[{0, 1}], C=[COUNT()])
    LogicalProject(DEPTNO=[$7], SAL=[$5])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(C=[$2])
  EnumerableProject(DEPTNO=[10], SAL=[$0], C=[$1])
    EnumerableAggregate(group=[{0}], C=[COUNT()])
      EnumerableProject(SAL=[$5])
        EnumerableFilter(condition=[=($7, 10)])
          EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateExtractProjectRule">
    <Resource name="sql">
      <![CDATA[select sum(sal)
from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($5)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0)])
  LogicalProject(SAL=[$5])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateExtractProjectRuleWithFilter">
    <Resource name="sql">
      <![CDATA[select sum(sal) filter (where empno = 40)
from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0) FILTER $1])
  LogicalProject(SAL=[$5], $f1=[=($0, 40)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateExtractProjectRuleWithGroupingSets">
    <Resource name="sql">
      <![CDATA[select empno, deptno, sum(sal)
from emp
group by grouping sets ((empno, deptno),(deptno),(empno))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 7}], groups=[[{0, 7}, {0}, {7}]], EXPR$2=[SUM($5)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0, 2}], groups=[[{0, 2}, {0}, {2}]], EXPR$2=[SUM($1)])
  LogicalProject(EMPNO=[$0], SAL=[$5], DEPTNO=[$7])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateExtractProjectRuleWithGroupingSets2">
    <Resource name="sql">
      <![CDATA[select empno, deptno, sum(empno)
from emp
group by grouping sets ((empno, deptno),(deptno),(empno))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 7}], groups=[[{0, 7}, {0}, {7}]], EXPR$2=[SUM($0)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {1}]], EXPR$2=[SUM($0)])
  LogicalProject(EMPNO=[$0], DEPTNO=[$7])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateGroupingSetsToUnionRuleGroupingGrouId">
    <Resource name="sql">
      <![CDATA[SELECT deptno, job, sal, SUM(comm),
 GROUPING(deptno) AS deptno_flag,
 GROUPING(job) AS job_flag,
 GROUPING(sal) AS sal_flag,
 GROUPING(deptno, sal) AS deptno_sal_flag,
 GROUP_ID() AS group_id
FROM emp
GROUP BY GROUPING SETS ((deptno, job),(deptno, job, sal),(deptno, sal))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], JOB=[$1], SAL=[$2], EXPR$3=[$3], DEPTNO_FLAG=[$4], JOB_FLAG=[$5], SAL_FLAG=[$6], DEPTNO_SAL_FLAG=[$7], GROUP_ID=[0:BIGINT])
  LogicalAggregate(group=[{0, 1, 2}], groups=[[{0, 1, 2}, {0, 1}, {0, 2}]], EXPR$3=[SUM($3)], DEPTNO_FLAG=[GROUPING($0)], JOB_FLAG=[GROUPING($1)], SAL_FLAG=[GROUPING($2)], DEPTNO_SAL_FLAG=[GROUPING($0, $2)])
    LogicalProject(DEPTNO=[$7], JOB=[$2], SAL=[$5], COMM=[$6])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], JOB=[$1], SAL=[$2], EXPR$3=[$3], DEPTNO_FLAG=[$4], JOB_FLAG=[$5], SAL_FLAG=[$6], DEPTNO_SAL_FLAG=[$7], GROUP_ID=[0:BIGINT])
  LogicalUnion(all=[true])
    LogicalProject(DEPTNO=[$0], JOB=[$1], SAL=[$2], EXPR$3=[$3], DEPTNO_FLAG=[0:BIGINT], JOB_FLAG=[0:BIGINT], SAL_FLAG=[0:BIGINT], DEPTNO_SAL_FLAG=[0:BIGINT])
      LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[SUM($3)])
        LogicalProject(DEPTNO=[$7], JOB=[$2], SAL=[$5], COMM=[$6])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], JOB=[$1], SAL=[null:INTEGER], EXPR$3=[$2], DEPTNO_FLAG=[0:BIGINT], JOB_FLAG=[0:BIGINT], SAL_FLAG=[1:BIGINT], DEPTNO_SAL_FLAG=[1:BIGINT])
      LogicalAggregate(group=[{0, 1}], EXPR$3=[SUM($3)])
        LogicalProject(DEPTNO=[$7], JOB=[$2], SAL=[$5], COMM=[$6])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], JOB=[null:VARCHAR(10)], SAL=[$1], EXPR$3=[$2], DEPTNO_FLAG=[0:BIGINT], JOB_FLAG=[1:BIGINT], SAL_FLAG=[0:BIGINT], DEPTNO_SAL_FLAG=[0:BIGINT])
      LogicalAggregate(group=[{0, 2}], EXPR$3=[SUM($3)])
        LogicalProject(DEPTNO=[$7], JOB=[$2], SAL=[$5], COMM=[$6])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateJoinRemove1">
    <Resource name="sql">
      <![CDATA[select distinct e.deptno from sales.emp e
left outer join sales.dept d on e.deptno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}])
  LogicalProject(DEPTNO=[$7])
    LogicalJoin(condition=[=($7, $9)], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{7}])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateJoinRemove10">
    <Resource name="sql">
      <![CDATA[SELECT e.deptno, COUNT(DISTINCT d1.dname, d2.dname)
FROM sales.emp e
LEFT JOIN sales.dept d1 ON e.deptno = d1.deptno
LEFT JOIN sales.dept d2 ON e.deptno = d2.deptno
GROUP BY e.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1, $2)])
  LogicalProject(DEPTNO=[$7], DNAME=[$10], DNAME0=[$12])
    LogicalJoin(condition=[=($7, $11)], joinType=[left])
      LogicalJoin(condition=[=($7, $9)], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{7}], EXPR$1=[COUNT(DISTINCT $10, $12)])
  LogicalJoin(condition=[=($7, $11)], joinType=[left])
    LogicalJoin(condition=[=($7, $9)], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateJoinRemove11">
    <Resource name="sql">
      <![CDATA[select e.deptno, count(distinct e.slacker)
from sales.emp e
left outer join sales.dept d on e.deptno = d.deptno
group by e.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)])
  LogicalProject(DEPTNO=[$7], SLACKER=[$8])
    LogicalJoin(condition=[=($7, $9)], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{7}], EXPR$1=[COUNT(DISTINCT $8)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateJoinRemove2">
    <Resource name="sql">
      <![CDATA[select e.deptno, count(distinct e.job)
from sales.emp e
left outer join sales.dept d on e.deptno = d.deptno
group by e.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)])
  LogicalProject(DEPTNO=[$7], JOB=[$2])
    LogicalJoin(condition=[=($7, $9)], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{7}], EXPR$1=[COUNT(DISTINCT $2)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateJoinRemove3">
    <Resource name="sql">
      <![CDATA[select e.deptno, count(distinct d.dname)
from sales.emp e
left outer join sales.dept d on e.deptno = d.deptno
group by e.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)])
  LogicalProject(DEPTNO=[$7], DNAME=[$10])
    LogicalJoin(condition=[=($7, $9)], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{7}], EXPR$1=[COUNT(DISTINCT $10)])
  LogicalJoin(condition=[=($7, $9)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateJoinRemove4">
    <Resource name="sql">
      <![CDATA[select distinct d.deptno
from sales.emp e
right outer join sales.dept d on e.deptno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}])
  LogicalProject(DEPTNO=[$9])
    LogicalJoin(condition=[=($7, $9)], joinType=[right])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateJoinRemove5">
    <Resource name="sql">
      <![CDATA[select d.deptno, count(distinct d.dname)
from sales.emp e
right outer join sales.dept d on e.deptno = d.deptno
group by d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)])
  LogicalProject(DEPTNO=[$9], DNAME=[$10])
    LogicalJoin(condition=[=($7, $9)], joinType=[right])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateJoinRemove6">
    <Resource name="sql">
      <![CDATA[select d.deptno, count(distinct e.job)
from sales.emp e
right outer join sales.dept d on e.deptno = d.deptno
group by d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)])
  LogicalProject(DEPTNO=[$9], JOB=[$2])
    LogicalJoin(condition=[=($7, $9)], joinType=[right])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{9}], EXPR$1=[COUNT(DISTINCT $2)])
  LogicalJoin(condition=[=($7, $9)], joinType=[right])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateJoinRemove7">
    <Resource name="sql">
      <![CDATA[SELECT distinct e.deptno
FROM sales.emp e
LEFT JOIN sales.dept d1 ON e.deptno = d1.deptno
LEFT JOIN sales.dept d2 ON e.deptno = d2.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}])
  LogicalProject(DEPTNO=[$7])
    LogicalJoin(condition=[=($7, $11)], joinType=[left])
      LogicalJoin(condition=[=($7, $9)], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{7}])
  LogicalJoin(condition=[=($7, $9)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateJoinRemove8">
    <Resource name="sql">
      <![CDATA[SELECT e.deptno, COUNT(DISTINCT d2.dname)
FROM sales.emp e
LEFT JOIN sales.dept d1 ON e.deptno = d1.deptno
LEFT JOIN sales.dept d2 ON e.deptno = d2.deptno
GROUP BY e.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)])
  LogicalProject(DEPTNO=[$7], DNAME0=[$12])
    LogicalJoin(condition=[=($7, $11)], joinType=[left])
      LogicalJoin(condition=[=($7, $9)], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{7}], EXPR$1=[COUNT(DISTINCT $10)])
  LogicalJoin(condition=[=($7, $9)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateJoinRemove9">
    <Resource name="sql">
      <![CDATA[SELECT distinct e.deptno, d2.dname
FROM sales.emp e
LEFT JOIN sales.dept d1 ON e.deptno = d1.deptno
LEFT JOIN sales.dept d2 ON e.deptno = d2.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}])
  LogicalProject(DEPTNO=[$7], DNAME=[$12])
    LogicalJoin(condition=[=($7, $11)], joinType=[left])
      LogicalJoin(condition=[=($7, $9)], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{7, 10}])
  LogicalJoin(condition=[=($7, $9)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateMerge1">
    <Resource name="sql">
      <![CDATA[select deptno c, min(y), max(z) z,
sum(r), sum(m) n, sum(x) sal from (
   select deptno, ename, sum(sal) x, max(sal) z,
      min(sal) y, count(hiredate) m, count(mgr) r
   from sales.emp group by deptno, ename) t
group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{1}], EXPR$1=[MIN($4)], Z=[MAX($3)], EXPR$3=[SUM($6)], N=[SUM($5)], SAL=[SUM($2)])
  LogicalAggregate(group=[{1, 7}], X=[SUM($5)], Z=[MAX($5)], Y=[MIN($5)], M=[COUNT()], R=[COUNT($3)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{7}], EXPR$1=[MIN($5)], Z=[MAX($5)], EXPR$3=[COUNT($3)], N=[COUNT()], SAL=[SUM($5)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateMerge10">
    <Resource name="sql">
      <![CDATA[SELECT min(mn), max(mx)
FROM (
    SELECT min(deptno) mn, max(deptno) mx
    FROM dept
    GROUP BY dname)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[MIN($1)], EXPR$1=[MAX($2)])
  LogicalAggregate(group=[{1}], MN=[MIN($0)], MX=[MAX($0)])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[MIN($0)], EXPR$1=[MAX($0)])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateMerge2">
    <Resource name="sql">
      <![CDATA[select deptno, empno, sum(x), sum(y)
from (
  select ename, empno, deptno, sum(sal) x, count(mgr) y
    from sales.emp
  group by deptno, ename, empno) t
group by grouping sets(deptno, empno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$1], EMPNO=[$0], EXPR$2=[$2], EXPR$3=[$3])
  LogicalAggregate(group=[{0, 2}], groups=[[{0}, {2}]], EXPR$2=[SUM($3)], EXPR$3=[SUM($4)])
    LogicalAggregate(group=[{0, 1, 7}], X=[SUM($5)], Y=[COUNT($3)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$1], EMPNO=[$0], EXPR$2=[$2], EXPR$3=[$3])
  LogicalAggregate(group=[{0, 7}], groups=[[{0}, {7}]], EXPR$2=[SUM($5)], EXPR$3=[COUNT($3)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateMerge3">
    <Resource name="sql">
      <![CDATA[select deptno, sum(x) from (
 select ename, deptno, sum(sal) x from
   sales.emp group by cube(deptno, ename)) t
group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{1}], EXPR$1=[SUM($2)])
  LogicalAggregate(group=[{1, 7}], groups=[[{1, 7}, {1}, {7}, {}]], X=[SUM($5)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateMerge4">
    <Resource name="sql">
      <![CDATA[select deptno, sum(x) from (
  select ename, deptno, count(distinct sal) x
    from sales.emp group by deptno, ename) t
group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{1}], EXPR$1=[SUM($2)])
  LogicalAggregate(group=[{1, 7}], X=[COUNT(DISTINCT $5)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateMerge5">
    <Resource name="sql">
      <![CDATA[select deptno, avg(x) from (
  select mgr, deptno, avg(sal) x from
    sales.emp group by deptno, mgr) t
group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{1}], EXPR$1=[AVG($2)])
  LogicalAggregate(group=[{3, 7}], X=[AVG($5)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateMerge6">
    <Resource name="sql">
      <![CDATA[select sum(x) from (
select mgr, deptno, count(sal) x from
sales.emp group by deptno, mgr) t]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($2)])
  LogicalAggregate(group=[{3, 7}], X=[COUNT()])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateMerge7">
    <Resource name="sql">
      <![CDATA[select mgr, deptno, sum(x) from (
  select mgr, deptno, count(sal) x from
    sales.emp group by deptno, mgr) t
group by cube(mgr, deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {1}, {}]], EXPR$2=[SUM($2)])
  LogicalAggregate(group=[{3, 7}], X=[COUNT()])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateMerge8">
    <Resource name="sql">
      <![CDATA[select sum(x) x, min(y) z from (
  select sum(sal) x, min(sal) y from sales.emp)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], X=[SUM($0)], Z=[MIN($1)])
  LogicalAggregate(group=[{}], X=[SUM($5)], Y=[MIN($5)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{}], X=[SUM($5)], Z=[MIN($5)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateMerge9">
    <Resource name="sql">
      <![CDATA[SELECT sum(deptno)
FROM (
    SELECT sum(deptno) AS deptno
    FROM dept
    GROUP BY dname)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($1)])
  LogicalAggregate(group=[{1}], DEPTNO=[SUM($0)])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0)])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateRemove1">
    <Resource name="sql">
      <![CDATA[select empno, sum(sal), min(sal), max(sal),
 bit_and(distinct sal), bit_or(sal), count(distinct sal),
 grouping(deptno)
from sales.emp
group by empno, deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[$2], EXPR$2=[$3], EXPR$3=[$4], EXPR$4=[$5], EXPR$5=[$6], EXPR$6=[$7], EXPR$7=[$8])
  LogicalAggregate(group=[{0, 1}], EXPR$1=[SUM($2)], EXPR$2=[MIN($2)], EXPR$3=[MAX($2)], EXPR$4=[BIT_AND($2)], EXPR$5=[BIT_OR($2)], EXPR$6=[COUNT(DISTINCT $2)], EXPR$7=[GROUPING($1)])
    LogicalProject(EMPNO=[$0], DEPTNO=[$7], SAL=[$5])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[$5], EXPR$2=[$5], EXPR$3=[$5], EXPR$4=[$5], EXPR$5=[$5], EXPR$6=[1:BIGINT], EXPR$7=[0:BIGINT])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateRemove2">
    <Resource name="sql">
      <![CDATA[select distinct empno, deptno from sales.emp
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}])
  LogicalProject(EMPNO=[$0], DEPTNO=[$7])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], DEPTNO=[$7])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateRemove3">
    <Resource name="sql">
      <![CDATA[select empno, count(mgr) from sales.emp group by empno, deptno
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[$2])
  LogicalAggregate(group=[{0, 1}], EXPR$1=[COUNT($2)])
    LogicalProject(EMPNO=[$0], DEPTNO=[$7], MGR=[$3])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[CASE(IS NOT NULL($3), 1:BIGINT, 0:BIGINT)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateRemove4">
    <Resource name="sql">
      <![CDATA[select empno, max(sal), avg(sal) from sales.emp group by empno, deptno
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[$2], EXPR$2=[$3])
  LogicalAggregate(group=[{0, 1}], EXPR$1=[MAX($2)], EXPR$2=[AVG($2)])
    LogicalProject(EMPNO=[$0], DEPTNO=[$7], SAL=[$5])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateRemove5">
    <Resource name="sql">
      <![CDATA[select empno, deptno, sum(sal) from sales.emp group by cube(empno, deptno)
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {1}, {}]], EXPR$2=[SUM($2)])
  LogicalProject(EMPNO=[$0], DEPTNO=[$7], SAL=[$5])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateRemove6">
    <Resource name="sql">
      <![CDATA[select deptno, max(sal) from sales.emp group by deptno
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)])
  LogicalProject(DEPTNO=[$7], SAL=[$5])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateRemove7">
    <Resource name="sql">
      <![CDATA[select mgr, sum(sum_sal)
from
(select mgr, deptno, sum(sal) sum_sal
 from sales.emp
 group by mgr, deptno)
where deptno=100
group by mgr]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
  LogicalProject(MGR=[$0], SUM_SAL=[$2])
    LogicalFilter(condition=[=($1, 100)])
      LogicalAggregate(group=[{0, 1}], SUM_SAL=[SUM($2)])
        LogicalProject(MGR=[$3], DEPTNO=[$7], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(MGR=[$0], SUM_SAL=[$2])
  LogicalFilter(condition=[=($1, 100)])
    LogicalAggregate(group=[{0, 1}], SUM_SAL=[SUM($2)])
      LogicalProject(MGR=[$3], DEPTNO=[$7], SAL=[$5])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateToSemiJoinRule">
    <Resource name="sql">
      <![CDATA[select distinct emp.deptno from emp
join (select distinct mgr from emp) d on emp.deptno = d.mgr]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{7}])
  LogicalJoin(condition=[=($7, $9)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{3}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{7}])
  LogicalJoin(condition=[=($7, $12)], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateValuesRuleWithAggregation">
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], V1_COUNT=[COUNT()])
  LogicalValues(tuples=[[{ 1, 'a' }, { 2, 'b' }, { 1, 'a' }, { 1, 'b' }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateValuesRuleWithDifferentRowTypes">
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}])
  LogicalValues(tuples=[[{ 1, 'a' }, { 2, 'b' }, { 1, 'a' }, { 1, 'b' }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateValuesRuleWithRepeatingValues">
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}])
  LogicalValues(tuples=[[{ 1 }, { 1 }, { 3 }, { null }, { null }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[{ 1 }, { 3 }, { null }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateValuesRuleWithSameRowType">
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}])
  LogicalValues(tuples=[[{ 1, 'a' }, { 2, 'b' }, { 1, 'a' }, { 1, 'b' }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[{ 1, 'a' }, { 2, 'b' }, { 1, 'b' }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAggregateWithDynamicParam">
    <Resource name="sql">
      <![CDATA[SELECT sal, COUNT(1) AS count_val
FROM emp t WHERE sal = ?
GROUP BY sal HAVING sal < 1000]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalFilter(condition=[<($0, 1000)])
  LogicalAggregate(group=[{0}], COUNT_VAL=[COUNT()])
    LogicalProject(SAL=[$5], $f1=[1])
      LogicalFilter(condition=[=($5, ?0)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAll">
    <Resource name="sql">
      <![CDATA[select * from emp e1
  where e1.empno > ALL (select deptno from dept)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[NOT(<= SOME($0, {
LogicalProject(DEPTNO=[$0])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
}))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[NOT(CAST(OR(AND(IS TRUE(<=($0, $9)), <>($10, 0)), AND(>($10, $11), null, <>($10, 0), IS NOT TRUE(<=($0, $9))), AND(<=($0, $9), <>($10, 0), IS NOT TRUE(<=($0, $9)), <=($10, $11)))):BOOLEAN NOT NULL)])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(m=[$0], c=[$1], d=[$1])
          LogicalAggregate(group=[{}], m=[MAX($0)], c=[COUNT()])
            LogicalProject(DEPTNO=[$0])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[NOT(CAST(OR(AND(IS TRUE(<=($0, $9)), <>($10, 0)), AND(>($10, $11), null, <>($10, 0), IS NOT TRUE(<=($0, $9))), AND(<=($0, $9), <>($10, 0), IS NOT TRUE(<=($0, $9)), <=($10, $11)))):BOOLEAN NOT NULL)])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(m=[$0], c=[$1], d=[$1])
          LogicalAggregate(group=[{}], m=[MAX($0)], c=[COUNT()])
            LogicalProject(DEPTNO=[$0])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAntiCorrelateWithLeftEmpty">
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[anti], requiredColumns=[{7}])
  LogicalValues(tuples=[[]])
  LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAntiCorrelateWithRightEmpty">
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[anti], requiredColumns=[{7}])
  LogicalTableScan(table=[[scott, EMP]])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAntiJoinProjectTranspose">
    <Resource name="sql">
      <![CDATA[select a.dname from dept a
where a.deptno not in (select b.deptno * 2 from dept);
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[=($0, $3)], joinType=[anti])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalProject($f0=[*(2, $0)])
        LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[=($0, $2)], joinType=[anti])
    LogicalProject(DEPTNO=[$0], DNAME=[$1])
      LogicalTableScan(table=[[scott, DEPT]])
    LogicalProject($f0=[$0])
      LogicalAggregate(group=[{0}])
        LogicalProject($f0=[*(2, $0)])
          LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAnyInProjectNonNullable">
    <Resource name="sql">
      <![CDATA[select dname, deptno > ANY (
  select deptno from emp)
from dept]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[> SOME($0, {
LogicalProject(DEPTNO=[$7])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[CAST(OR(AND(IS TRUE(>($0, $2)), <>($3, 0)), AND(>($3, $4), null, <>($3, 0), IS NOT TRUE(>($0, $2))), AND(>($0, $2), <>($3, 0), IS NOT TRUE(>($0, $2)), <=($3, $4)))):BOOLEAN NOT NULL])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(m=[$0], c=[$1], d=[$1])
      LogicalAggregate(group=[{}], m=[MIN($0)], c=[COUNT()])
        LogicalProject(DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[CAST(OR(AND(IS TRUE(>($0, $2)), <>($3, 0)), AND(>($3, $4), null, <>($3, 0), IS NOT TRUE(>($0, $2))), AND(>($0, $2), <>($3, 0), IS NOT TRUE(>($0, $2)), <=($3, $4)))):BOOLEAN NOT NULL])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(m=[$0], c=[$1], d=[$1])
      LogicalAggregate(group=[{}], m=[MIN($0)], c=[COUNT()])
        LogicalProject(DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testAnyInProjectNullable">
    <Resource name="sql">
      <![CDATA[select deptno, dname = ANY (
  select mgr from emp)
from dept]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[IN($1, {
LogicalProject(MGR=[$3])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[OR(AND(IS NOT NULL($5), <>($2, 0)), AND(<($3, $2), null, <>($2, 0), IS NULL($5)))])
  LogicalJoin(condition=[=($1, $4)], joinType=[left])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
        LogicalProject(MGR=[$3])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], i=[LITERAL_AGG(true)])
      LogicalProject(MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[OR(AND(IS NOT NULL($5), <>($2, 0)), AND(<($3, $2), null, <>($2, 0), IS NULL($5)))])
  LogicalJoin(condition=[=($1, $4)], joinType=[left])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
        LogicalProject(MGR=[$3])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], i=[LITERAL_AGG(true)])
      LogicalProject(MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testArrayConcat">
    <Resource name="sql">
      <![CDATA[select array_concat(ARRAY [1, 2], ARRAY [3, 4])]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[ARRAY_CONCAT(ARRAY(1, 2), ARRAY(3, 4))])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[ARRAY(1, 2, 3, 4)])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testArrayRepeat">
    <Resource name="sql">
      <![CDATA[select array_repeat(1, null)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[ARRAY_REPEAT(1, null:DECIMAL(19, 9))])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[null:INTEGER NOT NULL ARRAY])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testArrayToString">
    <Resource name="sql">
      <![CDATA[select array_to_string(array['1','2','3','4',NULL,'6'], ',', NULL)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[ARRAY_TO_STRING(ARRAY('1', '2', '3', '4', null:CHAR(1), '6'), ',', null:NULL)])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[null:VARCHAR])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCallOverCorrelationVariableIsNotFlattened">
    <Resource name="sql">
      <![CDATA[select * from emp e1 where exists (select * from emp e2 where (e1.deptno+30) = e2.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IS NOT NULL($9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], agg#0=[MIN($0)])
        LogicalProject($f0=[true])
          LogicalFilter(condition=[=(+($cor0.DEPTNO, 30), $7)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCanNotPushAntiJoinConditionsToLeft">
    <Resource name="sql">
      <![CDATA[select * from emp
where emp.deptno not in
(select dept.deptno from dept where emp.deptno > 20)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(IS NOT DISTINCT FROM($7, $8), >($0, 20))], joinType=[anti])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCanNotPushAntiJoinConditionsToRight">
    <Resource name="sql">
      <![CDATA[select * from emp
where emp.deptno
not in (select dept.deptno from dept where dept.dname = 'ddd')]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(IS NOT DISTINCT FROM($7, $8), =($9, 'ddd'))], joinType=[anti])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCanNotPushSemiJoinToLeftJoinRightInput">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[=($9, $12)], joinType=[semi])
  LogicalJoin(condition=[=($7, $8)], joinType=[left])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
  LogicalTableScan(table=[[scott, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCanNotPushSemiJoinToRightJoinLeftInput">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[=($1, $12)], joinType=[semi])
  LogicalJoin(condition=[=($0, $10)], joinType=[right])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalTableScan(table=[[scott, EMP]])
  LogicalTableScan(table=[[scott, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCartesianProductForDphyp">
    <Resource name="sql">
      <![CDATA[select emp.empno from emp_address, emp, emp_b, dept where emp_address.empno = emp.empno and dept.deptno = emp.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$3])
  HyperGraph(edges=[{1}——[INNER, =(node(3)_field(0), node(1)_field(7))]——{3},{0, 1}——[INNER, true]——{2},{0}——[INNER, =(node(0)_field(0), node(1)_field(0))]——{1}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$12])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
    LogicalJoin(condition=[=($11, $2)], joinType=[inner])
      LogicalJoin(condition=[=($0, $9)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCasePushIsAlwaysWorking">
    <Resource name="sql">
      <![CDATA[select empno from emp where case when sal > 1000 then empno else sal end = 1]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[=(CASE(>($5, 1000), $0, $5), 1)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[OR(AND(>($5, 1000), =($0, 1)), =($5, 1))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testChainJoinDphypJoinReorder">
    <Resource name="sql">
      <![CDATA[select emp.empno from emp, emp_address, dept, dept_nested where emp.deptno + emp_address.empno = dept.deptno + dept_nested.deptno and emp.empno = emp_address.empno and dept.deptno = dept_nested.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  HyperGraph(edges=[{0, 1, 2}——[INNER, =(+(node(0)_field(7), node(1)_field(0)), +(node(2)_field(0), node(3)_field(0)))]——{3},{2}——[INNER, =(node(2)_field(0), node(3)_field(0))]——{3},{0, 1}——[INNER, true]——{2},{0}——[INNER, =(node(0)_field(0), node(1)_field(0))]——{1}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$9])
  LogicalJoin(condition=[=(+($16, $6), +($4, $0))], joinType=[inner])
    LogicalJoin(condition=[=($4, $0)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalJoin(condition=[=($3, $0)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testComplexPredicateForDphyp">
    <Resource name="sql">
      <![CDATA[select emp.empno from emp, emp_b, dept, dept_nested where emp.deptno + emp_b.empno = dept.deptno + dept_nested.deptno and (emp.empno = emp_b.empno or emp.ename = emp_b.ename) and sqrt(dept.deptno + dept_nested.deptno) > 2]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  HyperGraph(edges=[{0, 1, 2}——[INNER, =(+(node(0)_field(7), node(1)_field(0)), +(node(2)_field(0), node(3)_field(0)))]——{3},{2}——[INNER, >(POWER(+(node(2)_field(0), node(3)_field(0)), 0.5:DECIMAL(2, 1)), CAST(2):DOUBLE NOT NULL)]——{3},{0, 1}——[INNER, true]——{2},{0}——[INNER, OR(=(node(0)_field(0), node(1)_field(0)), =(node(0)_field(1), node(1)_field(1)))]——{1}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$16])
  LogicalJoin(condition=[=(+($23, $6), +($4, $0))], joinType=[inner])
    LogicalJoin(condition=[>(POWER(+($4, $0), 0.5:DECIMAL(2, 1)), 2.0E0)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalJoin(condition=[OR(=($10, $0), =($11, $1))], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testConvertMultiJoinRule">
    <Resource name="sql">
      <![CDATA[select e1.ename from emp e1, dept d, emp e2
where e1.deptno = d.deptno and d.deptno = e2.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$1])
  LogicalFilter(condition=[AND(=($7, $9), =($9, $18))])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$1])
  MultiJoin(joinFilter=[AND(=($9, $18), =($7, $9))], isFullOuterJoin=[false], joinTypes=[[INNER, INNER, INNER]], outerJoinConditions=[[NULL, NULL, NULL]], projFields=[[ALL, ALL, ALL]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testConvertMultiJoinRuleOuterJoins">
    <Resource name="sql">
      <![CDATA[select * from     (select * from         (select * from             (select * from A right outer join B on a = b)             left outer join             (select * from C full outer join D on c = d)            on a = c and b = d)         right outer join         (select * from             (select * from E full outer join F on e = f)             right outer join             (select * from G left outer join H on g = h)             on e = g and f = h)         on a = e and b = f and c = g and d = h)     inner join     (select * from I inner join J on i = j)     on a = i and h = j]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(A=[$0], B=[$1], C=[$2], D=[$3], E=[$4], F=[$5], G=[$6], H=[$7], I=[$8], J=[$9])
  LogicalJoin(condition=[AND(=($0, $8), =($7, $9))], joinType=[inner])
    LogicalProject(A=[$0], B=[$1], C=[$2], D=[$3], E=[$4], F=[$5], G=[$6], H=[$7])
      LogicalJoin(condition=[AND(=($0, $4), =($1, $5), =($2, $6), =($3, $7))], joinType=[right])
        LogicalProject(A=[$0], B=[$1], C=[$2], D=[$3])
          LogicalJoin(condition=[AND(=($0, $2), =($1, $3))], joinType=[left])
            LogicalProject(A=[$0], B=[$1])
              LogicalJoin(condition=[=($0, $1)], joinType=[right])
                LogicalTableScan(table=[[CATALOG, SALES, A]])
                LogicalTableScan(table=[[CATALOG, SALES, B]])
            LogicalProject(C=[$0], D=[$1])
              LogicalJoin(condition=[=($0, $1)], joinType=[full])
                LogicalTableScan(table=[[CATALOG, SALES, C]])
                LogicalTableScan(table=[[CATALOG, SALES, D]])
        LogicalProject(E=[$0], F=[$1], G=[$2], H=[$3])
          LogicalJoin(condition=[AND(=($0, $2), =($1, $3))], joinType=[right])
            LogicalProject(E=[$0], F=[$1])
              LogicalJoin(condition=[=($0, $1)], joinType=[full])
                LogicalTableScan(table=[[CATALOG, SALES, E]])
                LogicalTableScan(table=[[CATALOG, SALES, F]])
            LogicalProject(G=[$0], H=[$1])
              LogicalJoin(condition=[=($0, $1)], joinType=[left])
                LogicalTableScan(table=[[CATALOG, SALES, G]])
                LogicalTableScan(table=[[CATALOG, SALES, H]])
    LogicalProject(I=[$0], J=[$1])
      LogicalJoin(condition=[=($0, $1)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, I]])
        LogicalTableScan(table=[[CATALOG, SALES, J]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
MultiJoin(joinFilter=[AND(=($0, $8), =($7, $9), =($8, $9))], isFullOuterJoin=[false], joinTypes=[[INNER, INNER, INNER]], outerJoinConditions=[[NULL, NULL, NULL]], projFields=[[ALL, ALL, ALL]])
  MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER]], outerJoinConditions=[[AND(=($0, $4), =($1, $5), =($2, $6), =($3, $7)), NULL]], projFields=[[ALL, ALL]])
    MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[INNER, LEFT]], outerJoinConditions=[[NULL, AND(=($0, $2), =($1, $3))]], projFields=[[ALL, ALL]])
      MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER]], outerJoinConditions=[[=($0, $1), NULL]], projFields=[[ALL, ALL]])
        LogicalTableScan(table=[[CATALOG, SALES, A]])
        LogicalTableScan(table=[[CATALOG, SALES, B]])
      MultiJoin(joinFilter=[=($0, $1)], isFullOuterJoin=[true], joinTypes=[[INNER, INNER]], outerJoinConditions=[[NULL, NULL]], projFields=[[ALL, ALL]])
        LogicalTableScan(table=[[CATALOG, SALES, C]])
        LogicalTableScan(table=[[CATALOG, SALES, D]])
    MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER]], outerJoinConditions=[[AND(=($0, $2), =($1, $3)), NULL]], projFields=[[ALL, ALL]])
      MultiJoin(joinFilter=[=($0, $1)], isFullOuterJoin=[true], joinTypes=[[INNER, INNER]], outerJoinConditions=[[NULL, NULL]], projFields=[[ALL, ALL]])
        LogicalTableScan(table=[[CATALOG, SALES, E]])
        LogicalTableScan(table=[[CATALOG, SALES, F]])
      MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[INNER, LEFT]], outerJoinConditions=[[NULL, =($0, $1)]], projFields=[[ALL, ALL]])
        LogicalTableScan(table=[[CATALOG, SALES, G]])
        LogicalTableScan(table=[[CATALOG, SALES, H]])
  LogicalTableScan(table=[[CATALOG, SALES, I]])
  LogicalTableScan(table=[[CATALOG, SALES, J]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testConvertMultiJoinRuleOuterJoins2">
    <Resource name="sql">
      <![CDATA[select * from A right join B on a = b join C on b = c]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(A=[$0], B=[$1], C=[$2])
  LogicalJoin(condition=[=($1, $2)], joinType=[inner])
    LogicalJoin(condition=[=($0, $1)], joinType=[right])
      LogicalTableScan(table=[[CATALOG, SALES, A]])
      LogicalTableScan(table=[[CATALOG, SALES, B]])
    LogicalTableScan(table=[[CATALOG, SALES, C]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
MultiJoin(joinFilter=[=($1, $2)], isFullOuterJoin=[false], joinTypes=[[INNER, INNER]], outerJoinConditions=[[NULL, NULL]], projFields=[[ALL, ALL]])
  MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER]], outerJoinConditions=[[=($0, $1), NULL]], projFields=[[ALL, ALL]])
    LogicalTableScan(table=[[CATALOG, SALES, A]])
    LogicalTableScan(table=[[CATALOG, SALES, B]])
  LogicalTableScan(table=[[CATALOG, SALES, C]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testConvertMultiJoinRuleOuterJoins3">
    <Resource name="sql">
      <![CDATA[select * from A join B on a = b left join C on b = c]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(A=[$0], B=[$1], C=[$2])
  LogicalJoin(condition=[=($1, $2)], joinType=[left])
    LogicalJoin(condition=[=($0, $1)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, A]])
      LogicalTableScan(table=[[CATALOG, SALES, B]])
    LogicalTableScan(table=[[CATALOG, SALES, C]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
MultiJoin(joinFilter=[=($0, $1)], isFullOuterJoin=[false], joinTypes=[[INNER, INNER, LEFT]], outerJoinConditions=[[NULL, NULL, =($1, $2)]], projFields=[[ALL, ALL, ALL]])
  LogicalTableScan(table=[[CATALOG, SALES, A]])
  LogicalTableScan(table=[[CATALOG, SALES, B]])
  LogicalTableScan(table=[[CATALOG, SALES, C]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testConvertMultiJoinRuleOuterJoins4">
    <Resource name="sql">
      <![CDATA[select * from A join B on a = b right join C on b = c]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(A=[$0], B=[$1], C=[$2])
  LogicalJoin(condition=[=($1, $2)], joinType=[right])
    LogicalJoin(condition=[=($0, $1)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, A]])
      LogicalTableScan(table=[[CATALOG, SALES, B]])
    LogicalTableScan(table=[[CATALOG, SALES, C]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[RIGHT, INNER]], outerJoinConditions=[[=($1, $2), NULL]], projFields=[[ALL, ALL]])
  MultiJoin(joinFilter=[=($0, $1)], isFullOuterJoin=[false], joinTypes=[[INNER, INNER]], outerJoinConditions=[[NULL, NULL]], projFields=[[ALL, ALL]])
    LogicalTableScan(table=[[CATALOG, SALES, A]])
    LogicalTableScan(table=[[CATALOG, SALES, B]])
  LogicalTableScan(table=[[CATALOG, SALES, C]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCorrelateWithoutCorrelationToEmpty">
    <Resource name="sql">
      <![CDATA[select * from emp e where exists (select 1 from dept where empno=null)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCorrelateWithoutCorrelationToEmptyInVolcano">
    <Resource name="sql">
      <![CDATA[select * from emp e where exists (select 1 from dept where empno=null)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCorrelatedFilterWithVariable">
    <Resource name="planBefore">
      <![CDATA[
LogicalFilter(condition=[EXISTS({
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[AND(=($cor0.DEPTNO, $7), >($5, 100))])
    LogicalTableScan(table=[[scott, EMP]])
})], variablesSet=[[$cor0]])
  LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1], LOC=[$2])
  LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalProject(i=[true])
        LogicalFilter(condition=[AND(=($cor0.DEPTNO, $7), >($5, 100))])
          LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCorrelatedVariableAtSecondLevel">
    <Resource name="sql">
      <![CDATA[SELECT d1.dname, d1.deptno +(
SELECT e1.empno
FROM emp e1
WHERE e1.sal = (SELECT max(sal)
                FROM emp e2
                WHERE e1.sal = e2.sal and
                    e1.deptno = e2.deptno and
                    d1.deptno < e2.deptno))
FROM dept d1]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor2]], DNAME=[$1], EXPR$1=[+($0, $SCALAR_QUERY({
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[=($5, $SCALAR_QUERY({
LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
  LogicalProject(SAL=[$5])
    LogicalFilter(condition=[AND(=($cor0.SAL, $5), =($cor0.DEPTNO, $7), <($cor2.DEPTNO, $7))])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[+($0, $2)])
  LogicalCorrelate(correlation=[$cor2], joinType=[left], requiredColumns=[{0}])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{}], agg#0=[SINGLE_VALUE($0)])
      LogicalProject(EMPNO=[$0])
        LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
          LogicalFilter(condition=[=($5, $9)])
            LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{5, 7}])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
              LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
                LogicalProject(SAL=[$5])
                  LogicalFilter(condition=[AND(=($cor0.SAL, $5), =($cor0.DEPTNO, $7), <($cor2.DEPTNO, $7))])
                    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[+($0, $3)])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $2)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0}], agg#0=[SINGLE_VALUE($1)])
      LogicalProject(DEPTNO00=[$11], EMPNO=[$0])
        LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], SAL0=[CAST($9):INTEGER], DEPTNO0=[CAST($10):INTEGER], DEPTNO00=[CAST($11):INTEGER], EXPR$0=[CAST($12):INTEGER])
          LogicalJoin(condition=[AND(=($5, $9), =($7, $10))], joinType=[inner])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
            LogicalFilter(condition=[=($0, $3)])
              LogicalAggregate(group=[{0, 1, 2}], EXPR$0=[MAX($3)])
                LogicalProject(SAL0=[$9], DEPTNO0=[$10], DEPTNO00=[$11], SAL=[$5])
                  LogicalJoin(condition=[AND(=($9, $5), =($10, $7), <($11, $7))], joinType=[inner])
                    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
                    LogicalJoin(condition=[true], joinType=[inner])
                      LogicalAggregate(group=[{0, 1}])
                        LogicalProject(SAL=[$5], DEPTNO=[$7])
                          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
                      LogicalProject(DEPTNO=[$0])
                        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCorrelationScalarAggAndFilter">
    <Resource name="sql">
      <![CDATA[SELECT e1.empno
FROM emp e1, dept d1 where e1.deptno = d1.deptno
and e1.deptno < 10 and d1.deptno < 15
and e1.sal > (select avg(sal) from emp e2 where e1.empno = e2.empno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(=($0, $4), >($1, $5))], joinType=[inner])
    LogicalJoin(condition=[=($2, $3)], joinType=[inner])
      LogicalFilter(condition=[<($2, 10)])
        LogicalProject(EMPNO=[$0], SAL=[$5], DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalFilter(condition=[<($0, 15)])
        LogicalProject(DEPTNO=[$0])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0}], EXPR$0=[AVG($1)])
      LogicalProject(EMPNO=[$0], SAL=[$5])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCrossJoinWithTimeStampSingleRowOnLeft">
    <Resource name="sql">
      <![CDATA[select e.empno, e.ename, c.* from (select 5, current_timestamp) c cross join emp e ]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$2], ENAME=[$3], EXPR$0=[$0], CURRENT_TIMESTAMP=[$1])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalProject(EXPR$0=[5], CURRENT_TIMESTAMP=[CURRENT_TIMESTAMP])
      LogicalValues(tuples=[[{ 0 }]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$2], ENAME=[$3], EXPR$0=[$0], CURRENT_TIMESTAMP=[$1])
  LogicalProject($f0=[5], $f1=[CURRENT_TIMESTAMP], EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCrossJoinWithTimeStampSingleRowOnRight">
    <Resource name="sql">
      <![CDATA[select e.empno, e.ename, c.* from emp e cross join (select 5, current_timestamp) c]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], EXPR$0=[$9], CURRENT_TIMESTAMP=[$10])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EXPR$0=[5], CURRENT_TIMESTAMP=[CURRENT_TIMESTAMP])
      LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], EXPR$0=[$9], CURRENT_TIMESTAMP=[$10])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[5], $f10=[CURRENT_TIMESTAMP])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCustomColumnResolvingInCorrelatedSubQuery">
    <Resource name="sql">
      <![CDATA[select *
from struct.t t1
where c0 = (
  select max(f1.c0) from struct.t t2 where t1.k0 = t2.k0)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject("K0"=[$0], "C1"=[$1], "F1"."A0"=[$2], "F2"."A0"=[$3], "F0"."C0"=[$4], "F1"."C0"=[$5], "F0"."C1"=[$6], "F1"."C2"=[$7], "F2"."C3"=[$8])
  LogicalFilter(condition=[=($4, $SCALAR_QUERY({
LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
  LogicalProject("F1"."C0"=[$5])
    LogicalFilter(condition=[=($cor0."K0", $0)])
      LogicalTableScan(table=[[CATALOG, STRUCT, T]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, STRUCT, T]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject("K0"=[$0], "C1"=[$1], "F1"."A0"=[$2], "F2"."A0"=[$3], "F0"."C0"=[$4], "F1"."C0"=[$5], "F0"."C1"=[$6], "F1"."C2"=[$7], "F2"."C3"=[$8])
  LogicalProject("K0"=[$0], "C1"=[$1], "F1"."A0"=[$2], "F2"."A0"=[$3], "F0"."C0"=[$4], "F1"."C0"=[$5], "F0"."C1"=[$6], "F1"."C2"=[$7], "F2"."C3"=[$8])
    LogicalFilter(condition=[=($4, $9)])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
        LogicalTableScan(table=[[CATALOG, STRUCT, T]])
        LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
          LogicalProject("F1"."C0"=[$5])
            LogicalFilter(condition=[=($cor0."K0", $0)])
              LogicalTableScan(table=[[CATALOG, STRUCT, T]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCustomColumnResolvingInCorrelatedSubQuery2">
    <Resource name="sql">
      <![CDATA[select *
from struct.t t1
where c0 in (
  select f1.c0 from struct.t t2 where t1.c2 = t2.c2)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject("K0"=[$0], "C1"=[$1], "F1"."A0"=[$2], "F2"."A0"=[$3], "F0"."C0"=[$4], "F1"."C0"=[$5], "F0"."C1"=[$6], "F1"."C2"=[$7], "F2"."C3"=[$8])
  LogicalFilter(condition=[IN($4, {
LogicalProject(C0=[$5])
  LogicalFilter(condition=[=($cor0."F1"."C2", $7)])
    LogicalTableScan(table=[[CATALOG, STRUCT, T]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, STRUCT, T]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject("K0"=[$0], "C1"=[$1], "F1"."A0"=[$2], "F2"."A0"=[$3], "F0"."C0"=[$4], "F1"."C0"=[$5], "F0"."C1"=[$6], "F1"."C2"=[$7], "F2"."C3"=[$8])
  LogicalProject("K0"=[$0], "C1"=[$1], "F1"."A0"=[$2], "F2"."A0"=[$3], "F0"."C0"=[$4], "F1"."C0"=[$5], "F0"."C1"=[$6], "F1"."C2"=[$7], "F2"."C3"=[$8])
    LogicalFilter(condition=[=($4, $9)])
      LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
        LogicalTableScan(table=[[CATALOG, STRUCT, T]])
        LogicalAggregate(group=[{0}])
          LogicalProject(C0=[$5])
            LogicalFilter(condition=[=($cor0."F1"."C2", $7)])
              LogicalTableScan(table=[[CATALOG, STRUCT, T]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCustomColumnResolvingInNonCorrelatedSubQuery">
    <Resource name="sql">
      <![CDATA[select *
from struct.t t1
where c0 in (
  select f1.c0 from struct.t t2)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject("K0"=[$0], "C1"=[$1], "F1"."A0"=[$2], "F2"."A0"=[$3], "F0"."C0"=[$4], "F1"."C0"=[$5], "F0"."C1"=[$6], "F1"."C2"=[$7], "F2"."C3"=[$8])
  LogicalFilter(condition=[IN($4, {
LogicalProject(C0=[$5])
  LogicalTableScan(table=[[CATALOG, STRUCT, T]])
})])
    LogicalTableScan(table=[[CATALOG, STRUCT, T]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject("K0"=[$0], "C1"=[$1], "F1"."A0"=[$2], "F2"."A0"=[$3], "F0"."C0"=[$4], "F1"."C0"=[$5], "F0"."C1"=[$6], "F1"."C2"=[$7], "F2"."C3"=[$8])
  LogicalProject("K0"=[$0], "C1"=[$1], "F1"."A0"=[$2], "F2"."A0"=[$3], "F0"."C0"=[$4], "F1"."C0"=[$5], "F0"."C1"=[$6], "F1"."C2"=[$7], "F2"."C3"=[$8])
    LogicalJoin(condition=[=($4, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, STRUCT, T]])
      LogicalAggregate(group=[{0}])
        LogicalProject(C0=[$5])
          LogicalTableScan(table=[[CATALOG, STRUCT, T]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testCustomDecorrelate">
    <Resource name="Comparing Plans from LogicalCorrelate and CustomCorrelate">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10], EMPNO0=[CAST($11):INTEGER], EXPR$0=[CAST($12):INTEGER])
    LogicalJoin(condition=[AND(=($0, $11), >($5, $12))], joinType=[inner])
      LogicalJoin(condition=[=($7, $9)], joinType=[inner])
        LogicalFilter(condition=[<($7, 10)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalFilter(condition=[<($0, 15)])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalAggregate(group=[{0}], EXPR$0=[AVG($1)])
        LogicalProject(EMPNO=[$0], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="sql">
      <![CDATA[SELECT e1.empno
FROM emp e1, dept d1 where e1.deptno = d1.deptno
and e1.deptno < 10 and d1.deptno < 15
and e1.sal > (select avg(sal) from emp e2 where e1.empno = e2.empno)]]>
    </Resource>
  </TestCase>
  <TestCase name="testCycleJoinDphypJoinReorder">
    <Resource name="sql">
      <![CDATA[select emp.empno from emp, emp_b, dept, dept_nested where emp.empno = emp_b.empno and emp_b.deptno = dept.deptno and dept.dname = dept_nested.dname and dept_nested.deptno = emp.deptno and emp.sal + emp_b.sal = dept.deptno + dept_nested.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  HyperGraph(edges=[{2}——[INNER, =(node(2)_field(1), node(3)_field(1))]——{3},{0}——[INNER, =(node(3)_field(0), node(0)_field(7))]——{3},{0, 1, 2}——[INNER, =(+(node(0)_field(5), node(1)_field(5)), +(node(2)_field(0), node(3)_field(0)))]——{3},{1}——[INNER, =(node(1)_field(7), node(2)_field(0))]——{2},{0}——[INNER, =(node(0)_field(0), node(1)_field(0))]——{1}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$16])
  LogicalJoin(condition=[AND(=($10, $23), =(+($21, $5), +($14, $10)), =($16, $0))], joinType=[inner])
    LogicalJoin(condition=[=($7, $14)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
      LogicalJoin(condition=[=($5, $1)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateAggWithConstantGroupKey">
    <Resource name="sql">
      <![CDATA[SELECT *
FROM emp A
where sal in (SELECT max(sal)
  FROM emp B
  where A.mgr = B.empno
  group by deptno, 'abc')]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{3, 5}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalFilter(condition=[=($cor0.SAL, $0)])
      LogicalAggregate(group=[{0}])
        LogicalProject(EXPR$0=[$2])
          LogicalAggregate(group=[{0, 1}], EXPR$0=[MAX($2)])
            LogicalProject(DEPTNO=[$2], $f1=['abc'], SAL=[$1])
              LogicalFilter(condition=[=($cor0.MGR, $0)])
                LogicalProject(EMPNO=[$0], SAL=[$5], DEPTNO=[$7])
                  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{3, 5}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalFilter(condition=[=($cor0.SAL, $0)])
      LogicalAggregate(group=[{0}])
        LogicalProject(EXPR$0=[$2])
          LogicalAggregate(group=[{0, 1}], EXPR$0=[MAX($2)])
            LogicalProject(DEPTNO=[$2], $f1=['abc'], SAL=[$1])
              LogicalFilter(condition=[=($cor0.MGR, $0)])
                LogicalProject(EMPNO=[$0], SAL=[$5], DEPTNO=[$7])
                  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalJoin(condition=[AND(=($3, $10), =($5, $9))], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EXPR$0=[$2], EMPNO=[$1])
      LogicalAggregate(group=[{0, 1}], EXPR$0=[MAX($2)])
        LogicalProject(DEPTNO=[$7], EMPNO=[$0], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateAggWithMultiParamsAggCall">
    <Resource name="sql">
      <![CDATA[SELECT * FROM (SELECT MYAGG(sal, 1) AS c FROM emp) as m,
 LATERAL TABLE(ramp(m.c)) AS T(s)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
  LogicalAggregate(group=[{}], C=[MYAGG($0, $1)])
    LogicalProject(SAL=[$5], $f1=[1])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalTableFunctionScan(invocation=[RAMP($cor0.C)], rowType=[RecordType(INTEGER I)])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
  LogicalAggregate(group=[{}], C=[MYAGG($0, $1)])
    LogicalProject(SAL=[$5], $f1=[1])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalTableFunctionScan(invocation=[RAMP($cor0.C)], rowType=[RecordType(INTEGER I)])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateAggWithMultiParamsAggCall2">
    <Resource name="sql">
      <![CDATA[SELECT * FROM (SELECT MYAGG(sal, 1) AS c FROM emp group by empno, 'abc') as m,
 LATERAL TABLE(ramp(m.c)) AS T(s)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
  LogicalProject(C=[$2])
    LogicalAggregate(group=[{0, 1}], C=[MYAGG($2, $3)])
      LogicalProject(EMPNO=[$0], $f1=['abc'], SAL=[$5], $f3=[1])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalTableFunctionScan(invocation=[RAMP($cor0.C)], rowType=[RecordType(INTEGER I)])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
  LogicalProject(C=[$2])
    LogicalAggregate(group=[{0, 1}], C=[MYAGG($2, $3)])
      LogicalProject(EMPNO=[$0], $f1=['abc'], SAL=[$5], $f3=[1])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalTableFunctionScan(invocation=[RAMP($cor0.C)], rowType=[RecordType(INTEGER I)])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateExists">
    <Resource name="sql">
      <![CDATA[select * from sales.emp
where EXISTS (
  select * from emp e where emp.deptno = e.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[EXISTS({
LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalJoin(condition=[=($7, $9)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], $f1=[true])
      LogicalAggregate(group=[{0}])
        LogicalProject(DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{0}])
        LogicalProject(i=[true])
          LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateFilterWithFetchOne">
    <Resource name="sql">
      <![CDATA[SELECT dname FROM dept WHERE 10 > (SELECT emp.sal FROM emp where dept.deptno = emp.deptno ORDER BY emp.sal limit 1)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalFilter(condition=[>(10, $SCALAR_QUERY({
LogicalSort(sort0=[$0], dir0=[ASC], fetch=[1])
  LogicalProject(SAL=[$5])
    LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalProject(DEPTNO=[$0], DNAME=[$1])
    LogicalFilter(condition=[>(10, $2)])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalSort(sort0=[$0], dir0=[ASC], fetch=[1])
          LogicalProject(SAL=[$5])
            LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalProject(DEPTNO=[$0], DNAME=[$1], DEPTNO0=[CAST($2):INTEGER], $f1=[CAST($3):INTEGER])
    LogicalJoin(condition=[=($0, $2)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalFilter(condition=[>(10, $1)])
        LogicalAggregate(group=[{1}], agg#0=[MIN($0)])
          LogicalProject(SAL=[$5], DEPTNO=[$7])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateFilterWithFetchOneDesc">
    <Resource name="sql">
      <![CDATA[SELECT dname FROM dept WHERE 10 > (SELECT emp.sal FROM emp where dept.deptno = emp.deptno ORDER BY emp.sal desc nulls last limit 1)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalFilter(condition=[>(10, $SCALAR_QUERY({
LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[1])
  LogicalProject(SAL=[$5])
    LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalProject(DEPTNO=[$0], DNAME=[$1])
    LogicalFilter(condition=[>(10, $2)])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[1])
          LogicalProject(SAL=[$5])
            LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalProject(DEPTNO=[$0], DNAME=[$1], DEPTNO0=[CAST($2):INTEGER], $f1=[CAST($3):INTEGER])
    LogicalJoin(condition=[=($0, $2)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalFilter(condition=[>(10, $1)])
        LogicalAggregate(group=[{1}], agg#0=[MAX($0)])
          LogicalProject(SAL=[$5], DEPTNO=[$7])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateFilterWithFetchOneDesc1">
    <Resource name="sql">
      <![CDATA[SELECT dname FROM dept WHERE 10 > (SELECT emp.sal FROM emp where dept.deptno = emp.deptno ORDER BY emp.sal desc limit 1)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalFilter(condition=[>(10, $SCALAR_QUERY({
LogicalSort(sort0=[$0], dir0=[DESC], fetch=[1])
  LogicalProject(SAL=[$5])
    LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalProject(DEPTNO=[$0], DNAME=[$1])
    LogicalFilter(condition=[>(10, $2)])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalSort(sort0=[$0], dir0=[DESC], fetch=[1])
          LogicalProject(SAL=[$5])
            LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalProject(DEPTNO=[$0], DNAME=[$1], SAL=[CAST($2):INTEGER], DEPTNO0=[CAST($3):INTEGER], rn=[CAST($4):BIGINT])
    LogicalJoin(condition=[=($0, $3)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalFilter(condition=[>(10, $0)])
        LogicalFilter(condition=[<=($2, 1)])
          LogicalProject(SAL=[$5], DEPTNO=[$7], rn=[ROW_NUMBER() OVER (PARTITION BY $7 ORDER BY $5 DESC NULLS FIRST)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateFilterWithMultiKeyAndFetchOne">
    <Resource name="sql">
      <![CDATA[SELECT dname FROM dept WHERE 10 > (SELECT emp.sal FROM emp where dept.deptno = emp.deptno order by year(hiredate), emp.sal desc limit 1)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalFilter(condition=[>(10, $SCALAR_QUERY({
LogicalProject(SAL=[$0])
  LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[DESC], fetch=[1])
    LogicalProject(SAL=[$5], EXPR$1=[EXTRACT(FLAG(YEAR), $4)])
      LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalProject(DEPTNO=[$0], DNAME=[$1])
    LogicalFilter(condition=[>(10, $2)])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalProject(SAL=[$0])
          LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[DESC], fetch=[1])
            LogicalProject(SAL=[$5], EXPR$1=[EXTRACT(FLAG(YEAR), $4)])
              LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalProject(DEPTNO=[$0], DNAME=[$1], SAL=[CAST($2):INTEGER], DEPTNO0=[CAST($3):INTEGER])
    LogicalJoin(condition=[=($0, $3)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalFilter(condition=[>(10, $0)])
        LogicalProject(SAL=[$0], DEPTNO=[$2])
          LogicalFilter(condition=[<=($3, 1)])
            LogicalProject(SAL=[$5], EXPR$1=[EXTRACT(FLAG(YEAR), $4)], DEPTNO=[$7], rn=[ROW_NUMBER() OVER (PARTITION BY $7 ORDER BY EXTRACT(FLAG(YEAR), $4) NULLS LAST, $5 DESC NULLS FIRST)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateProjectWithFetchOne">
    <Resource name="sql">
      <![CDATA[SELECT dname, (SELECT sal FROM emp where dept.deptno = emp.deptno order by sal limit 1) FROM dept]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], DNAME=[$1], EXPR$1=[$SCALAR_QUERY({
LogicalSort(sort0=[$0], dir0=[ASC], fetch=[1])
  LogicalProject(SAL=[$5])
    LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[$2])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalSort(sort0=[$0], dir0=[ASC], fetch=[1])
      LogicalProject(SAL=[$5])
        LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[$3])
  LogicalJoin(condition=[=($0, $2)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{1}], agg#0=[MIN($0)])
      LogicalProject(SAL=[$5], DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateProjectWithFetchOneDesc">
    <Resource name="sql">
      <![CDATA[SELECT dname, (SELECT emp.sal FROM emp WHERE dept.deptno = emp.deptno ORDER BY emp.sal desc nulls last LIMIT 1) FROM dept]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], DNAME=[$1], EXPR$1=[$SCALAR_QUERY({
LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[1])
  LogicalProject(SAL=[$5])
    LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[$2])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalSort(sort0=[$0], dir0=[DESC-nulls-last], fetch=[1])
      LogicalProject(SAL=[$5])
        LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[$3])
  LogicalJoin(condition=[=($0, $2)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{1}], agg#0=[MAX($0)])
      LogicalProject(SAL=[$5], DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateProjectWithMultiKeyAndFetchOne">
    <Resource name="sql">
      <![CDATA[SELECT dname, (SELECT sal FROM emp where dept.deptno = emp.deptno order by year(hiredate), emp.sal limit 1) FROM dept]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], DNAME=[$1], EXPR$1=[$SCALAR_QUERY({
LogicalProject(SAL=[$0])
  LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC], fetch=[1])
    LogicalProject(SAL=[$5], EXPR$1=[EXTRACT(FLAG(YEAR), $4)])
      LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[$2])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(SAL=[$0])
      LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC], fetch=[1])
        LogicalProject(SAL=[$5], EXPR$1=[EXTRACT(FLAG(YEAR), $4)])
          LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[$2])
  LogicalJoin(condition=[=($0, $3)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(SAL=[$0], DEPTNO=[$2])
      LogicalFilter(condition=[<=($3, 1)])
        LogicalProject(SAL=[$5], EXPR$1=[EXTRACT(FLAG(YEAR), $4)], DEPTNO=[$7], rn=[ROW_NUMBER() OVER (PARTITION BY $7 ORDER BY EXTRACT(FLAG(YEAR), $4) NULLS LAST, $5 NULLS LAST)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateProjectWithMultiKeyAndFetchOne1">
    <Resource name="sql">
      <![CDATA[SELECT dname, (SELECT sal FROM emp where dept.deptno = emp.deptno and dept.dname = emp.ename order by year(hiredate), emp.sal limit 1) FROM dept]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], DNAME=[$1], EXPR$1=[$SCALAR_QUERY({
LogicalProject(SAL=[$0])
  LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC], fetch=[1])
    LogicalProject(SAL=[$5], EXPR$1=[EXTRACT(FLAG(YEAR), $4)])
      LogicalFilter(condition=[AND(=($cor0.DEPTNO, $7), =(CAST($cor0.DNAME):VARCHAR(20) NOT NULL, $1))])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[$2])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 1}])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(SAL=[$0])
      LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC], fetch=[1])
        LogicalProject(SAL=[$5], EXPR$1=[EXTRACT(FLAG(YEAR), $4)])
          LogicalFilter(condition=[AND(=($cor0.DEPTNO, $7), =(CAST($cor0.DNAME):VARCHAR(20) NOT NULL, $1))])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[$4])
  LogicalJoin(condition=[AND(=($0, $5), =($3, $6))], joinType=[left])
    LogicalProject(DEPTNO=[$0], DNAME=[$1], DEPTNO0=[$0], DNAME0=[CAST($1):VARCHAR(20) NOT NULL])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(SAL=[$0], DEPTNO=[$2], ENAME=[$3])
      LogicalFilter(condition=[<=($4, 1)])
        LogicalProject(SAL=[$5], EXPR$1=[EXTRACT(FLAG(YEAR), $4)], DEPTNO=[$7], ENAME=[$1], rn=[ROW_NUMBER() OVER (PARTITION BY $7, $1 ORDER BY EXTRACT(FLAG(YEAR), $4) NULLS LAST, $5 NULLS LAST)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateTwoExists">
    <Resource name="sql">
      <![CDATA[select * from sales.emp
where EXISTS (
  select * from emp e where emp.deptno = e.deptno)
AND NOT EXISTS (
  select * from emp ee where ee.job = emp.job AND ee.sal=34)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[AND(EXISTS({
LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}), NOT(EXISTS({
LogicalFilter(condition=[AND(=($2, $cor0.JOB), =($5, 34))])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[IS NULL($10)])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{2}])
        LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalAggregate(group=[{0}])
            LogicalProject(i=[true])
              LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{0}])
          LogicalProject(i=[true])
            LogicalFilter(condition=[AND(=($2, $cor0.JOB), =($5, 34))])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IS NULL($12)])
    LogicalJoin(condition=[=($2, $11)], joinType=[left])
      LogicalJoin(condition=[=($7, $9)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(DEPTNO=[$0], $f1=[true])
          LogicalAggregate(group=[{0}])
            LogicalProject(DEPTNO=[$7])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(JOB=[$0], $f1=[true])
        LogicalAggregate(group=[{0}])
          LogicalProject(JOB=[$2])
            LogicalFilter(condition=[=($5, 34)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateTwoIn">
    <Resource name="sql">
      <![CDATA[select sal
from sales.emp
where empno IN (
  select deptno from dept where emp.job = dept.dname)
AND empno IN (
  select empno from emp e where emp.ename = e.ename)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalFilter(condition=[AND(IN($0, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($cor0.JOB, $1)])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
}), IN($0, {
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[=($cor0.ENAME, $1)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($0, $10)])
      LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
        LogicalFilter(condition=[=($0, $9)])
          LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
            LogicalProject(DEPTNO=[$0])
              LogicalFilter(condition=[=($cor0.JOB, $1)])
                LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalProject(EMPNO=[$0])
          LogicalFilter(condition=[=($cor0.ENAME, $1)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalJoin(condition=[AND(=($1, $12), =($0, $11))], joinType=[inner])
    LogicalJoin(condition=[AND(=($2, $10), =($0, $9))], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(DEPTNO=[$0], DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(EMPNO=[$0], ENAME=[$1])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateTwoScalar">
    <Resource name="sql">
      <![CDATA[select deptno,
  (select min(1) from emp where empno > d.deptno) as i0,
  (select min(0) from emp
    where deptno = d.deptno and ename = 'SMITH') as i1
from dept as d]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], I0=[$SCALAR_QUERY({
LogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
  LogicalProject($f0=[1])
    LogicalFilter(condition=[>($0, $cor0.DEPTNO)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})], I1=[$SCALAR_QUERY({
LogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
  LogicalProject($f0=[0])
    LogicalFilter(condition=[AND(=($7, $cor1.DEPTNO), =($1, 'SMITH'))])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DEPTNO=[$0], I0=[$2], I1=[$3])
  LogicalJoin(condition=[true], joinType=[left])
    LogicalJoin(condition=[true], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
        LogicalProject($f0=[1])
          LogicalFilter(condition=[>($0, $cor0.DEPTNO)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
      LogicalProject($f0=[0])
        LogicalFilter(condition=[AND(=($7, $cor1.DEPTNO), =($1, 'SMITH'))])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelateUncorrelatedInAndCorrelatedExists">
    <Resource name="sql">
      <![CDATA[select * from sales.emp
WHERE job in (
  select job from emp ee where ee.sal=34)AND EXISTS (
  select * from emp e where emp.deptno = e.deptno)
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[AND(IN($2, {
LogicalProject(JOB=[$2])
  LogicalFilter(condition=[=($5, 34)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}), EXISTS({
LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
      LogicalJoin(condition=[=($2, $9)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{0}])
          LogicalProject(JOB=[$2])
            LogicalFilter(condition=[=($5, 34)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{0}])
        LogicalProject(i=[true])
          LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalJoin(condition=[=($7, $10)], joinType=[inner])
    LogicalJoin(condition=[=($2, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{0}])
        LogicalProject(JOB=[$2])
          LogicalFilter(condition=[=($5, 34)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], $f1=[true])
      LogicalAggregate(group=[{0}])
        LogicalProject(DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelationWithProject">
    <Resource name="sql">
      <![CDATA[select sal,
exists (select * from emp_b where emp.deptno = emp_b.deptno)
from sales.emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], SAL=[$5], EXPR$1=[EXISTS({
LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(SAL=[$5], EXPR$1=[IS NOT NULL($9)])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}])
      LogicalProject(i=[true])
        LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(SAL=[$5], EXPR$1=[IS NOT NULL($10)])
  LogicalJoin(condition=[=($7, $9)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], $f1=[true])
      LogicalAggregate(group=[{0}])
        LogicalProject(DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDecorrelationWithSort">
    <Resource name="sql">
      <![CDATA[SELECT e1.empno
FROM emp e1, dept d1 where e1.deptno = d1.deptno
and e1.deptno < 10 and d1.deptno < 15
and e1.sal > (select avg(sal) from emp e2 where e1.empno = e2.empno)
order by e1.empno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC])
  LogicalProject(EMPNO=[$0])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10], EMPNO0=[CAST($11):INTEGER], EXPR$0=[CAST($12):INTEGER])
      LogicalJoin(condition=[AND(=($0, $11), >($5, $12))], joinType=[inner])
        LogicalJoin(condition=[=($7, $9)], joinType=[inner])
          LogicalFilter(condition=[<($7, 10)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalFilter(condition=[<($0, 15)])
            LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalAggregate(group=[{0}], EXPR$0=[AVG($1)])
          LogicalProject(EMPNO=[$0], SAL=[$5])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDigestOfApproximateDistinctAggregateCall">
    <Resource name="sql">
      <![CDATA[select *
from (
select deptno, count(distinct empno) from emp group by deptno
union all
select deptno, approx_count_distinct(empno) from emp group by deptno)]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$1])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{7}], EXPR$1=[COUNT(DISTINCT $0)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{7}], EXPR$1=[COUNT(APPROXIMATE DISTINCT $0)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$1])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)])
      LogicalProject(DEPTNO=[$7], EMPNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], EXPR$1=[COUNT(APPROXIMATE DISTINCT $1)])
      LogicalProject(DEPTNO=[$7], EMPNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDistinctCount1">
    <Resource name="sql">
      <![CDATA[select deptno, count(distinct ename)
from sales.emp group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)])
  LogicalProject(DEPTNO=[$7], ENAME=[$1])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{1}], EXPR$1=[COUNT($0)])
  LogicalAggregate(group=[{1, 7}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDistinctCount2">
    <Resource name="sql">
      <![CDATA[select deptno, count(distinct ename), sum(sal)
from sales.emp group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[SUM($2)])
  LogicalProject(DEPTNO=[$7], ENAME=[$1], SAL=[$5])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$1], EXPR$2=[CAST($2):INTEGER NOT NULL])
  LogicalAggregate(group=[{0}], EXPR$1_g0=[COUNT($1) FILTER $3], EXPR$2_g0=[MIN($2) FILTER $4])
    LogicalProject(DEPTNO=[$0], ENAME=[$1], EXPR$2=[$2], $g_0=[=($3, 0)], $g_1=[=($3, 1)])
      LogicalProject(DEPTNO=[$1], ENAME=[$0], EXPR$2=[$2], $g=[$3])
        LogicalAggregate(group=[{1, 7}], groups=[[{1, 7}, {7}]], EXPR$2=[SUM($5)], $g=[GROUPING($7, $1)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDistinctCountGroupingSets1">
    <Resource name="sql">
      <![CDATA[select deptno, job, count(distinct ename)
from sales.emp group by rollup(deptno,job)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[COUNT(DISTINCT $2)])
  LogicalProject(DEPTNO=[$7], JOB=[$2], ENAME=[$1])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], JOB=[$1], EXPR$2=[CAST(CASE(=($8, 0), $2, =($8, 1), $3, =($8, 3), $4, null:BIGINT)):BIGINT NOT NULL])
  LogicalFilter(condition=[OR(AND(=($8, 0), >($5, 0)), AND(=($8, 1), >($6, 0)), =($8, 3))])
    LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2_g0=[COUNT($2) FILTER $3], EXPR$2_g1=[COUNT($2) FILTER $5], EXPR$2_g2=[COUNT($2) FILTER $7], $g_present_0=[COUNT() FILTER $4], $g_present_1=[COUNT() FILTER $6], $g_present_2=[COUNT() FILTER $8], $g_final=[GROUPING($0, $1)])
      LogicalProject(DEPTNO=[$0], JOB=[$1], ENAME=[$2], $g_0=[=($3, 0)], $g_1=[=($3, 1)], $g_2=[=($3, 2)], $g_3=[=($3, 3)], $g_6=[=($3, 6)], $g_7=[=($3, 7)])
        LogicalAggregate(group=[{0, 1, 2}], groups=[[{0, 1, 2}, {0, 1}, {0, 2}, {0}, {2}, {}]], $g=[GROUPING($0, $1, $2)])
          LogicalProject(DEPTNO=[$7], JOB=[$2], ENAME=[$1])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDistinctCountGroupingSets2">
    <Resource name="sql">
      <![CDATA[select deptno, job, count(distinct ename), sum(sal)
from sales.emp group by rollup(deptno,job)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[COUNT(DISTINCT $2)], EXPR$3=[SUM($3)])
  LogicalProject(DEPTNO=[$7], JOB=[$2], ENAME=[$1], SAL=[$5])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], JOB=[$1], EXPR$2=[CAST(CASE(=($11, 0), $2, =($11, 1), $3, =($11, 3), $4, null:BIGINT)):BIGINT NOT NULL], EXPR$3=[CASE(=($11, 0), $5, =($11, 1), $6, =($11, 3), $7, null:INTEGER)])
  LogicalFilter(condition=[OR(AND(=($11, 0), >($8, 0)), AND(=($11, 1), >($9, 0)), =($11, 3))])
    LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2_g0=[COUNT($2) FILTER $4], EXPR$2_g1=[COUNT($2) FILTER $6], EXPR$2_g2=[COUNT($2) FILTER $8], EXPR$3_g0=[MIN($3) FILTER $5], EXPR$3_g1=[MIN($3) FILTER $7], EXPR$3_g2=[MIN($3) FILTER $9], $g_present_0=[COUNT() FILTER $5], $g_present_1=[COUNT() FILTER $7], $g_present_2=[COUNT() FILTER $9], $g_final=[GROUPING($0, $1)])
      LogicalProject(DEPTNO=[$0], JOB=[$1], ENAME=[$2], EXPR$3=[$3], $g_0=[=($4, 0)], $g_1=[=($4, 1)], $g_2=[=($4, 2)], $g_3=[=($4, 3)], $g_6=[=($4, 6)], $g_7=[=($4, 7)])
        LogicalAggregate(group=[{0, 1, 2}], groups=[[{0, 1, 2}, {0, 1}, {0, 2}, {0}, {2}, {}]], EXPR$3=[SUM($3)], $g=[GROUPING($0, $1, $2)])
          LogicalProject(DEPTNO=[$7], JOB=[$2], ENAME=[$1], SAL=[$5])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDistinctCountMixed">
    <Resource name="sql">
      <![CDATA[select deptno, count(distinct deptno, job) as cddj,
  sum(sal) as s
from sales.emp group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], CDDJ=[COUNT(DISTINCT $0, $1)], S=[SUM($2)])
  LogicalProject(DEPTNO=[$7], JOB=[$2], SAL=[$5])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], CDDJ=[$1], S=[CAST($2):INTEGER NOT NULL])
  LogicalAggregate(group=[{0}], CDDJ_g0=[COUNT($0, $1) FILTER $3], S_g0=[MIN($2) FILTER $4])
    LogicalProject(DEPTNO=[$0], JOB=[$1], S=[$2], $g_0=[=($3, 0)], $g_1=[=($3, 1)])
      LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}]], S=[SUM($2)], $g=[GROUPING($0, $1)])
        LogicalProject(DEPTNO=[$7], JOB=[$2], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDistinctCountMixed2">
    <Resource name="sql">
      <![CDATA[select deptno, count(distinct ename) as cde,
count(distinct job, ename) as cdje,
count(distinct deptno, job) as cddj,
sum(sal) as s
from sales.emp group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], CDE=[COUNT(DISTINCT $1)], CDJE=[COUNT(DISTINCT $2, $1)], CDDJ=[COUNT(DISTINCT $0, $2)], S=[SUM($3)])
  LogicalProject(DEPTNO=[$7], ENAME=[$1], JOB=[$2], SAL=[$5])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], CDE=[$1], CDJE=[$2], CDDJ=[$3], S=[CAST($4):INTEGER NOT NULL])
  LogicalAggregate(group=[{0}], CDE_g0=[COUNT($1) FILTER $5], CDJE_g0=[COUNT($2, $1) FILTER $4], CDDJ_g0=[COUNT($0, $2) FILTER $6], S_g0=[MIN($3) FILTER $7])
    LogicalProject(DEPTNO=[$2], ENAME=[$0], JOB=[$1], S=[$3], $g_0=[=($4, 0)], $g_1=[=($4, 1)], $g_2=[=($4, 2)], $g_3=[=($4, 3)])
      LogicalAggregate(group=[{1, 2, 7}], groups=[[{1, 2, 7}, {1, 7}, {2, 7}, {7}]], S=[SUM($5)], $g=[GROUPING($7, $1, $2)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDistinctCountMixedJoin">
    <Resource name="sql">
      <![CDATA[select deptno, count(distinct ename), count(distinct job, ename),
count(distinct deptno, job), sum(sal)
from sales.emp group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[COUNT(DISTINCT $2, $1)], EXPR$3=[COUNT(DISTINCT $0, $2)], EXPR$4=[SUM($3)])
  LogicalProject(DEPTNO=[$7], ENAME=[$1], JOB=[$2], SAL=[$5])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$3], EXPR$2=[$5], EXPR$3=[$7], EXPR$4=[$1])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $6)], joinType=[inner])
    LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $4)], joinType=[inner])
      LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $2)], joinType=[inner])
        LogicalAggregate(group=[{7}], EXPR$4=[SUM($5)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{1}], EXPR$1=[COUNT($0)])
          LogicalAggregate(group=[{1, 7}])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{2}], EXPR$2=[COUNT($1, $0)])
        LogicalAggregate(group=[{1, 2, 7}])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{1}], EXPR$3=[COUNT($1, $0)])
      LogicalAggregate(group=[{2, 7}])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDistinctCountMultiple">
    <Resource name="sql">
      <![CDATA[select deptno, count(distinct ename),
  count(distinct job)
from sales.emp group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[COUNT(DISTINCT $2)])
  LogicalProject(DEPTNO=[$7], ENAME=[$1], JOB=[$2])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$1], EXPR$2=[$2])
  LogicalAggregate(group=[{0}], EXPR$1_g0=[COUNT($1) FILTER $3], EXPR$2_g0=[COUNT($2) FILTER $4])
    LogicalProject(DEPTNO=[$0], ENAME=[$1], JOB=[$2], $g_1=[=($3, 1)], $g_2=[=($3, 2)])
      LogicalProject(DEPTNO=[$2], ENAME=[$0], JOB=[$1], $g=[$3])
        LogicalAggregate(group=[{1, 2, 7}], groups=[[{1, 7}, {2, 7}, {7}]], $g=[GROUPING($7, $1, $2)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDistinctCountMultipleNoGroup">
    <Resource name="sql">
      <![CDATA[select count(distinct ename), count(distinct job)
from sales.emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[COUNT(DISTINCT $0)], EXPR$1=[COUNT(DISTINCT $1)])
  LogicalProject(ENAME=[$1], JOB=[$2])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
  LogicalAggregate(group=[{}], EXPR$0_g0=[COUNT($0) FILTER $2], EXPR$1_g0=[COUNT($1) FILTER $3])
    LogicalProject(ENAME=[$0], JOB=[$1], $g_1=[=($2, 1)], $g_2=[=($2, 2)])
      LogicalAggregate(group=[{1, 2}], groups=[[{1}, {2}, {}]], $g=[GROUPING($1, $2)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDistinctCountMultipleViaJoin">
    <Resource name="sql">
      <![CDATA[select deptno, count(distinct ename),
  count(distinct job, ename),
  count(distinct deptno, job), sum(sal)
from sales.emp group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[COUNT(DISTINCT $2, $1)], EXPR$3=[COUNT(DISTINCT $0, $2)], EXPR$4=[SUM($3)])
  LogicalProject(DEPTNO=[$7], ENAME=[$1], JOB=[$2], SAL=[$5])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$3], EXPR$2=[$5], EXPR$3=[$7], EXPR$4=[$1])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $6)], joinType=[inner])
    LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $4)], joinType=[inner])
      LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $2)], joinType=[inner])
        LogicalAggregate(group=[{7}], EXPR$4=[SUM($5)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{1}], EXPR$1=[COUNT($0)])
          LogicalAggregate(group=[{1, 7}])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{2}], EXPR$2=[COUNT($1, $0)])
        LogicalAggregate(group=[{1, 2, 7}])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{1}], EXPR$3=[COUNT($1, $0)])
      LogicalAggregate(group=[{2, 7}])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDistinctCountWithExpandSumType">
    <Resource name="sql">
      <![CDATA[SELECT count(comm), COUNT(DISTINCT comm) FROM emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[COUNT()], EXPR$1=[COUNT(DISTINCT $0)])
  LogicalProject(COMM=[$6])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[CAST($0):BIGINT NOT NULL], EXPR$1=[$1])
  LogicalAggregate(group=[{}], EXPR$0=[$SUM0($1)], EXPR$1=[COUNT($0)])
    LogicalAggregate(group=[{0}], EXPR$0=[COUNT()])
      LogicalProject(COMM=[$6])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDistinctCountWithoutGroupBy">
    <Resource name="sql">
      <![CDATA[select max(deptno), count(distinct ename)
from sales.emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[MAX($0)], EXPR$1=[COUNT(DISTINCT $1)])
  LogicalProject(DEPTNO=[$7], ENAME=[$1])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
  LogicalAggregate(group=[{}], EXPR$0_g0=[MIN($1) FILTER $3], EXPR$1_g0=[COUNT($0) FILTER $2])
    LogicalProject(ENAME=[$0], EXPR$0=[$1], $g_0=[=($2, 0)], $g_1=[=($2, 1)])
      LogicalAggregate(group=[{1}], groups=[[{1}, {}]], EXPR$0=[MAX($7)], $g=[GROUPING($1)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDoNotPushFilterThroughAggregateWithoutGroupKeys">
    <Resource name="planBefore">
      <![CDATA[
LogicalFilter(condition=[false])
  LogicalAggregate(group=[{}], agg#0=[COUNT()])
    LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDoubleReduction">
    <Resource name="sql">
      <![CDATA[SELECT power(1004.3, 2)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[POWER(1004.3:DECIMAL(5, 1), 2)])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[1008618.4899999999E0:DOUBLE])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDoubleReduction2">
    <Resource name="sql">
      <![CDATA[SELECT 1.0 / 0.0e0]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[/(1.0:DECIMAL(2, 1), 0.0E0:DOUBLE)])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[Infinity:DOUBLE])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testDynamicStarWithUnion">
    <Resource name="sql">
      <![CDATA[(select n_nationkey from SALES.CUSTOMER)
union all
(select n_name from CUSTOMER_MODIFIABLEVIEW)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(N_NATIONKEY=[$0])
    LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
  LogicalProject(N_NAME=[$1])
    LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableUnion(all=[true])
  EnumerableProject(N_NATIONKEY=[$0])
    EnumerableTableScan(table=[[CATALOG, SALES, CUSTOMER]])
  EnumerableProject(N_NAME=[$1])
    EnumerableTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptyAggregate">
    <Resource name="sql">
      <![CDATA[select sum(empno) from emp where false group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[$1])
  LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptyAggregateEmptyKey">
    <Resource name="sql">
      <![CDATA[select sum(empno) from emp where false]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0)])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptyFilterProjectUnion">
    <Resource name="sql">
      <![CDATA[select * from (
select * from (values (10, 1), (30, 3)) as t (x, y)
union all
select * from (values (20, 2))
)
where x + y > 30]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(X=[$0], Y=[$1])
  LogicalFilter(condition=[>(+($0, $1), 30)])
    LogicalUnion(all=[true])
      LogicalProject(X=[$0], Y=[$1])
        LogicalValues(tuples=[[{ 10, 1 }, { 30, 3 }]])
      LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
        LogicalValues(tuples=[[{ 20, 2 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(X=[$0], Y=[$1])
  LogicalValues(tuples=[[{ 30, 3 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptyFilterProjectUnion2">
    <Resource name="sql">
      <![CDATA[select * from (
select * from (values (10, 1), (30, 3), (30, 3)) as t (x, y)
union
select * from (values (20, 2))
)
where x + y > 30]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(X=[$0], Y=[$1])
  LogicalFilter(condition=[>(+($0, $1), 30)])
    LogicalUnion(all=[false])
      LogicalProject(X=[$0], Y=[$1])
        LogicalValues(tuples=[[{ 10, 1 }, { 30, 3 }, { 30, 3 }]])
      LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
        LogicalValues(tuples=[[{ 20, 2 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(X=[$0], Y=[$1])
  LogicalAggregate(group=[{0, 1}])
    LogicalValues(tuples=[[{ 30, 3 }, { 30, 3 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptyIntersect">
    <Resource name="sql">
      <![CDATA[select * from (values (30, 3))intersect
select *
from (values (10, 1), (30, 3)) as t (x, y) where x > 50
intersect
select * from (values (30, 3))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalIntersect(all=[false])
  LogicalIntersect(all=[false])
    LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
      LogicalValues(tuples=[[{ 30, 3 }]])
    LogicalProject(X=[$0], Y=[$1])
      LogicalFilter(condition=[>($0, 50)])
        LogicalValues(tuples=[[{ 10, 1 }, { 30, 3 }]])
  LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
    LogicalValues(tuples=[[{ 30, 3 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptyMinus">
    <Resource name="sql">
      <![CDATA[select * from (values (30, 3)) as t (x, y)
where x > 30
except
select * from (values (20, 2))
except
select * from (values (40, 4))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalMinus(all=[false])
  LogicalMinus(all=[false])
    LogicalProject(X=[$0], Y=[$1])
      LogicalFilter(condition=[>($0, 30)])
        LogicalValues(tuples=[[{ 30, 3 }]])
    LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
      LogicalValues(tuples=[[{ 20, 2 }]])
  LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
    LogicalValues(tuples=[[{ 40, 4 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptyMinus2">
    <Resource name="sql">
      <![CDATA[select * from (values (30, 3)) as t (x, y)
except
select * from (values (20, 2)) as t (x, y) where x > 30
except
select * from (values (40, 4))
except
select * from (values (50, 5)) as t (x, y) where x > 50]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalMinus(all=[false])
  LogicalMinus(all=[false])
    LogicalMinus(all=[false])
      LogicalProject(X=[$0], Y=[$1])
        LogicalValues(tuples=[[{ 30, 3 }]])
      LogicalProject(X=[$0], Y=[$1])
        LogicalFilter(condition=[>($0, 30)])
          LogicalValues(tuples=[[{ 20, 2 }]])
    LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
      LogicalValues(tuples=[[{ 40, 4 }]])
  LogicalProject(X=[$0], Y=[$1])
    LogicalFilter(condition=[>($0, 50)])
      LogicalValues(tuples=[[{ 50, 5 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalMinus(all=[false])
  LogicalProject(X=[$0], Y=[$1])
    LogicalValues(tuples=[[{ 30, 3 }]])
  LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
    LogicalValues(tuples=[[{ 40, 4 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptyMinus3">
    <Resource name="sql">
      <![CDATA[select * from (values (30, 3), (30, 3)) as t (x, y)
except
select * from (values (20, 2)) as t (x, y) where x > 30]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalMinus(all=[false])
  LogicalProject(X=[$0], Y=[$1])
    LogicalValues(tuples=[[{ 30, 3 }, { 30, 3 }]])
  LogicalProject(X=[$0], Y=[$1])
    LogicalFilter(condition=[>($0, 30)])
      LogicalValues(tuples=[[{ 20, 2 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0, 1}])
  LogicalProject(X=[$0], Y=[$1])
    LogicalValues(tuples=[[{ 30, 3 }, { 30, 3 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptyProject">
    <Resource name="sql">
      <![CDATA[select z + x from (
  select x + y as z, x from (
    select * from (values (10, 1), (30, 3)) as t (x, y)
    where x + y > 50))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[+(+($0, $1), $0)])
  LogicalFilter(condition=[>(+($0, $1), 50)])
    LogicalValues(tuples=[[{ 10, 1 }, { 30, 3 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptyProject2">
    <Resource name="sql">
      <![CDATA[select z + x from (
  select x + y as z, x from (
    select * from (values (10, 1), (30, 3)) as t (x, y)
    where x + y > 50))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[+(+($0, $1), $0)])
  LogicalFilter(condition=[>(+($0, $1), 50)])
    LogicalValues(tuples=[[{ 10, 1 }, { 30, 3 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptySort">
    <Resource name="sql">
      <![CDATA[select * from emp where false order by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$7], dir0=[ASC])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[false])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptySort2">
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$1], sort1=[$0], dir0=[ASC], dir1=[ASC])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptySortLimitZero">
    <Resource name="sql">
      <![CDATA[select * from emp order by deptno limit 0]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$7], dir0=[ASC], fetch=[0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptyTable">
    <Resource name="sql">
      <![CDATA[select * from EMPTY_PRODUCTS
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(PRODUCTID=[$0], NAME=[$1], SUPPLIERID=[$2])
  LogicalTableScan(table=[[CATALOG, SALES, EMPTY_PRODUCTS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEmptyTableTransformsComplexQueryToSingleTableScan">
    <Resource name="sql">
      <![CDATA[select products.PRODUCTID, products.NAME from products left join
(select * from products as e
 inner join EMPTY_PRODUCTS as d on e.PRODUCTID = d.PRODUCTID
 where e.SUPPLIERID > 10) dt
 on products.PRODUCTID = dt.PRODUCTID]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(PRODUCTID=[$0], NAME=[$1])
  LogicalJoin(condition=[=($0, $3)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, PRODUCTS]])
    LogicalProject(PRODUCTID=[$0], NAME=[$1], SUPPLIERID=[$2], PRODUCTID0=[$3], NAME0=[$4], SUPPLIERID0=[$5])
      LogicalFilter(condition=[>($2, 10)])
        LogicalJoin(condition=[=($0, $3)], joinType=[inner])
          LogicalTableScan(table=[[CATALOG, SALES, PRODUCTS]])
          LogicalTableScan(table=[[CATALOG, SALES, EMPTY_PRODUCTS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(PRODUCTID=[$0], NAME=[$1])
  LogicalTableScan(table=[[CATALOG, SALES, PRODUCTS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEnumerableCalcRule">
    <Resource name="sql">
      <![CDATA[select FNAME, LNAME
from SALES.CUSTOMER
where CONTACTNO > 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(FNAME=[$1], LNAME=[$2])
  LogicalFilter(condition=[>($0, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(FNAME=[$1], LNAME=[$2])
  EnumerableCalc(expr#0..2=[{inputs}], expr#3=[10], expr#4=[>($t0, $t3)], proj#0..2=[{exprs}], $condition=[$t4])
    EnumerableTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEnumerableFilterRule">
    <Resource name="sql">
      <![CDATA[select R_REGIONKEY from SALES.CUSTOMER
where R_REGIONKEY > all (select R_REGIONKEY from SALES.CUSTOMER)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(R_REGIONKEY=[$0])
  LogicalFilter(condition=[NOT(<= SOME($0, {
LogicalProject(R_REGIONKEY=[$0])
  LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
}))])
    LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(R_REGIONKEY=[$0])
  EnumerableProject(R_REGIONKEY=[$0])
    EnumerableFilter(condition=[OR(=($2, 0), AND(>($0, $1), <>($2, 0), IS NOT TRUE(OR(<=($0, $1), >($2, $3)))))])
      EnumerableNestedLoopJoin(condition=[true], joinType=[inner])
        EnumerableTableScan(table=[[CATALOG, SALES, CUSTOMER]])
        EnumerableAggregate(group=[{}], m=[MAX($0)], c=[COUNT()], d=[COUNT($0)])
          EnumerableProject(R_REGIONKEY=[$0])
            EnumerableTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEnumerableMergeUnionRule">
    <Resource name="sql">
      <![CDATA[SELECT deptno, job, sal
FROM emp
UNION ALL
SELECT deptno, job, sal
FROM emp order by deptno limit 3000000000 offset 2500000000]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], JOB=[$1], SAL=[$2])
  LogicalSort(sort0=[$0], dir0=[ASC], offset=[2500000000:BIGINT], fetch=[3000000000:BIGINT])
    LogicalUnion(all=[true])
      LogicalProject(DEPTNO=[$7], JOB=[$2], SAL=[$5])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(DEPTNO=[$7], JOB=[$2], SAL=[$5])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(DEPTNO=[$0], JOB=[$1], SAL=[$2])
  EnumerableLimit(offset=[2500000000:BIGINT], fetch=[3000000000:BIGINT])
    EnumerableMergeUnion(all=[true])
      EnumerableSort(sort0=[$0], dir0=[ASC])
        EnumerableProject(DEPTNO=[$7], JOB=[$2], SAL=[$5])
          EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
      EnumerableSort(sort0=[$0], dir0=[ASC])
        EnumerableProject(DEPTNO=[$7], JOB=[$2], SAL=[$5])
          EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testEnumerableProjectRule">
    <Resource name="sql">
      <![CDATA[select R_REGIONKEY > all (select R_REGIONKEY from SALES.CUSTOMER)
from SALES.CUSTOMER]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[NOT(<= SOME($0, {
LogicalProject(R_REGIONKEY=[$0])
  LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
}))])
  LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(EXPR$0=[OR(=($2, 0), AND(>($2, $3), null, IS NOT TRUE(<=($0, $1))), AND(>($0, $1), IS NOT TRUE(<=($0, $1)), <=($2, $3)))])
  EnumerableNestedLoopJoin(condition=[true], joinType=[inner])
    EnumerableTableScan(table=[[CATALOG, SALES, CUSTOMER]])
    EnumerableAggregate(group=[{}], m=[MAX($0)], c=[COUNT()], d=[COUNT($0)])
      EnumerableProject(R_REGIONKEY=[$0])
        EnumerableTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExchangeRemoveConstantKeysRule">
    <Resource name="planBefore">
      <![CDATA[
LogicalSortExchange(distribution=[hash[0, 1]], collation=[[0, 1]])
  LogicalProject(EMPNO=[$0], ENAME=[$1])
    LogicalExchange(distribution=[hash[0]])
      LogicalFilter(condition=[=($0, 10)])
        LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalSortExchange(distribution=[hash[1]], collation=[[1]])
  LogicalProject(EMPNO=[$0], ENAME=[$1])
    LogicalExchange(distribution=[single])
      LogicalFilter(condition=[=($0, 10)])
        LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExistsDecorrelationProducesSingleValues">
    <Resource name="sql">
      <![CDATA[select empno, deptno in (select 10) from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[$9])
  LogicalJoin(condition=[=($7, $9)], joinType=[left_mark])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalValues(tuples=[[{ 10 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[$9])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExistsWithAtLeastOneRowSubQuery">
    <Resource name="sql">
      <![CDATA[select * from dept as d
where EXISTS (
  select count(*) from emp e where d.deptno = e.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalFilter(condition=[EXISTS({
LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
  LogicalProject($f0=[0])
    LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExistsWithNoRowSubQuery">
    <Resource name="sql">
      <![CDATA[select * from dept as d
where NOT EXISTS (
  select count(*) from emp e having false)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalFilter(condition=[NOT(EXISTS({
LogicalValues(tuples=[[]])
}))])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandFilterConstantInCorrelatedWithTwoSubQueries">
    <Resource name="sql">
      <![CDATA[select empno from sales.empnullables as e
where 1 in (
  select deptno from sales.deptnullables where e.ename = dname and deptno > 10)
or 2 in (
  select deptno from sales.deptnullables where e.ename = dname and deptno < 20)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[OR(IN(1, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), >($0, 10))])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}), IN(2, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), <($0, 20))])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}))], variablesSet=[[$cor0]])
    LogicalProject(EMPNO=[$0], ENAME=[$1])
      LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1])
    LogicalFilter(condition=[OR(CASE(=($2, false), null:BOOLEAN, IS NOT NULL($2), true, false), CASE(=($3, false), null:BOOLEAN, IS NOT NULL($3), true, false))])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1}])
        LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1}])
          LogicalProject(EMPNO=[$0], ENAME=[$1])
            LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
          LogicalSort(sort0=[$0], dir0=[DESC], fetch=[1])
            LogicalAggregate(group=[{0}])
              LogicalProject(cs=[IS NOT NULL($0)])
                LogicalFilter(condition=[OR(=(1, $0), IS NULL($0))])
                  LogicalProject(DEPTNO=[$0])
                    LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), >($0, 10))])
                      LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
        LogicalSort(sort0=[$0], dir0=[DESC], fetch=[1])
          LogicalAggregate(group=[{0}])
            LogicalProject(cs=[IS NOT NULL($0)])
              LogicalFilter(condition=[OR(=(2, $0), IS NULL($0))])
                LogicalProject(DEPTNO=[$0])
                  LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), <($0, 20))])
                    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandFilterConstantInWithTwoSubQueries">
    <Resource name="sql">
      <![CDATA[select empno from sales.empnullables
where 1 in (
  select deptno from sales.deptnullables where dname = 'dept1')
or 2 in (
  select deptno from sales.deptnullables where dname = 'dept2')]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalFilter(condition=[OR(IN(1, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($1, 'dept1')])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}), IN(2, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($1, 'dept2')])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}))])
  LogicalProject(EMPNO=[$0])
    LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[OR(CASE(IS NULL($2), false, =($1, false), null:BOOLEAN, IS NOT NULL($1), true, false), CASE(IS NULL($4), false, =($3, false), null:BOOLEAN, IS NOT NULL($3), true, false))])
    LogicalJoin(condition=[true], joinType=[left])
      LogicalJoin(condition=[true], joinType=[left])
        LogicalProject(EMPNO=[$0])
          LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
        LogicalSort(sort0=[$0], dir0=[DESC], fetch=[1])
          LogicalAggregate(group=[{0}], c=[COUNT()])
            LogicalProject(cs=[IS NOT NULL($0)])
              LogicalFilter(condition=[OR(=(1, $0), IS NULL($0))])
                LogicalProject(DEPTNO=[$0])
                  LogicalFilter(condition=[=($1, 'dept1')])
                    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
      LogicalSort(sort0=[$0], dir0=[DESC], fetch=[1])
        LogicalAggregate(group=[{0}], c=[COUNT()])
          LogicalProject(cs=[IS NOT NULL($0)])
            LogicalFilter(condition=[OR(=(2, $0), IS NULL($0))])
              LogicalProject(DEPTNO=[$0])
                LogicalFilter(condition=[=($1, 'dept2')])
                  LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandFilterDisjunctionForJoinInput">
    <Resource name="sql">
      <![CDATA[select e.empno from emp as e, empnullables as en, emp_b as eb
where e.empno = en.empno and e.empno = eb.empno
and
(
  (e.mgr > 100 and eb.sal < 200)
  or
  (en.comm < 50 and eb.deptno > 10)
)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[AND(=($0, $9), =($0, $18), OR(AND(>($3, 100), <($23, 200)), AND(<($15, 50), >($25, 10))), OR(>($3, 100), <($15, 50)), OR(<($23, 200), >($25, 10)))])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(=($0, $18), OR(AND(>($3, 100), <($23, 200)), AND(<($15, 50), >($25, 10))))], joinType=[inner])
    LogicalJoin(condition=[AND(=($0, $9), OR(>($3, 100), <($15, 50)))], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
    LogicalFilter(condition=[OR(<($5, 200), >($7, 10))])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandFilterExists">
    <Resource name="sql">
      <![CDATA[select empno
from sales.emp
where exists (select deptno from sales.emp where empno < 20)
or emp.sal < 100]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[OR(EXISTS({
LogicalFilter(condition=[<($0, 20)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}), <($5, 100))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[OR(IS NOT NULL($9), <($5, 100))])
      LogicalJoin(condition=[true], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{0}])
          LogicalProject(i=[true])
            LogicalFilter(condition=[<($0, 20)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandFilterExistsSimple">
    <Resource name="sql">
      <![CDATA[select empno
from sales.emp
where exists (select deptno from sales.emp where empno < 20)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[EXISTS({
LogicalFilter(condition=[<($0, 20)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{0}])
        LogicalProject(i=[true])
          LogicalFilter(condition=[<($0, 20)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandFilterExistsSimpleAnd">
    <Resource name="sql">
      <![CDATA[select empno
from sales.emp
where exists (select deptno from sales.emp where empno < 20)
and emp.sal < 100]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[AND(EXISTS({
LogicalFilter(condition=[<($0, 20)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}), <($5, 100))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[<($5, 100)])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{0}])
          LogicalProject(i=[true])
            LogicalFilter(condition=[<($0, 20)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandFilterIn">
    <Resource name="sql">
      <![CDATA[select empno
from sales.emp
where deptno in (select deptno from sales.emp where empno < 20)
or emp.sal < 100]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[OR(IN($7, {
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[<($0, 20)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}), <($5, 100))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[OR(IS NOT NULL($10), <($5, 100))])
      LogicalJoin(condition=[=($7, $9)], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{0}], i=[LITERAL_AGG(true)])
          LogicalProject(DEPTNO=[$7])
            LogicalFilter(condition=[<($0, 20)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandFilterIn3Value">
    <Resource name="sql">
      <![CDATA[select empno
from sales.emp
where empno
 < case deptno in (select case when deptno > 0 then deptno else null end
                   from sales.emp where empno < 20)
   when true then 10
   when false then 20
   else 30
   end]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[<($0, CASE(=(IN($7, {
LogicalProject(EXPR$0=[CASE(>($7, 0), CAST($7):INTEGER, null:INTEGER)])
  LogicalFilter(condition=[<($0, 20)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}), true), 10, =(IN($7, {
LogicalProject(EXPR$0=[CASE(>($7, 0), CAST($7):INTEGER, null:INTEGER)])
  LogicalFilter(condition=[<($0, 20)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}), false), 20, 30))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[<($0, CASE(=(CASE(=($9, 0), false, IS NOT NULL($12), true, <($10, $9), null:BOOLEAN, false), true), 10, =(CASE(=($9, 0), false, IS NOT NULL($12), true, <($10, $9), null:BOOLEAN, false), false), 20, 30))])
      LogicalJoin(condition=[=($7, $11)], joinType=[left])
        LogicalJoin(condition=[true], joinType=[inner])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
            LogicalProject(EXPR$0=[CASE(>($7, 0), CAST($7):INTEGER, null:INTEGER)])
              LogicalFilter(condition=[<($0, 20)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{0}], i=[LITERAL_AGG(true)])
          LogicalProject(EXPR$0=[CASE(>($7, 0), CAST($7):INTEGER, null:INTEGER)])
            LogicalFilter(condition=[<($0, 20)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandFilterInComposite">
    <Resource name="sql">
      <![CDATA[select empno
from sales.emp
where (empno, deptno) in (
  select empno, deptno from sales.emp where empno < 20)
or emp.sal < 100]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[OR(IN($0, $7, {
LogicalProject(EMPNO=[$0], DEPTNO=[$7])
  LogicalFilter(condition=[<($0, 20)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}), <($5, 100))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[OR(IS NOT NULL($11), <($5, 100))])
      LogicalJoin(condition=[AND(=($0, $9), =($7, $10))], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(EMPNO=[$0], DEPTNO=[$7], i=[true])
          LogicalFilter(condition=[<($0, 20)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandFilterInCorrelatedWithTwoSubQueries">
    <Resource name="sql">
      <![CDATA[select empno from sales.empnullables as e
where deptno in (
  select deptno from sales.deptnullables where e.ename = dname and deptno > 10)
or deptno in (
  select deptno from sales.deptnullables where e.ename = dname and deptno < 20)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[OR(IN($2, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), >($0, 10))])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}), IN($2, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), <($0, 20))])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}))], variablesSet=[[$cor0]])
    LogicalProject(EMPNO=[$0], ENAME=[$1], DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], DEPTNO=[$2])
    LogicalFilter(condition=[OR(CASE(=($3, 0), false, IS NULL($2), null:BOOLEAN, IS NOT NULL($6), true, <($4, $3), null:BOOLEAN, false), CASE(=($7, 0), false, IS NULL($2), null:BOOLEAN, IS NOT NULL($10), true, <($8, $7), null:BOOLEAN, false))])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1, 2}])
        LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1}])
          LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1, 2}])
            LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1}])
              LogicalProject(EMPNO=[$0], ENAME=[$1], DEPTNO=[$7])
                LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
              LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
                LogicalProject(DEPTNO=[$0])
                  LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), >($0, 10))])
                    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
            LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
              LogicalProject(DEPTNO=[$0], i=[true])
                LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), >($0, 10))])
                  LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
          LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
            LogicalProject(DEPTNO=[$0])
              LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), <($0, 20))])
                LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
        LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
          LogicalProject(DEPTNO=[$0], i=[true])
            LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), <($0, 20))])
              LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandFilterInWithTwoSubQueries">
    <Resource name="sql">
      <![CDATA[select empno from sales.empnullables
where deptno in (
  select deptno from sales.deptnullables where dname = 'dept1')
or deptno in (
  select deptno from sales.deptnullables where dname = 'dept2')]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[OR(IN($1, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($1, 'dept1')])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}), IN($1, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($1, 'dept2')])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}))])
    LogicalProject(EMPNO=[$0], DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], DEPTNO=[$1])
    LogicalFilter(condition=[OR(CASE(=($2, 0), false, IS NULL($1), null:BOOLEAN, IS NOT NULL($5), true, <($3, $2), null:BOOLEAN, false), CASE(=($6, 0), false, IS NULL($1), null:BOOLEAN, IS NOT NULL($9), true, <($7, $6), null:BOOLEAN, false))])
      LogicalJoin(condition=[=($1, $8)], joinType=[left])
        LogicalJoin(condition=[true], joinType=[inner])
          LogicalJoin(condition=[=($1, $4)], joinType=[left])
            LogicalJoin(condition=[true], joinType=[inner])
              LogicalProject(EMPNO=[$0], DEPTNO=[$7])
                LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
              LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
                LogicalProject(DEPTNO=[$0])
                  LogicalFilter(condition=[=($1, 'dept1')])
                    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
            LogicalProject(DEPTNO=[$0], i=[true])
              LogicalFilter(condition=[=($1, 'dept1')])
                LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
          LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
            LogicalProject(DEPTNO=[$0])
              LogicalFilter(condition=[=($1, 'dept2')])
                LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
        LogicalProject(DEPTNO=[$0], i=[true])
          LogicalFilter(condition=[=($1, 'dept2')])
            LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandFilterScalar">
    <Resource name="sql">
      <![CDATA[select empno
from sales.emp
where (select deptno from sales.emp where empno < 20)
 < (select deptno from sales.emp where empno > 100)
or emp.sal < 100]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[OR(<($SCALAR_QUERY({
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[<($0, 20)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}), $SCALAR_QUERY({
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[>($0, 100)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})), <($5, 100))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[OR(<($9, $10), <($5, 100))])
      LogicalJoin(condition=[true], joinType=[left])
        LogicalJoin(condition=[true], joinType=[left])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalAggregate(group=[{}], agg#0=[SINGLE_VALUE($0)])
            LogicalProject(DEPTNO=[$7])
              LogicalFilter(condition=[<($0, 20)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{}], agg#0=[SINGLE_VALUE($0)])
          LogicalProject(DEPTNO=[$7])
            LogicalFilter(condition=[>($0, 100)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandJoinDisjunctionForJoinInput">
    <Resource name="sql">
      <![CDATA[select e.empno from emp as e inner join empnullables as en
 on e.empno = en.empno
 inner join emp_b as eb
 on e.empno = eb.empno and
(
  (e.mgr > 100 and eb.sal < 200)
  or
  (en.comm < 50 and eb.deptno > 10)
)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(=($0, $18), OR(AND(>($3, 100), <($23, 200)), AND(<($15, 50), >($25, 10))), OR(>($3, 100), <($15, 50)), OR(<($23, 200), >($25, 10)))], joinType=[inner])
    LogicalJoin(condition=[=($0, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(=($0, $18), OR(AND(>($3, 100), <($23, 200)), AND(<($15, 50), >($25, 10))))], joinType=[inner])
    LogicalJoin(condition=[AND(=($0, $9), OR(>($3, 100), <($15, 50)))], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
    LogicalFilter(condition=[OR(<($5, 200), >($7, 10))])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandJoinExists">
    <Resource name="sql">
      <![CDATA[select empno
from sales.emp left join sales.dept
on exists (select deptno from sales.emp where empno < 20)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[EXISTS({
LogicalFilter(condition=[<($0, 20)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
    LogicalJoin(condition=[true], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalAggregate(group=[{0}])
          LogicalProject(i=[true])
            LogicalFilter(condition=[<($0, 20)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandJoinIn">
    <Resource name="sql">
      <![CDATA[select empno
from sales.emp left join sales.dept
on emp.deptno in (select deptno from sales.emp where empno < 20)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[IN($7, {
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[<($0, 20)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
    LogicalJoin(condition=[true], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalJoin(condition=[=($7, $11)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalAggregate(group=[{0}])
          LogicalProject(DEPTNO=[$7])
            LogicalFilter(condition=[<($0, 20)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandJoinInComposite">
    <Resource name="sql">
      <![CDATA[select empno
from sales.emp left join sales.dept
on (emp.empno, dept.deptno) in (
  select empno, deptno from sales.emp where empno < 20)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[IN($0, $9, {
LogicalProject(EMPNO=[$0], DEPTNO=[$7])
  LogicalFilter(condition=[<($0, 20)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
    LogicalJoin(condition=[true], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalJoin(condition=[AND(=($0, $11), =($9, $12))], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalAggregate(group=[{0, 1}])
          LogicalProject(EMPNO=[$0], DEPTNO=[$7])
            LogicalFilter(condition=[<($0, 20)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandJoinScalar">
    <Resource name="sql">
      <![CDATA[select empno
from sales.emp left join sales.dept
on (select deptno from sales.emp where empno < 20)
 < (select deptno from sales.emp where empno > 100)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[<($SCALAR_QUERY({
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[<($0, 20)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}), $SCALAR_QUERY({
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[>($0, 100)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10], $f0=[$11])
      LogicalJoin(condition=[<($11, $12)], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalJoin(condition=[true], joinType=[left])
          LogicalJoin(condition=[true], joinType=[left])
            LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
            LogicalAggregate(group=[{}], agg#0=[SINGLE_VALUE($0)])
              LogicalProject(DEPTNO=[$7])
                LogicalFilter(condition=[<($0, 20)])
                  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalAggregate(group=[{}], agg#0=[SINGLE_VALUE($0)])
            LogicalProject(DEPTNO=[$7])
              LogicalFilter(condition=[>($0, 100)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandProjectExists">
    <Resource name="sql">
      <![CDATA[select empno,
  exists (select deptno from sales.emp where empno < 20) as d
from sales.emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], D=[EXISTS({
LogicalFilter(condition=[<($0, 20)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], D=[IS NOT NULL($9)])
  LogicalJoin(condition=[true], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}])
      LogicalProject(i=[true])
        LogicalFilter(condition=[<($0, 20)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandProjectIn">
    <Resource name="sql">
      <![CDATA[select empno,
  deptno in (select deptno from sales.emp where empno < 20) as d
from sales.emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], D=[IN($7, {
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[<($0, 20)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], D=[CASE(IS NOT NULL($10), true, false)])
  LogicalJoin(condition=[=($7, $9)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], i=[LITERAL_AGG(true)])
      LogicalProject(DEPTNO=[$7])
        LogicalFilter(condition=[<($0, 20)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandProjectInComposite">
    <Resource name="sql">
      <![CDATA[select empno, (empno, deptno) in (
    select empno, deptno from sales.emp where empno < 20) as d
from sales.emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], D=[IN($0, $7, {
LogicalProject(EMPNO=[$0], DEPTNO=[$7])
  LogicalFilter(condition=[<($0, 20)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], D=[CASE(IS NOT NULL($11), true, false)])
  LogicalJoin(condition=[AND(=($0, $9), =($7, $10))], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EMPNO=[$0], DEPTNO=[$7], i=[true])
      LogicalFilter(condition=[<($0, 20)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandProjectInNullable">
    <Resource name="sql">
      <![CDATA[with e2 as (
  select empno, case when deptno > 0 then deptno else null end as deptno
  from sales.emp)
select empno,
  deptno in (select deptno from e2 where empno < 20) as d
from e2]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], D=[IN(CASE(>($7, 0), CAST($7):INTEGER, null:INTEGER), {
LogicalProject(DEPTNO=[$1])
  LogicalFilter(condition=[<($0, 20)])
    LogicalProject(EMPNO=[$0], DEPTNO=[CASE(>($7, 0), CAST($7):INTEGER, null:INTEGER)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], D=[CASE(=($9, 0), false, IS NULL(CASE(>($7, 0), CAST($7):INTEGER, null:INTEGER)), null:BOOLEAN, IS NOT NULL($12), true, <($10, $9), null:BOOLEAN, false)])
  LogicalJoin(condition=[=(CASE(>($7, 0), CAST($7):INTEGER, null:INTEGER), $11)], joinType=[left])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
        LogicalProject(DEPTNO=[$1])
          LogicalFilter(condition=[<($0, 20)])
            LogicalProject(EMPNO=[$0], DEPTNO=[CASE(>($7, 0), CAST($7):INTEGER, null:INTEGER)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], i=[LITERAL_AGG(true)])
      LogicalProject(DEPTNO=[$1])
        LogicalFilter(condition=[<($0, 20)])
          LogicalProject(EMPNO=[$0], DEPTNO=[CASE(>($7, 0), CAST($7):INTEGER, null:INTEGER)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandProjectInWithTwoCorrelatedSubQueries">
    <Resource name="sql">
      <![CDATA[select empno, deptno in (
  select deptno from sales.deptnullables where e.ename = dname and deptno > 10)
or deptno in (
  select deptno from sales.deptnullables where e.ename = dname and deptno < 20)
from sales.empnullables as e]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], EMPNO=[$0], EXPR$1=[OR(IN($2, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), >($0, 10))])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}), IN($2, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), <($0, 20))])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}))])
  LogicalProject(EMPNO=[$0], ENAME=[$1], DEPTNO=[$7])
    LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[OR(CASE(=($3, 0), false, IS NULL($2), null:BOOLEAN, IS NOT NULL($6), true, <($4, $3), null:BOOLEAN, false), CASE(=($7, 0), false, IS NULL($2), null:BOOLEAN, IS NOT NULL($10), true, <($8, $7), null:BOOLEAN, false))])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1, 2}])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1}])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1, 2}])
        LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1}])
          LogicalProject(EMPNO=[$0], ENAME=[$1], DEPTNO=[$7])
            LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
          LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
            LogicalProject(DEPTNO=[$0])
              LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), >($0, 10))])
                LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
        LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
          LogicalProject(DEPTNO=[$0], i=[true])
            LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), >($0, 10))])
              LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
      LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
        LogicalProject(DEPTNO=[$0])
          LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), <($0, 20))])
            LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
    LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
      LogicalProject(DEPTNO=[$0], i=[true])
        LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), <($0, 20))])
          LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandProjectInWithTwoSubQueries">
    <Resource name="sql">
      <![CDATA[select empno, deptno in (
  select deptno from sales.deptnullables where dname = 'dept1')
or deptno in (
  select deptno from sales.deptnullables where dname = 'dept2')
from sales.empnullables]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[OR(IN($7, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($1, 'dept1')])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}), IN($7, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($1, 'dept2')])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}))])
  LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[OR(CASE(=($9, 0), false, IS NULL($7), null:BOOLEAN, IS NOT NULL($12), true, <($10, $9), null:BOOLEAN, false), CASE(=($13, 0), false, IS NULL($7), null:BOOLEAN, IS NOT NULL($16), true, <($14, $13), null:BOOLEAN, false))])
  LogicalJoin(condition=[=($7, $15)], joinType=[left])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalJoin(condition=[=($7, $11)], joinType=[left])
        LogicalJoin(condition=[true], joinType=[inner])
          LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
          LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
            LogicalProject(DEPTNO=[$0])
              LogicalFilter(condition=[=($1, 'dept1')])
                LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
        LogicalProject(DEPTNO=[$0], i=[true])
          LogicalFilter(condition=[=($1, 'dept1')])
            LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
      LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
        LogicalProject(DEPTNO=[$0])
          LogicalFilter(condition=[=($1, 'dept2')])
            LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
    LogicalProject(DEPTNO=[$0], i=[true])
      LogicalFilter(condition=[=($1, 'dept2')])
        LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandProjectScalar">
    <Resource name="sql">
      <![CDATA[select empno,
  (select deptno from sales.emp where empno < 20) as d
from sales.emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], D=[$SCALAR_QUERY({
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[<($0, 20)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], D=[$9])
  LogicalJoin(condition=[true], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{}], agg#0=[SINGLE_VALUE($0)])
      LogicalProject(DEPTNO=[$7])
        LogicalFilter(condition=[<($0, 20)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpandWhereComparisonCorrelated">
    <Resource name="sql">
      <![CDATA[select empno
from sales.emp as e
where sal = (
  select max(sal) from sales.emp e2 where e2.empno = e.empno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[=($5, $SCALAR_QUERY({
LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
  LogicalProject(SAL=[$5])
    LogicalFilter(condition=[=($0, $cor0.EMPNO)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($5, $9)])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
          LogicalProject(SAL=[$5])
            LogicalFilter(condition=[=($0, $cor0.EMPNO)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExpressionInWindowFunction">
    <Resource name="sql">
      <![CDATA[select
 sum(deptno) over(partition by deptno order by sal) as sum1,
sum(deptno + sal) over(partition by deptno order by sal) as sum2
from emp]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(SUM1=[$3], SUM2=[$4])
  LogicalWindow(window#0=[window(partition {1} order by [0] aggs [SUM($1), SUM($2)])])
    LogicalProject(SAL=[$5], DEPTNO=[$7], $2=[+($7, $5)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(SUM1=[SUM($7) OVER (PARTITION BY $7 ORDER BY $5)], SUM2=[SUM(+($7, $5)) OVER (PARTITION BY $7 ORDER BY $5)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExtractYearMonthToRange">
    <Resource name="sql">
      <![CDATA[select *
from sales.emp_b as e
where extract(year from birthdate) = 2014and extract(month from birthdate) = 4]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], BIRTHDATE=[$9])
  LogicalFilter(condition=[AND(=(EXTRACT(FLAG(YEAR), $9), 2014), =(EXTRACT(FLAG(MONTH), $9), 4))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], BIRTHDATE=[$9])
  LogicalFilter(condition=[SEARCH($9, Sarg[[2014-04-01..2014-05-01)])])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testExtractYearToRange">
    <Resource name="sql">
      <![CDATA[select *
from sales.emp_b as e
where extract(year from birthdate) = 2014]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], BIRTHDATE=[$9])
  LogicalFilter(condition=[=(EXTRACT(FLAG(YEAR), $9), 2014)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], BIRTHDATE=[$9])
  LogicalFilter(condition=[SEARCH($9, Sarg[[2014-01-01..2015-01-01)])])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testFilterAndProjectWithMultiJoin">
    <Resource name="sql">
      <![CDATA[select * from emp e1 left outer join dept d on e1.deptno = d.deptno where d.deptno > 3]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
MyProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  MyFilter(condition=[>($9, 3)])
    LogicalJoin(condition=[=($7, $9)], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[INNER, LEFT]], outerJoinConditions=[[NULL, =($7, $9)]], projFields=[[{0, 1, 2, 3, 4, 5, 6, 7, 8}, {0, 1}]], postJoinFilter=[>($9, 3)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testFilterIntoJoinMissingVariableCor">
    <Resource name="sql">
      <![CDATA[SELECT E.EMPNO
FROM EMP E
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
WHERE  E.EMPNO > 10 AND D.DEPTNO = (
  SELECT MIN(D_INNER.DEPTNO)
  FROM DEPT D_INNER
  WHERE D_INNER.DEPTNO = E.DEPTNO)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[AND(>($0, 10), =($9, $SCALAR_QUERY({
LogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
  LogicalProject(DEPTNO=[$0])
    LogicalFilter(condition=[=($0, $cor0.DEPTNO)])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})))], variablesSet=[[$cor0]])
    LogicalJoin(condition=[=($7, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[=($9, $SCALAR_QUERY({
LogicalAggregate(group=[{}], EXPR$0=[MIN($0)])
  LogicalProject(DEPTNO=[$0])
    LogicalFilter(condition=[=($0, $cor0.DEPTNO)])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
}))])
    LogicalJoin(condition=[=($7, $9)], joinType=[inner])
      LogicalFilter(condition=[>($0, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testFilterProjectTranspose">
    <Resource name="sql">
      <![CDATA[SELECT e.empno
FROM emp as e
WHERE exists (
  SELECT *
  FROM (
    SELECT deptno * 2 AS twiceDeptno
    FROM dept) AS d
  WHERE e.deptno = d.twiceDeptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[IS NOT NULL($9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], agg#0=[MIN($0)])
        LogicalProject($f0=[true])
          LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
            LogicalProject(TWICEDEPTNO=[*($0, 2)])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[IS NOT NULL($9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], agg#0=[MIN($0)])
        LogicalProject($f0=[true])
          LogicalProject(TWICEDEPTNO=[*($0, 2)])
            LogicalFilter(condition=[=($cor0.DEPTNO, *($0, 2))])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testFilterProjectTransposeBloat">
    <Resource name="sql">
      <![CDATA[SELECT x1 from
    (SELECT 'L1' || x0  || x0 || x0 || x0 as x1 from
        (SELECT 'L0' || ENAME || ENAME || ENAME || ENAME as x0 from emp) t1) t2
WHERE x1 = 'Something']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(X1=[$0])
  LogicalFilter(condition=[=($0, 'Something')])
    LogicalProject(X1=[||(||(||(||('L1', $0), $0), $0), $0)])
      LogicalProject(X0=[||(||(||(||('L0', $1), $1), $1), $1)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(X1=[$0])
  LogicalProject(X1=[||(||(||(||('L1', $0), $0), $0), $0)])
    LogicalFilter(condition=[=(||(||(||(||('L1', $0), $0), $0), $0), 'Something')])
      LogicalProject(X0=[||(||(||(||('L0', $1), $1), $1), $1)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testFilterProjectTransposePreventedByCorrelation">
    <Resource name="sql">
      <![CDATA[SELECT e.empno
FROM emp as e
WHERE exists (
  SELECT *
  FROM (
    SELECT deptno * 2 AS twiceDeptno
    FROM dept) AS d
  WHERE e.deptno = d.twiceDeptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[IS NOT NULL($9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], agg#0=[MIN($0)])
        LogicalProject($f0=[true])
          LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
            LogicalProject(TWICEDEPTNO=[*($0, 2)])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testFilterRemoveIsNotDistinctFromRule">
    <Resource name="planBefore">
      <![CDATA[
LogicalFilter(condition=[IS NOT DISTINCT FROM($7, 20)])
  LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalFilter(condition=[=($7, 20)])
  LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testFilterSortTranspose">
    <Resource name="planBefore">
      <![CDATA[
LogicalFilter(condition=[<($0, 10)])
  LogicalSort(sort0=[$0], dir0=[ASC])
    LogicalProject(EMPNO=[$0])
      LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC])
  LogicalFilter(condition=[<($0, 10)])
    LogicalProject(EMPNO=[$0])
      LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testFilterSortTransposeFetch">
    <Resource name="planBefore">
      <![CDATA[
LogicalFilter(condition=[<($0, 10)])
  LogicalSort(sort0=[$0], dir0=[ASC], fetch=[1])
    LogicalProject(EMPNO=[$0])
      LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testFilterSortTransposeOffset">
    <Resource name="planBefore">
      <![CDATA[
LogicalFilter(condition=[<($0, 10)])
  LogicalSort(sort0=[$0], dir0=[ASC], offset=[1], fetch=[0])
    LogicalProject(EMPNO=[$0])
      LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testFlattenUncorrelatedCallBelowEquals">
    <Resource name="sql">
      <![CDATA[select * from emp e1 where exists (select * from emp e2 where e1.deptno = (e2.deptno+30))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IS NOT NULL($9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], agg#0=[MIN($0)])
        LogicalProject($f0=[true])
          LogicalFilter(condition=[=($cor0.DEPTNO, +($7, 30))])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IS NOT NULL($9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], agg#0=[MIN($0)])
        LogicalProject($f0=[true])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
            LogicalFilter(condition=[=($cor0.DEPTNO, $9)])
              LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[+($7, 30)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testFlattenUncorrelatedTwoLevelCallBelowEqualsSucceeds">
    <Resource name="sql">
      <![CDATA[select * from emp e1 where exists (select * from emp e2 where e1.deptno = (2 * e2.deptno+30))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IS NOT NULL($9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], agg#0=[MIN($0)])
        LogicalProject($f0=[true])
          LogicalFilter(condition=[=($cor0.DEPTNO, +(*(2, $7), 30))])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IS NOT NULL($9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], agg#0=[MIN($0)])
        LogicalProject($f0=[true])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
            LogicalFilter(condition=[=($cor0.DEPTNO, $9)])
              LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[+(*(2, $7), 30)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testFullLeftSemiJoinTypeForDphyp">
    <Resource name="sql">
      <![CDATA[select emp.empno from emp_address full join emp on emp_address.empno = emp.empno left join dept on emp.deptno = dept.deptno where exists(select * from dept_nested where dept.deptno = dept_nested.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$9])
  HyperGraph(edges=[{0, 1, 2}——[SEMI, =(node(2)_field(0), node(3)_field(0))]——{3},{0, 1}——[LEFT, =(node(1)_field(7), node(2)_field(0))]——{2},{0}——[FULL, =(node(0)_field(0), node(1)_field(0))]——{1}])
    LogicalProject(EMPNO=[$0], STREET=[$1.STREET], CITY=[$1.CITY], ZIP=[$1.ZIP], STATE=[$1.STATE], STREET5=[$2.STREET], CITY6=[$2.CITY], ZIP7=[$2.ZIP], STATE8=[$2.STATE])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$0], $f0=[true])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[=($18, $20)], joinType=[semi])
    LogicalJoin(condition=[=($7, $18)], joinType=[left])
      LogicalJoin(condition=[=($9, $0)], joinType=[full])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(EMPNO=[$0], STREET=[$1.STREET], CITY=[$1.CITY], ZIP=[$1.ZIP], STATE=[$1.STATE], STREET5=[$2.STREET], CITY6=[$2.CITY], ZIP7=[$2.ZIP], STATE8=[$2.STATE])
          LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$0], $f0=[true])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testGroupByBooleanLiteralSimple">
    <Resource name="sql">
      <![CDATA[select avg(sal)
from emp
group by true]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[$1])
  LogicalAggregate(group=[{0}], EXPR$0=[AVG($1)])
    LogicalProject($f0=[true], SAL=[$5])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$1])
  LogicalAggregate(group=[{0}], EXPR$0=[AVG($1)])
    LogicalProject($f0=[$9], SAL=[$5])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalValues(tuples=[[{ true }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testGroupByDateLiteralSimple">
    <Resource name="sql">
      <![CDATA[select avg(sal)
from emp
group by DATE '2022-01-01']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[$1])
  LogicalAggregate(group=[{0}], EXPR$0=[AVG($1)])
    LogicalProject($f0=[2022-01-01], SAL=[$5])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$1])
  LogicalAggregate(group=[{0}], EXPR$0=[AVG($1)])
    LogicalProject($f0=[$9], SAL=[$5])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalValues(tuples=[[{ 2022-01-01 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testGroupByMultipleLiterals">
    <Resource name="sql">
      <![CDATA[select avg(sal)
from emp
group by false, deptno, true, true, empno, false, 'ab', DATE '2022-01-01']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[$6])
  LogicalAggregate(group=[{0, 1, 2, 3, 4, 5}], EXPR$0=[AVG($6)])
    LogicalProject($f0=[false], DEPTNO=[$7], $f2=[true], EMPNO=[$0], $f4=['ab'], $f5=[2022-01-01], SAL=[$5])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$6])
  LogicalAggregate(group=[{0, 1, 2, 3, 4, 5}], EXPR$0=[AVG($6)])
    LogicalProject($f0=[$9], DEPTNO=[$7], $f2=[$10], EMPNO=[$0], $f4=[$11], $f5=[$12], SAL=[$5])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalValues(tuples=[[{ false, true, 'ab', 2022-01-01 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testHeterogeneousConversion">
    <Resource name="sql">
      <![CDATA[select upper(ename) from emp union all
select lower(ename) from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(EXPR$0=[UPPER($1)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EXPR$0=[LOWER($1)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalCalc(expr#0..8=[{inputs}], expr#9=[UPPER($t1)], EXPR$0=[$t9])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EXPR$0=[LOWER($1)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testHypergraph0">
    <Resource name="sql">
      <![CDATA[select a.ename, bc.dname from bonus a inner join (select b.empno, b.ename, c.dname from emp b inner join dept c on b.deptno = c.deptno) bc on a.ename = bc.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], DNAME=[$14])
  HyperGraph(edges=[{0}——[INNER, =(node(0)_field(0), node(1)_field(1))]——{1},{1}——[INNER, =(node(1)_field(7), node(2)_field(0))]——{2}])
    LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$11], DNAME=[$1])
  LogicalJoin(condition=[=($9, $0)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalJoin(condition=[=($9, $1)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testHypergraph1">
    <Resource name="sql">
      <![CDATA[select a.ename, bcde.dname from bonus a inner join (  select b.empno, b.ename, c.dname   from emp b   inner join dept c on b.deptno = c.deptno   inner join emp_address d on d.empno = b.empno   inner join salgrade e on b.sal = e.hisal) bcde on a.ename = bcde.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], DNAME=[$14])
  HyperGraph(edges=[{0}——[INNER, =(node(0)_field(0), node(1)_field(1))]——{1},{1}——[INNER, =(node(1)_field(5), node(4)_field(2))]——{4},{1}——[INNER, =(node(3)_field(0), node(1)_field(0))]——{3},{1}——[INNER, =(node(1)_field(7), node(2)_field(0))]——{2}])
    LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
    LogicalTableScan(table=[[CATALOG, SALES, SALGRADE]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$17], DNAME=[$7])
  LogicalJoin(condition=[=($0, $8)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
    LogicalJoin(condition=[=($10, $2)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, SALGRADE]])
      LogicalJoin(condition=[=($9, $0)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalJoin(condition=[=($9, $1)], joinType=[inner])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testHypergraph2">
    <Resource name="sql">
      <![CDATA[select ab.ename, cdef.dname from (select a.ename from bonus a inner join emp b on a.ename = b.ename) ab inner join (  select c.empno, c.ename, d.dname   from emp c   inner join dept d on c.deptno = d.deptno   inner join emp_address e on e.empno = c.empno   inner join salgrade f on c.sal = f.hisal) cdef on ab.ename = cdef.ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], DNAME=[$23])
  HyperGraph(edges=[{0}——[INNER, =(node(0)_field(0), node(2)_field(1))]——{2},{0}——[INNER, =(node(0)_field(0), node(1)_field(1))]——{1},{2}——[INNER, =(node(2)_field(5), node(5)_field(2))]——{5},{2}——[INNER, =(node(4)_field(0), node(2)_field(0))]——{4},{2}——[INNER, =(node(2)_field(7), node(3)_field(0))]——{3}])
    LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
    LogicalTableScan(table=[[CATALOG, SALES, SALGRADE]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$26], DNAME=[$16])
  LogicalJoin(condition=[=($0, $17)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
    LogicalJoin(condition=[=($23, $1)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalJoin(condition=[=($10, $2)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, SALGRADE]])
        LogicalJoin(condition=[=($9, $0)], joinType=[inner])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
          LogicalJoin(condition=[=($9, $1)], joinType=[inner])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
            LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testInOptimizationBothNotNull">
    <Resource name="sql">
      <![CDATA[select * from emp as e1
where empno in (
  select empno from emp e2)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IN($0, {
LogicalProject(EMPNO=[$0])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalJoin(condition=[=($0, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testInWithNoRowSubQuery">
    <Resource name="sql">
      <![CDATA[select * from dept as d
where deptno in (
  select deptno from emp e where false)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalFilter(condition=[IN($0, {
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[false])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testIncorrectInType">
    <Resource name="sql">
      <![CDATA[select ename from emp   where ename in ( 'Sebastian' ) and ename = 'Sebastian' and deptno < 100]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0])
  LogicalFilter(condition=[AND(=($0, 'Sebastian'), <($1, 100))])
    LogicalProject(ENAME=[$1], DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testInferringPredicatesWithNotOperatorInJoinCondition">
    <Resource name="sql">
      <![CDATA[select * from sales.emp d
join sales.emp e on e.deptno = d.deptno and d.deptno not in (4, 6)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], EMPNO0=[$9], ENAME0=[$10], JOB0=[$11], MGR0=[$12], HIREDATE0=[$13], SAL0=[$14], COMM0=[$15], DEPTNO0=[$16], SLACKER0=[$17])
  LogicalJoin(condition=[AND(=($16, $7), NOT(OR(=($7, 4), =($7, 6))))], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], EMPNO0=[$9], ENAME0=[$10], JOB0=[$11], MGR0=[$12], HIREDATE0=[$13], SAL0=[$14], COMM0=[$15], DEPTNO0=[$16], SLACKER0=[$17])
  LogicalJoin(condition=[=($16, $7)], joinType=[inner])
    LogicalFilter(condition=[NOT(OR(=($7, 4), =($7, 6)))])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalFilter(condition=[SEARCH($7, Sarg[(-∞..4), (4..6), (6..+∞)])])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testInnerCorrelateWithLeftEmpty">
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
  LogicalValues(tuples=[[]])
  LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testInnerCorrelateWithNoneEmpty">
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
  LogicalTableScan(table=[[scott, EMP]])
  LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testInnerCorrelateWithRightEmpty">
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
  LogicalTableScan(table=[[scott, EMP]])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testInnerJoinWithConstantRowOnLeft">
    <Resource name="sql">
      <![CDATA[select e.empno, e.ename, c.* from (select 5 as nm) c inner join emp e on e.empno = c.nm]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$1], ENAME=[$2], NM=[$0])
  LogicalJoin(condition=[=($1, $0)], joinType=[inner])
    LogicalValues(tuples=[[{ 5 }]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$1], ENAME=[$2], NM=[$0])
  LogicalProject($f0=[5], EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($0, 5)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testInnerJoinWithConstantRowOnRight">
    <Resource name="sql">
      <![CDATA[select e.empno, e.ename, c.* from emp e inner join (select 5 as nm) c  on e.empno = c.nm]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], NM=[$9])
  LogicalJoin(condition=[=($0, $9)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalValues(tuples=[[{ 5 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], NM=[$9])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[5])
    LogicalFilter(condition=[=($0, 5)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testInnerJoinWithTimeStampSingleRowOnLeft">
    <Resource name="sql">
      <![CDATA[select e.empno, e.ename, c.t from (select 7934 as ono, current_timestamp as t) c inner join emp e on e.empno=c.ono]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$2], ENAME=[$3], T=[$1])
  LogicalJoin(condition=[=($2, $0)], joinType=[inner])
    LogicalProject(ONO=[7934], T=[CURRENT_TIMESTAMP])
      LogicalValues(tuples=[[{ 0 }]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$2], ENAME=[$3], T=[$1])
  LogicalProject($f0=[7934], $f1=[CURRENT_TIMESTAMP], EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($0, 7934)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testInnerJoinWithTimeStampSingleRowOnRight">
    <Resource name="sql">
      <![CDATA[select e.empno, e.ename, c.t from emp e inner join (select 7934 as ono, current_timestamp as t) c on e.empno=c.ono]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], T=[$10])
  LogicalJoin(condition=[=($0, $9)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(ONO=[7934], T=[CURRENT_TIMESTAMP])
      LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], T=[$10])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[7934], $f10=[CURRENT_TIMESTAMP])
    LogicalFilter(condition=[=($0, 7934)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testInnerLeftSemiJoinTypeForDphyp">
    <Resource name="sql">
      <![CDATA[select emp.empno from emp_address inner join emp on emp_address.empno = emp.empno left join dept on emp.deptno = dept.deptno where exists(select * from dept_nested where dept.deptno = dept_nested.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$9])
  HyperGraph(edges=[{1, 2}——[SEMI, =(node(2)_field(0), node(3)_field(0))]——{3},{1}——[LEFT, =(node(1)_field(7), node(2)_field(0))]——{2},{0}——[INNER, =(node(0)_field(0), node(1)_field(0))]——{1}])
    LogicalProject(EMPNO=[$0], STREET=[$1.STREET], CITY=[$1.CITY], ZIP=[$1.ZIP], STATE=[$1.STATE], STREET5=[$2.STREET], CITY6=[$2.CITY], ZIP7=[$2.ZIP], STATE8=[$2.STATE])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$0], $f0=[true])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[=($11, $0)], joinType=[inner])
    LogicalJoin(condition=[=($9, $11)], joinType=[semi])
      LogicalJoin(condition=[=($7, $9)], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalProject(DEPTNO=[$0], $f0=[true])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
    LogicalProject(EMPNO=[$0], STREET=[$1.STREET], CITY=[$1.CITY], ZIP=[$1.ZIP], STATE=[$1.STATE], STREET5=[$2.STREET], CITY6=[$2.CITY], ZIP7=[$2.ZIP], STATE8=[$2.STATE])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testIntersectReorderRule">
    <Resource name="sql">
      <![CDATA[select deptno from emp
intersect
select deptno from emp where deptno > 5
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalIntersect(all=[false])
  LogicalProject(DEPTNO=[$7])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(DEPTNO=[$7])
    LogicalFilter(condition=[>($7, 5)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableIntersect(all=[false])
  EnumerableProject(DEPTNO=[$7])
    EnumerableFilter(condition=[>($7, 5)])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableProject(DEPTNO=[$7])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testIntersectReorderRuleAll">
    <Resource name="sql">
      <![CDATA[select deptno from emp
intersect all
select deptno from emp where deptno > 5
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalIntersect(all=[true])
  LogicalProject(DEPTNO=[$7])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(DEPTNO=[$7])
    LogicalFilter(condition=[>($7, 5)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableIntersect(all=[true])
  EnumerableProject(DEPTNO=[$7])
    EnumerableFilter(condition=[>($7, 5)])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableProject(DEPTNO=[$7])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testIntersectReorderRuleSameRowCount">
    <Resource name="sql">
      <![CDATA[select deptno from emp where deptno > 10
intersect
select deptno from emp where deptno > 5
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalIntersect(all=[false])
  LogicalProject(DEPTNO=[$7])
    LogicalFilter(condition=[>($7, 10)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(DEPTNO=[$7])
    LogicalFilter(condition=[>($7, 5)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableIntersect(all=[false])
  EnumerableProject(DEPTNO=[$7])
    EnumerableFilter(condition=[>($7, 10)])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
  EnumerableProject(DEPTNO=[$7])
    EnumerableFilter(condition=[>($7, 5)])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testIntersectToDistinct">
    <Resource name="sql">
      <![CDATA[select * from emp where deptno = 10
intersect
select * from emp where deptno = 20
intersect
select * from emp where deptno = 30
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalIntersect(all=[false])
  LogicalIntersect(all=[false])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[=($7, 20)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($7, 30)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[=($9, 3)])
    LogicalAggregate(group=[{0, 1, 2, 3, 4, 5, 6, 7, 8}], agg#0=[COUNT()])
      LogicalUnion(all=[true])
        LogicalAggregate(group=[{0, 1, 2, 3, 4, 5, 6, 7, 8}], agg#0=[COUNT()])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
            LogicalFilter(condition=[=($7, 10)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{0, 1, 2, 3, 4, 5, 6, 7, 8}], agg#0=[COUNT()])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
            LogicalFilter(condition=[=($7, 20)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{0, 1, 2, 3, 4, 5, 6, 7, 8}], agg#0=[COUNT()])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
            LogicalFilter(condition=[=($7, 30)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testIntersectToDistinctAll">
    <Resource name="sql">
      <![CDATA[select * from emp where deptno = 10
intersect
select * from emp where deptno = 20
intersect all
select * from emp where deptno = 30
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalIntersect(all=[true])
  LogicalIntersect(all=[false])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[=($7, 20)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($7, 30)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalIntersect(all=[true])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($9, 2)])
      LogicalAggregate(group=[{0, 1, 2, 3, 4, 5, 6, 7, 8}], agg#0=[COUNT()])
        LogicalUnion(all=[true])
          LogicalAggregate(group=[{0, 1, 2, 3, 4, 5, 6, 7, 8}], agg#0=[COUNT()])
            LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
              LogicalFilter(condition=[=($7, 10)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalAggregate(group=[{0, 1, 2, 3, 4, 5, 6, 7, 8}], agg#0=[COUNT()])
            LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
              LogicalFilter(condition=[=($7, 20)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($7, 30)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testIntersectToDistinctAllNoAggregatePushdown">
    <Resource name="sql">
      <![CDATA[select * from emp where deptno = 10
intersect
select * from emp where deptno = 20
intersect all
select * from emp where deptno = 30
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalIntersect(all=[true])
  LogicalIntersect(all=[false])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[=($7, 20)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($7, 30)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalIntersect(all=[true])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[AND(>($9, 0), >($10, 0))])
      LogicalAggregate(group=[{0, 1, 2, 3, 4, 5, 6, 7, 8}], count_i0=[COUNT() FILTER $9], count_i1=[COUNT() FILTER $10])
        LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f10=[=($9, 0)], $f11=[=($9, 1)])
          LogicalUnion(all=[true])
            LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], i=[0])
              LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
                LogicalFilter(condition=[=($7, 10)])
                  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
            LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], i=[1])
              LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
                LogicalFilter(condition=[=($7, 20)])
                  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($7, 30)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testIntersectToDistinctNoAggregatePushdown">
    <Resource name="sql">
      <![CDATA[select * from emp where deptno = 10
intersect
select * from emp where deptno = 20
intersect
select * from emp where deptno = 30
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalIntersect(all=[false])
  LogicalIntersect(all=[false])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[=($7, 20)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($7, 30)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[AND(>($9, 0), >($10, 0), >($11, 0))])
    LogicalAggregate(group=[{0, 1, 2, 3, 4, 5, 6, 7, 8}], count_i0=[COUNT() FILTER $9], count_i1=[COUNT() FILTER $10], count_i2=[COUNT() FILTER $11])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f10=[=($9, 0)], $f11=[=($9, 1)], $f12=[=($9, 2)])
        LogicalUnion(all=[true])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], i=[0])
            LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
              LogicalFilter(condition=[=($7, 10)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], i=[1])
            LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
              LogicalFilter(condition=[=($7, 20)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], i=[2])
            LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
              LogicalFilter(condition=[=($7, 30)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testIsNullPushDown">
    <Resource name="sql">
      <![CDATA[select empno, deptno, w_count from (
  select empno, deptno, count(empno) over (w) w_count
  from emp
  window w as (partition by deptno order by empno)
) sub_query where w_count is null]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], DEPTNO=[$1], W_COUNT=[$2])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], DEPTNO=[$1], W_COUNT=[$2])
  LogicalFilter(condition=[IS NULL($2)])
    LogicalProject(EMPNO=[$0], DEPTNO=[$7], W_COUNT=[$9])
      LogicalWindow(window#0=[window(partition {7} order by [0] aggs [COUNT($0)])])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testIsNullPushDown2">
    <Resource name="sql">
      <![CDATA[select empno, deptno, w_count from (
  select empno, deptno, count(empno) over (ROWS BETWEEN 10 PRECEDING AND 1 PRECEDING) w_count
  from emp
) sub_query where w_count is null]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], DEPTNO=[$1], W_COUNT=[$2])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], DEPTNO=[$1], W_COUNT=[$2])
  LogicalFilter(condition=[IS NULL($2)])
    LogicalWindow(window#0=[window(rows between $2 PRECEDING and $3 PRECEDING aggs [COUNT($0)])], constants=[[10, 1]])
      LogicalProject(EMPNO=[$0], DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinAssociateRuleWithBottomAlwaysTrueConditionAllowed">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[=($2, $12)], joinType=[inner])
  LogicalJoin(condition=[=($7, $8)], joinType=[inner])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
  LogicalTableScan(table=[[scott, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalJoin(condition=[AND(=($2, $12), =($7, $8))], joinType=[inner])
  LogicalTableScan(table=[[scott, EMP]])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalTableScan(table=[[scott, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinAssociateRuleWithBottomAlwaysTrueConditionDisallowed">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[=($2, $12)], joinType=[inner])
  LogicalJoin(condition=[=($7, $8)], joinType=[inner])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
  LogicalTableScan(table=[[scott, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinAssociateRuleWithTopAlwaysTrueConditionAllowed">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[=($7, $12)], joinType=[inner])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, BONUS]])
  LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalJoin(condition=[=($7, $12)], joinType=[inner])
  LogicalTableScan(table=[[scott, EMP]])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalTableScan(table=[[scott, BONUS]])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinAssociateRuleWithTopAlwaysTrueConditionDisallowed">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[=($7, $12)], joinType=[inner])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, BONUS]])
  LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinCommuteRuleWithAlwaysTrueConditionAllowed">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[true], joinType=[inner])
  LogicalTableScan(table=[[scott, EMP]])
  LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$3], ENAME=[$4], JOB=[$5], MGR=[$6], HIREDATE=[$7], SAL=[$8], COMM=[$9], DEPTNO=[$10], DEPTNO0=[$0], DNAME=[$1], LOC=[$2])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinCommuteRuleWithAlwaysTrueConditionDisallowed">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[true], joinType=[inner])
  LogicalTableScan(table=[[scott, EMP]])
  LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinConditionOrExpansionRuleAnti">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[OR(=($0, $10), =($1, $5))], joinType=[anti])
  LogicalTableScan(table=[[scott, DEPT]])
  LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalJoin(condition=[=($1, $5)], joinType=[anti])
  LogicalJoin(condition=[=($0, $10)], joinType=[anti])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalTableScan(table=[[scott, EMP]])
  LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinConditionOrExpansionRuleFull">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[OR(=($0, $10), =($1, $5))], joinType=[full])
  LogicalTableScan(table=[[scott, DEPT]])
  LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalJoin(condition=[=($0, $10)], joinType=[inner])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalTableScan(table=[[scott, EMP]])
  LogicalJoin(condition=[AND(=($1, $5), <>($0, $10))], joinType=[inner])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalTableScan(table=[[scott, EMP]])
  LogicalProject($f0=[null:TINYINT], $f1=[null:VARCHAR(14)], $f2=[null:VARCHAR(13)], EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7])
    LogicalJoin(condition=[=($9, $2)], joinType=[anti])
      LogicalJoin(condition=[=($8, $7)], joinType=[anti])
        LogicalTableScan(table=[[scott, EMP]])
        LogicalTableScan(table=[[scott, DEPT]])
      LogicalTableScan(table=[[scott, DEPT]])
  LogicalProject(DEPTNO=[$0], DNAME=[$1], LOC=[$2], $f3=[null:SMALLINT], $f4=[null:VARCHAR(10)], $f5=[null:VARCHAR(9)], $f6=[null:SMALLINT], $f7=[null:DATE], $f8=[null:DECIMAL(7, 2)], $f9=[null:DECIMAL(7, 2)], $f10=[null:TINYINT])
    LogicalJoin(condition=[=($1, $5)], joinType=[anti])
      LogicalJoin(condition=[=($0, $10)], joinType=[anti])
        LogicalTableScan(table=[[scott, DEPT]])
        LogicalTableScan(table=[[scott, EMP]])
      LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinConditionPushdown1">
    <Resource name="sql">
      <![CDATA[select *
from emp e1, emp e2, dept d2
where e1.deptno = d2.deptno and e2.deptno = d2.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], EMPNO0=[$9], ENAME0=[$10], JOB0=[$11], MGR0=[$12], HIREDATE0=[$13], SAL0=[$14], COMM0=[$15], DEPTNO0=[$16], SLACKER0=[$17], DEPTNO1=[$18], DNAME=[$19])
  LogicalFilter(condition=[AND(=($7, $18), =($16, $18))])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], EMPNO0=[$9], ENAME0=[$10], JOB0=[$11], MGR0=[$12], HIREDATE0=[$13], SAL0=[$14], COMM0=[$15], DEPTNO0=[$16], SLACKER0=[$17], DEPTNO1=[$18], DNAME=[$19])
  LogicalJoin(condition=[=($7, $18)], joinType=[inner])
    LogicalJoin(condition=[=($7, $16)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinConditionPushdown2">
    <Resource name="sql">
      <![CDATA[select *
from emp e, dept d
where e.deptno = d.deptno and e.empno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalFilter(condition=[AND(=($7, $9), =($0, $9))])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[=($7, $9)], joinType=[inner])
    LogicalFilter(condition=[=($7, $0)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinConditionPushdown3">
    <Resource name="sql">
      <![CDATA[select *
from emp e full join dept d
on e.deptno = d.deptno and e.empno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[AND(=($7, $9), =($0, $9))], joinType=[full])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinConditionPushdown4">
    <Resource name="sql">
      <![CDATA[select *
from emp e semi join dept d
on e.deptno = d.deptno and e.empno = d.deptno
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalJoin(condition=[AND(=($0, $2), =($0, $3))], joinType=[semi])
    LogicalProject(DEPTNO=[$7], ENAME=[$1])
      LogicalTableScan(table=[[scott, EMP]])
    LogicalProject(DEPTNO=[$0], DNAME=[$1])
      LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalProject(DEPTNO=[$7], ENAME=[$1])
    LogicalJoin(condition=[=($7, $8)], joinType=[semi])
      LogicalTableScan(table=[[scott, EMP]])
      LogicalFilter(condition=[=($0, $1)])
        LogicalProject(DEPTNO=[$0], DNAME=[$1])
          LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinConditionPushdown5">
    <Resource name="sql">
      <![CDATA[select *
from emp e left join dept d
on e.deptno = d.deptno and e.empno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[AND(=($7, $9), =($0, $9))], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinConditionPushdown6">
    <Resource name="sql">
      <![CDATA[select *
from emp e right join dept d
on e.deptno = d.deptno and e.empno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[AND(=($7, $9), =($0, $9))], joinType=[right])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[=($7, $9)], joinType=[right])
    LogicalFilter(condition=[=($7, $0)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinDeriveIsNotNullFilterRule14">
    <Resource name="sql">
      <![CDATA[select t1.deptno from empnullables t1 inner join
empnullables t2 on nvl(t1.ename, t2.ename) = 'abc']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalJoin(condition=[=(CASE(IS NOT NULL($1), $1, $10), 'abc')], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
    LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinProjectTranspose1">
    <Resource name="sql">
      <![CDATA[select a.dname
from dept a
left join dept b on b.deptno > 10
right join dept c on b.deptno > 10
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$0])
  LogicalJoin(condition=[$1], joinType=[right])
    LogicalProject(DNAME=[$1], $f4=[$5])
      LogicalJoin(condition=[$4], joinType=[left])
        LogicalProject(DEPTNO=[$0], DNAME=[$1])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalProject(DEPTNO=[$0], DNAME=[$1], $f2=[>($0, 10)], $f4=[>($0, 10)])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[>($2, 10)], joinType=[right])
    LogicalJoin(condition=[>($2, 10)], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinPushTransitivePredicatesRule">
    <Resource name="sql">
      <![CDATA[select d.deptno from sales.emp d where d.deptno
IN (select e.deptno from sales.emp e where e.deptno = d.deptno or e.deptno = 4)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
      LogicalAggregate(group=[{0}])
        LogicalProject(DEPTNO=[$7])
          LogicalFilter(condition=[OR(=($7, $cor0.DEPTNO), =($7, 4))])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinPushTransitivePredicatesRule2">
    <Resource name="sql">
      <![CDATA[select n1.SAL
from EMPNULLABLES_20 n1
where n1.SAL IN (
  select n2.SAL
  from EMPNULLABLES_20 n2
  where n1.SAL = n2.SAL or n1.SAL = 4)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalJoin(condition=[AND(=($5, $11), IS NOT DISTINCT FROM($9, $12))], joinType=[inner])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], SLACKER=[$8], SAL0=[$5], $f9=[=($5, 4)])
      LogicalFilter(condition=[AND(=($7, 20), >($5, 1000))])
        LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
    LogicalFilter(condition=[=($1, $0)])
      LogicalAggregate(group=[{0, 1, 2}])
        LogicalProject(SAL=[$5], SAL0=[$8], $f9=[$9])
          LogicalJoin(condition=[OR(=($8, $5), $9)], joinType=[inner])
            LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], SLACKER=[$8])
              LogicalFilter(condition=[AND(=($7, 20), >($5, 1000))])
                LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
            LogicalAggregate(group=[{0, 1}])
              LogicalProject(SAL=[$5], $f9=[=($5, 4)])
                LogicalFilter(condition=[AND(=($7, 20), >($5, 1000))])
                  LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinToMultiJoinDoesNotMatchAntiJoin">
    <Resource name="sql">
      <![CDATA[select * from
(select * from emp join dept ON emp.deptno = emp.deptno) t
where not exists (select job from bonus where emp.job = bonus.job)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[=($2, $12)], joinType=[anti])
  LogicalJoin(condition=[=($7, $8)], joinType=[inner])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
  LogicalTableScan(table=[[scott, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalJoin(condition=[=($2, $12)], joinType=[anti])
  MultiJoin(joinFilter=[=($7, $8)], isFullOuterJoin=[false], joinTypes=[[INNER, INNER]], outerJoinConditions=[[NULL, NULL]], projFields=[[ALL, ALL]])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
  LogicalTableScan(table=[[scott, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinToMultiJoinDoesNotMatchSemiJoin">
    <Resource name="sql">
      <![CDATA[select * from
(select * from emp join dept ON emp.deptno = emp.deptno) t
where emp.job in (select job from bonus))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[=($2, $12)], joinType=[semi])
  LogicalJoin(condition=[=($7, $8)], joinType=[inner])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
  LogicalTableScan(table=[[scott, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalJoin(condition=[=($2, $12)], joinType=[semi])
  MultiJoin(joinFilter=[=($7, $8)], isFullOuterJoin=[false], joinTypes=[[INNER, INNER]], outerJoinConditions=[[NULL, NULL]], projFields=[[ALL, ALL]])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
  LogicalTableScan(table=[[scott, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinToSemiJoinRuleOnAntiJoin">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[=($0, $3)], joinType=[anti])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalProject(DEPTNO=[$7])
        LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinWithConstantRowOnLeft">
    <Resource name="sql">
      <![CDATA[select e.empno, e.ename, c.* from (select 5, 5) c cross join emp e]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$2], ENAME=[$3], EXPR$0=[$0], EXPR$1=[$1])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalValues(tuples=[[{ 5, 5 }]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$2], ENAME=[$3], EXPR$0=[$0], EXPR$1=[$1])
  LogicalProject($f0=[5], $f1=[5], EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testJoinWithConstantRowOnRight">
    <Resource name="sql">
      <![CDATA[select e.empno, e.ename, c.* from emp e cross join (select 5, 5) c]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], EXPR$0=[$9], EXPR$1=[$10])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalValues(tuples=[[{ 5, 5 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], EXPR$0=[$9], EXPR$1=[$10])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[5], $f10=[5])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLateralTransposeWithDecorrelateFalse">
    <Resource name="sql">
      <![CDATA[WITH   t1(a, ts) AS (VALUES('a', 1)),  t2(a, ts, x) AS (SELECT ename as a, empno as ts, mgr as x FROM emp)
SELECT * FROM t1
LEFT JOIN LATERAL (
    SELECT x FROM t2
    WHERE t2.a = t1.a AND t2.ts <= t1.ts
    LIMIT 1
) ON true
LEFT JOIN LATERAL (
    SELECT x
    FROM t2
    WHERE t2.a = t1.a
) ON true]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(A=[$0], TS=[$1], X=[$2], X0=[$3])
  LogicalCorrelate(correlation=[$cor2], joinType=[left], requiredColumns=[{0}])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 1}])
      LogicalValues(tuples=[[{ 'a', 1 }]])
      LogicalSort(fetch=[1])
        LogicalProject(X=[$2])
          LogicalFilter(condition=[AND(=($0, CAST($cor0.A):VARCHAR(20) NOT NULL), <=($1, $cor0.TS))])
            LogicalProject(A=[$1], TS=[$0], X=[$3])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(X=[$2])
      LogicalFilter(condition=[=($0, CAST($cor2.A):VARCHAR(20) NOT NULL)])
        LogicalProject(A=[$1], TS=[$0], X=[$3])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLateralTransposeWithDecorrelateTrue">
    <Resource name="sql">
      <![CDATA[WITH   t1(a, ts) AS (VALUES('a', 1)),  t2(a, ts, x) AS (SELECT ename as a, empno as ts, mgr as x FROM emp)
SELECT * FROM t1
LEFT JOIN LATERAL (
    SELECT x FROM t2
    WHERE t2.a = t1.a AND t2.ts <= t1.ts
    LIMIT 1
) ON true
LEFT JOIN LATERAL (
    SELECT x
    FROM t2
    WHERE t2.a = t1.a
) ON true]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(A=[$0], TS=[$1], X=[$2], X0=[$4])
  LogicalJoin(condition=[=($3, $5)], joinType=[left])
    LogicalProject(EXPR$0=[$0], EXPR$1=[$1], X=[$4], EXPR$00=[CAST($0):VARCHAR(20) NOT NULL])
      LogicalJoin(condition=[AND(=($1, $5), =($2, $6))], joinType=[left])
        LogicalProject(EXPR$0=[$0], EXPR$1=[$1], EXPR$00=[CAST($0):VARCHAR(20) NOT NULL], EXPR$10=[$1])
          LogicalValues(tuples=[[{ 'a', 1 }]])
        LogicalFilter(condition=[<=($3, 1)])
          LogicalProject(X=[$2], EXPR$1=[$3], EXPR$00=[$4], rn=[ROW_NUMBER() OVER (PARTITION BY $3, $4)])
            LogicalJoin(condition=[AND(=($0, $4), <=($1, $3))], joinType=[inner])
              LogicalProject(A=[$1], TS=[$0], X=[$3])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
              LogicalProject(EXPR$1=[$1], EXPR$00=[CAST($0):VARCHAR(20) NOT NULL])
                LogicalValues(tuples=[[{ 'a', 1 }]])
    LogicalProject(X=[$3], A=[$1])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftCorrelateWithBothEmpty1">
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
  LogicalValues(tuples=[[]])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], DEPTNO0=[null:TINYINT], DNAME=[null:VARCHAR(14)], LOC=[null:VARCHAR(13)])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftCorrelateWithBothEmpty2">
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
  LogicalValues(tuples=[[]])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftCorrelateWithBothEmpty3">
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
  LogicalValues(tuples=[[]])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], DEPTNO0=[null:TINYINT], DNAME=[null:VARCHAR(14)], LOC=[null:VARCHAR(13)])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftCorrelateWithLeftEmpty">
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
  LogicalValues(tuples=[[]])
  LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftCorrelateWithRightEmpty">
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
  LogicalTableScan(table=[[scott, EMP]])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], DEPTNO0=[null:TINYINT], DNAME=[null:VARCHAR(14)], LOC=[null:VARCHAR(13)])
  LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftEmptyAntiJoin">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[=($7, $8)], joinType=[anti])
    LogicalValues(tuples=[[]])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftEmptyFullJoin">
    <Resource name="sql">
      <![CDATA[select * from (
  select * from emp where false) e
full join dept d on e.deptno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[=($7, $9)], joinType=[full])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[false])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalProject(EMPNO=[null:INTEGER], ENAME=[null:VARCHAR(20)], JOB=[null:VARCHAR(10)], MGR=[null:INTEGER], HIREDATE=[null:TIMESTAMP(0)], SAL=[null:INTEGER], COMM=[null:INTEGER], DEPTNO=[null:INTEGER], SLACKER=[null:BOOLEAN], DEPTNO0=[CAST($0):INTEGER], DNAME=[CAST($1):VARCHAR(10)])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftEmptyInnerJoin">
    <Resource name="sql">
      <![CDATA[select * from (
select * from emp where false) as e
join dept as d on e.deptno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[=($7, $9)], joinType=[inner])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[false])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftEmptyLeftJoin">
    <Resource name="sql">
      <![CDATA[select * from (
  select * from emp where false) e
left join dept d on e.deptno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[=($7, $9)], joinType=[left])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[false])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftEmptyRightJoin">
    <Resource name="sql">
      <![CDATA[select * from (
  select * from emp where false) e
right join dept d on e.deptno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[=($7, $9)], joinType=[right])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[false])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalProject(EMPNO=[null:INTEGER], ENAME=[null:VARCHAR(20)], JOB=[null:VARCHAR(10)], MGR=[null:INTEGER], HIREDATE=[null:TIMESTAMP(0)], SAL=[null:INTEGER], COMM=[null:INTEGER], DEPTNO=[null:INTEGER], SLACKER=[null:BOOLEAN], DEPTNO0=[$0], DNAME=[$1])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftEmptySemiJoin">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[=($7, $8)], joinType=[semi])
    LogicalValues(tuples=[[]])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftInnerSemiJoinTypeForDphyp">
    <Resource name="sql">
      <![CDATA[select emp.empno from emp_address left join emp on emp_address.empno = emp.empno inner join dept on emp.deptno = dept.deptno where exists(select * from dept_nested where dept.deptno = dept_nested.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$9])
  HyperGraph(edges=[{2}——[SEMI, =(node(2)_field(0), node(3)_field(0))]——{3},{0, 1}——[INNER, =(node(1)_field(7), node(2)_field(0))]——{2},{0}——[LEFT, =(node(0)_field(0), node(1)_field(0))]——{1}])
    LogicalProject(EMPNO=[$0], STREET=[$1.STREET], CITY=[$1.CITY], ZIP=[$1.ZIP], STATE=[$1.STATE], STREET5=[$2.STREET], CITY6=[$2.CITY], ZIP7=[$2.ZIP], STATE8=[$2.STATE])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$0], $f0=[true])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$11])
  LogicalJoin(condition=[=($18, $0)], joinType=[inner])
    LogicalJoin(condition=[=($0, $2)], joinType=[semi])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalProject(DEPTNO=[$0], $f0=[true])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
    LogicalJoin(condition=[=($0, $9)], joinType=[left])
      LogicalProject(EMPNO=[$0], STREET=[$1.STREET], CITY=[$1.CITY], ZIP=[$1.ZIP], STATE=[$1.STATE], STREET5=[$2.STREET], CITY6=[$2.CITY], ZIP7=[$2.ZIP], STATE8=[$2.STATE])
        LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftJoinRemoveConditionIsAlwaysFalse">
    <Resource name="sql">
      <![CDATA[SELECT e.deptno
FROM sales.emp e
LEFT JOIN sales.dept d ON e.deptno = d.deptno and e.deptno between 3 and 1]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalJoin(condition=[false], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[null:INTEGER], DNAME=[null:VARCHAR(10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftJoinWithConstantRowOnRight">
    <Resource name="sql">
      <![CDATA[select e.empno, e.ename, c.* from emp e left join (select 5 as nm) c  on e.empno = c.nm]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], NM=[$9])
  LogicalJoin(condition=[=($0, $9)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalValues(tuples=[[{ 5 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], NM=[$9])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[CASE(=($0, 5), 5, null:INTEGER)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftJoinWithTimeStampSingleRowOnRight">
    <Resource name="sql">
      <![CDATA[select e.empno, e.ename, c.t from emp e left join (select 7934 as ono, current_timestamp as t) c   on e.empno = c.ono]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], T=[$10])
  LogicalJoin(condition=[=($0, $9)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(ONO=[7934], T=[CURRENT_TIMESTAMP])
      LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], T=[$10])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[CASE(=($0, 7934), 7934, null:INTEGER)], $f10=[CASE(=($0, 7934), CURRENT_TIMESTAMP, null:TIMESTAMP(0))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLeftMarkJoinWithSingleValues">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[=($0, $8)], joinType=[left_mark])
  LogicalTableScan(table=[[scott, EMP]])
  LogicalValues(tuples=[[{ 1 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], $f8=[=($0, 1)])
  LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitMerge">
    <Resource name="sql">
      <![CDATA[select deptno from
(select deptno from emp where sal > 100 limit 10000)
limit 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalProject(DEPTNO=[$7])
    LogicalSort(fetch=[10])
      LogicalSort(fetch=[10000])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalSort(fetch=[10])
    LogicalFilter(condition=[>($5, 100)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitMerge1">
    <Resource name="sql">
      <![CDATA[select deptno from
(select deptno from emp where sal > 100 order by sal desc limit 10000)
limit 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalProject(DEPTNO=[$7], SAL=[$5])
    LogicalSort(fetch=[10])
      LogicalSort(sort0=[$5], dir0=[DESC], fetch=[10000])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalSort(sort0=[$5], dir0=[DESC], fetch=[10])
    LogicalFilter(condition=[>($5, 100)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitMerge2">
    <Resource name="sql">
      <![CDATA[select deptno from
(select deptno from emp where sal > 100 order by sal desc limit 10)
limit 10000]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalProject(DEPTNO=[$7], SAL=[$5])
    LogicalSort(fetch=[10000])
      LogicalSort(sort0=[$5], dir0=[DESC], fetch=[10])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalSort(sort0=[$5], dir0=[DESC], fetch=[10])
    LogicalFilter(condition=[>($5, 100)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitMerge3">
    <Resource name="sql">
      <![CDATA[select deptno from
(select deptno from emp where sal > 100 limit 100)
order by deptno desc]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalProject(DEPTNO=[$7])
    LogicalSort(sort0=[$7], dir0=[DESC])
      LogicalSort(fetch=[100])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalSort(sort0=[$7], dir0=[DESC])
    LogicalSort(fetch=[100])
      LogicalFilter(condition=[>($5, 100)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitMerge4">
    <Resource name="sql">
      <![CDATA[select deptno from
(select deptno from emp where sal > 100 order by sal desc limit 10)
order by deptno limit 10000]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalProject(DEPTNO=[$7], SAL=[$5])
    LogicalSort(sort0=[$7], dir0=[ASC], fetch=[10000])
      LogicalSort(sort0=[$5], dir0=[DESC], fetch=[10])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalSort(sort0=[$7], dir0=[ASC], fetch=[10000])
    LogicalSort(sort0=[$5], dir0=[DESC], fetch=[10])
      LogicalFilter(condition=[>($5, 100)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitMerge5">
    <Resource name="sql">
      <![CDATA[select deptno from
(select deptno from emp where sal > 100 order by sal desc limit 10000)
order by deptno limit 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalProject(DEPTNO=[$7], SAL=[$5])
    LogicalSort(sort0=[$7], dir0=[ASC], fetch=[10])
      LogicalSort(sort0=[$5], dir0=[DESC], fetch=[10000])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalSort(sort0=[$7], dir0=[ASC], fetch=[10])
    LogicalSort(sort0=[$5], dir0=[DESC], fetch=[10000])
      LogicalFilter(condition=[>($5, 100)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitMergeBigint">
    <Resource name="sql">
      <![CDATA[select deptno from
(select deptno from emp where sal > 100 limit 3100000000)
limit 3000000000]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalProject(DEPTNO=[$7])
    LogicalSort(fetch=[3000000000:BIGINT])
      LogicalSort(fetch=[3100000000:BIGINT])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalProject(DEPTNO=[$7])
    LogicalSort(fetch=[3000000000:BIGINT])
      LogicalFilter(condition=[>($5, 100)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitSort">
    <Resource name="sql">
      <![CDATA[select mgr from sales.emp
union select mgr from sales.emp
order by mgr limit 10 offset 5]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC], offset=[5], fetch=[10])
  LogicalProject(MGR=[$0])
    LogicalUnion(all=[false])
      LogicalProject(MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableLimitSort(sort0=[$0], dir0=[ASC], offset=[5], fetch=[10])
  EnumerableProject(MGR=[$0])
    EnumerableUnion(all=[false])
      EnumerableProject(MGR=[$3])
        EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
      EnumerableProject(MGR=[$3])
        EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitSortOnlyLimit">
    <Resource name="sql">
      <![CDATA[select * from emp limit 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(fetch=[10])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableLimit(fetch=[10])
  EnumerableProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitSortOnlyOffset">
    <Resource name="sql">
      <![CDATA[select * from emp offset 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(offset=[10])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableLimit(offset=[10])
  EnumerableProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitSortOnlyOrderBy">
    <Resource name="sql">
      <![CDATA[select * from emp order by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$7], dir0=[ASC])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableSort(sort0=[$7], dir0=[ASC])
  EnumerableProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitSortOrderByLimit">
    <Resource name="sql">
      <![CDATA[select * from emp order by deptno limit 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$7], dir0=[ASC], fetch=[10])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableLimitSort(sort0=[$7], dir0=[ASC], fetch=[10])
  EnumerableProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitSortOrderByOffset">
    <Resource name="sql">
      <![CDATA[select * from emp order by deptno offset 5]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$7], dir0=[ASC], offset=[5])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableLimitSort(sort0=[$7], dir0=[ASC], offset=[5])
  EnumerableProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLimitSortOrderByOffsetLimit">
    <Resource name="sql">
      <![CDATA[select * from emp order by deptno limit 10 offset 5]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$7], dir0=[ASC], offset=[5], fetch=[10])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableLimitSort(sort0=[$7], dir0=[ASC], offset=[5], fetch=[10])
  EnumerableProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLoptOptimizeJoinRuleWithDefaultCost">
    <Resource name="sql">
      <![CDATA[select e1.empno from emp e1 inner join dept d1 on d1.deptno = e1.deptno inner join emp e2 on e1.ename = e2.ename inner join dept d2 on d2.deptno = e1.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  MultiJoin(joinFilter=[AND(=($20, $7), =($1, $12), =($9, $7))], isFullOuterJoin=[false], joinTypes=[[INNER, INNER, INNER, INNER]], outerJoinConditions=[[NULL, NULL, NULL, NULL]], projFields=[[ALL, ALL, ALL, ALL]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$9], ENAME=[$10], JOB=[$11], MGR=[$12], HIREDATE=[$13], SAL=[$14], COMM=[$15], DEPTNO=[$16], SLACKER=[$17], DEPTNO0=[$18], DNAME=[$19], EMPNO0=[$0], ENAME0=[$1], JOB0=[$2], MGR0=[$3], HIREDATE0=[$4], SAL0=[$5], COMM0=[$6], DEPTNO1=[$7], SLACKER0=[$8], DEPTNO2=[$20], DNAME0=[$21])
    LogicalJoin(condition=[=($10, $1)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalJoin(condition=[=($11, $7)], joinType=[inner])
        LogicalJoin(condition=[=($9, $7)], joinType=[inner])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLoptOptimizeJoinRuleWithSpecialCost">
    <Resource name="sql">
      <![CDATA[select e1.empno from emp e1 inner join dept d1 on d1.deptno = e1.deptno inner join emp e2 on e1.ename = e2.ename inner join dept d2 on d2.deptno = e1.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  MultiJoin(joinFilter=[AND(=($20, $7), =($1, $12), =($9, $7))], isFullOuterJoin=[false], joinTypes=[[INNER, INNER, INNER, INNER]], outerJoinConditions=[[NULL, NULL, NULL, NULL]], projFields=[[ALL, ALL, ALL, ALL]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$18], DNAME=[$19], EMPNO0=[$9], ENAME0=[$10], JOB0=[$11], MGR0=[$12], HIREDATE0=[$13], SAL0=[$14], COMM0=[$15], DEPTNO1=[$16], SLACKER0=[$17], DEPTNO2=[$20], DNAME0=[$21])
    LogicalJoin(condition=[=($20, $7)], joinType=[inner])
      LogicalJoin(condition=[=($18, $7)], joinType=[inner])
        LogicalJoin(condition=[=($1, $10)], joinType=[inner])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testLpad">
    <Resource name="sql">
      <![CDATA[select LPAD('abc', 8, 'A')]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[LPAD('abc', 8, 'A')])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=['AAAAAabc':VARCHAR])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testManyFiltersOnTopOfMultiJoinShouldCollapse">
    <Resource name="sql">
      <![CDATA[select * from (select * from emp e1 left outer join dept d
on e1.deptno = d.deptno
where d.deptno > 3) where ename LIKE 'bar']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalFilter(condition=[LIKE($1, 'bar')])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
      LogicalFilter(condition=[>($9, 3)])
        LogicalJoin(condition=[=($7, $9)], joinType=[left])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  MultiJoin(joinFilter=[true], isFullOuterJoin=[false], joinTypes=[[INNER, LEFT]], outerJoinConditions=[[NULL, =($7, $9)]], projFields=[[{0, 1, 2, 3, 4, 5, 6, 7, 8}, {0, 1}]], postJoinFilter=[AND(LIKE($1, 'bar'), >($9, 3))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMarkJoinMarkerColumnTypeNullableMismatch">
    <Resource name="sql">
      <![CDATA[select sal,
  cast(null as int) IN (
    select cast(null as int)
    from dept)
from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(SAL=[$5], EXPR$1=[IN(null:INTEGER, {
LogicalProject(EXPR$0=[null:INTEGER])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(SAL=[$5], EXPR$1=[$9])
  LogicalJoin(condition=[null:BOOLEAN], joinType=[left_mark])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EXPR$0=[null:INTEGER])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(SAL=[$5], EXPR$1=[$9])
  LogicalJoin(condition=[null:BOOLEAN], joinType=[left_mark])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EXPR$0=[null:INTEGER])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMeasureAggregate">
    <Resource name="sql">
      <![CDATA[select deptno, c1
from (select deptno, job, count(*) + 1 as measure c1
  from emp)
group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], C1=[$1])
  LogicalAggregate(group=[{0}], agg#0=[AGG_M2V($1)])
    LogicalProject(DEPTNO=[$7], C1=[V2M(+(COUNT(), 1))])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], C1=[$1])
  LogicalProject(DEPTNO=[$0], $f1=[+($1, 1)])
    LogicalAggregate(group=[{0}], agg#0=[COUNT()])
      LogicalProject(DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMeasureJoin">
    <Resource name="sql">
      <![CDATA[select deptno, aggregate(m) as m
from (select deptno, name, avg(char_length(name)) as measure m
  from dept)
join emp using (deptno)
group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], M=[$1])
  LogicalAggregate(group=[{0}], M=[AGG_M2V($1)])
    LogicalProject($f0=[$0], M=[$2])
      LogicalJoin(condition=[=($0, $10)], joinType=[inner])
        LogicalProject(DEPTNO=[$0], DNAME=[$1], M=[V2M(CAST(/(SUM(CHAR_LENGTH($1)), COUNT(CHAR_LENGTH($1)))):INTEGER NOT NULL)])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], M=[$1])
  LogicalAggregate(group=[{0}], agg#0=[SINGLE_VALUE($1)])
    LogicalProject($f0=[$0], $f2=[M2X($2, SAME_PARTITION($0))])
      LogicalJoin(condition=[=($0, $10)], joinType=[inner])
        LogicalProject(DEPTNO=[$0], DNAME=[$1], M=[V2M(CAST(/(SUM(CHAR_LENGTH($1)), COUNT(CHAR_LENGTH($1)))):INTEGER NOT NULL)])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMeasureSort">
    <Resource name="sql">
      <![CDATA[select deptno, c1
from (select deptno, job, count(*) + 1 as measure c1
  from emp)
order by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], C1=[M2V($1)])
  LogicalSort(sort0=[$0], dir0=[ASC])
    LogicalProject(DEPTNO=[$7], C1=[V2M(+(COUNT(), 1))])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], C1=[$2])
  LogicalSort(sort0=[$0], dir0=[ASC])
    LogicalProject(DEPTNO=[$0], C1=[$1], $f2=[M2V($1)])
      LogicalProject(DEPTNO=[$7], C1=[V2M(+(COUNT(), 1))])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMeasureWithoutGroupBy">
    <Resource name="sql">
      <![CDATA[with empm as
  (select *, avg(sal) as measure avgSal from emp)
select deptno, avgSal
from empm]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$7], AVGSAL=[CAST(/(SUM($5) OVER (ROWS CURRENT ROW), COUNT($5) OVER (ROWS CURRENT ROW))):INTEGER NOT NULL])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMeasureWithoutGroupByWithOrderBy">
    <Resource name="sql">
      <![CDATA[with empm as
  (select *, avg(sal) as measure avgSal from emp)
select deptno, avgSal
from empm
order by 2 desc limit 3]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], AVGSAL=[$1])
  LogicalProject(DEPTNO=[$0], AVGSAL=[M2V($1)], EXPR$2=[$2])
    LogicalSort(sort0=[$2], dir0=[DESC], fetch=[3])
      LogicalProject(DEPTNO=[$7], AVGSAL=[V2M(CAST(/(SUM($5), COUNT($5))):INTEGER NOT NULL)], EXPR$2=[CAST(/(SUM($5) OVER (ROWS CURRENT ROW), COUNT($5) OVER (ROWS CURRENT ROW))):INTEGER NOT NULL])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], AVGSAL=[$3])
  LogicalSort(sort0=[$2], dir0=[ASC], fetch=[3])
    LogicalProject(DEPTNO=[$7], AVGSAL=[V2M(CAST(/(SUM($5), COUNT($5))):INTEGER NOT NULL)], EXPR$2=[CAST(/(SUM($5) OVER (ROWS CURRENT ROW), COUNT($5) OVER (ROWS CURRENT ROW))):INTEGER NOT NULL], $f3=[CAST(/(SUM($5) OVER (ROWS CURRENT ROW), COUNT($5) OVER (ROWS CURRENT ROW))):INTEGER NOT NULL])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMergeFilter">
    <Resource name="sql">
      <![CDATA[select dname from (
  select *
  from dept
  where deptno = 10)
where deptno = 10
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalFilter(condition=[=($0, 10)])
    LogicalProject(DEPTNO=[$0], DNAME=[$1])
      LogicalFilter(condition=[=($0, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalProject(DEPTNO=[$0], DNAME=[$1])
    LogicalFilter(condition=[=($0, 10)])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMergeFilterWithJoinCondition">
    <Resource name="sql">
      <![CDATA[select d.dname, e.ename
 from emp e inner join dept d
 on e.deptno=d.deptno
 where d.dname='Propane']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$10], ENAME=[$1])
  LogicalFilter(condition=[=($10, 'Propane')])
    LogicalJoin(condition=[=($7, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalCalc(expr#0..10=[{inputs}], expr#11=[=($t7, $t9)], expr#12=['Propane':VARCHAR(10)], expr#13=[=($t10, $t12)], expr#14=[AND($t11, $t13)], DNAME=[$t10], ENAME=[$t1], $condition=[$t14])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMergeJoinCollation">
    <Resource name="sql">
      <![CDATA[select r.ename, s.sal from
sales.emp r join sales.bonus s
on r.ename=s.ename where r.sal+1=s.sal]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$1], SAL=[$11])
  LogicalFilter(condition=[=(+($5, 1), $11)])
    LogicalJoin(condition=[=($1, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(ENAME=[$5], SAL=[$2])
  EnumerableHashJoin(condition=[AND(=($0, $5), =(+($9, 1), $2))], joinType=[inner])
    EnumerableTableScan(table=[[CATALOG, SALES, BONUS]])
    EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMergeJoinFilter">
    <Resource name="sql">
      <![CDATA[select * from (
  select d.deptno, e.ename
  from emp as e
  join dept as d
  on e.deptno = d.deptno
  and d.deptno = 10)
where deptno = 10
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], ENAME=[$1])
  LogicalFilter(condition=[=($0, 10)])
    LogicalProject(DEPTNO=[$9], ENAME=[$1])
      LogicalJoin(condition=[AND(=($7, $9), =($9, 10))], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], ENAME=[$1])
  LogicalProject(DEPTNO=[$9], ENAME=[$1])
    LogicalJoin(condition=[=($7, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalFilter(condition=[=($0, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMergeSetOpMixed">
    <Resource name="sql">
      <![CDATA[select * from emp where deptno = 10
union
select * from emp where deptno = 20
intersect
select * from emp where deptno = 30
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[false])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($7, 10)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalIntersect(all=[false])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[=($7, 20)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[=($7, 30)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMinusMergeRule">
    <Resource name="sql">
      <![CDATA[select * from (
select * from (
  select dname, deptno from
  (
    select dname, deptno, count(1) from dept group by dname, deptno
    except all
    select dname, deptno, 1 from dept
  ) subq
  except all
  select dname, deptno from
  (
    select dname, deptno, 1 from dept
    except all
    select dname, deptno, count(1) from dept group by dname, deptno
  ) subq2
) a
except all
select dname, deptno from dept
) aa
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalMinus(all=[true])
  LogicalProject(DNAME=[$0], DEPTNO=[$1])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
      LogicalProject(DNAME=[$1], DEPTNO=[$0], $f2=[1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
  LogicalProject(DNAME=[$0], DEPTNO=[$1])
    LogicalProject(DNAME=[$1], DEPTNO=[$0], EXPR$2=[1:BIGINT])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
  LogicalMinus(all=[true])
    LogicalProject(DNAME=[$0], DEPTNO=[$1])
      LogicalProject(DNAME=[$1], DEPTNO=[$0], EXPR$2=[1:BIGINT])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DNAME=[$0], DEPTNO=[$1])
      LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
        LogicalProject(DNAME=[$1], DEPTNO=[$0], $f2=[1])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
  LogicalProject(DNAME=[$1], DEPTNO=[$0])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$0], DEPTNO=[$1])
  LogicalMinus(all=[true])
    LogicalProject(DNAME=[$0], DEPTNO=[$1])
      LogicalMinus(all=[true])
        LogicalProject(DNAME=[$0], DEPTNO=[$1])
          LogicalMinus(all=[true])
            LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
              LogicalProject(DNAME=[$1], DEPTNO=[$0], $f2=[1])
                LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
            LogicalProject(DNAME=[$1], DEPTNO=[$0], EXPR$2=[1:BIGINT])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalProject(DNAME=[$0], DEPTNO=[$1])
          LogicalMinus(all=[true])
            LogicalProject(DNAME=[$1], DEPTNO=[$0], EXPR$2=[1:BIGINT])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
            LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
              LogicalProject(DNAME=[$1], DEPTNO=[$0], $f2=[1])
                LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DNAME=[$1], DEPTNO=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMinusToDistinct">
    <Resource name="sql">
      <![CDATA[select EMPNO, ENAME, JOB from emp where deptno = 10
except
select EMPNO, ENAME, JOB from emp where deptno = 20
except
select EMPNO, ENAME, JOB from emp where deptno = 30
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalMinus(all=[false])
  LogicalMinus(all=[false])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
      LogicalFilter(condition=[=($7, 20)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
    LogicalFilter(condition=[=($7, 30)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
  LogicalFilter(condition=[AND(>($3, 0), =($4, 0), =($5, 0))])
    LogicalAggregate(group=[{0, 1, 2}], agg#0=[COUNT() FILTER $3], agg#1=[COUNT() FILTER $4], agg#2=[COUNT() FILTER $5])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], $f3=[=($3, 0)], $f4=[=($3, 1)], $f5=[=($3, 2)])
        LogicalUnion(all=[true])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], $f3=[0])
            LogicalFilter(condition=[=($7, 10)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], $f3=[1])
            LogicalFilter(condition=[=($7, 20)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], $f3=[2])
            LogicalFilter(condition=[=($7, 30)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMinusToDistinctAll">
    <Resource name="sql">
      <![CDATA[select EMPNO, ENAME, JOB from emp where deptno = 10
except
select EMPNO, ENAME, JOB from emp where deptno = 20
except all
select EMPNO, ENAME, JOB from emp where deptno = 30
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalMinus(all=[true])
  LogicalMinus(all=[false])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
      LogicalFilter(condition=[=($7, 20)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
    LogicalFilter(condition=[=($7, 30)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalMinus(all=[true])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
    LogicalFilter(condition=[AND(>($3, 0), =($4, 0))])
      LogicalAggregate(group=[{0, 1, 2}], agg#0=[COUNT() FILTER $3], agg#1=[COUNT() FILTER $4])
        LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], $f3=[=($3, 0)], $f4=[=($3, 1)])
          LogicalUnion(all=[true])
            LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], $f3=[0])
              LogicalFilter(condition=[=($7, 10)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
            LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], $f3=[1])
              LogicalFilter(condition=[=($7, 20)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
    LogicalFilter(condition=[=($7, 30)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMinusToDistinctAllAndDistinct">
    <Resource name="sql">
      <![CDATA[select EMPNO, ENAME, JOB from emp where deptno = 10
except all
select EMPNO, ENAME, JOB from emp where deptno = 20
except
select EMPNO, ENAME, JOB from emp where deptno = 30
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalMinus(all=[false])
  LogicalMinus(all=[true])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
      LogicalFilter(condition=[=($7, 20)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
    LogicalFilter(condition=[=($7, 30)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
  LogicalFilter(condition=[AND(>($3, 0), =($4, 0))])
    LogicalAggregate(group=[{0, 1, 2}], agg#0=[COUNT() FILTER $3], agg#1=[COUNT() FILTER $4])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], $f3=[=($3, 0)], $f4=[=($3, 1)])
        LogicalUnion(all=[true])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], $f3=[0])
            LogicalMinus(all=[true])
              LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
                LogicalFilter(condition=[=($7, 10)])
                  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
              LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2])
                LogicalFilter(condition=[=($7, 20)])
                  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], $f3=[1])
            LogicalFilter(condition=[=($7, 30)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMultipleDistinctWithSameArgsDifferentFilterUsingJoin">
    <Resource name="sql">
      <![CDATA[select deptno, count(distinct sal) FILTER (WHERE sal > 1000), count(distinct sal) FILTER (WHERE sal > 500) from sales.emp group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1) FILTER $2], EXPR$2=[COUNT(DISTINCT $1) FILTER $3])
  LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[>($5, 1000)], $f3=[>($5, 500)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$1], EXPR$2=[$3])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $2)], joinType=[inner])
    LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)])
      LogicalAggregate(group=[{0, 1}])
        LogicalProject(DEPTNO=[$0], i$SAL=[CASE($2, $1, null:INTEGER)])
          LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[>($5, 1000)], $f3=[>($5, 500)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], EXPR$2=[COUNT($1)])
      LogicalAggregate(group=[{0, 1}])
        LogicalProject(DEPTNO=[$0], i$SAL=[CASE($3, $1, null:INTEGER)])
          LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[>($5, 1000)], $f3=[>($5, 500)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNoReduceAverage">
    <Resource name="sql">
      <![CDATA[select dname, max(dname), avg(deptno), min(dname) from sales.dept group by dname]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[MAX($0)], EXPR$2=[AVG($1)], EXPR$3=[MIN($0)])
  LogicalProject(DNAME=[$1], DEPTNO=[$0])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNoReduceDynamic">
    <Resource name="sql">
      <![CDATA[select USER from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(USER=[USER])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNoReduceSum">
    <Resource name="sql">
      <![CDATA[select dname, sum(deptno) from sales.dept group by dname]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
  LogicalProject(DNAME=[$1], DEPTNO=[$0])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNotInNullableKey">
    <Resource name="sql">
      <![CDATA[select * from empnullables as e1
where deptno not in (
  select coalesce(deptno, 0) from empnullables e2)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[NOT(IN($7, {
LogicalProject(EXPR$0=[CASE(IS NOT NULL($7), CAST($7):INTEGER NOT NULL, 0)])
  LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
}))])
    LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[OR(=($9, 0), AND(IS NULL($12), >=($10, $9), IS NOT NULL($7)))])
      LogicalJoin(condition=[=($7, $11)], joinType=[left])
        LogicalJoin(condition=[true], joinType=[inner])
          LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
          LogicalProject(c=[$0], ck=[$0])
            LogicalAggregate(group=[{}], c=[COUNT()])
              LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
        LogicalAggregate(group=[{0}], i=[LITERAL_AGG(true)])
          LogicalProject(EXPR$0=[CASE(IS NOT NULL($7), CAST($7):INTEGER NOT NULL, 0)])
            LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNotInNullableSubqueryColumn">
    <Resource name="sql">
      <![CDATA[select * from empnullables as e1
where coalesce(deptno, 0) not in (
  select deptno from empnullables e2)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[NOT(IN(CASE(IS NOT NULL($7), CAST($7):INTEGER NOT NULL, 0), {
LogicalProject(DEPTNO=[$7])
  LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
}))])
    LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[NOT(AND(OR(IS NOT NULL($12), <($10, $9)), <>($9, 0)))])
      LogicalJoin(condition=[=(CASE(IS NOT NULL($7), CAST($7):INTEGER NOT NULL, 0), $11)], joinType=[left])
        LogicalJoin(condition=[true], joinType=[inner])
          LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
          LogicalAggregate(group=[{}], c=[COUNT()], ck=[COUNT($0)])
            LogicalProject(DEPTNO=[$7])
              LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
        LogicalAggregate(group=[{0}], i=[LITERAL_AGG(true)])
          LogicalProject(DEPTNO=[$7])
            LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNotInWithNoRowSubQuery">
    <Resource name="sql">
      <![CDATA[select * from dept as d
where deptno not in (
  select deptno from emp e where false)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalFilter(condition=[NOT(IN($0, {
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[false])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNotPushFilterPastWindowWhenPredicateNotOnPartitionKey">
    <Resource name="sql">
      <![CDATA[select * from
(select DNAME, DEPTNO, count(*) over (partition by DNAME) from dept) t
where DEPTNO = 0]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$0], DEPTNO=[$1], EXPR$2=[$2])
  LogicalFilter(condition=[=($1, 0)])
    LogicalProject(DNAME=[$1], DEPTNO=[$0], EXPR$2=[$2])
      LogicalWindow(window#0=[window(partition {1} aggs [COUNT()])])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1], DEPTNO=[$0], EXPR$2=[$2])
  LogicalFilter(condition=[=($0, 0)])
    LogicalWindow(window#0=[window(partition {1} aggs [COUNT()])])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNotUniqueWithNoRowSubQuery">
    <Resource name="sql">
      <![CDATA[select * from dept as d
where not unique(
  select deptno from emp e where false)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalFilter(condition=[NOT(UNIQUE({
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[false])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNullSelect">
    <Resource name="sql">
      <![CDATA[SELECT 1 from emp WHERE NULL IN (SELECT null)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[1])
  LogicalFilter(condition=[IN(null:NULL, {
LogicalValues(tuples=[[{ null }]])
})])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EXPR$0=[1])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(cs=[true])
        LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[1])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(cs=[true])
        LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testNullSelect2">
    <Resource name="sql">
      <![CDATA[SELECT * from emp where 123 in (select null from dept)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IN(123, {
LogicalProject(EXPR$0=[null:INTEGER])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{0}])
        LogicalProject(cs=[true])
          LogicalProject(EXPR$0=[null:INTEGER])
            LogicalFilter(condition=[false])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testOuterJoinForDphyp">
    <Resource name="sql">
      <![CDATA[select emp.empno from emp_address inner join emp on emp_address.empno = emp.empno left join dept on emp.deptno = dept.deptno inner join dept_nested on dept.deptno = dept_nested.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$3])
  HyperGraph(edges=[{1, 2}——[INNER, =(node(2)_field(0), node(3)_field(0))]——{3},{1}——[LEFT, =(node(1)_field(7), node(2)_field(0))]——{2},{0}——[INNER, =(node(0)_field(0), node(1)_field(0))]——{1}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$4])
  LogicalJoin(condition=[=($15, $4)], joinType=[inner])
    LogicalJoin(condition=[=($13, $0)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
      LogicalJoin(condition=[=($7, $9)], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectCorrelateTranspose">
    <Resource name="sql">
      <![CDATA[select t1.dname, t2.ename
from DEPT_NESTED as t1,
unnest(t1.employees) as t2]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1], ENAME=[$5])
  LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{3}])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
    Uncollect
      LogicalProject(EMPLOYEES=[$cor0.EMPLOYEES])
        LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$0], ENAME=[$2])
  LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{1}])
    LogicalProject(DNAME=[$1], EMPLOYEES=[$3])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
    LogicalProject(ENAME=[$1])
      Uncollect
        LogicalProject(EMPLOYEES=[$cor1.EMPLOYEES])
          LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectCorrelateTransposeDynamic">
    <Resource name="sql">
      <![CDATA[select t1.c_nationkey, t2.a as fake_col2 from SALES.CUSTOMER as t1, unnest(t1.fake_col) as t2(a)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(C_NATIONKEY=[$1], FAKE_COL2=[$2])
  LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
    LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
    LogicalProject(A=[$0])
      Uncollect
        LogicalProject(FAKE_COL=[$cor0.FAKE_COL])
          LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectCorrelateTransposeRuleAntiCorrelate">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(f=[$0])
  LogicalCorrelate(correlation=[$cor0], joinType=[anti], requiredColumns=[{0}])
    LogicalValues(tuples=[[{ '1', '2' }]])
    LogicalProject(f3=[$0], $f1=[$cor0.f])
      LogicalValues(tuples=[[{ '1', '2' }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[anti], requiredColumns=[{0}])
  LogicalProject(f=[$0])
    LogicalValues(tuples=[[{ '1', '2' }]])
  LogicalProject
    LogicalProject(f3=[$0], $f1=[$cor0.f])
      LogicalValues(tuples=[[{ '1', '2' }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectCorrelateTransposeRuleLeftCorrelate">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[IS NOT NULL($9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], agg#0=[MIN($0)])
        LogicalProject($f0=[true])
          LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
            LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[IS NOT NULL($1)])
    LogicalProject(EMPNO=[$0], $f0=[$2])
      LogicalCorrelate(correlation=[$cor2], joinType=[left], requiredColumns=[{1}])
        LogicalProject(EMPNO=[$0], DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject($f0=[$0])
          LogicalAggregate(group=[{}], agg#0=[MIN($0)])
            LogicalProject($f0=[true])
              LogicalFilter(condition=[=($cor2.DEPTNO, $0)])
                LogicalProject(DEPTNO=[$0])
                  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="sql">
      <![CDATA[SELECT e1.empno
FROM emp e1 where exists (select empno, deptno from dept d2 where e1.deptno = d2.deptno)]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectCorrelateTransposeRuleSemiCorrelate">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(f=[$0])
  LogicalCorrelate(correlation=[$cor0], joinType=[semi], requiredColumns=[{0}])
    LogicalValues(tuples=[[{ '1', '2' }]])
    LogicalProject(f3=[$0], $f1=[$cor0.f])
      LogicalValues(tuples=[[{ '1', '2' }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[semi], requiredColumns=[{0}])
  LogicalProject(f=[$0])
    LogicalValues(tuples=[[{ '1', '2' }]])
  LogicalProject
    LogicalProject(f3=[$0], $f1=[$cor0.f])
      LogicalValues(tuples=[[{ '1', '2' }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectCorrelateTransposeWithExprCond">
    <Resource name="sql">
      <![CDATA[select t1.dname, t2.ename
from DEPT_NESTED as t1,
unnest(t1.employees) as t2]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1], ENAME=[$5])
  LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{3}])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
    Uncollect
      LogicalProject(EMPLOYEES=[$cor0.EMPLOYEES])
        LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$0], ENAME=[$2])
  LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{1}])
    LogicalProject(DNAME=[$1], EMPLOYEES=[$3])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
    LogicalProject(ENAME=[$1])
      Uncollect
        LogicalProject(EMPLOYEES=[$cor1.EMPLOYEES])
          LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectFilterTransposeRuleOnEmptyRowType">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject
  LogicalFilter(condition=[=($7, 20)])
    LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject
  LogicalFilter(condition=[=($0, 20)])
    LogicalProject(DEPTNO=[$7])
      LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectJoinTransposeItem">
    <Resource name="sql">
      <![CDATA[select t1.c_nationkey[0], t2.c_nationkey[0]
from sales.customer as t1
left outer join sales.customer as t2
on t1.c_nationkey[0] = t2.c_nationkey[0]]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[ITEM($0, 0)], EXPR$1=[ITEM($2, 0)])
  LogicalJoin(condition=[=($1, $3)], joinType=[left])
    LogicalProject(C_NATIONKEY=[$0], $f1=[ITEM($0, 0)])
      LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
    LogicalProject(C_NATIONKEY=[$0], $f1=[ITEM($0, 0)])
      LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$1], EXPR$1=[$3])
  LogicalJoin(condition=[=($0, $2)], joinType=[left])
    LogicalProject($f1=[$1], EXPR$0=[ITEM($0, 0)])
      LogicalProject(C_NATIONKEY=[$0], $f1=[ITEM($0, 0)])
        LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
    LogicalProject($f1=[$1], EXPR$0=[ITEM($0, 0)])
      LogicalProject(C_NATIONKEY=[$0], $f1=[ITEM($0, 0)])
        LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectJoinTransposeRuleOnAggWithNoFieldsWithTrimmer">
    <Resource name="planBeforeTrimming">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalAggregate(group=[{}], DUMMY_COUNT=[COUNT()])
      LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="planAfterTrimming">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalProject(DEPTNO=[$0])
      LogicalTableScan(table=[[scott, DEPT]])
    LogicalAggregate(group=[{}], DUMMY=[COUNT()])
      LogicalProject(EMPNO=[$0])
        LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="finalPlan">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalProject(DEPTNO=[$0])
      LogicalTableScan(table=[[scott, DEPT]])
    LogicalAggregate(group=[{}], DUMMY=[COUNT()])
      LogicalProject(EMPNO=[$0])
        LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalJoin(condition=[true], joinType=[inner])
    LogicalProject(DEPTNO=[$0])
      LogicalTableScan(table=[[scott, DEPT]])
    LogicalAggregate(group=[{}], DUMMY=[COUNT()])
      LogicalProject(EMPNO=[$0])
        LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectOverWithAvg">
    <Resource name="sql">
      <![CDATA[select avg(sal) over (order by empno rows 3 preceding) from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[CAST(/(CASE(>(COUNT($5) OVER (ORDER BY $0 ROWS 3 PRECEDING), 0), SUM($5) OVER (ORDER BY $0 ROWS 3 PRECEDING), null:INTEGER), COUNT($5) OVER (ORDER BY $0 ROWS 3 PRECEDING))):INTEGER])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[CAST(/(CASE(>($2, 0), $3, null:INTEGER), $2)):INTEGER])
  LogicalWindow(window#0=[window(order by [0] rows between $2 PRECEDING and CURRENT ROW aggs [COUNT($1), $SUM0($1)])], constants=[[3]])
    LogicalProject(EMPNO=[$0], SAL=[$5])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectPredicatePull">
    <Resource name="sql">
      <![CDATA[select e.ename, d.dname
from (select ename, deptno from emp where deptno = 10) e
join (select dname dname, deptno, * from dept) d
on e.deptno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], DNAME=[$2])
  LogicalJoin(condition=[=($1, $3)], joinType=[inner])
    LogicalProject(ENAME=[$1], DEPTNO=[$7])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DNAME=[$1], DEPTNO=[$0], DEPTNO0=[$0], DNAME0=[$1])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$0], DNAME=[$2])
  LogicalJoin(condition=[=($1, $3)], joinType=[inner])
    LogicalProject(ENAME=[$1], DEPTNO=[$7])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DNAME=[$1], DEPTNO=[$0], DEPTNO0=[$0], DNAME0=[$1])
      LogicalFilter(condition=[=($0, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectRemoveRule">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(newAlias=[$0])
  LogicalProject($f0=[+($0, 1)])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(newAlias=[+($0, 1)])
  LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectToSemiJoinRuleOnAntiJoin">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[=($0, $3)], joinType=[anti])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalProject(DEPTNO=[$7])
        LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectToWindowRuleForMultiOver">
    <Resource name="sql">
      <![CDATA[select * from (select empno, deptno, last_value(deptno) over (order by empno) f1,
first_value(deptno) over (order by empno desc) f3,
count(deptno) over (order by empno) f2
from emp) where f2 > 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], DEPTNO=[$1], F1=[$2], F3=[$3], F2=[$4])
  LogicalFilter(condition=[>($4, 10)])
    LogicalProject(EMPNO=[$0], DEPTNO=[$7], F1=[LAST_VALUE($7) OVER (ORDER BY $0)], F3=[FIRST_VALUE($7) OVER (ORDER BY $0 DESC)], F2=[COUNT($7) OVER (ORDER BY $0)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], DEPTNO=[$1], F1=[$2], F3=[$3], F2=[$4])
  LogicalFilter(condition=[>($4, 10)])
    LogicalProject(EMPNO=[$0], DEPTNO=[$7], F1=[$9], F3=[$11], F2=[$10])
      LogicalWindow(window#0=[window(order by [0] aggs [LAST_VALUE($7), COUNT($7)])], window#1=[window(order by [0 DESC] aggs [FIRST_VALUE($7)])])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectToWindowRuleForMultipleWindows">
    <Resource name="sql">
      <![CDATA[select
 count(*) over(partition by empno order by sal) as count1,
 count(*) over(partition by deptno order by sal) as count2,
 sum(deptno) over(partition by empno order by sal) as sum1,
 sum(deptno) over(partition by deptno order by sal) as sum2
from emp]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(COUNT1=[$9], COUNT2=[$11], SUM1=[$10], SUM2=[$12])
  LogicalWindow(window#0=[window(partition {0} order by [5] aggs [COUNT(), SUM($7)])], window#1=[window(partition {7} order by [5] aggs [COUNT(), SUM($7)])])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(COUNT1=[COUNT() OVER (PARTITION BY $0 ORDER BY $5)], COUNT2=[COUNT() OVER (PARTITION BY $7 ORDER BY $5)], SUM1=[SUM($7) OVER (PARTITION BY $0 ORDER BY $5)], SUM2=[SUM($7) OVER (PARTITION BY $7 ORDER BY $5)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectToWindowRuleForNestedOver">
    <Resource name="sql">
      <![CDATA[select deptno, f1, f2 from (select *, last_value(deptno) over (order by empno) f2
from (select *, first_value(deptno) over (order by empno) f1 from emp))
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$7], F1=[$9], F2=[LAST_VALUE($7) OVER (ORDER BY $0)])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], F1=[FIRST_VALUE($7) OVER (ORDER BY $0)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$7], F1=[$9], F2=[$10])
  LogicalWindow(window#0=[window(order by [0] aggs [LAST_VALUE($7)])])
    LogicalWindow(window#0=[window(order by [0] aggs [FIRST_VALUE($7)])])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectWindowTransposeRule">
    <Resource name="sql">
      <![CDATA[select count(empno) over(), deptno from emp]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$2], DEPTNO=[$1])
  LogicalWindow(window#0=[window(aggs [COUNT($0)])])
    LogicalProject(EMPNO=[$0], DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[COUNT($0) OVER ()], DEPTNO=[$7])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testProjectWindowTransposeRuleWithConstants">
    <Resource name="sql">
      <![CDATA[select col1, col2
from (
  select empno,
    sum(100) over (partition by  deptno order by sal) as col1,
  sum(1000) over(partition by deptno order by sal) as col2
  from emp)]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(COL1=[$2], COL2=[$3])
  LogicalWindow(window#0=[window(partition {1} order by [0] aggs [SUM($2), SUM($3)])], constants=[[100, 1000]])
    LogicalProject(SAL=[$5], DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(COL1=[SUM(100) OVER (PARTITION BY $7 ORDER BY $5)], COL2=[SUM(1000) OVER (PARTITION BY $7 ORDER BY $5)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPruneEmptyRuleForLeftMarkJoin">
    <Resource name="sql">
      <![CDATA[select * from dept where deptno not in (select deptno from emp where false)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalProject(DEPTNO=[$0], DNAME=[$1])
    LogicalFilter(condition=[NOT($2)])
      LogicalJoin(condition=[=($0, $2)], joinType=[left_mark])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalProject(DEPTNO=[$0], DNAME=[$1])
    LogicalFilter(condition=[NOT($2)])
      LogicalProject(DEPTNO=[$0], DNAME=[$1], markCol=[false])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantIntoFilter">
    <Resource name="sql">
      <![CDATA[select * from (select * from sales.emp where deptno = 10)
where deptno + 5 > empno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[>(+($7, 5), $0)])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[>(15, $0)])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantIntoJoin">
    <Resource name="sql">
      <![CDATA[select * from (select * from sales.emp where empno = 10) as e
left join sales.dept as d on e.empno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[=($0, $9)], joinType=[left])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[=($0, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[true], joinType=[left])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
      LogicalFilter(condition=[=($0, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalFilter(condition=[=($0, 10)])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantIntoJoin2">
    <Resource name="sql">
      <![CDATA[select * from (select * from sales.emp where empno = 10) as e
join sales.dept as d on e.empno = d.deptno and e.deptno + e.empno = d.deptno + 5]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$10], DNAME=[$11])
  LogicalJoin(condition=[AND(=($0, $10), =($9, $12))], joinType=[inner])
    LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[+($7, $0)])
      LogicalFilter(condition=[=($0, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], DNAME=[$1], $f2=[+($0, 5)])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[10], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[10], DNAME=[$11])
  LogicalJoin(condition=[=($9, 15)], joinType=[inner])
    LogicalProject(EMPNO=[10], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[+($7, 10)])
      LogicalFilter(condition=[=($0, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[10], DNAME=[$1], $f2=[15])
      LogicalFilter(condition=[=($0, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantIntoProject">
    <Resource name="sql">
      <![CDATA[select deptno, deptno + 1, empno + deptno
from sales.emp
where deptno = 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$7], EXPR$1=[+($7, 1)], EXPR$2=[+($0, $7)])
  LogicalFilter(condition=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[10], EXPR$1=[11], EXPR$2=[+($0, 10)])
  LogicalFilter(condition=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantIntoProjectWithIsNotDistinctFrom">
    <Resource name="sql">
      <![CDATA[select deptno, deptno + 1, empno + deptno
from sales.emp
where deptno is not distinct from 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$7], EXPR$1=[+($7, 1)], EXPR$2=[+($0, $7)])
  LogicalFilter(condition=[OR(AND(IS NULL($7), IS NULL(10)), IS TRUE(=($7, 10)))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[10], EXPR$1=[11], EXPR$2=[+($0, 10)])
  LogicalFilter(condition=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantIntoProjectWithIsNotDistinctFromDate">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(HIREDATE=[$4])
  LogicalFilter(condition=[IS NOT DISTINCT FROM($4, 2020-12-11)])
    LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(HIREDATE=[CAST(2020-12-11):DATE])
  LogicalFilter(condition=[IS NOT DISTINCT FROM($4, 2020-12-11)])
    LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantIntoProjectWithIsNotDistinctFromForNull">
    <Resource name="sql">
      <![CDATA[select mgr, deptno
from sales.emp
where mgr is not distinct from null]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(MGR=[$3], DEPTNO=[$7])
  LogicalFilter(condition=[OR(AND(IS NULL($3), IS NULL(null:INTEGER)), IS TRUE(=($3, null)))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(MGR=[null:INTEGER], DEPTNO=[$7])
  LogicalFilter(condition=[IS NULL($3)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughAggregateAllConst">
    <Resource name="sql">
      <![CDATA[select 4, 2+3, max(five) from (
  select *, 4 as four, 2+3 as two_plus_three, 5 as five, deptno+42 as deptno42 from emp
) group by 4, 2+3]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], EXPR$2=[MAX($2)])
  LogicalProject(EXPR$0=[4], EXPR$1=[+(2, 3)], FIVE=[5])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$0], EXPR$1=[+(2, 3)], EXPR$2=[$1])
  LogicalAggregate(group=[{0}], EXPR$2=[MAX($1)])
    LogicalProject(EXPR$0=[4], FIVE=[5])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughAggregateAllLiterals">
    <Resource name="sql">
      <![CDATA[select 4, 2+3, max(5) from (
  select *, 4 as four, 2+3 as two_plus_three, 5 as five, deptno+42 as deptno42 from emp
) group by 4, 2+3]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], EXPR$2=[MAX($2)])
  LogicalProject(EXPR$0=[4], EXPR$1=[+(2, 3)], $f2=[5])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$0], EXPR$1=[+(2, 3)], EXPR$2=[$1])
  LogicalAggregate(group=[{0}], EXPR$2=[MAX($1)])
    LogicalProject(EXPR$0=[4], $f2=[5])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughAggregateConstGroupBy">
    <Resource name="sql">
      <![CDATA[select 4, 2+3, max(mgr) from (
  select *, 4 as four, 2+3 as two_plus_three, deptno+42 as deptno42 from emp
) group by 4, 2+3]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], EXPR$2=[MAX($2)])
  LogicalProject(EXPR$0=[4], EXPR$1=[+(2, 3)], MGR=[$3])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$0], EXPR$1=[+(2, 3)], EXPR$2=[$1])
  LogicalAggregate(group=[{0}], EXPR$2=[MAX($1)])
    LogicalProject(EXPR$0=[4], MGR=[$3])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughAggregatePermuted">
    <Resource name="sql">
      <![CDATA[select deptno, max(mgr) from (
  select *, 4 as four, 2+3 as two_plus_three, deptno+42 as deptno42 from emp
) group by deptno, four, two_plus_three, deptno42]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$4])
  LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$1=[MAX($4)])
    LogicalProject(DEPTNO=[$7], FOUR=[4], TWO_PLUS_THREE=[+(2, 3)], DEPTNO42=[+($7, 42)], MGR=[$3])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$2])
  LogicalAggregate(group=[{0, 1}], EXPR$1=[MAX($2)])
    LogicalProject(DEPTNO=[$7], DEPTNO42=[+($7, 42)], MGR=[$3])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughAggregatePermutedConstFirst">
    <Resource name="sql">
      <![CDATA[select deptno, max(mgr) from (
  select *, 4 as four, 2+3 as two_plus_three, deptno+42 as deptno42 from emp
) group by four, deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$1], EXPR$1=[$2])
  LogicalAggregate(group=[{0, 1}], EXPR$1=[MAX($2)])
    LogicalProject(FOUR=[4], DEPTNO=[$7], MGR=[$3])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)])
  LogicalProject(DEPTNO=[$7], MGR=[$3])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughAggregatePermutedConstGroupBy">
    <Resource name="sql">
      <![CDATA[select deptno, max(mgr) from (
  select *, 4 as four, 2+3 as two_plus_three, deptno+42 as deptno42 from emp
) group by 42+24, deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$1], EXPR$1=[$2])
  LogicalAggregate(group=[{0, 1}], EXPR$1=[MAX($2)])
    LogicalProject($f0=[+(42, 24)], DEPTNO=[$7], MGR=[$3])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)])
  LogicalProject(DEPTNO=[$7], MGR=[$3])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughAggregatePermutedInVolcano">
    <Resource name="sql">
      <![CDATA[select deptno, max(mgr) from (
  select *, 4 as four, 2+3 as two_plus_three, deptno+42 as deptno42 from emp
) group by deptno, four, two_plus_three, deptno42]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$4])
  LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$1=[MAX($4)])
    LogicalProject(DEPTNO=[$7], FOUR=[4], TWO_PLUS_THREE=[+(2, 3)], DEPTNO42=[+($7, 42)], MGR=[$3])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(DEPTNO=[$0], EXPR$1=[$2])
  EnumerableAggregate(group=[{0, 1}], EXPR$1=[MAX($2)])
    EnumerableProject(DEPTNO=[$7], DEPTNO42=[+($7, 42)], MGR=[$3])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughAggregateSimpleNonNullable">
    <Resource name="sql">
      <![CDATA[select deptno, max(ename) from (
  select *, 4 as four, 2+3 as two_plus_three, deptno+42 as deptno42 from emp
) group by deptno, four]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$2])
  LogicalAggregate(group=[{0, 1}], EXPR$1=[MAX($2)])
    LogicalProject(DEPTNO=[$7], FOUR=[4], ENAME=[$1])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)])
  LogicalProject(DEPTNO=[$7], ENAME=[$1])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughConstLast">
    <Resource name="sql">
      <![CDATA[select deptno, max(mgr) from (
  select *, 4 as four, 2+3 as two_plus_three, deptno+42 as deptno42 from emp
) group by deptno, four]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$2])
  LogicalAggregate(group=[{0, 1}], EXPR$1=[MAX($2)])
    LogicalProject(DEPTNO=[$7], FOUR=[4], MGR=[$3])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)])
  LogicalProject(DEPTNO=[$7], MGR=[$3])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughUnion">
    <Resource name="sql">
      <![CDATA[select 2, deptno, job from emp as e1
union all
select 2, deptno, job from emp as e2]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(EXPR$0=[2], DEPTNO=[$7], JOB=[$2])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EXPR$0=[2], DEPTNO=[$7], JOB=[$2])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[2], DEPTNO=[$0], JOB=[$1])
  LogicalUnion(all=[true])
    LogicalProject(DEPTNO=[$7], JOB=[$2])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$7], JOB=[$2])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughUnion2">
    <Resource name="sql">
      <![CDATA[select 2, deptno, job from emp as e1
union all
select 1, deptno, job from emp as e2]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(EXPR$0=[2], DEPTNO=[$7], JOB=[$2])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EXPR$0=[1], DEPTNO=[$7], JOB=[$2])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughUnion3">
    <Resource name="sql">
      <![CDATA[select 2, 3 from emp as e1
union all
select 2, 3 from emp as e2]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(EXPR$0=[2], EXPR$1=[3])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EXPR$0=[2], EXPR$1=[3])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[2], EXPR$1=[3])
  LogicalUnion(all=[true])
    LogicalProject(EXPR$0=[2])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EXPR$0=[2])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughUnionInVolcano">
    <Resource name="sql">
      <![CDATA[select 2, deptno, job from emp as e1
union all
select 2, deptno, job from emp as e2]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(EXPR$0=[2], DEPTNO=[$7], JOB=[$2])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EXPR$0=[2], DEPTNO=[$7], JOB=[$2])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(EXPR$0=[2], DEPTNO=[$0], JOB=[$1])
  EnumerableUnion(all=[true])
    EnumerableProject(DEPTNO=[$7], JOB=[$2])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
    EnumerableProject(DEPTNO=[$7], JOB=[$2])
      EnumerableTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullConstantThroughUnionSameTypeNullableField">
    <Resource name="sql">
      <![CDATA[select deptno, ename from empnullables where deptno = 1
union all
select deptno, ename from empnullables where deptno = 1]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(DEPTNO=[$1], ENAME=[$0])
    LogicalFilter(condition=[=($1, 1)])
      LogicalProject(ENAME=[$1], DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
  LogicalProject(DEPTNO=[$1], ENAME=[$0])
    LogicalFilter(condition=[=($1, 1)])
      LogicalProject(ENAME=[$1], DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[CAST(1):INTEGER], ENAME=[$0])
  LogicalUnion(all=[true])
    LogicalProject(ENAME=[$0])
      LogicalFilter(condition=[=($1, 1)])
        LogicalProject(ENAME=[$1], DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
    LogicalProject(ENAME=[$0])
      LogicalFilter(condition=[=($1, 1)])
        LogicalProject(ENAME=[$1], DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullUpPredicatesFromProject2">
    <Resource name="sql">
      <![CDATA[select comm = 2, empno <> 1 from emp where comm = 2 and empno = 1]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[=($6, 2)], EXPR$1=[<>($0, 1)])
  LogicalFilter(condition=[AND(=($6, 2), =($0, 1))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[true], EXPR$1=[false])
  LogicalFilter(condition=[AND(=($6, 2), =($0, 1))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPullUpPredicatesFromUnionWithProject">
    <Resource name="sql">
      <![CDATA[select empno = null from emp where comm = 2
union all
select comm = 2 from emp where comm = 2]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(EXPR$0=[null:BOOLEAN])
    LogicalFilter(condition=[=($6, 2)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EXPR$0=[=($6, 2)])
    LogicalFilter(condition=[=($6, 2)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(EXPR$0=[null:BOOLEAN])
    LogicalFilter(condition=[=($6, 2)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(EXPR$0=[true])
    LogicalFilter(condition=[=($6, 2)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushAggregateThroughSemiJoin">
    <Resource name="sql">
      <![CDATA[select distinct sal
from (select * from sales.emp e where e.job in
(select d.dname from sales.dept d))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}])
  LogicalProject(SAL=[$1])
    LogicalProject(JOB=[$0], SAL=[$1])
      LogicalJoin(condition=[=($0, $2)], joinType=[inner])
        LogicalProject(JOB=[$2], SAL=[$5])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{0}])
          LogicalProject(DNAME=[$1])
            LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalAggregate(group=[{1}])
  LogicalJoin(condition=[=($0, $2)], joinType=[semi])
    LogicalAggregate(group=[{0, 1}])
      LogicalProject(JOB=[$2], SAL=[$5])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{1}])
  LogicalJoin(condition=[=($0, $2)], joinType=[semi])
    LogicalAggregate(group=[{0, 1}])
      LogicalProject(JOB=[$2], SAL=[$5])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushAvgGroupingSetsThroughUnion">
    <Resource name="sql">
      <![CDATA[select deptno, job, avg(empno) from
(select * from emp as e1 union all
 select * from emp as e2)
group by rollup(deptno, job)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[AVG($2)])
  LogicalProject(DEPTNO=[$7], JOB=[$2], EMPNO=[$0])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[AVG($2)])
  LogicalUnion(all=[true])
    LogicalProject(DEPTNO=[$7], JOB=[$2], EMPNO=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$7], JOB=[$2], EMPNO=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushAvgThroughUnion">
    <Resource name="sql">
      <![CDATA[select ename,avg(empno) from
(select * from emp as e1 union all
 select * from emp as e2)
group by ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[AVG($1)])
  LogicalProject(ENAME=[$1], EMPNO=[$0])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[AVG($1)])
  LogicalUnion(all=[true])
    LogicalProject(ENAME=[$1], EMPNO=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(ENAME=[$1], EMPNO=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushBoolAndBoolOrThroughUnion">
    <Resource name="sql">
      <![CDATA[select ename, bool_and(empbol), bool_or(empbol) from
(select ename, case when mod(empno, 2) = 1 then true else false end as empbol from emp as e1 union all
 select ename, case when mod(empno, 2) = 1 then true else false end as empbol from emp as e2)
group by ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[BOOL_AND($1)], EXPR$2=[BOOL_OR($1)])
  LogicalUnion(all=[true])
    LogicalProject(ENAME=[$1], EMPBOL=[=(MOD($0, 2), 1)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(ENAME=[$1], EMPBOL=[=(MOD($0, 2), 1)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[BOOL_AND($1)], EXPR$2=[BOOL_OR($2)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0}], EXPR$1=[BOOL_AND($1)], EXPR$2=[BOOL_OR($1)])
      LogicalProject(ENAME=[$1], EMPBOL=[=(MOD($0, 2), 1)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], EXPR$1=[BOOL_AND($1)], EXPR$2=[BOOL_OR($1)])
      LogicalProject(ENAME=[$1], EMPBOL=[=(MOD($0, 2), 1)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushCountFilterThroughUnion">
    <Resource name="sql">
      <![CDATA[select deptno, count(*) filter (where job = 'CLERK')
from (
  select * from emp where deptno = 10
  union all
  select * from emp where deptno > 20)
group by deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT() FILTER $1])
  LogicalProject(DEPTNO=[$7], $f1=[=($2, 'CLERK')])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalFilter(condition=[=($7, 10)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalFilter(condition=[>($7, 20)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[$SUM0($1)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0}], EXPR$1=[COUNT() FILTER $1])
      LogicalProject(DEPTNO=[$7], $f1=[=($2, 'CLERK')])
        LogicalFilter(condition=[=($7, 10)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], EXPR$1=[COUNT() FILTER $1])
      LogicalProject(DEPTNO=[$7], $f1=[=($2, 'CLERK')])
        LogicalFilter(condition=[>($7, 20)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushCountNullableGroupingSetsThroughUnion">
    <Resource name="sql">
      <![CDATA[select deptno, job, count(mgr) from
(select * from emp as e1 union all
 select * from emp as e2)
group by rollup(deptno, job)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[COUNT($2)])
  LogicalProject(DEPTNO=[$7], JOB=[$2], MGR=[$3])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[$SUM0($2)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushCountNullableThroughUnion">
    <Resource name="sql">
      <![CDATA[select ename,count(mgr) from
(select * from emp as e1 union all
 select * from emp as e2)
group by ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)])
  LogicalProject(ENAME=[$1], MGR=[$3])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[$SUM0($1)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)])
      LogicalProject(ENAME=[$1], MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)])
      LogicalProject(ENAME=[$1], MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushCountStarGroupingSetsThroughUnion">
    <Resource name="sql">
      <![CDATA[select deptno, job, count(*) from
(select * from emp as e1 union all
 select * from emp as e2)
group by rollup(deptno, job)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[COUNT()])
  LogicalProject(DEPTNO=[$7], JOB=[$2])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[$SUM0($2)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
      LogicalProject(DEPTNO=[$7], JOB=[$2])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
      LogicalProject(DEPTNO=[$7], JOB=[$2])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushCountStarThroughUnion">
    <Resource name="sql">
      <![CDATA[select ename,count(*) from
(select * from emp as e1 union all
 select * from emp as e2)
group by ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[COUNT()])
  LogicalProject(ENAME=[$1])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[$SUM0($1)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0}], EXPR$1=[COUNT()])
      LogicalProject(ENAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], EXPR$1=[COUNT()])
      LogicalProject(ENAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushFilterPastAggWithGroupingSets1">
    <Resource name="sql">
      <![CDATA[select ddeptno, dname, c from
             (select deptno ddeptno, dname dname, count(*) as c
             from dept group by rollup(deptno,dname)) t
              where dname = 'Charlie']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DDEPTNO=[$0], DNAME=[$1], C=[$2])
  LogicalProject(DDEPTNO=[$0], DNAME=[$1], C=[$2])
    LogicalFilter(condition=[=($1, 'Charlie')])
      LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], C=[COUNT()])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushFilterPastAggWithGroupingSets2">
    <Resource name="sql">
      <![CDATA[select dname, ddeptno, c from
             (select dname dname, deptno ddeptno, count(*) as c
             from dept group by grouping sets ((dname,deptno),(dname))) t
              where dname = 'Charlie']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$0], DDEPTNO=[$1], C=[$2])
  LogicalFilter(condition=[=($0, 'Charlie')])
    LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}]], C=[COUNT()])
      LogicalProject(DNAME=[$1], DDEPTNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$0], DDEPTNO=[$1], C=[$2])
  LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}]], C=[COUNT()])
    LogicalFilter(condition=[=($0, 'Charlie')])
      LogicalProject(DNAME=[$1], DDEPTNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushFilterPastProject">
    <Resource name="sql">
      <![CDATA[select a.dname
from dept a
left join dept b on b.deptno > 10
right join dept c on b.deptno > 10
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[$4], joinType=[right])
    LogicalProject(DEPTNO=[$0], DNAME=[$1], DEPTNO0=[$2], DNAME0=[$3], $f4=[>($2, 10)])
      LogicalJoin(condition=[$4], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalProject(DEPTNO=[$0], DNAME=[$1], $f2=[>($0, 10)])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[true], joinType=[right])
    LogicalProject(DEPTNO=[$0], DNAME=[$1], DEPTNO0=[$2], DNAME0=[$3], $f4=[>($2, 10)])
      LogicalProject(DEPTNO=[$0], DNAME=[$1], DEPTNO0=[CAST($2):INTEGER], DNAME0=[CAST($3):VARCHAR(10)], $f2=[CAST($4):BOOLEAN])
        LogicalJoin(condition=[true], joinType=[inner])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
          LogicalProject(DEPTNO=[$0], DNAME=[$1], $f2=[>($0, 10)])
            LogicalFilter(condition=[>($0, 10)])
              LogicalFilter(condition=[>($0, 10)])
                LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushFilterPastWindowWithDoubleWindows">
    <Resource name="sql">
      <![CDATA[select * from
(select DNAME, DEPTNO, count(*) over (partition by DNAME, DEPTNO) as cnt,
sum(1) over (partition by DEPTNO) as all_sum from dept) t
where DEPTNO = 1]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$0], DEPTNO=[$1], CNT=[$2], ALL_SUM=[$3])
  LogicalFilter(condition=[=($1, 1)])
    LogicalProject(DNAME=[$1], DEPTNO=[$0], CNT=[$2], ALL_SUM=[$3])
      LogicalWindow(window#0=[window(partition {0, 1} aggs [COUNT()])], window#1=[window(partition {0} aggs [SUM($2)])], constants=[[1]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1], DEPTNO=[$0], CNT=[$2], ALL_SUM=[$3])
  LogicalFilter(condition=[=($0, 1)])
    LogicalWindow(window#0=[window(partition {0, 1} aggs [COUNT()])], window#1=[window(partition {0} aggs [SUM($2)])], constants=[[1]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushFilterPastWindowWithOnePartitionColumn">
    <Resource name="sql">
      <![CDATA[select * from
(select DNAME, DEPTNO, count(*) over (partition by DEPTNO) from dept)
where DEPTNO > 0]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$0], DEPTNO=[$1], EXPR$2=[$2])
  LogicalFilter(condition=[>($1, 0)])
    LogicalProject(DNAME=[$1], DEPTNO=[$0], EXPR$2=[$2])
      LogicalWindow(window#0=[window(partition {0} aggs [COUNT()])])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1], DEPTNO=[$0], EXPR$2=[$2])
  LogicalWindow(window#0=[window(partition {0} aggs [COUNT()])])
    LogicalFilter(condition=[>($0, 0)])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushFilterPastWindowWithTwoPartitionColumns">
    <Resource name="sql">
      <![CDATA[select * from
(select DNAME, DEPTNO, count(*) over (partition by DNAME, DEPTNO) from dept)
where DEPTNO > 0]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$0], DEPTNO=[$1], EXPR$2=[$2])
  LogicalFilter(condition=[>($1, 0)])
    LogicalProject(DNAME=[$1], DEPTNO=[$0], EXPR$2=[$2])
      LogicalWindow(window#0=[window(partition {0, 1} aggs [COUNT()])])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1], DEPTNO=[$0], EXPR$2=[$2])
  LogicalWindow(window#0=[window(partition {0, 1} aggs [COUNT()])])
    LogicalFilter(condition=[>($0, 0)])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushFilterSemijoin">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[AND(=($0, $10), =($8, 100))], joinType=[semi])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[=($0, $10)], joinType=[semi])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalFilter(condition=[=($5, 100)])
      LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushFilterThroughJoinWithNonDeterministic">
    <Resource name="sql">
      <![CDATA[select * from (
  select * from dept inner join
     emp on dept.deptno = emp.deptno) R
where 0.9 <= rand()]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1], EMPNO=[$2], ENAME=[$3], JOB=[$4], MGR=[$5], HIREDATE=[$6], SAL=[$7], COMM=[$8], DEPTNO0=[$9], SLACKER=[$10])
  LogicalFilter(condition=[<=(CAST(0.9:DECIMAL(2, 1)):DOUBLE NOT NULL, RAND())])
    LogicalProject(DEPTNO=[$0], DNAME=[$1], EMPNO=[$2], ENAME=[$3], JOB=[$4], MGR=[$5], HIREDATE=[$6], SAL=[$7], COMM=[$8], DEPTNO0=[$9], SLACKER=[$10])
      LogicalJoin(condition=[=($0, $9)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1], EMPNO=[$2], ENAME=[$3], JOB=[$4], MGR=[$5], HIREDATE=[$6], SAL=[$7], COMM=[$8], DEPTNO0=[$9], SLACKER=[$10])
  LogicalProject(DEPTNO=[$0], DNAME=[$1], EMPNO=[$2], ENAME=[$3], JOB=[$4], MGR=[$5], HIREDATE=[$6], SAL=[$7], COMM=[$8], DEPTNO0=[$9], SLACKER=[$10])
    LogicalFilter(condition=[<=(CAST(0.9:DECIMAL(2, 1)):DOUBLE NOT NULL, RAND())])
      LogicalJoin(condition=[=($0, $9)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushFilterThroughSemiJoin">
    <Resource name="sql">
      <![CDATA[select * from (
  select * from dept where dept.deptno in (
    select emp.deptno from emp))R
where R.deptno <=10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalFilter(condition=[<=($0, 10)])
    LogicalJoin(condition=[=($0, $2)], joinType=[semi])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalProject(DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalJoin(condition=[=($0, $2)], joinType=[semi])
    LogicalFilter(condition=[<=($0, 10)])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushJoinCondDownToProject">
    <Resource name="sql">
      <![CDATA[select d.deptno, e.deptno from sales.dept d, sales.emp e
 where d.deptno + 10 = e.deptno * 2]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DEPTNO0=[$9])
  LogicalFilter(condition=[=(+($0, 10), *($9, 2))])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DEPTNO0=[$9])
  LogicalProject(DEPTNO=[$0], DNAME=[$1], EMPNO=[$3], ENAME=[$4], JOB=[$5], MGR=[$6], HIREDATE=[$7], SAL=[$8], COMM=[$9], DEPTNO0=[$10], SLACKER=[$11])
    LogicalJoin(condition=[=($2, $12)], joinType=[inner])
      LogicalProject(DEPTNO=[$0], DNAME=[$1], $f2=[+($0, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[*($7, 2)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushJoinConditionWithNonDeterministic">
    <Resource name="sql">
      <![CDATA[select * from (
  select * from dept inner join
     emp on dept.deptno = emp.deptno and emp.mgr <= rand()) R
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1], EMPNO=[$2], ENAME=[$3], JOB=[$4], MGR=[$5], HIREDATE=[$6], SAL=[$7], COMM=[$8], DEPTNO0=[$9], SLACKER=[$10])
  LogicalJoin(condition=[AND(=($0, $9), <=(CAST($5):DOUBLE, RAND()))], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushJoinThroughUnionOnRightDoesNotMatchAntiJoin">
    <Resource name="sql">
      <![CDATA[select r1.sal from emp r1 where r1.deptno not in (select deptno from dept d1 where deptno < 10 union all select deptno from dept d2 where deptno > 20)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalJoin(condition=[=($7, $8)], joinType=[anti])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalUnion(all=[true])
      LogicalProject(DEPTNO=[$0])
        LogicalFilter(condition=[<($0, 10)])
          LogicalTableScan(table=[[scott, DEPT]])
      LogicalProject(DEPTNO=[$0])
        LogicalFilter(condition=[>($0, 20)])
          LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushJoinThroughUnionOnRightDoesNotMatchSemiJoin">
    <Resource name="sql">
      <![CDATA[select r1.sal from emp r1 where r1.deptno in (select deptno from dept d1 where deptno > 100 union all select deptno from dept d2 where deptno > 20)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalJoin(condition=[=($7, $8)], joinType=[semi])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalUnion(all=[true])
      LogicalProject(DEPTNO=[$0])
        LogicalFilter(condition=[<($0, 10)])
          LogicalTableScan(table=[[scott, DEPT]])
      LogicalProject(DEPTNO=[$0])
        LogicalFilter(condition=[>($0, 20)])
          LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushMaxNullableGroupingSetsThroughUnion">
    <Resource name="sql">
      <![CDATA[select deptno, job, max(mgr) from
(select * from emp as e1 union all
 select * from emp as e2)
group by rollup(deptno, job)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[MAX($2)])
  LogicalProject(DEPTNO=[$7], JOB=[$2], MGR=[$3])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[MAX($2)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[MAX($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[MAX($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushMaxNullableThroughUnion">
    <Resource name="sql">
      <![CDATA[select ename,max(mgr) from
(select * from emp as e1 union all
 select * from emp as e2)
group by ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)])
  LogicalProject(ENAME=[$1], MGR=[$3])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)])
      LogicalProject(ENAME=[$1], MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], EXPR$1=[MAX($1)])
      LogicalProject(ENAME=[$1], MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushMinGroupingSetsThroughUnion">
    <Resource name="sql">
      <![CDATA[select deptno, job, min(empno) from
            (select * from emp as e1 union all
            select * from emp as e2)
            group by rollup(deptno, job)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[MIN($2)])
  LogicalProject(DEPTNO=[$7], JOB=[$2], EMPNO=[$0])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[MIN($2)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[MIN($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], EMPNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[MIN($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], EMPNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushMinThroughUnion">
    <Resource name="sql">
      <![CDATA[select ename,min(empno) from
            (select * from emp as e1 union all
            select * from emp as e2)
            group by ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[MIN($1)])
  LogicalProject(ENAME=[$1], EMPNO=[$0])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[MIN($1)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0}], EXPR$1=[MIN($1)])
      LogicalProject(ENAME=[$1], EMPNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], EXPR$1=[MIN($1)])
      LogicalProject(ENAME=[$1], EMPNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushProjectPastFilter3b">
    <Resource name="sql">
      <![CDATA[select empno + deptno as x, ename, job, mgr,
  hiredate, sal, comm, slacker
from emp
where sal = 10 * comm
and upper(ename) = 'FOO']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(X=[+($0, $7)], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], SLACKER=[$8])
  LogicalFilter(condition=[AND(=($5, *(10, $6)), =(UPPER($1), 'FOO'))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(X=[$8], ENAME=[$0], JOB=[$1], MGR=[$2], HIREDATE=[$3], SAL=[$4], COMM=[$5], SLACKER=[$6])
  LogicalFilter(condition=[$7])
    LogicalProject(ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], SLACKER=[$8], $f7=[AND(=($5, *(10, $6)), =(UPPER($1), 'FOO'))], $f8=[+($0, $7)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushProjectPastFilter3c">
    <Resource name="sql">
      <![CDATA[select empno + deptno as x, ename, job, mgr,
  hiredate, sal, comm, slacker
from emp
where sal = 10 * comm
and upper(ename) = 'FOO']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(X=[+($0, $7)], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], SLACKER=[$8])
  LogicalFilter(condition=[AND(=($5, *(10, $6)), =(UPPER($1), 'FOO'))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(X=[$7], ENAME=[$0], JOB=[$1], MGR=[$2], HIREDATE=[$3], SAL=[$4], COMM=[$5], SLACKER=[$6])
  LogicalFilter(condition=[AND(=($4, *(10, $5)), =(UPPER($0), 'FOO'))])
    LogicalProject(ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], SLACKER=[$8], $f7=[+($0, $7)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSemiJoinConditions">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalJoin(condition=[AND(OR(=($0, $2), AND(IS NULL($0), IS NULL($2))), OR(=($1, $3), AND(IS NULL($1), IS NULL($3))))], joinType=[semi])
    LogicalProject(DEPTNO=[$7], ENAME=[$1])
      LogicalTableScan(table=[[scott, EMP]])
    LogicalProject(DEPTNO=[$0], DNAME=[$1])
      LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalProject(DEPTNO=[$7], ENAME=[$1])
    LogicalJoin(condition=[AND(IS NOT DISTINCT FROM($7, $8), IS NOT DISTINCT FROM($1, $9))], joinType=[semi])
      LogicalTableScan(table=[[scott, EMP]])
      LogicalProject(DEPTNO=[$0], DNAME=[$1])
        LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSemiJoinConditionsToLeft">
    <Resource name="sql">
      <![CDATA[select * from emp
where emp.deptno
in (select dept.deptno from dept where emp.empno > 20)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(IS NOT DISTINCT FROM($7, $8), >($0, 20))], joinType=[semi])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSemiJoinPastFilter">
    <Resource name="sql">
      <![CDATA[select e.ename from emp e, dept d
where e.deptno = d.deptno and e.ename = 'foo']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$1])
  LogicalFilter(condition=[AND(=($7, $9), =($1, 'foo'))])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$1])
  LogicalJoin(condition=[=($7, $9)], joinType=[inner], semiJoinDone=[true])
    LogicalFilter(condition=[=($1, 'foo')])
      LogicalJoin(condition=[=($7, $9)], joinType=[semi])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSemiJoinPastJoinRuleLeft">
    <Resource name="sql">
      <![CDATA[select e1.ename from emp e1, dept d, emp e2
where e1.deptno = d.deptno and e1.empno = e2.empno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$1])
  LogicalFilter(condition=[AND(=($7, $9), =($0, $11))])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$1])
  LogicalJoin(condition=[=($0, $11)], joinType=[inner], semiJoinDone=[true])
    LogicalJoin(condition=[=($7, $9)], joinType=[inner], semiJoinDone=[true])
      LogicalJoin(condition=[=($0, $9)], joinType=[semi])
        LogicalJoin(condition=[=($7, $9)], joinType=[semi])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSemiJoinPastJoinRuleNotHappensJoinKeysDifferentOrigin">
    <Resource name="sql">
      <![CDATA[select e.ename from emp e, dept d, bonus b
where e.deptno = d.deptno and e.ename = b.ename and d.dname = b.job]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$1])
  LogicalFilter(condition=[AND(=($7, $9), =($1, $11), =($10, $12))])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$1])
  LogicalJoin(condition=[AND(=($1, $11), =($10, $12))], joinType=[inner], semiJoinDone=[true])
    LogicalJoin(condition=[AND(=($1, $11), =($10, $12))], joinType=[semi])
      LogicalJoin(condition=[=($7, $9)], joinType=[inner], semiJoinDone=[true])
        LogicalJoin(condition=[=($7, $9)], joinType=[semi])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
    LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSemiJoinPastJoinRuleRight">
    <Resource name="sql">
      <![CDATA[select e1.ename from emp e1, dept d, emp e2
where e1.deptno = d.deptno and d.deptno = e2.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$1])
  LogicalFilter(condition=[AND(=($7, $9), =($9, $18))])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$1])
  LogicalJoin(condition=[=($9, $18)], joinType=[inner], semiJoinDone=[true])
    LogicalJoin(condition=[=($7, $9)], joinType=[inner], semiJoinDone=[true])
      LogicalJoin(condition=[=($7, $9)], joinType=[semi])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalJoin(condition=[=($0, $9)], joinType=[semi])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSemiJoinPastProject">
    <Resource name="sql">
      <![CDATA[select e.* from
(select ename, trim(job), sal * 2, deptno from emp) e, dept d
where e.deptno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], EXPR$1=[$1], EXPR$2=[$2], DEPTNO=[$3])
  LogicalFilter(condition=[=($3, $4)])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalProject(ENAME=[$1], EXPR$1=[TRIM(FLAG(BOTH), ' ', $2)], EXPR$2=[*($5, 2)], DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$0], EXPR$1=[$1], EXPR$2=[$2], DEPTNO=[$3])
  LogicalJoin(condition=[=($3, $4)], joinType=[inner], semiJoinDone=[true])
    LogicalProject(ENAME=[$1], EXPR$1=[TRIM(FLAG(BOTH), ' ', $2)], EXPR$2=[*($5, 2)], DEPTNO=[$7])
      LogicalJoin(condition=[=($7, $9)], joinType=[semi])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSemiJoinToLeftJoinLeftInput">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[=($1, $12)], joinType=[semi])
  LogicalJoin(condition=[=($0, $10)], joinType=[left])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalTableScan(table=[[scott, EMP]])
  LogicalTableScan(table=[[scott, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalJoin(condition=[=($0, $10)], joinType=[left])
  LogicalJoin(condition=[=($1, $4)], joinType=[semi])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalTableScan(table=[[scott, BONUS]])
  LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSemiJoinToRightJoinRightInput">
    <Resource name="planBefore">
      <![CDATA[
LogicalJoin(condition=[=($9, $12)], joinType=[semi])
  LogicalJoin(condition=[=($7, $8)], joinType=[right])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
  LogicalTableScan(table=[[scott, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalJoin(condition=[=($7, $8)], joinType=[right])
  LogicalTableScan(table=[[scott, EMP]])
  LogicalJoin(condition=[=($1, $4)], joinType=[semi])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalTableScan(table=[[scott, BONUS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSumConstantGroupingSetsThroughUnion">
    <Resource name="sql">
      <![CDATA[select deptno, job, sum(u) from
(select *, 2 u from emp as e1 union all
 select *, 3 u from emp as e2)
group by rollup(deptno,job)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[SUM($2)])
  LogicalProject(DEPTNO=[$7], JOB=[$2], U=[$9])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], U=[2])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], U=[3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[SUM($2)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[SUM($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], U=[2])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[SUM($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], U=[3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSumConstantThroughUnion">
    <Resource name="sql">
      <![CDATA[select ename, sum(u) from
(select *, 2 u from emp as e1 union all
 select *, 3 u from emp as e2)
group by ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
  LogicalProject(ENAME=[$1], U=[$9])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], U=[2])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], U=[3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
      LogicalProject(ENAME=[$1], U=[2])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
      LogicalProject(ENAME=[$1], U=[3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSumCountStarGroupingSetsThroughUnion">
    <Resource name="sql">
      <![CDATA[select deptno,job,sum(empno),count(*),min(deptno),max(empno) from
(select * from emp as e1 union all
 select * from emp as e2)
group by rollup(deptno,job)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[SUM($2)], EXPR$3=[COUNT()], EXPR$4=[MIN($0)], EXPR$5=[MAX($2)])
  LogicalProject(DEPTNO=[$7], JOB=[$2], EMPNO=[$0])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[SUM($2)], EXPR$3=[$SUM0($3)], EXPR$4=[MIN($4)], EXPR$5=[MAX($5)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[SUM($2)], EXPR$3=[COUNT()], EXPR$4=[MIN($0)], EXPR$5=[MAX($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], EMPNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[SUM($2)], EXPR$3=[COUNT()], EXPR$4=[MIN($0)], EXPR$5=[MAX($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], EMPNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSumCountStarThroughUnion">
    <Resource name="sql">
      <![CDATA[select ename,sum(empno),count(*),min(deptno),max(empno) from
(select * from emp as e1 union all
 select * from emp as e2)
group by ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT()], EXPR$3=[MIN($2)], EXPR$4=[MAX($1)])
  LogicalProject(ENAME=[$1], EMPNO=[$0], DEPTNO=[$7])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[$SUM0($2)], EXPR$3=[MIN($3)], EXPR$4=[MAX($4)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT()], EXPR$3=[MIN($2)], EXPR$4=[MAX($1)])
      LogicalProject(ENAME=[$1], EMPNO=[$0], DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[COUNT()], EXPR$3=[MIN($2)], EXPR$4=[MAX($1)])
      LogicalProject(ENAME=[$1], EMPNO=[$0], DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSumNullConstantGroupingSetsThroughUnion">
    <Resource name="sql">
      <![CDATA[select deptno, job, sum(u) from
(select *, cast(null as integer) u from emp as e1 union all
 select *, cast(null as integer) u from emp as e2)
group by rollup(deptno,job)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[SUM($2)])
  LogicalProject(DEPTNO=[$7], JOB=[$2], U=[$9])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], U=[null:INTEGER])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], U=[null:INTEGER])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[SUM($2)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[SUM($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], U=[null:INTEGER])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[SUM($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], U=[null:INTEGER])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSumNullConstantThroughUnion">
    <Resource name="sql">
      <![CDATA[select ename, sum(u) from
(select *, cast(null as integer) u from emp as e1 union all
 select *, cast(null as integer) u from emp as e2)
group by ename]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
  LogicalProject(ENAME=[$1], U=[$9])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], U=[null:INTEGER])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], U=[null:INTEGER])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
      LogicalProject(ENAME=[$1], U=[null:INTEGER])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
      LogicalProject(ENAME=[$1], U=[null:INTEGER])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSumNullableGroupingSetsThroughUnion">
    <Resource name="sql">
      <![CDATA[select deptno, job, sum(mgr) from
(select * from emp as e1 union all
 select * from emp as e2)
group by rollup(deptno, job)
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[SUM($2)])
  LogicalProject(DEPTNO=[$7], JOB=[$2], MGR=[$3])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], EXPR$2=[SUM($2)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[SUM($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[SUM($2)])
      LogicalProject(DEPTNO=[$7], JOB=[$2], MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSumNullableNOGBYThroughUnion">
    <Resource name="sql">
      <![CDATA[select sum(mgr) from
(select * from emp as e1 union all
 select * from emp as e2)
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0)])
  LogicalProject(MGR=[$3])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{}], EXPR$0=[SUM($0)])
      LogicalProject(MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{}], EXPR$0=[SUM($0)])
      LogicalProject(MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testPushSumNullableThroughUnion">
    <Resource name="sql">
      <![CDATA[select ename, sum(mgr) from
(select * from emp as e1 union all
 select * from emp as e2)
group by ename
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
  LogicalProject(ENAME=[$1], MGR=[$3])
    LogicalUnion(all=[true])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
  LogicalUnion(all=[true])
    LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
      LogicalProject(ENAME=[$1], MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
      LogicalProject(ENAME=[$1], MGR=[$3])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceAggregateFunctionsByGroup">
    <Resource name="sql">
      <![CDATA[select sal, max(sal) as sal_max, min(sal) as sal_min,
avg(sal) sal_avg, any_value(sal) as sal_val, first_value(sal) as sal_first,
last_value(sal) as sal_last
from emp group by sal, deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(SAL=[$0], SAL_MAX=[$2], SAL_MIN=[$3], SAL_AVG=[$4], SAL_VAL=[$5], SAL_FIRST=[$6], SAL_LAST=[$7])
  LogicalAggregate(group=[{0, 1}], SAL_MAX=[MAX($0)], SAL_MIN=[MIN($0)], SAL_AVG=[AVG($0)], SAL_VAL=[ANY_VALUE($0)], SAL_FIRST=[FIRST_VALUE($0)], SAL_LAST=[LAST_VALUE($0)])
    LogicalProject(SAL=[$5], DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(SAL=[$0], SAL_MAX=[$0], SAL_MIN=[$0], SAL_AVG=[$0], SAL_VAL=[$0], SAL_FIRST=[$0], SAL_LAST=[$0])
  LogicalAggregate(group=[{0, 1}])
    LogicalProject(SAL=[$5], DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceAllAggregateFunctions">
    <Resource name="sql">
      <![CDATA[select dname, stddev_pop(deptno), avg(deptno), stddev_samp(deptno), var_pop(deptno), var_samp(deptno)
from sales.dept group by dname]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[STDDEV_POP($1)], EXPR$2=[AVG($1)], EXPR$3=[STDDEV_SAMP($1)], EXPR$4=[VAR_POP($1)], EXPR$5=[VAR_SAMP($1)])
  LogicalProject(DNAME=[$1], DEPTNO=[$0])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$0], EXPR$1=[CAST(POWER(/(-($1, /(*($2, $2), $3)), $3), 0.5:DECIMAL(2, 1))):INTEGER NOT NULL], EXPR$2=[CAST(/($2, $3)):INTEGER NOT NULL], EXPR$3=[CAST(POWER(/(-($1, /(*($2, $2), $3)), CASE(=($3, 1), null:BIGINT, -($3, 1))), 0.5:DECIMAL(2, 1))):INTEGER], EXPR$4=[CAST(/(-($1, /(*($2, $2), $3)), $3)):INTEGER NOT NULL], EXPR$5=[CAST(/(-($1, /(*($2, $2), $3)), CASE(=($3, 1), null:BIGINT, -($3, 1)))):INTEGER NOT NULL])
  LogicalAggregate(group=[{0}], agg#0=[$SUM0($2)], agg#1=[$SUM0($1)], agg#2=[COUNT()])
    LogicalProject(DNAME=[$0], DEPTNO=[$1], $f2=[*($1, $1)])
      LogicalProject(DNAME=[$1], DEPTNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceAverageAndSumWithNoReduceStddevAndVar">
    <Resource name="sql">
      <![CDATA[select dname, stddev_pop(deptno), avg(deptno), var_pop(deptno)
from sales.dept group by dname]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[STDDEV_POP($1)], EXPR$2=[AVG($1)], EXPR$3=[VAR_POP($1)])
  LogicalProject(DNAME=[$1], DEPTNO=[$0])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$0], EXPR$1=[$1], EXPR$2=[CAST(/($2, $3)):INTEGER NOT NULL], EXPR$3=[$4])
  LogicalAggregate(group=[{0}], EXPR$1=[STDDEV_POP($1)], agg#1=[$SUM0($1)], agg#2=[COUNT()], EXPR$3=[VAR_POP($1)])
    LogicalProject(DNAME=[$1], DEPTNO=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceAverageAndVarWithNoReduceStddev">
    <Resource name="sql">
      <![CDATA[select dname, stddev_pop(deptno), avg(deptno), var_pop(deptno)
from sales.dept group by dname]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[STDDEV_POP($1)], EXPR$2=[AVG($1)], EXPR$3=[VAR_POP($1)])
  LogicalProject(DNAME=[$1], DEPTNO=[$0])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$0], EXPR$1=[$1], EXPR$2=[CAST(/($2, $3)):INTEGER NOT NULL], EXPR$3=[CAST(/(-($4, /(*($2, $2), $3)), $3)):INTEGER NOT NULL])
  LogicalAggregate(group=[{0}], EXPR$1=[STDDEV_POP($1)], agg#1=[SUM($1)], agg#2=[COUNT()], agg#3=[SUM($2)])
    LogicalProject(DNAME=[$0], DEPTNO=[$1], $f2=[*($1, $1)])
      LogicalProject(DNAME=[$1], DEPTNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceAverageWithNoReduceSum">
    <Resource name="sql">
      <![CDATA[select dname, max(dname), avg(deptno), min(dname)
from sales.dept group by dname]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[MAX($0)], EXPR$2=[AVG($1)], EXPR$3=[MIN($0)])
  LogicalProject(DNAME=[$1], DEPTNO=[$0])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$0], EXPR$1=[$0], EXPR$2=[CAST(/($1, $2)):INTEGER NOT NULL], EXPR$3=[$0])
  LogicalAggregate(group=[{0}], agg#0=[SUM($1)], agg#1=[COUNT()])
    LogicalProject(DNAME=[$1], DEPTNO=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceCaseNullabilityChange">
    <Resource name="sql">
      <![CDATA[select case when empno = 1 then 1
when 1 IS NOT NULL then 2
else null end as qx from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(QX=[CASE(=($0, 1), 1, IS NOT NULL(1), 2, null:INTEGER)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(QX=[CAST(CASE(=($0, 1), 1, 2)):INTEGER])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceCaseWhenWithCast">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject($f0=[CAST(CASE(=(MOD($0, ?0), 1), <($0, 2:BIGINT), =(MOD($0, ?1), 2), <($0, 1:BIGINT), <($0, 3:BIGINT))):BOOLEAN])
  LogicalValues(tuples=[[{ 1, 2 }, { 2, 1 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceCasts">
    <Resource name="sql">
      <![CDATA[select cast(d.dname as varchar(128)), cast(e.empno as integer)
from dept as d inner join emp as e
on cast(d.deptno as integer) = cast(e.deptno as integer)
where cast(e.job as varchar(1)) = 'Manager']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[CAST($1):VARCHAR(128) NOT NULL], EXPR$1=[CAST($2):INTEGER NOT NULL])
  LogicalFilter(condition=[=(CAST(CAST($4):VARCHAR(1) NOT NULL):VARCHAR(7) NOT NULL, 'Manager')])
    LogicalProject(DEPTNO=[$0], DNAME=[$1], EMPNO=[$3], ENAME=[$4], JOB=[$5], MGR=[$6], HIREDATE=[$7], SAL=[$8], COMM=[$9], DEPTNO1=[$10], SLACKER=[$11])
      LogicalJoin(condition=[=($2, $12)], joinType=[inner])
        LogicalProject(DEPTNO=[$0], DNAME=[$1], DEPTNO0=[CAST($0):INTEGER NOT NULL])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[CAST($7):INTEGER NOT NULL])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[CAST($1):VARCHAR(128) NOT NULL], EXPR$1=[$2])
  LogicalFilter(condition=[=(CAST(CAST($4):VARCHAR(1) NOT NULL):VARCHAR(7) NOT NULL, 'Manager')])
    LogicalProject(DEPTNO=[$0], DNAME=[$1], EMPNO=[$3], ENAME=[$4], JOB=[$5], MGR=[$6], HIREDATE=[$7], SAL=[$8], COMM=[$9], DEPTNO1=[$10], SLACKER=[$11])
      LogicalJoin(condition=[=($2, $12)], joinType=[inner])
        LogicalProject(DEPTNO=[$0], DNAME=[$1], DEPTNO0=[$0])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceCastsNullable">
    <Resource name="sql">
      <![CDATA[insert into sales.dept(deptno, dname)
select empno, cast(job as varchar(128)) from sales.empnullables]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalTableModify(table=[[CATALOG, SALES, DEPT]], operation=[INSERT], flattened=[false])
  LogicalProject(DEPTNO=[$0], DNAME=[$2])
    LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalTableModify(table=[[CATALOG, SALES, DEPT]], operation=[INSERT], flattened=[false])
  LogicalCalc(expr#0..8=[{inputs}], expr#9=[CAST($t2):VARCHAR(10) NOT NULL], DEPTNO=[$t0], DNAME=[$t9])
    LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceConstants">
    <Resource name="sql">
      <![CDATA[select 1+2, d.deptno+(3+4), (5+6)+d.deptno, cast(null as integer), coalesce(2,null), row(7+8) from dept d inner join emp e on d.deptno = e.deptno + (5-5) where d.deptno=(7+8) and d.deptno=(8+7) and d.deptno=coalesce(2,null)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[+(1, 2)], EXPR$1=[+($0, +(3, 4))], EXPR$2=[+(+(5, 6), $0)], EXPR$3=[null:INTEGER], EXPR$4=[CASE(IS NOT NULL(2), 2, null:INTEGER)], EXPR$5=[ROW(+(7, 8))])
  LogicalFilter(condition=[AND(=($0, +(7, 8)), =($0, CASE(IS NOT NULL(2), 2, null:INTEGER)))])
    LogicalProject(DEPTNO=[$0], DNAME=[$1], EMPNO=[$2], ENAME=[$3], JOB=[$4], MGR=[$5], HIREDATE=[$6], SAL=[$7], COMM=[$8], DEPTNO0=[$9], SLACKER=[$10])
      LogicalJoin(condition=[=($0, $11)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[+($7, -(5, 5))])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[3], EXPR$1=[22], EXPR$2=[26], EXPR$3=[null:INTEGER], EXPR$4=[CAST(2):INTEGER], EXPR$5=[ROW(15)])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceConstants2">
    <Resource name="sql">
      <![CDATA[select p1 is not distinct from p0
from (values (2, cast(null as integer))) as t(p0, p1)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[false])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceConstantsCalc">
    <Resource name="sql">
      <![CDATA[select * from (
  select upper(substring(x FROM 1 FOR 2) || substring(x FROM 3)) as u,
      substring(x FROM 1 FOR 1) as s
  from (
    select 'table' as x from (values (true))
    union
    select 'view' from (values (true))
    union
    select 'foreign table' from (values (true))
  )
) where u = 'TABLE']]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(U=[$0], S=[$1])
  LogicalFilter(condition=[=($0, 'TABLE')])
    LogicalProject(U=[UPPER(||(SUBSTRING($0, 1, 2), SUBSTRING($0, 3)))], S=[SUBSTRING($0, 1, 1)])
      LogicalUnion(all=[false])
        LogicalUnion(all=[false])
          LogicalProject(X=['table        '])
            LogicalValues(tuples=[[{ true }]])
          LogicalProject(EXPR$0=['view         '])
            LogicalValues(tuples=[[{ true }]])
        LogicalProject(EXPR$0=['foreign table'])
          LogicalValues(tuples=[[{ true }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalCalc(expr#0=[{inputs}], expr#1=[1], expr#2=[2], expr#3=[SUBSTRING($t0, $t1, $t2)], expr#4=[3], expr#5=[SUBSTRING($t0, $t4)], expr#6=[||($t3, $t5)], expr#7=[UPPER($t6)], expr#8=[SUBSTRING($t0, $t1, $t1)], U=[$t7], S=[$t8])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceConstantsNonDeterministicFunction">
    <Resource name="sql">
      <![CDATA[select sal, r
from (select sal, rand() as r from emp)
where r > 0.5]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalFilter(condition=[>($1, 10)])
  LogicalProject(SAL=[$5], N=[NDC()])
    LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceConstantsRequiresExecutor">
    <Resource name="sql">
      <![CDATA[select * from (values (1,2)) where 1 + 2 > 3 + CAST(NULL AS INTEGER)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
  LogicalFilter(condition=[>(+(1, 2), +(3, null))])
    LogicalValues(tuples=[[{ 1, 2 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceConstantsWindow">
    <Resource name="sql">
      <![CDATA[select col1, col2, col3
from (
  select empno,
    sum(100) over (partition by deptno, sal order by sal) as col1,
    sum(100) over (partition by sal order by deptno) as col2,
    sum(sal) over (partition by deptno order by sal) as col3
  from emp where sal = 5000)]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(COL1=[$2], COL2=[$3], COL3=[$4])
  LogicalWindow(window#0=[window(partition {1} range between UNBOUNDED PRECEDING and CURRENT ROW aggs [SUM($2)])], window#1=[window(order by [1] aggs [SUM($2)])], window#2=[window(partition {1} range between UNBOUNDED PRECEDING and CURRENT ROW aggs [SUM(5000)])], constants=[[100]])
    LogicalProject(SAL=[$5], DEPTNO=[$7])
      LogicalFilter(condition=[=($5, 5000)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(COL1=[SUM(100) OVER (PARTITION BY $7, $5 ORDER BY $5)], COL2=[SUM(100) OVER (PARTITION BY $5 ORDER BY $7)], COL3=[SUM($5) OVER (PARTITION BY $7 ORDER BY $5)])
  LogicalFilter(condition=[=($5, 5000)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceConstantsWithMultipleOrderByWindow">
    <Resource name="sql">
      <![CDATA[select col1, col2
from (
  select empno,
    sum(100) over (order by deptno, empno range between current row and unbounded following) as col1,
    sum(100) over (partition by sal, deptno order by deptno, empno range between unbounded preceding and unbounded following) as col2
  from emp where sal = 5000)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(COL1=[SUM(100) OVER (ORDER BY $7, $0 RANGE BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING)], COL2=[SUM(100) OVER (PARTITION BY $5, $7 ORDER BY $7, $0 RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)])
  LogicalFilter(condition=[=($5, 5000)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(COL1=[$3], COL2=[$4])
  LogicalWindow(window#0=[window(order by [2, 0] range between CURRENT ROW and UNBOUNDED FOLLOWING aggs [SUM($3)])], window#1=[window(partition {2} order by [2, 0] range between UNBOUNDED PRECEDING and UNBOUNDED FOLLOWING aggs [SUM($3)])], constants=[[100]])
    LogicalProject(EMPNO=[$0], SAL=[$5], DEPTNO=[$7])
      LogicalFilter(condition=[=($5, 5000)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceDecimal">
    <Resource name="sql">
      <![CDATA[select ename from emp where sal > cast (100.0 as decimal(4, 1))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$1])
  LogicalFilter(condition=[>(CAST($5):DECIMAL(11, 1) NOT NULL, 100.0)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$1])
  LogicalCalc(expr#0..8=[{inputs}], expr#9=[10:BIGINT], expr#10=[*($t5, $t9)], expr#11=[Reinterpret($t10)], expr#12=[Reinterpret($t11)], expr#13=[100.0:DECIMAL(11, 1)], expr#14=[Reinterpret($t13)], expr#15=[>($t12, $t14)], proj#0..8=[{exprs}], $condition=[$t15])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceDynamic">
    <Resource name="sql">
      <![CDATA[select USER from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(USER=[USER])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(USER=['happyCalciteUser':VARCHAR(2000)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceLambda">
    <Resource name="sql">
      <![CDATA[select "EXISTS"(ARRAY[1], x -> true)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[EXISTS(ARRAY(1), (X) -> true)])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceNestedCaseWhen">
    <Resource name="sql">
      <![CDATA[select sal
from emp
where case when (sal = 1000) then
(case when sal = 1000 then null else 1 end is null) else
(case when sal = 2000 then null else 1 end is null) end is true]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalFilter(condition=[SEARCH($5, Sarg[1000, 2000])])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalFilter(condition=[IS TRUE(CASE(=($5, 1000), IS NULL(CASE(=($5, 1000), null:INTEGER, 1)), IS NULL(CASE(=($5, 2000), null:INTEGER, 1))))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceNot">
    <Resource name="sql">
      <![CDATA[select *
from (select (case when sal > 1000 then null else false end) as caseCol from emp)
where NOT(caseCol)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(CASECOL=[$0])
  LogicalFilter(condition=[NOT($0)])
    LogicalProject(CASECOL=[AND(>($5, 1000), null)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceNullableCase">
    <Resource name="sql">
      <![CDATA[SELECT CASE WHEN 1=2 THEN cast((values(1)) as integer) ELSE 2 end from (values(1))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[CAST(2):INTEGER])
  LogicalJoin(condition=[true], joinType=[left])
    LogicalValues(tuples=[[{ 1 }]])
    LogicalValues(tuples=[[{ 1 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceNullableCase2">
    <Resource name="sql">
      <![CDATA[SELECT deptno, ename, CASE WHEN 1=2 THEN substring(ename, 1, cast(2 as int)) ELSE NULL end from emp group by deptno, ename, case when 1=2 then substring(ename,1, cast(2 as int))  else null end]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0, 1, 2}])
  LogicalProject(DEPTNO=[$7], ENAME=[$1], EXPR$2=[null:VARCHAR(20)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceNullableToNotNull">
    <Resource name="sql">
      <![CDATA[select
  empno + case when 'a' = 'a' then 1 else null end as newcol
from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(NEWCOL=[+($0, CASE(=('a', 'a'), 1, null:INTEGER))])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(NEWCOL=[+($0, 1)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceNullableToNotNull2">
    <Resource name="sql">
      <![CDATA[select
  empno + case when 'a' = 'a' then 1 else null end as newcol
from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(NEWCOL=[+($0, CASE(=('a', 'a'), 1, null:INTEGER))])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(NEWCOL=[+($0, 1)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceOrCaseWhen">
    <Resource name="sql">
      <![CDATA[select sal
from emp
where case when sal = 1000 then null else 1 end is null
OR case when sal = 2000 then null else 1 end is null]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalFilter(condition=[SEARCH($5, Sarg[1000, 2000])])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalFilter(condition=[OR(IS NULL(CASE(=($5, 1000), null:INTEGER, 1)), IS NULL(CASE(=($5, 2000), null:INTEGER, 1)))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceValuesToEmpty">
    <Resource name="sql">
      <![CDATA[select a + b as x, b, a from (values (10, 1), (30, 7)) as t(a, b)
where a - b < 0]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(X=[+($0, $1)], B=[$1], A=[$0])
  LogicalFilter(condition=[<(-($0, $1), 0)])
    LogicalValues(tuples=[[{ 10, 1 }, { 30, 7 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceValuesUnderFilter">
    <Resource name="sql">
      <![CDATA[select a, b from (values (10, 'x'), (20, 'y')) as t(a, b) where a < 15]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(A=[$0], B=[$1])
  LogicalFilter(condition=[<($0, 15)])
    LogicalValues(tuples=[[{ 10, 'x' }, { 20, 'y' }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(A=[$0], B=[$1])
  LogicalValues(tuples=[[{ 10, 'x' }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceValuesUnderProjectFilter">
    <Resource name="sql">
      <![CDATA[select a + b as x, b, a
from (values (10, 1), (30, 7), (20, 3)) as t(a, b)
where a - b < 21]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(X=[+($0, $1)], B=[$1], A=[$0])
  LogicalFilter(condition=[<(-($0, $1), 21)])
    LogicalValues(tuples=[[{ 10, 1 }, { 30, 7 }, { 20, 3 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[{ 11, 1, 10 }, { 23, 3, 20 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReduceWithNonTypePredicate">
    <Resource name="sql">
      <![CDATA[select avg(sal), avg(sal) within distinct (deptno)
from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], EXPR$1=[AVG($0) WITHIN DISTINCT ($1)])
  LogicalProject(SAL=[$5], DEPTNO=[$7])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$0], EXPR$1=[CAST(/($1, $2)):INTEGER])
  LogicalProject(EXPR$0=[$0], $f1=[CASE(=($2, 0), null:INTEGER, $1)], $f2=[$2])
    LogicalAggregate(group=[{}], EXPR$0=[AVG($0)], agg#1=[$SUM0($0) WITHIN DISTINCT ($1)], agg#2=[COUNT() WITHIN DISTINCT ($1)])
      LogicalProject(SAL=[$5], DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReducingConstantsInferredFromCorrelate">
    <Resource name="sql">
      <![CDATA[SELECT ename,
  empno,
  T.empno_r,
  CASE
    WHEN __source__type__ = 'bounded'
      THEN 1
    ELSE 2
    END AS type
FROM (
  SELECT ename,
    empno,
    'bounded' AS __source__type__
  FROM emp
  ) a,
  lateral TABLE (ramp(empno)) AS T(empno_r)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0], EMPNO=[$1], EMPNO_R=[$3], TYPE=[CASE(=($2, 'bounded'), 1, 2)])
  LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
    LogicalProject(ENAME=[$1], EMPNO=[$0], __SOURCE__TYPE__=['bounded'])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableFunctionScan(invocation=[RAMP($cor0.EMPNO)], rowType=[RecordType(INTEGER I)])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$0], EMPNO=[$1], EMPNO_R=[$3], TYPE=[1])
  LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1}])
    LogicalProject(ENAME=[$1], EMPNO=[$0], __SOURCE__TYPE__=['bounded'])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableFunctionScan(invocation=[RAMP($cor0.EMPNO)], rowType=[RecordType(INTEGER I)])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRelFnWithVolcanoPlanner">
    <Resource name="planBefore">
      <![CDATA[
LogicalFilter(condition=[>($5, 2000)])
  LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableFilter(condition=[>($5, 2000)])
  EnumerableTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRemoveDistinctOnAgg">
    <Resource name="sql">
      <![CDATA[SELECT empno, SUM(distinct sal), MIN(sal), MIN(distinct sal), MAX(distinct sal), bit_and(distinct sal), bit_or(sal), count(distinct sal) from sales.emp group by empno, deptno
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[$2], EXPR$2=[$3], EXPR$3=[$3], EXPR$4=[$4], EXPR$5=[$5], EXPR$6=[$6], EXPR$7=[$7])
  LogicalAggregate(group=[{0, 1}], EXPR$1=[SUM(DISTINCT $2)], EXPR$2=[MIN($2)], EXPR$4=[MAX($2)], EXPR$5=[BIT_AND($2)], EXPR$6=[BIT_OR($2)], EXPR$7=[COUNT(DISTINCT $2)])
    LogicalProject(EMPNO=[$0], DEPTNO=[$7], SAL=[$5])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[$5], EXPR$2=[$5], EXPR$3=[$5], EXPR$4=[$5], EXPR$5=[$5], EXPR$6=[$5], EXPR$7=[1:BIGINT])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRepeat">
    <Resource name="sql">
      <![CDATA[select REPEAT('abc', 2)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[REPEAT('abc', 2)])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=['abcabc':VARCHAR])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testReplace">
    <Resource name="sql">
      <![CDATA[select REPLACE('abc', 'c', 'cd')]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[REPLACE('abc', 'c', 'cd')])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=['abcd':VARCHAR])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRightEmptyAntiJoin">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[=($7, $8)], joinType=[anti])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRightEmptyAntiJoinNonEqui">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(=($7, $8), =($5, 2000))], joinType=[anti])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRightEmptyFullJoin">
    <Resource name="sql">
      <![CDATA[select * from emp e
full join (select * from dept where false) as d
on e.deptno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[=($7, $9)], joinType=[full])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], DNAME=[$1])
      LogicalFilter(condition=[false])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalProject(EMPNO=[CAST($0):INTEGER], ENAME=[CAST($1):VARCHAR(20)], JOB=[CAST($2):VARCHAR(10)], MGR=[$3], HIREDATE=[CAST($4):TIMESTAMP(0)], SAL=[CAST($5):INTEGER], COMM=[CAST($6):INTEGER], DEPTNO=[CAST($7):INTEGER], SLACKER=[CAST($8):BOOLEAN], DEPTNO0=[null:INTEGER], DNAME=[null:VARCHAR(10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRightEmptyInnerJoin">
    <Resource name="sql">
      <![CDATA[select * from emp e
join (select * from dept where false) as d
on e.deptno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[=($7, $9)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], DNAME=[$1])
      LogicalFilter(condition=[false])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRightEmptyLeftJoin">
    <Resource name="sql">
      <![CDATA[select * from emp e
left join (select * from dept where false) as d
on e.deptno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[=($7, $9)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], DNAME=[$1])
      LogicalFilter(condition=[false])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[null:INTEGER], DNAME=[null:VARCHAR(10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRightEmptyRightJoin">
    <Resource name="sql">
      <![CDATA[select * from emp e
right join (select * from dept where false) as d
on e.deptno = d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalJoin(condition=[=($7, $9)], joinType=[right])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], DNAME=[$1])
      LogicalFilter(condition=[false])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRightEmptySemiJoin">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[=($7, $8)], joinType=[semi])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRightJoinRemoveConditionIsAlwaysFalse">
    <Resource name="sql">
      <![CDATA[SELECT e.deptno
FROM sales.dept d
RIGHT JOIN sales.emp e ON e.deptno = d.deptno and e.deptno between 3 and 1]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$9])
  LogicalJoin(condition=[false], joinType=[right])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$9])
  LogicalProject(DEPTNO=[null:INTEGER], DNAME=[null:VARCHAR(10)], EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO0=[$7], SLACKER=[$8])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRightJoinWithConstantRowOnLeft">
    <Resource name="sql">
      <![CDATA[select e.empno, e.ename, c.* from (select 5 as nm) c right join emp e on e.empno = c.nm]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$1], ENAME=[$2], NM=[$0])
  LogicalJoin(condition=[=($1, $0)], joinType=[right])
    LogicalValues(tuples=[[{ 5 }]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$1], ENAME=[$2], NM=[$0])
  LogicalProject($f0=[CASE(=($0, 5), 5, null:INTEGER)], EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRightJoinWithTimeStampSingleRowOnLeft">
    <Resource name="sql">
      <![CDATA[select e.empno, e.ename, c.t from (select 7934 as ono, current_timestamp as t) c right join emp e   on e.empno = c.ono]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$2], ENAME=[$3], T=[$1])
  LogicalJoin(condition=[=($2, $0)], joinType=[right])
    LogicalProject(ONO=[7934], T=[CURRENT_TIMESTAMP])
      LogicalValues(tuples=[[{ 0 }]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$2], ENAME=[$3], T=[$1])
  LogicalProject($f0=[CASE(=($0, 7934), 7934, null:INTEGER)], $f1=[CASE(=($0, 7934), CURRENT_TIMESTAMP, null:TIMESTAMP(0))], EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testRpad">
    <Resource name="sql">
      <![CDATA[select RPAD('abc', 8, 'A')]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[RPAD('abc', 8, 'A')])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=['abcAAAAA':VARCHAR])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSelectAnyCorrelated">
    <Resource name="sql">
      <![CDATA[select empno > ANY (
  select deptno from dept where emp.job = dept.dname)
from emp
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], EXPR$0=[> SOME($0, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($cor0.JOB, $1)])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EXPR$0=[CAST(OR(AND(IS TRUE(>($0, $9)), IS NOT TRUE(OR(IS NULL($12), =($10, 0)))), AND(IS TRUE(>($10, $11)), null, IS NOT TRUE(OR(IS NULL($12), =($10, 0))), IS NOT TRUE(>($0, $9))), AND(>($0, $9), IS NOT TRUE(OR(IS NULL($12), =($10, 0))), IS NOT TRUE(>($0, $9)), IS NOT TRUE(>($10, $11))))):BOOLEAN NOT NULL])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{2}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(m=[$0], c=[$1], d=[$1], trueLiteral=[$2])
      LogicalAggregate(group=[{}], m=[MIN($0)], c=[COUNT()], trueLiteral=[LITERAL_AGG(true)])
        LogicalProject(DEPTNO=[$0])
          LogicalFilter(condition=[=($cor0.JOB, $1)])
            LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[CAST(OR(AND(IS TRUE(>($0, $9)), IS NOT TRUE(OR(IS NULL($12), =($10, 0)))), AND(IS TRUE(>($10, $11)), null, IS NOT TRUE(OR(IS NULL($12), =($10, 0))), IS NOT TRUE(>($0, $9))), AND(>($0, $9), IS NOT TRUE(OR(IS NULL($12), =($10, 0))), IS NOT TRUE(>($0, $9)), IS NOT TRUE(>($10, $11))))):BOOLEAN NOT NULL])
  LogicalJoin(condition=[=($2, $13)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(m=[$2], c=[CASE(IS NOT NULL($3), $3, 0)], d=[CASE(IS NOT NULL($3), $3, 0)], trueLiteral=[$4], DNAME=[$0])
      LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $1)], joinType=[left])
        LogicalAggregate(group=[{0}])
          LogicalProject(JOB=[$2])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{0}], m=[MIN($1)], c=[COUNT()], trueLiteral=[LITERAL_AGG(true)])
          LogicalProject(DNAME=[$1], DEPTNO=[$0])
            LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSelectNotInCorrelated">
    <Resource name="sql">
      <![CDATA[select sal,
 empno NOT IN (
 select deptno from dept
   where emp.job=dept.dname)
 from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], SAL=[$5], EXPR$1=[NOT(IN($0, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($cor0.JOB, $1)])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
}))])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(SAL=[$5], EXPR$1=[IS NULL($10)])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 2}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalFilter(condition=[=($cor0.EMPNO, $0)])
      LogicalProject(DEPTNO=[$0], i=[true])
        LogicalFilter(condition=[=($cor0.JOB, $1)])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(SAL=[$5], EXPR$1=[IS NULL($10)])
  LogicalJoin(condition=[AND(=($0, $9), =($2, $11))], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], i=[true], DNAME=[$1])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiCorrelateWithLeftEmpty">
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[semi], requiredColumns=[{7}])
  LogicalValues(tuples=[[]])
  LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiCorrelateWithRightEmpty">
    <Resource name="planBefore">
      <![CDATA[
LogicalCorrelate(correlation=[$cor0], joinType=[semi], requiredColumns=[{7}])
  LogicalTableScan(table=[[scott, EMP]])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinForDphyp">
    <Resource name="sql">
      <![CDATA[select emp.empno from emp, emp_address, salgrade where emp_address.empno = emp.empno and emp.sal = salgrade.hisal and exists(select * from emp_b where emp_address.empno = emp_b.empno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  HyperGraph(edges=[{1}——[SEMI, =(node(1)_field(0), node(3)_field(0))]——{3},{0}——[INNER, =(node(0)_field(5), node(2)_field(2))]——{2},{0}——[INNER, =(node(1)_field(0), node(0)_field(0))]——{1}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EMPNO=[$0], STREET=[$1.STREET], CITY=[$1.CITY], ZIP=[$1.ZIP], STATE=[$1.STATE], STREET5=[$2.STREET], CITY6=[$2.CITY], ZIP7=[$2.ZIP], STATE8=[$2.STATE])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
    LogicalTableScan(table=[[CATALOG, SALES, SALGRADE]])
    LogicalProject(EMPNO=[$0], $f0=[true])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$12])
  LogicalJoin(condition=[=($0, $12)], joinType=[inner])
    LogicalJoin(condition=[=($0, $9)], joinType=[semi])
      LogicalProject(EMPNO=[$0], STREET=[$1.STREET], CITY=[$1.CITY], ZIP=[$1.ZIP], STATE=[$1.STATE], STREET5=[$2.STREET], CITY6=[$2.CITY], ZIP7=[$2.ZIP], STATE8=[$2.STATE])
        LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
      LogicalProject(EMPNO=[$0], $f0=[true])
        LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
    LogicalJoin(condition=[=($8, $2)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, SALGRADE]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinProjectTranspose">
    <Resource name="sql">
      <![CDATA[select a.dname from dept a
where a.deptno in (select b.deptno * 2 from dept);
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[=($0, $3)], joinType=[semi])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalProject($f0=[*(2, $0)])
        LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[=($0, $2)], joinType=[semi])
    LogicalProject(DEPTNO=[$0], DNAME=[$1])
      LogicalTableScan(table=[[scott, DEPT]])
    LogicalProject($f0=[$0])
      LogicalAggregate(group=[{0}])
        LogicalProject($f0=[*(2, $0)])
          LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinReduceConstants">
    <Resource name="sql">
      <![CDATA[select e1.sal
from (select * from emp where deptno = 200) as e1
where e1.deptno in (
  select e2.deptno from emp e2 where e2.sal = 100)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(SAL=[$0])
  LogicalJoin(condition=[=($1, $2)], joinType=[semi])
    LogicalFilter(condition=[=($1, 200)])
      LogicalProject(SAL=[$5], DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$1])
      LogicalFilter(condition=[=($0, 100)])
        LogicalProject(SAL=[$5], DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(SAL=[$0])
  LogicalJoin(condition=[=(200, $2)], joinType=[semi])
    LogicalFilter(condition=[=($1, 200)])
      LogicalProject(SAL=[$5], DEPTNO=[$7])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$1])
      LogicalFilter(condition=[=($0, 100)])
        LogicalProject(SAL=[$5], DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinRule">
    <Resource name="sql">
      <![CDATA[select dept.* from dept join (
  select distinct deptno from emp
  where sal > 100) using (deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalProject(DEPTNO=[$7])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalJoin(condition=[=($0, $2)], joinType=[semi])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
  LogicalProject(DEPTNO=[$7])
    LogicalFilter(condition=[>($5, 100)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinRuleDoNotMatchAggregate">
    <Resource name="sql">
      <![CDATA[select *
from emp
where exists(select * from dept where emp.deptno = dept.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalJoin(condition=[=($7, $9)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0}], agg#0=[MIN($1)])
      LogicalProject(DEPTNO=[$0], $f0=[true])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinRuleExists">
    <Resource name="sql">
      <![CDATA[select * from dept where exists (
  select * from emp
  where emp.deptno = dept.deptno
  and emp.sal > 100)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalProject(DEPTNO=[$7])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalJoin(condition=[=($0, $2)], joinType=[semi])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
  LogicalProject(DEPTNO=[$7])
    LogicalFilter(condition=[>($5, 100)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinRuleFull">
    <Resource name="sql">
      <![CDATA[select dept.* from dept full join (
  select distinct deptno from emp
  where sal > 100) using (deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalJoin(condition=[=($0, $2)], joinType=[full])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalProject(DEPTNO=[$7])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinRuleLeft">
    <Resource name="sql">
      <![CDATA[select dname from dept left join (
  select distinct deptno from emp
  where sal > 100) using (deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[=($0, $2)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalProject(DEPTNO=[$7])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinRuleRight">
    <Resource name="sql">
      <![CDATA[select dept.* from dept right join (
  select distinct deptno from emp
  where sal > 100) using (deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalJoin(condition=[=($0, $2)], joinType=[right])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalProject(DEPTNO=[$7])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinRuleWithHint">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[=($0, $3)], joinType=[inner])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalProject(DEPTNO=[$7])
        LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1])
  LogicalJoin(condition=[=($0, $3)], joinType=[semi])
    LogicalTableScan(table=[[scott, DEPT]])
    LogicalProject(DEPTNO=[$7])
      LogicalTableScan(table=[[scott, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinRuleWithJoinOnUniqueInput">
    <Resource name="sql">
      <![CDATA[select *
from emp
where exists(select * from dept where emp.deptno = dept.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalJoin(condition=[=($7, $9)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalJoin(condition=[=($7, $9)], joinType=[semi])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
  LogicalProject(DEPTNO=[$0])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinRuleWithJoinOnUniqueInputWithAlias">
    <Resource name="sql">
      <![CDATA[select emp.deptno as department_id, emp.sal as salary
from emp
where exists(select * from dept where emp.deptno = dept.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPARTMENT_ID=[$1], SALARY=[$0])
  LogicalJoin(condition=[=($1, $2)], joinType=[inner])
    LogicalProject(SAL=[$5], DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPARTMENT_ID=[$1], SALARY=[$0])
  LogicalJoin(condition=[=($1, $2)], joinType=[semi])
    LogicalProject(SAL=[$5], DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSemiJoinTrim">
    <Resource name="sql">
      <![CDATA[select s.deptno
from (select *
  from dept
  where exists (
    select * from emp
    where emp.deptno = dept.deptno
    and emp.sal > 100)) s
join customer.account on s.deptno = account.acctno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
    LogicalJoin(condition=[=($0, $2)], joinType=[semi])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalProject(DEPTNO=[$7], $f0=[true])
        LogicalFilter(condition=[>($5, 100)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0])
  LogicalJoin(condition=[=($0, $1)], joinType=[inner])
    LogicalJoin(condition=[=($0, $1)], joinType=[semi])
      LogicalProject(DEPTNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalProject(DEPTNO=[$1])
        LogicalFilter(condition=[>($0, 100)])
          LogicalProject(SAL=[$5], DEPTNO=[$7])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(ACCTNO=[$0])
      LogicalTableScan(table=[[CATALOG, CUSTOMER, ACCOUNT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSimplifyFilter">
    <Resource name="sql">
      <![CDATA[select * from (select * from sales.emp where deptno > 10)
where empno > 3 and deptno > 5]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[AND(>($0, 3), >($7, 5))])
      LogicalFilter(condition=[>($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[>($0, 3)])
      LogicalFilter(condition=[>($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSimplifyItemIsNotNull">
    <Resource name="sql">
      <![CDATA[select *
from sales.customer as t1
where t1.c_nationkey[0] is not null]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(**=[$1])
  LogicalFilter(condition=[IS NOT NULL(ITEM($0, 0))])
    LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSimplifyItemIsNull">
    <Resource name="sql">
      <![CDATA[select * from sales.customer as t1 where t1.c_nationkey[0] is null]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(**=[$1])
  LogicalFilter(condition=[IS NULL(ITEM($0, 0))])
    LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSkipReduceConstantsCaseEquals">
    <Resource name="sql">
      <![CDATA[select * from emp e1, emp e2
where coalesce(e1.mgr, -1) = coalesce(e2.mgr, -1)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], EMPNO0=[$9], ENAME0=[$10], JOB0=[$11], MGR0=[$12], HIREDATE0=[$13], SAL0=[$14], COMM0=[$15], DEPTNO0=[$16], SLACKER0=[$17])
  LogicalFilter(condition=[=(CASE(IS NOT NULL($3), CAST($3):INTEGER NOT NULL, -1), CASE(IS NOT NULL($12), CAST($12):INTEGER NOT NULL, -1))])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], EMPNO0=[$9], ENAME0=[$10], JOB0=[$11], MGR0=[$12], HIREDATE0=[$13], SAL0=[$14], COMM0=[$15], DEPTNO0=[$16], SLACKER0=[$17])
  LogicalJoin(condition=[=(CASE(IS NOT NULL($3), CAST($3):INTEGER NOT NULL, -1), CASE(IS NOT NULL($12), CAST($12):INTEGER NOT NULL, -1))], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSome">
    <Resource name="sql">
      <![CDATA[select * from emp e1
  where e1.empno > SOME (select deptno from dept)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[> SOME($0, {
LogicalProject(DEPTNO=[$0])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[OR(AND(IS TRUE(>($0, $9)), <>($10, 0)), AND(>($10, $11), null, <>($10, 0), IS NOT TRUE(>($0, $9))), AND(>($0, $9), <>($10, 0), IS NOT TRUE(>($0, $9)), <=($10, $11)))])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(m=[$0], c=[$1], d=[$1])
          LogicalAggregate(group=[{}], m=[MIN($0)], c=[COUNT()])
            LogicalProject(DEPTNO=[$0])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[OR(AND(IS TRUE(>($0, $9)), <>($10, 0)), AND(>($10, $11), null, <>($10, 0), IS NOT TRUE(>($0, $9))), AND(>($0, $9), <>($10, 0), IS NOT TRUE(>($0, $9)), <=($10, $11)))])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(m=[$0], c=[$1], d=[$1])
          LogicalAggregate(group=[{}], m=[MIN($0)], c=[COUNT()])
            LogicalProject(DEPTNO=[$0])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSomeWithEquality">
    <Resource name="sql">
      <![CDATA[select * from emp e1
  where e1.deptno = SOME (select deptno from dept)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IN($7, {
LogicalProject(DEPTNO=[$0])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalJoin(condition=[=($7, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(DEPTNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalJoin(condition=[=($7, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(DEPTNO=[$0])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSomeWithEquality2">
    <Resource name="sql">
      <![CDATA[select * from emp e1
  where e1.ename= SOME (select dname from dept)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IN($1, {
LogicalProject(DNAME=[$1])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalJoin(condition=[=($1, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{0}])
        LogicalProject(DNAME=[$1])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalJoin(condition=[=($1, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{0}])
        LogicalProject(DNAME=[$1])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSomeWithGreaterThanNoRowSubQuery">
    <Resource name="sql">
      <![CDATA[select * from dept as d
where deptno > some(
  select deptno from emp e where false)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalFilter(condition=[> SOME($0, {
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[false])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSomeWithLessThanOrEqualNoRowSubQuery">
    <Resource name="sql">
      <![CDATA[select * from dept as d
where deptno <= some(
  select deptno from emp e where false)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalFilter(condition=[<= SOME($0, {
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[false])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSomeWithNotEquality">
    <Resource name="sql">
      <![CDATA[select * from emp e1
  where e1.deptno <> SOME (select deptno from dept)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[<> SOME($7, {
LogicalProject(DEPTNO=[$0])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[OR(AND(<>($10, $9), <=($10, 1), OR(<>($7, $11), null), <>($9, 0)), AND(=($10, 1), <>($7, $11), <>($9, 0), OR(=($10, $9), >($10, 1))), AND(<>($9, 0), OR(=($10, $9), >($10, 1)), <>($10, 1)))])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(c=[$0], d=[$0], m=[$1])
          LogicalAggregate(group=[{}], c=[COUNT()], m=[MAX($0)])
            LogicalProject(DEPTNO=[$0])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[OR(AND(<>($10, $9), <=($10, 1), OR(<>($7, $11), null), <>($9, 0)), AND(=($10, 1), <>($7, $11), <>($9, 0), OR(=($10, $9), >($10, 1))), AND(<>($9, 0), OR(=($10, $9), >($10, 1)), <>($10, 1)))])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(c=[$0], d=[$0], m=[$1])
          LogicalAggregate(group=[{}], c=[COUNT()], m=[MAX($0)])
            LogicalProject(DEPTNO=[$0])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSomeWithTwoCorrelatedSubQueries">
    <Resource name="sql">
      <![CDATA[select empno from sales.empnullables as e
where deptno > some(
  select deptno from sales.deptnullables where e.ename = dname and deptno > 10)
or deptno < some(
  select deptno from sales.deptnullables where e.ename = dname and deptno < 20)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[OR(> SOME($2, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), >($0, 10))])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}), < SOME($2, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), <($0, 20))])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}))], variablesSet=[[$cor0]])
    LogicalProject(EMPNO=[$0], ENAME=[$1], DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], DEPTNO=[$2])
    LogicalFilter(condition=[OR(AND(>($2, $3), IS NOT TRUE(OR(IS NULL($6), =($4, 0)))), AND(>($2, $3), IS NOT TRUE(OR(IS NULL($6), =($4, 0))), IS NOT TRUE(>($2, $3)), IS NOT TRUE(>($4, $5))), AND(<($2, $7), IS NOT TRUE(OR(IS NULL($10), =($8, 0)))), AND(<($2, $7), IS NOT TRUE(OR(IS NULL($10), =($8, 0))), IS NOT TRUE(<($2, $7)), IS NOT TRUE(>($8, $9))))])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1}])
        LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1}])
          LogicalProject(EMPNO=[$0], ENAME=[$1], DEPTNO=[$7])
            LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
          LogicalProject(m=[$0], c=[$1], d=[$2], trueLiteral=[true])
            LogicalAggregate(group=[{}], m=[MIN($0)], c=[COUNT()], d=[COUNT($0)])
              LogicalProject(DEPTNO=[$0])
                LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), >($0, 10))])
                  LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
        LogicalProject(m=[$0], c=[$1], d=[$2], trueLiteral=[true])
          LogicalAggregate(group=[{}], m=[MAX($0)], c=[COUNT()], d=[COUNT($0)])
            LogicalProject(DEPTNO=[$0])
              LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), <($0, 20))])
                LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], DEPTNO=[$2])
    LogicalFilter(condition=[OR(CASE(IS NULL($6), false, =($4, 0), false, IS TRUE(>($2, $3)), true, >($4, $5), null:BOOLEAN, >($2, $3)), CASE(IS NULL($10), false, =($8, 0), false, IS TRUE(<($2, $7)), true, >($8, $9), null:BOOLEAN, <($2, $7)))])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1}])
        LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1}])
          LogicalProject(EMPNO=[$0], ENAME=[$1], DEPTNO=[$7])
            LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
          LogicalAggregate(group=[{}], m=[MIN($0)], c=[COUNT()], d=[COUNT($0)], trueLiteral=[LITERAL_AGG(true)])
            LogicalProject(DEPTNO=[$0])
              LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), >($0, 10))])
                LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
        LogicalAggregate(group=[{}], m=[MAX($0)], c=[COUNT()], d=[COUNT($0)], trueLiteral=[LITERAL_AGG(true)])
          LogicalProject(DEPTNO=[$0])
            LogicalFilter(condition=[AND(=($cor0.ENAME, CAST($1):VARCHAR(20)), <($0, 20))])
              LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSomeWithTwoSubQueries">
    <Resource name="sql">
      <![CDATA[select empno from sales.empnullables
where deptno > some(
  select deptno from sales.deptnullables where dname = 'dept1')
or deptno < some(
  select deptno from sales.deptnullables where dname = 'dept2')]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[OR(> SOME($1, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($1, 'dept1')])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}), < SOME($1, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($1, 'dept2')])
    LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
}))])
    LogicalProject(EMPNO=[$0], DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], DEPTNO=[$1])
    LogicalFilter(condition=[OR(AND(>($1, $2), <>($3, 0)), AND(>($1, $2), <>($3, 0), IS NOT TRUE(>($1, $2)), <=($3, $4)), AND(<($1, $5), <>($6, 0)), AND(<($1, $5), <>($6, 0), IS NOT TRUE(<($1, $5)), <=($6, $7)))])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalJoin(condition=[true], joinType=[inner])
          LogicalProject(EMPNO=[$0], DEPTNO=[$7])
            LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
          LogicalAggregate(group=[{}], m=[MIN($0)], c=[COUNT()], d=[COUNT($0)])
            LogicalProject(DEPTNO=[$0])
              LogicalFilter(condition=[=($1, 'dept1')])
                LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
        LogicalAggregate(group=[{}], m=[MAX($0)], c=[COUNT()], d=[COUNT($0)])
          LogicalProject(DEPTNO=[$0])
            LogicalFilter(condition=[=($1, 'dept2')])
              LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], DEPTNO=[$1])
    LogicalFilter(condition=[OR(CASE(=($3, 0), false, IS TRUE(>($1, $2)), true, >($3, $4), null:BOOLEAN, >($1, $2)), CASE(=($6, 0), false, IS TRUE(<($1, $5)), true, >($6, $7), null:BOOLEAN, <($1, $5)))])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalJoin(condition=[true], joinType=[inner])
          LogicalProject(EMPNO=[$0], DEPTNO=[$7])
            LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
          LogicalAggregate(group=[{}], m=[MIN($0)], c=[COUNT()], d=[COUNT($0)])
            LogicalProject(DEPTNO=[$0])
              LogicalFilter(condition=[=($1, 'dept1')])
                LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
        LogicalAggregate(group=[{}], m=[MAX($0)], c=[COUNT()], d=[COUNT($0)])
          LogicalProject(DEPTNO=[$0])
            LogicalFilter(condition=[=($1, 'dept2')])
              LogicalTableScan(table=[[CATALOG, SALES, DEPTNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortJoinCopySemiJoinOrderBy">
    <Resource name="sql">
      <![CDATA[select * from sales.dept d where d.deptno in
 (select e.deptno from sales.emp e) order by d.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC])
  LogicalJoin(condition=[=($0, $2)], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC])
  LogicalJoin(condition=[=($0, $2)], joinType=[semi])
    LogicalSort(sort0=[$0], dir0=[ASC])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortJoinCopySemiJoinOrderByLimitOffset">
    <Resource name="sql">
      <![CDATA[select * from sales.dept d where d.deptno in
 (select e.deptno from sales.emp e) order by d.deptno limit 10 offset 2]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC], offset=[2], fetch=[10])
  LogicalJoin(condition=[=($0, $2)], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC], offset=[2], fetch=[10])
  LogicalJoin(condition=[=($0, $2)], joinType=[semi])
    LogicalSort(sort0=[$0], dir0=[ASC])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortJoinCopySemiJoinOrderByOffset">
    <Resource name="sql">
      <![CDATA[select * from sales.dept d where d.deptno in (select e.deptno from sales.emp e) order by d.deptno offset 2]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC], offset=[2])
  LogicalJoin(condition=[=($0, $2)], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC], offset=[2])
  LogicalJoin(condition=[=($0, $2)], joinType=[semi])
    LogicalSort(sort0=[$0], dir0=[ASC])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$7])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortJoinTranspose4">
    <Resource name="sql">
      <![CDATA[select * from sales.emp e right join (
  select * from sales.dept d) d on e.deptno = d.deptno
order by dname]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalSort(sort0=[$10], dir0=[ASC])
    LogicalJoin(condition=[=($7, $9)], joinType=[right])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(DEPTNO=[$0], DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
  LogicalSort(sort0=[$10], dir0=[ASC])
    LogicalJoin(condition=[=($7, $9)], joinType=[right])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalSort(sort0=[$1], dir0=[ASC])
        LogicalProject(DEPTNO=[$0], DNAME=[$1])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortRemovalOneKeyConstant">
    <Resource name="sql">
      <![CDATA[select count(*) as c
from sales.emp
where deptno = 10
group by deptno, sal
order by deptno, sal desc nulls first]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(C=[$0])
  LogicalSort(sort0=[$1], sort1=[$2], dir0=[ASC], dir1=[DESC])
    LogicalProject(C=[$2], DEPTNO=[$0], SAL=[$1])
      LogicalAggregate(group=[{0, 1}], C=[COUNT()])
        LogicalProject(DEPTNO=[$7], SAL=[$5])
          LogicalFilter(condition=[=($7, 10)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(C=[$0])
  LogicalSort(sort0=[$2], dir0=[DESC])
    LogicalProject(C=[$2], DEPTNO=[$0], SAL=[$1])
      LogicalAggregate(group=[{0, 1}], C=[COUNT()])
        LogicalProject(DEPTNO=[$7], SAL=[$5])
          LogicalFilter(condition=[=($7, 10)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortRemoveConstantKeyDoesNotRemoveOrderByRandom">
    <Resource name="sql">
      <![CDATA[SELECT ename FROM emp ORDER BY RANDOM()]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0])
  LogicalSort(sort0=[$1], dir0=[ASC])
    LogicalProject(ENAME=[$1], EXPR$1=[RANDOM()])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortUnionTranspose">
    <Resource name="sql">
      <![CDATA[select a.dname from dept a
union all
select b.dname from dept b
order by dname limit 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC], fetch=[10])
  LogicalProject(DNAME=[$0])
    LogicalUnion(all=[true])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC], fetch=[10])
  LogicalUnion(all=[true])
    LogicalSort(sort0=[$0], dir0=[ASC], fetch=[10])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalSort(sort0=[$0], dir0=[ASC], fetch=[10])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortUnionTranspose2">
    <Resource name="sql">
      <![CDATA[select a.dname from dept a
union all
select b.dname from dept b
order by dname]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC])
  LogicalProject(DNAME=[$0])
    LogicalUnion(all=[true])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC])
  LogicalUnion(all=[true])
    LogicalSort(sort0=[$0], dir0=[ASC])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalSort(sort0=[$0], dir0=[ASC])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortUnionTranspose3">
    <Resource name="sql">
      <![CDATA[select a.dname from dept a
union all
select b.dname from dept b
order by dname limit 0]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC], fetch=[0])
  LogicalProject(DNAME=[$0])
    LogicalUnion(all=[true])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalSort(sort0=[$0], dir0=[ASC], fetch=[0])
  LogicalUnion(all=[true])
    LogicalSort(sort0=[$0], dir0=[ASC], fetch=[0])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalSort(sort0=[$0], dir0=[ASC], fetch=[0])
      LogicalProject(DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSortWithDynamicParam">
    <Resource name="sql">
      <![CDATA[SELECT x.sal
FROM (SELECT emp1.sal
      FROM (SELECT sal
            from emp
            LIMIT ?) AS emp1
      UNION ALL
      SELECT emp2.sal
      FROM (SELECT sal
            from emp
            LIMIT ?) AS emp2) AS x
LIMIT ?]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalSort(fetch=[?2])
  LogicalProject(SAL=[$0])
    LogicalUnion(all=[true])
      LogicalProject(SAL=[$0])
        LogicalSort(fetch=[?0])
          LogicalProject(SAL=[$5])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(SAL=[$0])
        LogicalSort(fetch=[?1])
          LogicalProject(SAL=[$5])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(SAL=[$0])
  LogicalSort(fetch=[?2])
    LogicalUnion(all=[true])
      LogicalProject(SAL=[$0])
        LogicalProject(SAL=[$5])
          LogicalSort(fetch=[?0])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(SAL=[$0])
        LogicalProject(SAL=[$5])
          LogicalSort(fetch=[?1])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSpace">
    <Resource name="sql">
      <![CDATA[select SPACE(2001)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[SPACE(2001)])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=['                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ':VARCHAR])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSpatialContainsPoint">
    <Resource name="sql">
      <![CDATA[select *
from GEO.Restaurants as r
where ST_Contains(
  ST_Buffer(ST_Point(10.0, 20.0), 6),
  ST_Point(r.longitude, r.latitude))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(NAME=[$0], LATITUDE=[$1], LONGITUDE=[$2], CUISINE=[$3], HILBERT=[$4])
  LogicalFilter(condition=[ST_CONTAINS(ST_BUFFER(ST_POINT(10.0:DECIMAL(3, 1), 20.0:DECIMAL(3, 1)), 6), ST_POINT($2, $1))])
    LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(NAME=[$0], LATITUDE=[$1], LONGITUDE=[$2], CUISINE=[$3], HILBERT=[$4])
  LogicalFilter(condition=[AND(SEARCH($4, Sarg[[33033..33035], [33050..33053], [33055..33080], [33092..33100], [33112..33156], [33164..33176], [33236..33244], [33252..33254], [36456..36464], [36496..36520]]), ST_CONTAINS(POLYGON ((16 20, 15.884711682419383 18.829458067903232, 15.54327719506772 17.703899405809462, 14.988817673815271 16.666578601882385, 14.242640687119286 15.757359312880716, 13.333421398117615 15.011182326184729, 12.29610059419054 14.45672280493228, 11.17054193209677 14.115288317580617, 10 14, 8.82945806790323 14.115288317580617, 7.703899405809461 14.45672280493228, 6.666578601882389 15.011182326184727, 5.757359312880715 15.757359312880714, 5.011182326184728 16.666578601882385, 4.45672280493228 17.70389940580946, 4.115288317580617 18.82945806790323, 4 20, 4.115288317580617 21.17054193209677, 4.45672280493228 22.296100594190538, 5.011182326184727 23.33342139811761, 5.757359312880714 24.242640687119284, 6.666578601882387 24.98881767381527, 7.703899405809458 25.54327719506772, 8.829458067903229 25.884711682419383, 9.999999999999998 26, 11.17054193209677 25.884711682419383, 12.29610059419054 25.54327719506772, 13.333421398117611 24.988817673815273, 14.242640687119284 24.242640687119284, 14.988817673815271 23.333421398117615, 15.54327719506772 22.29610059419054, 15.884711682419383 21.17054193209677, 16 20)):GEOMETRY, ST_POINT($2, $1)))])
    LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSpatialDWithinLine">
    <Resource name="sql">
      <![CDATA[select *
from GEO.Restaurants as r
where ST_DWithin(
  ST_MakeLine(ST_Point(8.0, 20.0), ST_Point(12.0, 20.0)),
  ST_Point(r.longitude, r.latitude), 4)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(NAME=[$0], LATITUDE=[$1], LONGITUDE=[$2], CUISINE=[$3], HILBERT=[$4])
  LogicalFilter(condition=[ST_DWITHIN(ST_MAKELINE(ST_POINT(8.0:DECIMAL(2, 1), 20.0:DECIMAL(3, 1)), ST_POINT(12.0:DECIMAL(3, 1), 20.0:DECIMAL(3, 1))), ST_POINT($2, $1), 4)])
    LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(NAME=[$0], LATITUDE=[$1], LONGITUDE=[$2], CUISINE=[$3], HILBERT=[$4])
  LogicalFilter(condition=[AND(SEARCH($4, Sarg[[33064..33076], [33092..33100], [33112..33156], [33164..33176], [33236..33240], [36457..36459], [36501..36503], [36505..36507], [36517..36519]]), ST_DWITHIN(LINESTRING (8 20, 12 20):GEOMETRY, ST_POINT($2, $1), 4))])
    LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSpatialDWithinReversed">
    <Resource name="sql">
      <![CDATA[select *
from GEO.Restaurants as r
where ST_DWithin(ST_Point(r.longitude, r.latitude),
                 ST_Point(10.0, 20.0), 6)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(NAME=[$0], LATITUDE=[$1], LONGITUDE=[$2], CUISINE=[$3], HILBERT=[$4])
  LogicalFilter(condition=[ST_DWITHIN(ST_POINT($2, $1), ST_POINT(10.0:DECIMAL(3, 1), 20.0:DECIMAL(3, 1)), 6)])
    LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(NAME=[$0], LATITUDE=[$1], LONGITUDE=[$2], CUISINE=[$3], HILBERT=[$4])
  LogicalFilter(condition=[AND(SEARCH($4, Sarg[[33033..33035], [33050..33053], [33055..33080], [33092..33100], [33112..33156], [33164..33176], [33236..33244], [33252..33254], [36456..36464], [36496..36520]]), ST_DWITHIN(ST_POINT($2, $1), POINT (10 20):GEOMETRY, 6))])
    LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSpatialDWithinToHilbert">
    <Resource name="sql">
      <![CDATA[select *
from GEO.Restaurants as r
where ST_DWithin(ST_Point(10.0, 20.0),
                 ST_Point(r.longitude, r.latitude), 10)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(NAME=[$0], LATITUDE=[$1], LONGITUDE=[$2], CUISINE=[$3], HILBERT=[$4])
  LogicalFilter(condition=[ST_DWITHIN(ST_POINT(10.0:DECIMAL(3, 1), 20.0:DECIMAL(3, 1)), ST_POINT($2, $1), 10)])
    LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(NAME=[$0], LATITUDE=[$1], LONGITUDE=[$2], CUISINE=[$3], HILBERT=[$4])
  LogicalFilter(condition=[AND(SEARCH($4, Sarg[[28988..28989], [28991..28994], [29006..29009], [29011..29014], [32426..32429], [32431..32434], [32446..32449], [32451..32454], [32506..32509], [32511..32514], [32526..32527], [32929..32930], [32942..32949], [32951..32953], [32955..32970], [32973..32975], [33009..33011], [33014..33185], [33187..33190], [33205..33207], [33209..33211], [33226..33229], [33231..33265], [33267..33270], [36392..36401], [36403..36404], [36421..36423], [36425..36427], [36442..36445], [36447..36548], [36556..36568]]), ST_DWITHIN(POINT (10 20):GEOMETRY, ST_POINT($2, $1), 10))])
    LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSpatialDWithinToHilbertNegative">
    <Resource name="sql">
      <![CDATA[select *
from GEO.Restaurants as r
where ST_DWithin(ST_Point(10.0, 20.0),
                 ST_Point(r.longitude, r.latitude), -2)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(NAME=[$0], LATITUDE=[$1], LONGITUDE=[$2], CUISINE=[$3], HILBERT=[$4])
  LogicalFilter(condition=[ST_DWITHIN(ST_POINT(10.0:DECIMAL(3, 1), 20.0:DECIMAL(3, 1)), ST_POINT($2, $1), -2)])
    LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(NAME=[$0], LATITUDE=[$1], LONGITUDE=[$2], CUISINE=[$3], HILBERT=[$4])
  LogicalValues(tuples=[[]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSpatialDWithinToHilbertZero">
    <Resource name="sql">
      <![CDATA[select *
from GEO.Restaurants as r
where ST_DWithin(ST_Point(10.0, 20.0),
                 ST_Point(r.longitude, r.latitude), 0)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(NAME=[$0], LATITUDE=[$1], LONGITUDE=[$2], CUISINE=[$3], HILBERT=[$4])
  LogicalFilter(condition=[ST_DWITHIN(ST_POINT(10.0:DECIMAL(3, 1), 20.0:DECIMAL(3, 1)), ST_POINT($2, $1), 0)])
    LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(NAME=[$0], LATITUDE=[$1], LONGITUDE=[$2], CUISINE=[$3], HILBERT=[$4])
  LogicalFilter(condition=[AND(=($4, 33139), =(POINT (10 20), ST_POINT($2, $1)))])
    LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSpatialReduce">
    <Resource name="sql">
      <![CDATA[select
  ST_Buffer(ST_Point(0.0, 0.0), 1, 4) as b
from GEO.Restaurants as r]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(B=[ST_BUFFER(ST_POINT(0.0:DECIMAL(2, 1), 0.0:DECIMAL(2, 1)), 1, 4)])
  LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(B=[CAST(POLYGON ((1 0, 0.9238795325112867 -0.3826834323650898, 0.7071067811865476 -0.7071067811865475, 0.3826834323650898 -0.9238795325112867, 0.0000000000000001 -1, -0.3826834323650897 -0.9238795325112867, -0.7071067811865475 -0.7071067811865476, -0.9238795325112867 -0.3826834323650899, -1 -0.0000000000000001, -0.9238795325112867 0.3826834323650897, -0.7071067811865477 0.7071067811865475, -0.3826834323650903 0.9238795325112865, -0.0000000000000002 1, 0.38268343236509 0.9238795325112866, 0.7071067811865474 0.7071067811865477, 0.9238795325112865 0.3826834323650904, 1 0)):GEOMETRY):GEOMETRY])
  LogicalTableScan(table=[[CATALOG, GEO, RESTAURANTS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSplit">
    <Resource name="sql">
      <![CDATA[select split('1|2|3', '|')]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[SPLIT('1|2|3', '|')])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[ARRAY('1':VARCHAR, '2':VARCHAR, '3':VARCHAR)])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSplitNull">
    <Resource name="sql">
      <![CDATA[select split('1|2|3', NULL)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[SPLIT('1|2|3', null:NULL)])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[null:VARCHAR NOT NULL ARRAY])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSplitNull1">
    <Resource name="sql">
      <![CDATA[select split(NULL, '|')]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[SPLIT(null:NULL, '|')])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[null:VARCHAR NOT NULL ARRAY])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSplitNull2">
    <Resource name="sql">
      <![CDATA[select split(NULL, NULL)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[SPLIT(null:NULL, null:NULL)])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[null:VARCHAR NOT NULL ARRAY])
  LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testStarJoinDphypJoinReorder">
    <Resource name="sql">
      <![CDATA[select emp.empno from emp, emp_b, emp_address, dept, dept_nested where emp.empno = emp_b.empno and emp.empno = emp_address.empno and emp.deptno = dept.deptno and emp.deptno = dept_nested.deptno and emp_b.sal + emp_address.empno = dept.deptno + dept_nested.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  HyperGraph(edges=[{0}——[INNER, =(node(0)_field(7), node(4)_field(0))]——{4},{1, 2, 3}——[INNER, =(+(node(1)_field(5), node(2)_field(0)), +(node(3)_field(0), node(4)_field(0)))]——{4},{0}——[INNER, =(node(0)_field(7), node(3)_field(0))]——{3},{0}——[INNER, =(node(0)_field(0), node(2)_field(0))]——{2},{0}——[INNER, =(node(0)_field(0), node(1)_field(0))]——{1}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$16])
  LogicalJoin(condition=[AND(=(+($5, $25), +($14, $10)), =($16, $25))], joinType=[inner])
    LogicalJoin(condition=[=($16, $0)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
      LogicalJoin(condition=[=($13, $0)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
        LogicalJoin(condition=[=($9, $0)], joinType=[inner])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_ADDRESS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testStrengthenJoinType">
    <Resource name="sql">
      <![CDATA[select *
from dept left join emp on dept.deptno = emp.deptno
where emp.deptno is not null and emp.sal > 100]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1], EMPNO=[$2], ENAME=[$3], JOB=[$4], MGR=[$5], HIREDATE=[$6], SAL=[$7], COMM=[$8], DEPTNO0=[$9], SLACKER=[$10])
  LogicalFilter(condition=[AND(IS NOT NULL($9), >($7, 100))])
    LogicalJoin(condition=[=($0, $9)], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1], EMPNO=[$2], ENAME=[$3], JOB=[$4], MGR=[$5], HIREDATE=[$6], SAL=[$7], COMM=[$8], DEPTNO0=[$9], SLACKER=[$10])
  LogicalProject(DEPTNO=[$0], DNAME=[$1], EMPNO=[CAST($2):INTEGER], ENAME=[CAST($3):VARCHAR(20)], JOB=[CAST($4):VARCHAR(10)], MGR=[$5], HIREDATE=[CAST($6):TIMESTAMP(0)], SAL=[CAST($7):INTEGER], COMM=[CAST($8):INTEGER], DEPTNO0=[CAST($9):INTEGER], SLACKER=[CAST($10):BOOLEAN])
    LogicalJoin(condition=[=($0, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
      LogicalFilter(condition=[>($5, 100)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSubQueryWithDynamicStarHang">
    <Resource name="sql">
      <![CDATA[select n.n_regionkey
from (select *
  from (select *
    from sales.customer) t) n
where n.n_nationkey > 1]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(N_REGIONKEY=[ITEM($0, 'N_REGIONKEY')])
  LogicalFilter(condition=[>(ITEM($0, 'N_NATIONKEY'), 1)])
    LogicalProject(**=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
EnumerableProject(N_REGIONKEY=[ITEM($0, 'N_REGIONKEY')])
  EnumerableFilter(condition=[>(ITEM($0, 'N_NATIONKEY'), 1)])
    EnumerableTableScan(table=[[CATALOG, SALES, CUSTOMER]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSumAndDistinctSumWithExpandSumType">
    <Resource name="sql">
      <![CDATA[SELECT SUM(comm), SUM(DISTINCT comm) FROM emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0)], EXPR$1=[SUM(DISTINCT $0)])
  LogicalProject(COMM=[$6])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[CAST($0):BIGINT], EXPR$1=[$1])
  LogicalAggregate(group=[{}], EXPR$0=[SUM($1)], EXPR$1=[SUM($0)])
    LogicalAggregate(group=[{0}], EXPR$0=[SUM($0)])
      LogicalProject(COMM=[$6])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSwapAntiJoin">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[=($7, $8)], joinType=[anti])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSwapOuterJoin">
    <Resource name="sql">
      <![CDATA[select 1 from sales.dept d left outer join sales.emp e
 on d.deptno = e.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[1])
  LogicalJoin(condition=[=($0, $9)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[1])
  LogicalProject(DEPTNO=[$9], DNAME=[$10], EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO0=[$7], SLACKER=[$8])
    LogicalJoin(condition=[=($9, $7)], joinType=[right])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSwapOuterJoinFieldAccess">
    <Resource name="sql">
      <![CDATA[select t1.dname, e.ename
from DEPT_NESTED as t1 left outer join sales.emp e
 on t1.skill.type = e.job]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$1], ENAME=[$5])
  LogicalJoin(condition=[=($2.TYPE, $6)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$10], ENAME=[$1])
  LogicalJoin(condition=[=($11.TYPE, $2)], joinType=[right])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT_NESTED]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSwapRightToLeftOnly">
    <Resource name="sql">
      <![CDATA[select 1 from sales.dept d right outer join sales.emp e
 on d.deptno = e.deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[1])
  LogicalJoin(condition=[=($0, $9)], joinType=[right])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[1])
  LogicalProject(DEPTNO=[$9], DNAME=[$10], EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO0=[$7], SLACKER=[$8])
    LogicalJoin(condition=[=($9, $7)], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSwapSemiJoin">
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[=($7, $8)], joinType=[semi])
    LogicalTableScan(table=[[scott, EMP]])
    LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForCannotRemoveD">
    <Resource name="sql">
      <![CDATA[select empno from emp where exists(select * from empnullables where emp.deptno > empnullables.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[EXISTS({
LogicalFilter(condition=[>($cor0.DEPTNO, $7)])
  LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[$9])
    LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalFilter(condition=[>($cor0.DEPTNO, $7)])
        LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($7, $18)], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalJoin(condition=[>($9, $7)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
      LogicalAggregate(group=[{0}])
        LogicalProject(DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForCountScalar">
    <Resource name="sql">
      <![CDATA[select deptno, (select count(empno) from emp where dept.deptno = emp.deptno) from dept]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], DEPTNO=[$0], EXPR$1=[$SCALAR_QUERY({
LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
  LogicalProject(EMPNO=[$0])
    LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$2])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
      LogicalProject(EMPNO=[$0])
        LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$4])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $2)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DEPTNO=[$0], DEPTNO0=[$1], $f2=[CASE(IS NOT NULL($2), $2, 0)])
      LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $1)], joinType=[left])
        LogicalProject(DEPTNO=[$0])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalAggregate(group=[{0}], EXPR$0=[COUNT()])
          LogicalProject(DEPTNO=[$7])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForFilterExists">
    <Resource name="sql">
      <![CDATA[select empno from emp where exists(select * from dept where dept.deptno = emp.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[EXISTS({
LogicalFilter(condition=[=($0, $cor0.DEPTNO)])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[$9])
    LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalFilter(condition=[=($0, $cor0.DEPTNO)])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($7, $9)], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForFilterNotExists">
    <Resource name="sql">
      <![CDATA[select empno from emp where not exists(select * from emp_b where emp.ename = emp_b.ename)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[NOT(EXISTS({
LogicalFilter(condition=[=($cor0.ENAME, $1)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[NOT($9)])
    LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{1}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalFilter(condition=[=($cor0.ENAME, $1)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($1, $10)], joinType=[anti])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForFilterNotIn">
    <Resource name="sql">
      <![CDATA[select empno from emp where empno not in (select empno from emp_b where emp.ename = emp_b.ename)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[NOT(IN($0, {
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[=($cor0.ENAME, $1)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[NOT($9)])
    LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{1}], condition=[=($0, $9)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0])
        LogicalFilter(condition=[=($cor0.ENAME, $1)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[NOT($9)])
    LogicalJoin(condition=[AND(=($0, $9), IS NOT DISTINCT FROM($1, $10))], joinType=[left_mark])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForFilterScalar">
    <Resource name="sql">
      <![CDATA[select empno from emp where sal > (select avg(sal) from emp_b where emp.ename = emp_b.ename)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[>($5, $SCALAR_QUERY({
LogicalAggregate(group=[{}], EXPR$0=[AVG($0)])
  LogicalProject(SAL=[$5])
    LogicalFilter(condition=[=($cor0.ENAME, $1)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[>($5, $9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{1}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], EXPR$0=[AVG($0)])
        LogicalProject(SAL=[$5])
          LogicalFilter(condition=[=($cor0.ENAME, $1)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(IS NOT DISTINCT FROM($1, $9), >($5, $10))], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{1}], EXPR$0=[AVG($0)])
      LogicalProject(SAL=[$5], ENAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForFilterSome">
    <Resource name="sql">
      <![CDATA[select empno from emp where empno > SOME(select empno from emp_b where emp.ename = emp_b.ename)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[> SOME($0, {
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[=($cor0.ENAME, $1)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[$9])
    LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{1}], condition=[>($0, $9)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0])
        LogicalFilter(condition=[=($cor0.ENAME, $1)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(>($0, $9), IS NOT DISTINCT FROM($1, $10))], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EMPNO=[$0], ENAME=[$1])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForLateralJoin">
    <Resource name="sql">
      <![CDATA[select empno from emp,
 LATERAL (select * from dept where emp.deptno = dept.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], DNAME=[$1])
      LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalFilter(condition=[=($cor0.DEPTNO, $0)])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($7, $9)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForMeasure">
    <Resource name="sql">
      <![CDATA[SELECT job,
  (SELECT
      CAST(SUM(i.sal) - SUM(COALESCE(i.comm, 0)) AS DECIMAL(10, 2)) / SUM(i.sal)
    FROM emp AS i
    WHERE i.job = e.job) AS profitMargin,
  COUNT(*) AS "count"
FROM emp AS e
GROUP BY job]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], JOB=[$0], PROFITMARGIN=[$SCALAR_QUERY({
LogicalProject(EXPR$0=[/(CAST(-($0, $1)):DECIMAL(10, 2), $0)])
  LogicalAggregate(group=[{}], agg#0=[SUM($0)], agg#1=[SUM($1)])
    LogicalProject(SAL=[$5], $f1=[$6])
      LogicalFilter(condition=[=($2, $cor0.JOB)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})], count=[$1])
  LogicalAggregate(group=[{0}], count=[COUNT()])
    LogicalProject(JOB=[$2])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(JOB=[$0], PROFITMARGIN=[$2], count=[$1])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
    LogicalAggregate(group=[{0}], count=[COUNT()])
      LogicalProject(JOB=[$2])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EXPR$0=[/(CAST(-($0, $1)):DECIMAL(10, 2), $0)])
      LogicalAggregate(group=[{}], agg#0=[SUM($0)], agg#1=[SUM($1)])
        LogicalProject(SAL=[$5], $f1=[$6])
          LogicalFilter(condition=[=($2, $cor0.JOB)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(JOB=[$0], PROFITMARGIN=[$2], count=[$1])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $3)], joinType=[left])
    LogicalAggregate(group=[{0}], count=[COUNT()])
      LogicalProject(JOB=[$2])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject($f0=[/(CAST(-($1, $2)):DECIMAL(10, 2), $1)], JOB=[$0])
      LogicalAggregate(group=[{2}], agg#0=[SUM($0)], agg#1=[SUM($1)])
        LogicalProject(SAL=[$5], COMM=[$6], JOB=[$2])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForProjectExists">
    <Resource name="sql">
      <![CDATA[SELECT dept.deptno, EXISTS ( SELECT 1 FROM emp e WHERE e.deptno = dept.deptno ) AS has_employees FROM dept]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], DEPTNO=[$0], HAS_EMPLOYEES=[EXISTS({
LogicalFilter(condition=[=($7, $cor0.DEPTNO)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DEPTNO=[$0], HAS_EMPLOYEES=[$2])
  LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{0}])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalFilter(condition=[=($7, $cor0.DEPTNO)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], HAS_EMPLOYEES=[$2])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $9)], joinType=[left_mark])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForProjectIn">
    <Resource name="sql">
      <![CDATA[SELECT emp.deptno, emp.deptno IN (SELECT dept.deptno FROM dept where dept.deptno < emp.empno ) FROM emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], DEPTNO=[$7], EXPR$1=[IN($7, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[<($0, $cor0.EMPNO)])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DEPTNO=[$7], EXPR$1=[$9])
  LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{0}], condition=[=($7, $9)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0])
      LogicalFilter(condition=[<($0, $cor0.EMPNO)])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$7], EXPR$1=[$9])
  LogicalJoin(condition=[AND(=($7, $9), IS NOT DISTINCT FROM($0, $10))], joinType=[left_mark])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], EMPNO=[$2])
      LogicalJoin(condition=[<($0, $2)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalProject(EMPNO=[$0])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForProjectScalar">
    <Resource name="sql">
      <![CDATA[SELECT empno, sal + (SELECT avg(sal) FROM empdefaults where emp.deptno = empdefaults.deptno) FROM emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], EMPNO=[$0], EXPR$1=[+($5, $SCALAR_QUERY({
LogicalAggregate(group=[{}], EXPR$0=[AVG($0)])
  LogicalProject(SAL=[$5])
    LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
      LogicalTableScan(table=[[CATALOG, SALES, EMPDEFAULTS]])
}))])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[+($5, $9)])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{}], EXPR$0=[AVG($0)])
      LogicalProject(SAL=[$5])
        LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
          LogicalTableScan(table=[[CATALOG, SALES, EMPDEFAULTS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[+($5, $10)])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($7, $9)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{1}], EXPR$0=[AVG($0)])
      LogicalProject(SAL=[$5], DEPTNO=[$7])
        LogicalFilter(condition=[IS NOT NULL($7)])
          LogicalTableScan(table=[[CATALOG, SALES, EMPDEFAULTS]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForSubqueryWithCube">
    <Resource name="sql">
      <![CDATA[select empno from emp where sal < SOME(select avg(sal) from emp_b where emp.job = emp_b.job group by cube(deptno))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[< SOME($5, {
LogicalProject(EXPR$0=[$1])
  LogicalAggregate(group=[{0}], groups=[[{0}, {}]], EXPR$0=[AVG($1)])
    LogicalProject(DEPTNO=[$7], SAL=[$5])
      LogicalFilter(condition=[=($cor0.JOB, $2)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[$9])
    LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{2}], condition=[<($5, $9)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EXPR$0=[$1])
        LogicalAggregate(group=[{0}], groups=[[{0}, {}]], EXPR$0=[AVG($1)])
          LogicalProject(DEPTNO=[$7], SAL=[$5])
            LogicalFilter(condition=[=($cor0.JOB, $2)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(<($5, $9), IS NOT DISTINCT FROM($2, $10))], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(EXPR$0=[$3], JOB=[$0])
      LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $2)], joinType=[left])
        LogicalAggregate(group=[{0}])
          LogicalProject(JOB=[$2])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{0, 2}], groups=[[{0, 2}, {2}]], EXPR$0=[AVG($1)])
          LogicalProject(DEPTNO=[$7], SAL=[$5], JOB=[$2])
            LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForSubqueryWithJoin">
    <Resource name="sql">
      <![CDATA[select empno from emp where sal > SOME(select sal from empnullables, (select empno from emp_b where emp.deptno = emp_b.deptno) b where empnullables.empno = b.empno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[> SOME($5, {
LogicalProject(SAL=[$5])
  LogicalFilter(condition=[=($0, $9)])
    LogicalJoin(condition=[true], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
      LogicalProject(EMPNO=[$0])
        LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[$9])
    LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{7}], condition=[>($5, $9)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(SAL=[$5])
        LogicalFilter(condition=[=($0, $9)])
          LogicalJoin(condition=[true], joinType=[inner])
            LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
            LogicalProject(EMPNO=[$0])
              LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(>($5, $9), IS NOT DISTINCT FROM($7, $10))], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(SAL=[$5], DEPTNO0=[$10])
      LogicalJoin(condition=[=($0, $9)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
        LogicalProject(EMPNO=[$0], DEPTNO=[$7])
          LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForSubqueryWithSetOp">
    <Resource name="sql">
      <![CDATA[select empno, (select sum(deptno) from (select deptno from emp_b where emp.empno = emp_b.empno union all select deptno from empnullables where emp.empno = empnullables.empno)) from emp]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], EMPNO=[$0], EXPR$1=[$SCALAR_QUERY({
LogicalAggregate(group=[{}], EXPR$0=[SUM($0)])
  LogicalUnion(all=[true])
    LogicalProject(DEPTNO=[$7])
      LogicalFilter(condition=[=($cor0.EMPNO, $0)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
    LogicalProject(DEPTNO=[$7])
      LogicalFilter(condition=[=($cor0.EMPNO, $0)])
        LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
})])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[$9])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{}], EXPR$0=[SUM($0)])
      LogicalUnion(all=[true])
        LogicalProject(DEPTNO=[$7])
          LogicalFilter(condition=[=($cor0.EMPNO, $0)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
        LogicalProject(DEPTNO=[$7])
          LogicalFilter(condition=[=($cor0.EMPNO, $0)])
            LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], EXPR$1=[$10])
  LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $9)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{1}], EXPR$0=[SUM($0)])
      LogicalUnion(all=[true])
        LogicalProject(DEPTNO=[$7], EMPNO=[$0])
          LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
        LogicalProject(DEPTNO=[$7], EMPNO=[$0])
          LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForSubqueryWithSort">
    <Resource name="sql">
      <![CDATA[select empno from emp where sal > SOME(select sal from emp_b where emp.deptno = emp_b.deptno order by emp_b.sal limit 5)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[> SOME($5, {
LogicalSort(sort0=[$0], dir0=[ASC], fetch=[5])
  LogicalProject(SAL=[$5])
    LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[$9])
    LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{7}], condition=[>($5, $9)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalSort(sort0=[$0], dir0=[ASC], fetch=[5])
        LogicalProject(SAL=[$5])
          LogicalFilter(condition=[=($cor0.DEPTNO, $7)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(>($5, $9), IS NOT DISTINCT FROM($7, $10))], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalFilter(condition=[<=($2, 5)])
      LogicalProject(SAL=[$5], DEPTNO=[$7], $f2=[ROW_NUMBER() OVER (PARTITION BY $7 ORDER BY $5 NULLS LAST)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForTwoLevelCorrelate">
    <Resource name="sql">
      <![CDATA[select empno from emp where exists(select * from emp_b where emp.ename = emp_b.ename and exists(select * from empnullables where emp.empno = empnullables.empno and emp_b.deptno = empnullables.deptno))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[EXISTS({
LogicalFilter(condition=[AND(=($cor0.ENAME, $1), EXISTS({
LogicalFilter(condition=[AND(=($cor0.EMPNO, $0), =($cor2.DEPTNO, $7))])
  LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
}))], variablesSet=[[$cor2]])
  LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[$9])
    LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{0, 1}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], BIRTHDATE=[$9])
        LogicalFilter(condition=[AND(=($cor0.ENAME, $1), $10)])
          LogicalConditionalCorrelate(correlation=[$cor2], joinType=[left_mark], requiredColumns=[{7}])
            LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
            LogicalFilter(condition=[AND(=($cor0.EMPNO, $0), =($cor2.DEPTNO, $7))])
              LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(IS NOT DISTINCT FROM($0, $19), IS NOT DISTINCT FROM($1, $20))], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalJoin(condition=[AND(IS NOT DISTINCT FROM($10, $21), IS NOT DISTINCT FROM($11, $22), IS NOT DISTINCT FROM($7, $23))], joinType=[semi])
      LogicalJoin(condition=[=($11, $1)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
        LogicalProject(EMPNO=[$0], ENAME=[$1])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalJoin(condition=[AND(=($9, $0), =($11, $7))], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
        LogicalAggregate(group=[{0, 1, 2}])
          LogicalProject(EMPNO0=[$10], ENAME0=[$11], DEPTNO=[$7])
            LogicalJoin(condition=[true], joinType=[inner])
              LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
              LogicalProject(EMPNO=[$0], ENAME=[$1])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForTwoLevelCorrelate2">
    <Resource name="sql">
      <![CDATA[select empno from emp where exists(select * from emp_b where emp.ename = emp_b.ename and exists(select * from empnullables where emp.empno = empnullables.empno))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[EXISTS({
LogicalFilter(condition=[AND(=($cor0.ENAME, $1), EXISTS({
LogicalFilter(condition=[=($cor0.EMPNO, $0)])
  LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
}))])
  LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[$9])
    LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{0, 1}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], BIRTHDATE=[$9])
        LogicalFilter(condition=[AND(=($cor0.ENAME, $1), $10)])
          LogicalJoin(condition=[true], joinType=[left_mark])
            LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
            LogicalFilter(condition=[=($cor0.EMPNO, $0)])
              LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalJoin(condition=[AND(IS NOT DISTINCT FROM($0, $19), IS NOT DISTINCT FROM($1, $20))], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalJoin(condition=[AND(IS NOT DISTINCT FROM($10, $21), IS NOT DISTINCT FROM($11, $22))], joinType=[semi])
      LogicalJoin(condition=[=($11, $1)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
        LogicalProject(EMPNO=[$0], ENAME=[$1])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalJoin(condition=[=($9, $0)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, EMPNULLABLES]])
        LogicalProject(EMPNO=[$0], ENAME=[$1])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTopDownGeneralDecorrelateForTwoLevelCorrelate3">
    <Resource name="sql">
      <![CDATA[SELECT deptno FROM emp e WHERE EXISTS (SELECT * FROM dept d WHERE EXISTS (SELECT * FROM bonus ea WHERE ea.ENAME = e.ENAME AND d.deptno = e.deptno))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[EXISTS({
LogicalFilter(condition=[EXISTS({
LogicalFilter(condition=[AND(=($0, $cor0.ENAME), =($cor1.DEPTNO, $cor0.DEPTNO))])
  LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
})], variablesSet=[[$cor1]])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[$9])
    LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{1, 7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(DEPTNO=[$0], DNAME=[$1])
        LogicalFilter(condition=[$2])
          LogicalConditionalCorrelate(correlation=[$cor1], joinType=[left_mark], requiredColumns=[{0}])
            LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
            LogicalFilter(condition=[AND(=($0, $cor0.ENAME), =($cor1.DEPTNO, $cor0.DEPTNO))])
              LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$7])
  LogicalJoin(condition=[AND(IS NOT DISTINCT FROM($1, $11), IS NOT DISTINCT FROM($7, $12))], joinType=[semi])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalJoin(condition=[AND(IS NOT DISTINCT FROM($2, $8), IS NOT DISTINCT FROM($3, $9), IS NOT DISTINCT FROM($0, $10))], joinType=[semi])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalAggregate(group=[{0, 1}])
          LogicalProject(ENAME=[$1], DEPTNO=[$7])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalJoin(condition=[=($0, $4)], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, BONUS]])
        LogicalProject(ENAME=[$2], DEPTNO0=[$3], DEPTNO=[$0])
          LogicalJoin(condition=[=($0, $3)], joinType=[inner])
            LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
            LogicalAggregate(group=[{0, 1}])
              LogicalProject(ENAME=[$1], DEPTNO=[$7])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testTwoLevelDecorrelate">
    <Resource name="sql">
      <![CDATA[SELECT d1.dname, d1.deptno + (
SELECT e1.empno
FROM emp e1
WHERE d1.deptno = e1.deptno and
    e1.sal = (SELECT max(sal)
              FROM emp e2
              WHERE e1.sal = e2.sal and
                  e1.deptno = e2.deptno and
                  d1.deptno < e2.deptno))
FROM dept d1]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(variablesSet=[[$cor0]], DNAME=[$1], EXPR$1=[+($0, $SCALAR_QUERY({
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[AND(=($cor0.DEPTNO, $7), =($5, $SCALAR_QUERY({
LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
  LogicalProject(SAL=[$5])
    LogicalFilter(condition=[AND(=($cor1.SAL, $5), =($cor1.DEPTNO, $7), <($cor0.DEPTNO, $7))])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})))], variablesSet=[[$cor1]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[+($0, $2)])
  LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0}])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{}], agg#0=[SINGLE_VALUE($0)])
      LogicalProject(EMPNO=[$0])
        LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
          LogicalFilter(condition=[AND(=($cor0.DEPTNO, $7), =($5, $9))])
            LogicalCorrelate(correlation=[$cor1], joinType=[left], requiredColumns=[{5, 7}])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
              LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
                LogicalProject(SAL=[$5])
                  LogicalFilter(condition=[AND(=($cor1.SAL, $5), =($cor1.DEPTNO, $7), <($cor0.DEPTNO, $7))])
                    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$1], EXPR$1=[+($0, $3)])
  LogicalJoin(condition=[=($0, $2)], joinType=[left])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0}], agg#0=[SINGLE_VALUE($1)])
      LogicalProject(DEPTNO0=[$10], EMPNO=[$0])
        LogicalFilter(condition=[AND(=($10, $7), =($5, $9))])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], EXPR$0=[$12], DEPTNO0=[$9])
            LogicalJoin(condition=[AND(=($5, $10), =($7, $11))], joinType=[left])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
              LogicalAggregate(group=[{0, 1, 2}], EXPR$0=[MAX($3)])
                LogicalProject(DEPTNO0=[$9], SAL0=[$10], DEPTNO00=[$11], SAL=[$5])
                  LogicalJoin(condition=[AND(=($10, $5), =($11, $7), <($9, $7))], joinType=[inner])
                    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
                    LogicalJoin(condition=[true], joinType=[inner])
                      LogicalProject(DEPTNO=[$0])
                        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
                      LogicalAggregate(group=[{0, 1}])
                        LogicalProject(SAL=[$5], DEPTNO=[$7])
                          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUncorrelatedCallBelowNonComparisonOpIsNotFlattened">
    <Resource name="sql">
      <![CDATA[select * from emp e1 where exists (select * from emp e2 where (e1.deptno + (e2.deptno+30)) > 0)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IS NOT NULL($9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], agg#0=[MIN($0)])
        LogicalProject($f0=[true])
          LogicalFilter(condition=[>(+($cor0.DEPTNO, +($7, 30)), 0)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUncorrelatedCallInConjunctionIsFlattenedOnlyIfSiblingOfCorrelation">
    <Resource name="sql">
      <![CDATA[select * from emp e1 where exists (select * from emp e2 where (e2.empno+50) < 20 and e1.deptno >= (30+e2.deptno))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IS NOT NULL($9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], agg#0=[MIN($0)])
        LogicalProject($f0=[true])
          LogicalFilter(condition=[AND(<(+($0, 50), 20), >=($cor0.DEPTNO, +(30, $7)))])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IS NOT NULL($9)])
    LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{7}])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalAggregate(group=[{}], agg#0=[MIN($0)])
        LogicalProject($f0=[true])
          LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
            LogicalFilter(condition=[AND(<(+($0, 50), 20), >=($cor0.DEPTNO, $9))])
              LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], $f9=[+(30, $7)])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionEliminatorRuleIntersect">
    <Resource name="planBefore">
      <![CDATA[
LogicalIntersect(all=[true])
  LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionEliminatorRuleMinus">
    <Resource name="planBefore">
      <![CDATA[
LogicalMinus(all=[true])
  LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionEliminatorRuleUnion">
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalTableScan(table=[[scott, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionMergeRule">
    <Resource name="sql">
      <![CDATA[select * from (
select * from (
  select dname, deptno from dept
  union all
  select dname, deptno from
  (
    select dname, deptno, count(1) from dept group by dname, deptno
    union all
    select dname, deptno, count(1) from dept group by dname, deptno
  ) subq
) a
union all
select dname, deptno from dept
) aa
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(DNAME=[$1], DEPTNO=[$0])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
  LogicalProject(DNAME=[$0], DEPTNO=[$1])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
      LogicalProject(DNAME=[$1], DEPTNO=[$0], $f2=[1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
  LogicalProject(DNAME=[$0], DEPTNO=[$1])
    LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
      LogicalProject(DNAME=[$1], DEPTNO=[$0], $f2=[1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
  LogicalProject(DNAME=[$1], DEPTNO=[$0])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$0], DEPTNO=[$1])
  LogicalUnion(all=[true])
    LogicalProject(DNAME=[$0], DEPTNO=[$1])
      LogicalUnion(all=[true])
        LogicalProject(DNAME=[$1], DEPTNO=[$0])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalProject(DNAME=[$0], DEPTNO=[$1])
          LogicalUnion(all=[true])
            LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
              LogicalProject(DNAME=[$1], DEPTNO=[$0], $f2=[1])
                LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
            LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
              LogicalProject(DNAME=[$1], DEPTNO=[$0], $f2=[1])
                LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalProject(DNAME=[$1], DEPTNO=[$0])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByInList">
    <Resource name="sql">
      <![CDATA[
with t1(a, y) as (select * from (values (1, 2), (3, null), (7369, null), (7499, 30), (null, 20), (null, 5)) as t1)
select *
from t1
where (t1.a, t1.y) in ((1, 2), (3, null), (7369, null), (7499, 30), (null, 20), (null, 5))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(A=[$0], Y=[$1])
  LogicalJoin(condition=[AND(=($0, $2), =($1, $3))], joinType=[inner])
    LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
      LogicalValues(tuples=[[{ 1, 2 }, { 3, null }, { 7369, null }, { 7499, 30 }, { null, 20 }, { null, 5 }]])
    LogicalAggregate(group=[{0, 1}])
      LogicalUnion(all=[true])
        LogicalProject(EXPR$0=[3], EXPR$1=[null:INTEGER])
          LogicalValues(tuples=[[{ 0 }]])
        LogicalProject(EXPR$0=[7369], EXPR$1=[null:INTEGER])
          LogicalValues(tuples=[[{ 0 }]])
        LogicalProject(EXPR$0=[null:INTEGER], EXPR$1=[20])
          LogicalValues(tuples=[[{ 0 }]])
        LogicalProject(EXPR$0=[null:INTEGER], EXPR$1=[5])
          LogicalValues(tuples=[[{ 0 }]])
        LogicalValues(tuples=[[{ 1, 2 }, { 7499, 30 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(A=[$0], Y=[$1])
  LogicalJoin(condition=[AND(=($0, $2), =($1, $3))], joinType=[inner])
    LogicalValues(tuples=[[{ 1, 2 }, { 3, null }, { 7369, null }, { 7499, 30 }, { null, 20 }, { null, 5 }]])
    LogicalAggregate(group=[{0, 1}])
      LogicalValues(tuples=[[{ 3, null }, { 7369, null }, { null, 20 }, { null, 5 }, { 1, 2 }, { 7499, 30 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByInList2">
    <Resource name="sql">
      <![CDATA[
with t1(a, y) as (select * from (values (1, 2), (3, null), (7369, null), (7499, 30), (null, 20), (null, 5)) as t1)
select *
from t1
where (t1.a, t1.y) in ((cast(1.1 as int), 2), (3, null), (7369, null), (7499, 30), (null, cast(20.2 as int)), (null, 5))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(A=[$0], Y=[$1])
  LogicalJoin(condition=[AND(=($0, $2), =($1, $3))], joinType=[inner])
    LogicalProject(EXPR$0=[$0], EXPR$1=[$1])
      LogicalValues(tuples=[[{ 1, 2 }, { 3, null }, { 7369, null }, { 7499, 30 }, { null, 20 }, { null, 5 }]])
    LogicalAggregate(group=[{0, 1}])
      LogicalUnion(all=[true])
        LogicalProject(EXPR$0=[1], EXPR$1=[2])
          LogicalValues(tuples=[[{ 0 }]])
        LogicalProject(EXPR$0=[3], EXPR$1=[null:INTEGER])
          LogicalValues(tuples=[[{ 0 }]])
        LogicalProject(EXPR$0=[7369], EXPR$1=[null:INTEGER])
          LogicalValues(tuples=[[{ 0 }]])
        LogicalProject(EXPR$0=[null:INTEGER], EXPR$1=[20])
          LogicalValues(tuples=[[{ 0 }]])
        LogicalProject(EXPR$0=[null:INTEGER], EXPR$1=[5])
          LogicalValues(tuples=[[{ 0 }]])
        LogicalValues(tuples=[[{ 7499, 30 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(A=[$0], Y=[$1])
  LogicalJoin(condition=[AND(=($0, $2), =($1, $3))], joinType=[inner])
    LogicalValues(tuples=[[{ 1, 2 }, { 3, null }, { 7369, null }, { 7499, 30 }, { null, 20 }, { null, 5 }]])
    LogicalAggregate(group=[{0, 1}])
      LogicalValues(tuples=[[{ 1, 2 }, { 3, null }, { 7369, null }, { null, 20 }, { null, 5 }, { 7499, 30 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByInList3">
    <Resource name="sql">
      <![CDATA[select * from dept where deptno in (12, 34, cast(56.4 as int))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalUnion(all=[true])
        LogicalProject(EXPR$0=[56])
          LogicalValues(tuples=[[{ 0 }]])
        LogicalValues(tuples=[[{ 12 }, { 34 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalJoin(condition=[=($0, $2)], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalValues(tuples=[[{ 56 }, { 12 }, { 34 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByInList4">
    <Resource name="sql">
      <![CDATA[select * from dept where deptno in (12, 34, cast(56.4 as double))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalJoin(condition=[=($2, $3)], joinType=[inner])
    LogicalProject(DEPTNO=[$0], DNAME=[$1], DEPTNO0=[CAST($0):DOUBLE NOT NULL])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalUnion(all=[true])
        LogicalProject(EXPR$0=[12.0E0:DOUBLE])
          LogicalValues(tuples=[[{ 0 }]])
        LogicalProject(EXPR$0=[34.0E0:DOUBLE])
          LogicalValues(tuples=[[{ 0 }]])
        LogicalProject(EXPR$0=[56.4E0:DOUBLE])
          LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalJoin(condition=[=($2, $3)], joinType=[inner])
    LogicalProject(DEPTNO=[$0], DNAME=[$1], DEPTNO0=[CAST($0):DOUBLE NOT NULL])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0}])
      LogicalValues(tuples=[[{ 12.0E0 }, { 34.0E0 }, { 56.4E0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByInList5">
    <Resource name="sql">
      <![CDATA[select deptno in (12, 34, cast(56.4 as double)) from dept]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[CAST(OR(AND(IS NOT NULL($6), <>($2, 0)), AND(<($3, $2), null, <>($2, 0), IS NULL($6)))):BOOLEAN NOT NULL])
  LogicalJoin(condition=[=($4, $5)], joinType=[left])
    LogicalProject(DEPTNO=[$0], DNAME=[$1], $f0=[$2], $f1=[$3], DEPTNO0=[CAST($0):DOUBLE NOT NULL])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalAggregate(group=[{}], agg#0=[COUNT()], agg#1=[COUNT($0)])
          LogicalProject(EXPR$0=[$0], $f1=[true])
            LogicalUnion(all=[true])
              LogicalProject(EXPR$0=[12.0E0:DOUBLE])
                LogicalValues(tuples=[[{ 0 }]])
              LogicalProject(EXPR$0=[34.0E0:DOUBLE])
                LogicalValues(tuples=[[{ 0 }]])
              LogicalProject(EXPR$0=[56.4E0:DOUBLE])
                LogicalValues(tuples=[[{ 0 }]])
    LogicalAggregate(group=[{0}], agg#0=[MIN($1)])
      LogicalProject(EXPR$0=[$0], $f1=[true])
        LogicalUnion(all=[true])
          LogicalProject(EXPR$0=[12.0E0:DOUBLE])
            LogicalValues(tuples=[[{ 0 }]])
          LogicalProject(EXPR$0=[34.0E0:DOUBLE])
            LogicalValues(tuples=[[{ 0 }]])
          LogicalProject(EXPR$0=[56.4E0:DOUBLE])
            LogicalValues(tuples=[[{ 0 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[CAST(OR(AND(IS NOT NULL($6), <>($2, 0)), AND(<($3, $2), null, <>($2, 0), IS NULL($6)))):BOOLEAN NOT NULL])
  LogicalJoin(condition=[=($4, $5)], joinType=[left])
    LogicalProject(DEPTNO=[$0], DNAME=[$1], $f0=[$2], $f1=[$3], DEPTNO0=[CAST($0):DOUBLE NOT NULL])
      LogicalJoin(condition=[true], joinType=[inner])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalAggregate(group=[{}], agg#0=[COUNT()], agg#1=[COUNT($0)])
          LogicalProject(EXPR$0=[$0], $f1=[true])
            LogicalValues(tuples=[[{ 12.0E0 }, { 34.0E0 }, { 56.4E0 }]])
    LogicalAggregate(group=[{0}], agg#0=[MIN($1)])
      LogicalProject(EXPR$0=[$0], $f1=[true])
        LogicalValues(tuples=[[{ 12.0E0 }, { 34.0E0 }, { 56.4E0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByUnion">
    <Resource name="sql">
      <![CDATA[select *
from (values (1, 'a'), (2, 'b')) as t(x, y)
union
select *
from (values (1, 'a'), (2, 'b'), (1, 'b'), (2, 'c'), (2, 'c')) as t(x, y)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[false])
  LogicalProject(X=[$0], Y=[$1])
    LogicalValues(tuples=[[{ 1, 'a' }, { 2, 'b' }]])
  LogicalProject(X=[$0], Y=[$1])
    LogicalValues(tuples=[[{ 1, 'a' }, { 2, 'b' }, { 1, 'b' }, { 2, 'c' }, { 2, 'c' }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[{ 1, 'a' }, { 2, 'b' }, { 1, 'b' }, { 2, 'c' }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByUnion2">
    <Resource name="sql">
      <![CDATA[select *
from (values ('a'), ('b')) as t(x)
union
select *
from (values ('a'), ('b'), ('b'), ('c'), ('c')) as t(y)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[false])
  LogicalProject(X=[$0])
    LogicalValues(tuples=[[{ 'a' }, { 'b' }]])
  LogicalProject(Y=[$0])
    LogicalValues(tuples=[[{ 'a' }, { 'b' }, { 'b' }, { 'c' }, { 'c' }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[{ 'a' }, { 'b' }, { 'c' }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByUnion3">
    <Resource name="sql">
      <![CDATA[select *
from (values (5.0)) as t(x)
union
select *
from (values (5)) as t(y)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[false])
  LogicalProject(X=[CAST($0):DECIMAL(11, 1) NOT NULL])
    LogicalValues(tuples=[[{ 5.0 }]])
  LogicalProject(Y=[CAST($0):DECIMAL(11, 1) NOT NULL])
    LogicalValues(tuples=[[{ 5 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[{ 5.0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByUnion4">
    <Resource name="sql">
      <![CDATA[select *
from (values (cast(5.0 as int))) as t(x)
union
select *
from (values (5)) as t(y)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[false])
  LogicalProject(X=[$0])
    LogicalValues(tuples=[[{ 5 }]])
  LogicalProject(Y=[$0])
    LogicalValues(tuples=[[{ 5 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[{ 5 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByUnionAll">
    <Resource name="sql">
      <![CDATA[select *
from (values (1, 'a'), (2, 'b')) as t(x, y)
union all
select *
from (values (1, 'a'), (2, 'b'), (1, 'b'), (2, 'c'), (2, 'c')) as t(x, y)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(X=[$0], Y=[$1])
    LogicalValues(tuples=[[{ 1, 'a' }, { 2, 'b' }]])
  LogicalProject(X=[$0], Y=[$1])
    LogicalValues(tuples=[[{ 1, 'a' }, { 2, 'b' }, { 1, 'b' }, { 2, 'c' }, { 2, 'c' }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[{ 1, 'a' }, { 2, 'b' }, { 1, 'a' }, { 2, 'b' }, { 1, 'b' }, { 2, 'c' }, { 2, 'c' }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByUnionAll2">
    <Resource name="sql">
      <![CDATA[select *
from (values ('a'), ('b')) as t(x)
union all
select *
from (values ('a'), ('b'), ('b'), ('c'), ('c')) as t(y)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(X=[$0])
    LogicalValues(tuples=[[{ 'a' }, { 'b' }]])
  LogicalProject(Y=[$0])
    LogicalValues(tuples=[[{ 'a' }, { 'b' }, { 'b' }, { 'c' }, { 'c' }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[{ 'a' }, { 'b' }, { 'a' }, { 'b' }, { 'b' }, { 'c' }, { 'c' }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByUnionAll3">
    <Resource name="sql">
      <![CDATA[select *
from (values (5.0)) as t(x)
union all
select *
from (values (5)) as t(y)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(X=[CAST($0):DECIMAL(11, 1) NOT NULL])
    LogicalValues(tuples=[[{ 5.0 }]])
  LogicalProject(Y=[CAST($0):DECIMAL(11, 1) NOT NULL])
    LogicalValues(tuples=[[{ 5 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[{ 5.0 }, { 5.0 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnionToValuesByUnionAll4">
    <Resource name="sql">
      <![CDATA[select *
from (values (cast(5.0 as int))) as t(x)
union all
select *
from (values (5)) as t(y)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalUnion(all=[true])
  LogicalProject(X=[$0])
    LogicalValues(tuples=[[{ 5 }]])
  LogicalProject(Y=[$0])
    LogicalValues(tuples=[[{ 5 }]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalValues(tuples=[[{ 5 }, { 5 }]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUniqueWithNoRowSubQuery">
    <Resource name="sql">
      <![CDATA[select * from dept as d
where unique(
  select deptno from emp e where false)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalFilter(condition=[UNIQUE({
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[false])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], DNAME=[$1])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testUnnestInternalMissingParameter">
    <Resource name="sql">
      <![CDATA[SELECT empno FROM emp e WHERE sal > some(SELECT avg(sal) over (partition by deptno) from emp_b b where b.deptno = e.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[> SOME($5, {
LogicalProject(EXPR$0=[CAST(/(SUM($5) OVER (PARTITION BY $7), COUNT($5) OVER (PARTITION BY $7))):INTEGER NOT NULL])
  LogicalFilter(condition=[=($7, $cor0.DEPTNO)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[$9])
      LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{7}], condition=[>($5, $9)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(EXPR$0=[CAST(/($10, $11)):INTEGER NOT NULL])
          LogicalWindow(window#0=[window(partition {7} aggs [SUM($5), COUNT($5)])])
            LogicalFilter(condition=[=($7, $cor0.DEPTNO)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[$9])
    LogicalConditionalCorrelate(correlation=[$cor0], joinType=[left_mark], requiredColumns=[{7}], condition=[>($5, $9)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EXPR$0=[CAST(/($10, $11)):INTEGER NOT NULL])
        LogicalWindow(window#0=[window(partition {7} aggs [SUM($5), COUNT($5)])])
          LogicalFilter(condition=[=($7, $cor0.DEPTNO)])
            LogicalTableScan(table=[[CATALOG, SALES, EMP_B]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testVarianceStddevWithFilter">
    <Resource name="sql">
      <![CDATA[select dname, stddev_pop(deptno) filter (where deptno > 10), stddev_samp(deptno) filter (where deptno > 20), var_pop(deptno) filter (where deptno > 30), var_samp(deptno) filter (where deptno > 40), avg(deptno) filter (where deptno > 50)
from sales.dept group by dname]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[STDDEV_POP($1) FILTER $2], EXPR$2=[STDDEV_SAMP($1) FILTER $3], EXPR$3=[VAR_POP($1) FILTER $4], EXPR$4=[VAR_SAMP($1) FILTER $5], EXPR$5=[AVG($1) FILTER $6])
  LogicalProject(DNAME=[$1], DEPTNO=[$0], $f2=[>($0, 10)], $f3=[>($0, 20)], $f4=[>($0, 30)], $f5=[>($0, 40)], $f6=[>($0, 50)])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$0], EXPR$1=[CAST(POWER(/(-($1, /(*($2, $2), $3)), $3), 0.5:DECIMAL(2, 1))):INTEGER], EXPR$2=[CAST(POWER(/(-($4, /(*($5, $5), $6)), CASE(=($6, 1), null:BIGINT, -($6, 1))), 0.5:DECIMAL(2, 1))):INTEGER], EXPR$3=[CAST(/(-($7, /(*($8, $8), $9)), $9)):INTEGER], EXPR$4=[CAST(/(-($10, /(*($11, $11), $12)), CASE(=($12, 1), null:BIGINT, -($12, 1)))):INTEGER], EXPR$5=[CAST(/($13, $14)):INTEGER])
  LogicalAggregate(group=[{0}], agg#0=[SUM($7) FILTER $2], agg#1=[SUM($1) FILTER $2], agg#2=[COUNT() FILTER $2], agg#3=[SUM($7) FILTER $3], agg#4=[SUM($1) FILTER $3], agg#5=[COUNT() FILTER $3], agg#6=[SUM($7) FILTER $4], agg#7=[SUM($1) FILTER $4], agg#8=[COUNT() FILTER $4], agg#9=[SUM($7) FILTER $5], agg#10=[SUM($1) FILTER $5], agg#11=[COUNT() FILTER $5], agg#12=[SUM($1) FILTER $6], agg#13=[COUNT() FILTER $6])
    LogicalProject(DNAME=[$0], DEPTNO=[$1], $f2=[$2], $f3=[$3], $f4=[$4], $f5=[$5], $f6=[$6], $f7=[*($1, $1)])
      LogicalProject(DNAME=[$1], DEPTNO=[$0], $f2=[>($0, 10)], $f3=[>($0, 20)], $f4=[>($0, 30)], $f5=[>($0, 40)], $f6=[>($0, 50)])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWhereAnyCorrelatedInSelect">
    <Resource name="sql">
      <![CDATA[select * from emp where empno > ANY (
  select deptno from dept where emp.job = dept.dname)
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[> SOME($0, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($cor0.JOB, $1)])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[OR(AND(IS TRUE(>($0, $9)), IS NOT TRUE(OR(IS NULL($12), =($10, 0)))), AND(IS TRUE(>($10, $11)), null, IS NOT TRUE(OR(IS NULL($12), =($10, 0))), IS NOT TRUE(>($0, $9))), AND(>($0, $9), IS NOT TRUE(OR(IS NULL($12), =($10, 0))), IS NOT TRUE(>($0, $9)), IS NOT TRUE(>($10, $11))))])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{2}])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(m=[$0], c=[$1], d=[$1], trueLiteral=[$2])
          LogicalAggregate(group=[{}], m=[MIN($0)], c=[COUNT()], trueLiteral=[LITERAL_AGG(true)])
            LogicalProject(DEPTNO=[$0])
              LogicalFilter(condition=[=($cor0.JOB, $1)])
                LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], m=[$9], c=[CAST($10):BIGINT], d=[CAST($11):BIGINT], trueLiteral=[$12], DNAME=[CAST($13):VARCHAR(10)])
    LogicalJoin(condition=[AND(=($2, $13), OR(AND(>($0, $9), IS NOT TRUE(OR(IS NULL($12), =($10, 0)))), AND(>($0, $9), IS NOT TRUE(OR(IS NULL($12), =($10, 0))), IS NOT TRUE(>($0, $9)), IS NOT TRUE(>($10, $11)))))], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(m=[$2], c=[CASE(IS NOT NULL($3), $3, 0)], d=[CASE(IS NOT NULL($3), $3, 0)], trueLiteral=[$4], DNAME=[$0])
        LogicalJoin(condition=[IS NOT DISTINCT FROM($0, $1)], joinType=[left])
          LogicalAggregate(group=[{0}])
            LogicalProject(JOB=[$2])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalAggregate(group=[{0}], m=[MIN($1)], c=[COUNT()], trueLiteral=[LITERAL_AGG(true)])
            LogicalProject(DNAME=[$1], DEPTNO=[$0])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWhereExpressionInCorrelated">
    <Resource name="sql">
      <![CDATA[select ename from (
  select ename, deptno, sal + 1 as salPlus from emp) as e
where deptno in (
  select deptno from emp where sal + 1 = e.salPlus)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(ENAME=[$0])
  LogicalFilter(condition=[IN($1, {
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[=(+($5, 1), $cor0.SALPLUS)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})], variablesSet=[[$cor0]])
    LogicalProject(ENAME=[$1], DEPTNO=[$7], SALPLUS=[+($5, 1)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(ENAME=[$0])
  LogicalProject(ENAME=[$0], DEPTNO=[$1], SALPLUS=[$2])
    LogicalFilter(condition=[=($1, $3)])
      LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
        LogicalProject(ENAME=[$1], DEPTNO=[$7], SALPLUS=[+($5, 1)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalAggregate(group=[{0}])
          LogicalProject(DEPTNO=[$7])
            LogicalFilter(condition=[=(+($5, 1), $cor0.SALPLUS)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(ENAME=[$0])
  LogicalJoin(condition=[AND(=($2, $4), =($1, $3))], joinType=[inner])
    LogicalProject(ENAME=[$1], DEPTNO=[$7], SALPLUS=[+($5, 1)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalAggregate(group=[{0, 1}])
      LogicalProject(DEPTNO=[$7], $f9=[+($5, 1)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWhereExpressionInCorrelated2">
    <Resource name="sql">
      <![CDATA[select dname from (
  select dname, deptno, deptno - 10 as deptnoMinus from dept) as d
where deptno in (
  select deptno from emp where sal + 1 = d.deptnoMinus)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(DNAME=[$0])
  LogicalFilter(condition=[IN($1, {
LogicalProject(DEPTNO=[$7])
  LogicalFilter(condition=[=(+($5, 1), $cor0.DEPTNOMINUS)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})], variablesSet=[[$cor0]])
    LogicalProject(DNAME=[$1], DEPTNO=[$0], DEPTNOMINUS=[-($0, 10)])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(DNAME=[$0])
  LogicalProject(DNAME=[$0], DEPTNO=[$1], DEPTNOMINUS=[$2])
    LogicalFilter(condition=[=($1, $3)])
      LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
        LogicalProject(DNAME=[$1], DEPTNO=[$0], DEPTNOMINUS=[-($0, 10)])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalAggregate(group=[{0}])
          LogicalProject(DEPTNO=[$7])
            LogicalFilter(condition=[=(+($5, 1), $cor0.DEPTNOMINUS)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DNAME=[$0])
  LogicalJoin(condition=[AND(=($2, $4), =($1, $3))], joinType=[inner])
    LogicalProject(DNAME=[$1], DEPTNO=[$0], DEPTNOMINUS=[-($0, 10)])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
    LogicalAggregate(group=[{0, 1}])
      LogicalProject(DEPTNO=[$7], $f9=[+($5, 1)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWhereInCorrelated">
    <Resource name="sql">
      <![CDATA[select sal from emp where empno IN (
  select deptno from dept where emp.job = dept.dname)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalFilter(condition=[IN($0, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($cor0.JOB, $1)])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[=($0, $9)])
      LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(DEPTNO=[$0])
          LogicalFilter(condition=[=($cor0.JOB, $1)])
            LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalJoin(condition=[AND(=($2, $10), =($0, $9))], joinType=[inner])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
    LogicalProject(DEPTNO=[$0], DNAME=[$1])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWhereInJoinCorrelated">
    <Resource name="sql">
      <![CDATA[select empno from emp as e
join dept as d using (deptno)
where e.sal in (
  select e2.sal from emp as e2 where e2.deptno > e.deptno)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalFilter(condition=[IN($5, {
LogicalProject(SAL=[$5])
  LogicalFilter(condition=[>($7, $cor0.DEPTNO)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
})], variablesSet=[[$cor0]])
    LogicalJoin(condition=[=($7, $9)], joinType=[inner])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8], DEPTNO0=[$9], DNAME=[$10])
    LogicalFilter(condition=[=($5, $11)])
      LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{7}])
        LogicalJoin(condition=[=($7, $9)], joinType=[inner])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
        LogicalAggregate(group=[{0}])
          LogicalProject(SAL=[$5])
            LogicalFilter(condition=[>($7, $cor0.DEPTNO)])
              LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWhereNotInCorrelated">
    <Resource name="sql">
      <![CDATA[select sal from emp
where empno NOT IN (
  select deptno from dept
  where emp.job = dept.dname)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalFilter(condition=[NOT(IN($0, {
LogicalProject(DEPTNO=[$0])
  LogicalFilter(condition=[=($cor0.JOB, $1)])
    LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalFilter(condition=[IS NULL($10)])
    LogicalJoin(condition=[AND(=($0, $9), =($2, $11))], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(DEPTNO=[$0], i=[true], DNAME=[$1])
        LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(SAL=[$5])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[IS NULL($10)])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 2}])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalFilter(condition=[=($cor0.EMPNO, $0)])
          LogicalProject(DEPTNO=[$0], i=[true])
            LogicalFilter(condition=[=($cor0.JOB, $1)])
              LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWhereNotInCorrelated2">
    <Resource name="sql">
      <![CDATA[select * from emp e1
  where e1.empno NOT IN
   (select empno from (select ename, empno, sal as r from emp) e2
    where r > 2 and e1.ename= e2.ename)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[NOT(IN($0, {
LogicalProject(EMPNO=[$1])
  LogicalFilter(condition=[AND(>($2, 2), =($cor0.ENAME, $0))])
    LogicalProject(ENAME=[$1], EMPNO=[$0], R=[$5])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
}))], variablesSet=[[$cor0]])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[IS NULL($10)])
      LogicalCorrelate(correlation=[$cor0], joinType=[left], requiredColumns=[{0, 1}])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalFilter(condition=[=($cor0.EMPNO, $0)])
          LogicalProject(EMPNO=[$1], i=[true])
            LogicalFilter(condition=[AND(>($2, 2), =($cor0.ENAME, $0))])
              LogicalProject(ENAME=[$1], EMPNO=[$0], R=[$5])
                LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[IS NULL($10)])
    LogicalJoin(condition=[AND(=($0, $9), =($1, $11))], joinType=[left])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
      LogicalProject(EMPNO=[$1], i=[true], ENAME=[$0])
        LogicalFilter(condition=[>($2, 2)])
          LogicalProject(ENAME=[$1], EMPNO=[$0], R=[$5])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWhereOrSubQuery">
    <Resource name="sql">
      <![CDATA[select * from emp
where sal = 4
or empno NOT IN (select deptno from dept)]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalFilter(condition=[OR(=($5, 4), NOT(IN($0, {
LogicalProject(DEPTNO=[$0])
  LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
})))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planMid">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[OR(=($5, 4), IS NULL($10))])
      LogicalJoin(condition=[=($0, $9)], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(DEPTNO=[$0], i=[true])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
  LogicalProject(EMPNO=[$0], ENAME=[$1], JOB=[$2], MGR=[$3], HIREDATE=[$4], SAL=[$5], COMM=[$6], DEPTNO=[$7], SLACKER=[$8])
    LogicalFilter(condition=[OR(=($5, 4), IS NULL($10))])
      LogicalJoin(condition=[=($0, $9)], joinType=[left])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
        LogicalProject(DEPTNO=[$0], i=[true])
          LogicalTableScan(table=[[CATALOG, SALES, DEPT]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWindowInParenthesis">
    <Resource name="sql">
      <![CDATA[select count(*) over (w), count(*) over w
from emp
window w as (partition by empno order by empno)]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$9], EXPR$1=[$9])
  LogicalWindow(window#0=[window(partition {0} order by [0] aggs [COUNT()])])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[COUNT() OVER (PARTITION BY $0 ORDER BY $0)], EXPR$1=[COUNT() OVER (PARTITION BY $0 ORDER BY $0)])
  LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWithinDistinct">
    <Resource name="sql">
      <![CDATA[SELECT deptno, SUM(sal), SUM(sal) WITHIN DISTINCT (job)
FROM emp
GROUP BY deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[SUM($1) WITHIN DISTINCT ($2)])
  LogicalProject(DEPTNO=[$7], SAL=[$5], JOB=[$2])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], $f1=[CAST($1):INTEGER NOT NULL], $f2=[$2])
  LogicalAggregate(group=[{0}], agg#0=[MIN($1) FILTER $3], agg#1=[$SUM0($2) FILTER $4])
    LogicalProject(DEPTNO=[$0], $f2=[$2], $f3=[$3], $f6=[=($5, 1)], $f7=[AND(=($5, 0), $THROW_UNLESS(OR(<>($5, 0), =($3, $4)), 'more than one distinct value in agg UNIQUE_VALUE'))])
      LogicalAggregate(group=[{0, 2}], groups=[[{0, 2}, {0}]], agg#0=[$SUM0($1)], agg#1=[MIN($1)], agg#2=[MAX($1)], agg#3=[GROUPING($0, $2)])
        LogicalProject(DEPTNO=[$7], SAL=[$5], JOB=[$2])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWithinDistinctCountDistinct">
    <Resource name="sql">
      <![CDATA[SELECT deptno,
  SUM(sal) WITHIN DISTINCT (comm) AS ss_c,
  COUNT(DISTINCT job) cdj,
  COUNT(job) WITHIN DISTINCT (job) AS cj_j,
  COUNT(DISTINCT job) WITHIN DISTINCT (job) AS cdj_j,
  COUNT(DISTINCT job) FILTER (WHERE sal > 1000) AS cdj_filtered
FROM emp
GROUP BY deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], SS_C=[SUM($1) WITHIN DISTINCT ($2)], CDJ=[COUNT(DISTINCT $3)], CJ_J=[COUNT() WITHIN DISTINCT ($3)], CDJ_J=[COUNT(DISTINCT $3) WITHIN DISTINCT ($3)], CDJ_FILTERED=[COUNT(DISTINCT $3) FILTER $4])
  LogicalProject(DEPTNO=[$7], SAL=[$5], COMM=[$6], JOB=[$2], $f4=[>($5, 1000)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], $f1=[$1], $f2=[$2], $f20=[$2], $f21=[$2], $f3=[$3])
  LogicalAggregate(group=[{0}], agg#0=[$SUM0($1) FILTER $3], agg#1=[COUNT() FILTER $4], agg#2=[COUNT($2) FILTER $5])
    LogicalProject(DEPTNO=[$0], $f3=[$3], $f4=[$4], $f7=[=($6, 1)], $f8=[=($6, 2)], $f9=[AND(=($6, 2), >($5, 0))])
      LogicalAggregate(group=[{0, 2, 3}], groups=[[{0, 2}, {0, 3}]], agg#0=[MIN($1)], agg#1=[MIN($3) FILTER $4], agg#2=[COUNT() FILTER $4], agg#3=[GROUPING($0, $2, $3)])
        LogicalProject(DEPTNO=[$7], SAL=[$5], COMM=[$6], JOB=[$2], $f4=[>($5, 1000)])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWithinDistinctFilteredAggs">
    <Resource name="sql">
      <![CDATA[SELECT deptno,
 SUM(sal) WITHIN DISTINCT (job) FILTER (WHERE comm > 10),
 AVG(comm) WITHIN DISTINCT (sal) FILTER (WHERE ename LIKE '%ok%')
FROM emp
GROUP BY deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1) WITHIN DISTINCT ($3) FILTER $2], EXPR$2=[AVG($4) WITHIN DISTINCT ($1) FILTER $5])
  LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[>($6, 10)], JOB=[$2], COMM=[$6], $f5=[LIKE($1, '%ok%')])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[CASE(=($2, 0), null:INTEGER, $1)], EXPR$2=[CAST(/($3, $4)):INTEGER])
  LogicalProject(DEPTNO=[$0], EXPR$1=[$1], $f2=[$2], $f3=[CASE(=($4, 0), null:INTEGER, $3)], $f4=[$4])
    LogicalAggregate(group=[{0}], agg#0=[$SUM0($1) FILTER $3], agg#1=[COUNT() FILTER $4], agg#2=[$SUM0($2) FILTER $5], agg#3=[COUNT() FILTER $6])
      LogicalProject(DEPTNO=[$0], $f3=[$3], $f6=[$6], $f10=[AND(=($9, 2), >($5, 0), $THROW_UNLESS(OR(<>($9, 2), AND(IS NULL($3), IS NULL($4)), IS TRUE(=($3, $4))), 'more than one distinct value in agg UNIQUE_VALUE'))], $f11=[AND(=($9, 2), >($5, 0))], $f12=[AND(=($9, 1), >($8, 0), $THROW_UNLESS(OR(<>($9, 1), AND(IS NULL($6), IS NULL($7)), IS TRUE(=($6, $7))), 'more than one distinct value in agg UNIQUE_VALUE'))], $f13=[AND(=($9, 1), >($8, 0))])
        LogicalAggregate(group=[{0, 1, 3}], groups=[[{0, 1}, {0, 3}]], agg#0=[MIN($1) FILTER $2], agg#1=[MAX($1) FILTER $2], agg#2=[COUNT() FILTER $2], agg#3=[MIN($4) FILTER $5], agg#4=[MAX($4) FILTER $5], agg#5=[COUNT() FILTER $5], agg#6=[GROUPING($0, $1, $3)])
          LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[>($6, 10)], JOB=[$2], COMM=[$6], $f5=[LIKE($1, '%ok%')])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWithinDistinctFilteredAggsSameFilter">
    <Resource name="sql">
      <![CDATA[SELECT deptno,
 SUM(sal) WITHIN DISTINCT (job) FILTER (WHERE ename LIKE '%ok%'),
 AVG(comm) WITHIN DISTINCT (sal) FILTER (WHERE ename LIKE '%ok%')
FROM emp
GROUP BY deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1) WITHIN DISTINCT ($3) FILTER $2], EXPR$2=[AVG($4) WITHIN DISTINCT ($1) FILTER $2])
  LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[LIKE($1, '%ok%')], JOB=[$2], COMM=[$6])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[CASE(=($2, 0), null:INTEGER, $1)], EXPR$2=[CAST(/($3, $4)):INTEGER])
  LogicalProject(DEPTNO=[$0], EXPR$1=[$1], $f2=[$2], $f3=[CASE(=($4, 0), null:INTEGER, $3)], $f4=[$4])
    LogicalAggregate(group=[{0}], agg#0=[$SUM0($1) FILTER $3], agg#1=[COUNT() FILTER $4], agg#2=[$SUM0($2) FILTER $5], agg#3=[COUNT() FILTER $6])
      LogicalProject(DEPTNO=[$0], $f3=[$3], $f6=[$6], $f9=[AND(=($8, 2), >($5, 0), $THROW_UNLESS(OR(<>($8, 2), AND(IS NULL($3), IS NULL($4)), IS TRUE(=($3, $4))), 'more than one distinct value in agg UNIQUE_VALUE'))], $f10=[AND(=($8, 2), >($5, 0))], $f11=[AND(=($8, 1), >($5, 0), $THROW_UNLESS(OR(<>($8, 1), AND(IS NULL($6), IS NULL($7)), IS TRUE(=($6, $7))), 'more than one distinct value in agg UNIQUE_VALUE'))], $f12=[AND(=($8, 1), >($5, 0))])
        LogicalAggregate(group=[{0, 1, 3}], groups=[[{0, 1}, {0, 3}]], agg#0=[MIN($1) FILTER $2], agg#1=[MAX($1) FILTER $2], agg#2=[COUNT() FILTER $2], agg#3=[MIN($4) FILTER $2], agg#4=[MAX($4) FILTER $2], agg#5=[GROUPING($0, $1, $3)])
          LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[LIKE($1, '%ok%')], JOB=[$2], COMM=[$6])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWithinDistinctFilteredAggsUniformDistinctKeys">
    <Resource name="sql">
      <![CDATA[SELECT deptno,
 SUM(sal) WITHIN DISTINCT (job) FILTER (WHERE comm > 10),
 AVG(comm) WITHIN DISTINCT (job) FILTER (WHERE ename LIKE '%ok%')
FROM emp
GROUP BY deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1) WITHIN DISTINCT ($3) FILTER $2], EXPR$2=[AVG($4) WITHIN DISTINCT ($3) FILTER $5])
  LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[>($6, 10)], JOB=[$2], COMM=[$6], $f5=[LIKE($1, '%ok%')])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[CASE(=($2, 0), null:INTEGER, $1)], EXPR$2=[CAST(/($3, $4)):INTEGER])
  LogicalProject(DEPTNO=[$0], EXPR$1=[$1], $f2=[$2], $f3=[CASE(=($4, 0), null:INTEGER, $3)], $f4=[$4])
    LogicalAggregate(group=[{0}], agg#0=[$SUM0($1) FILTER $3], agg#1=[COUNT() FILTER $4], agg#2=[$SUM0($2) FILTER $5], agg#3=[COUNT() FILTER $6])
      LogicalProject(DEPTNO=[$0], $f2=[$2], $f5=[$5], $f8=[AND(>($4, 0), $THROW_UNLESS(OR(AND(IS NULL($2), IS NULL($3)), IS TRUE(=($2, $3))), 'more than one distinct value in agg UNIQUE_VALUE'))], $f9=[>($4, 0)], $f10=[AND(>($7, 0), $THROW_UNLESS(OR(AND(IS NULL($5), IS NULL($6)), IS TRUE(=($5, $6))), 'more than one distinct value in agg UNIQUE_VALUE'))], $f11=[>($7, 0)])
        LogicalAggregate(group=[{0, 3}], agg#0=[MIN($1) FILTER $2], agg#1=[MAX($1) FILTER $2], agg#2=[COUNT() FILTER $2], agg#3=[MIN($4) FILTER $5], agg#4=[MAX($4) FILTER $5], agg#5=[COUNT() FILTER $5])
          LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[>($6, 10)], JOB=[$2], COMM=[$6], $f5=[LIKE($1, '%ok%')])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWithinDistinctFilteredAggsUniformDistinctKeysNoThrow">
    <Resource name="sql">
      <![CDATA[SELECT deptno,
 SUM(sal) WITHIN DISTINCT (job) FILTER (WHERE comm > 10),
 AVG(comm) WITHIN DISTINCT (job) FILTER (WHERE ename LIKE '%ok%')
FROM emp
GROUP BY deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1) WITHIN DISTINCT ($3) FILTER $2], EXPR$2=[AVG($4) WITHIN DISTINCT ($3) FILTER $5])
  LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[>($6, 10)], JOB=[$2], COMM=[$6], $f5=[LIKE($1, '%ok%')])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[CASE(=($2, 0), null:INTEGER, $1)], EXPR$2=[CAST(/($3, $4)):INTEGER])
  LogicalProject(DEPTNO=[$0], EXPR$1=[$1], $f2=[$2], $f3=[CASE(=($4, 0), null:INTEGER, $3)], $f4=[$4])
    LogicalAggregate(group=[{0}], agg#0=[$SUM0($1) FILTER $3], agg#1=[COUNT() FILTER $3], agg#2=[$SUM0($2) FILTER $4], agg#3=[COUNT() FILTER $4])
      LogicalProject(DEPTNO=[$0], $f2=[$2], $f4=[$4], $f6=[>($3, 0)], $f7=[>($5, 0)])
        LogicalAggregate(group=[{0, 3}], agg#0=[MIN($1) FILTER $2], agg#1=[COUNT() FILTER $2], agg#2=[MIN($4) FILTER $5], agg#3=[COUNT() FILTER $5])
          LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[>($6, 10)], JOB=[$2], COMM=[$6], $f5=[LIKE($1, '%ok%')])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWithinDistinctNoThrow">
    <Resource name="sql">
      <![CDATA[SELECT deptno, SUM(sal), SUM(sal) WITHIN DISTINCT (job)
FROM emp
GROUP BY deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)], EXPR$2=[SUM($1) WITHIN DISTINCT ($2)])
  LogicalProject(DEPTNO=[$7], SAL=[$5], JOB=[$2])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], $f1=[CAST($1):INTEGER NOT NULL], $f2=[$2])
  LogicalAggregate(group=[{0}], agg#0=[MIN($1) FILTER $3], agg#1=[$SUM0($2) FILTER $4])
    LogicalProject(DEPTNO=[$0], $f2=[$2], $f3=[$3], $f5=[=($4, 1)], $f6=[=($4, 0)])
      LogicalAggregate(group=[{0, 2}], groups=[[{0, 2}, {0}]], agg#0=[$SUM0($1)], agg#1=[MIN($1)], agg#2=[GROUPING($0, $2)])
        LogicalProject(DEPTNO=[$7], SAL=[$5], JOB=[$2])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWithinDistinctPreservesNonDistinctAggFilters">
    <Resource name="sql">
      <![CDATA[SELECT deptno,
 SUM(sal) FILTER (WHERE sal > 1000),
 SUM(sal) WITHIN DISTINCT (job)
FROM emp
GROUP BY deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1) FILTER $2], EXPR$2=[SUM($1) WITHIN DISTINCT ($3)])
  LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[>($5, 1000)], JOB=[$2])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[CASE(=($2, 0), null:INTEGER, $1)], EXPR$2=[$3])
  LogicalProject(DEPTNO=[$0], $f1=[CAST($1):INTEGER NOT NULL], $f2=[CAST($2):BIGINT NOT NULL], $f3=[$3])
    LogicalAggregate(group=[{0}], agg#0=[MIN($1) FILTER $4], agg#1=[MIN($2) FILTER $4], agg#2=[$SUM0($3) FILTER $5])
      LogicalProject(DEPTNO=[$0], $f2=[$2], $f3=[$3], $f4=[$4], $f7=[=($6, 1)], $f8=[AND(=($6, 0), $THROW_UNLESS(OR(<>($6, 0), =($4, $5)), 'more than one distinct value in agg UNIQUE_VALUE'))])
        LogicalAggregate(group=[{0, 3}], groups=[[{0, 3}, {0}]], agg#0=[$SUM0($1) FILTER $2], agg#1=[COUNT() FILTER $2], agg#2=[MIN($1)], agg#3=[MAX($1)], agg#4=[GROUPING($0, $3)])
          LogicalProject(DEPTNO=[$7], SAL=[$5], $f2=[>($5, 1000)], JOB=[$2])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWithinDistinctPreservesNonDistinctCollation">
    <Resource name="sql">
      <![CDATA[SELECT SUM(sal) WITHIN DISTINCT (job),
LISTAGG(ename, '; ') WITHIN GROUP (ORDER BY sal DESC)
 FROM Emp
GROUP BY deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
  LogicalAggregate(group=[{0}], EXPR$0=[SUM($1) WITHIN DISTINCT ($2)], EXPR$1=[LISTAGG($3, $4) WITHIN GROUP ([1 DESC])])
    LogicalProject(DEPTNO=[$7], SAL=[$5], JOB=[$2], ENAME=[$1], $f4=['; '])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
  LogicalProject(DEPTNO=[$0], $f1=[$1], $f2=[CAST($2):VARCHAR(20) NOT NULL])
    LogicalAggregate(group=[{0}], agg#0=[$SUM0($1) FILTER $3], agg#1=[MIN($2) FILTER $4])
      LogicalProject(DEPTNO=[$0], $f2=[$2], $f4=[$4], $f6=[AND(=($5, 0), $THROW_UNLESS(OR(<>($5, 0), =($2, $3)), 'more than one distinct value in agg UNIQUE_VALUE'))], $f7=[=($5, 1)])
        LogicalAggregate(group=[{0, 2}], groups=[[{0, 2}, {0}]], agg#0=[MIN($1)], agg#1=[MAX($1)], agg#2=[LISTAGG($3, $4) WITHIN GROUP ([1 DESC])], agg#3=[GROUPING($0, $2)])
          LogicalProject(DEPTNO=[$7], SAL=[$5], JOB=[$2], ENAME=[$1], $f4=['; '])
            LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWithinDistinctUniformDistinctKeys">
    <Resource name="sql">
      <![CDATA[SELECT deptno,
 SUM(sal) WITHIN DISTINCT (job),
 AVG(comm) WITHIN DISTINCT (job)
FROM emp
GROUP BY deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1) WITHIN DISTINCT ($2)], EXPR$2=[AVG($3) WITHIN DISTINCT ($2)])
  LogicalProject(DEPTNO=[$7], SAL=[$5], JOB=[$2], COMM=[$6])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$1], EXPR$2=[CAST(/($2, $3)):INTEGER NOT NULL])
  LogicalAggregate(group=[{0}], agg#0=[$SUM0($1) FILTER $3], agg#1=[$SUM0($2) FILTER $4], agg#2=[COUNT()])
    LogicalProject(DEPTNO=[$0], $f2=[$2], $f4=[$4], $f6=[$THROW_UNLESS(=($2, $3), 'more than one distinct value in agg UNIQUE_VALUE')], $f7=[$THROW_UNLESS(=($4, $5), 'more than one distinct value in agg UNIQUE_VALUE')])
      LogicalAggregate(group=[{0, 2}], agg#0=[MIN($1)], agg#1=[MAX($1)], agg#2=[MIN($3)], agg#3=[MAX($3)])
        LogicalProject(DEPTNO=[$7], SAL=[$5], JOB=[$2], COMM=[$6])
          LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testWithinDistinctUniformDistinctKeysNoThrow">
    <Resource name="sql">
      <![CDATA[SELECT deptno,
 SUM(sal) WITHIN DISTINCT (job),
 AVG(comm) WITHIN DISTINCT (job)
FROM emp
GROUP BY deptno]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{0}], EXPR$1=[SUM($1) WITHIN DISTINCT ($2)], EXPR$2=[AVG($3) WITHIN DISTINCT ($2)])
  LogicalProject(DEPTNO=[$7], SAL=[$5], JOB=[$2], COMM=[$6])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalProject(DEPTNO=[$0], EXPR$1=[$1], EXPR$2=[CAST(/($2, $3)):INTEGER NOT NULL])
  LogicalAggregate(group=[{0}], agg#0=[$SUM0($2)], agg#1=[$SUM0($3)], agg#2=[COUNT()])
    LogicalAggregate(group=[{0, 2}], agg#0=[MIN($1)], agg#1=[MIN($3)])
      LogicalProject(DEPTNO=[$7], SAL=[$5], JOB=[$2], COMM=[$6])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
</Root>
