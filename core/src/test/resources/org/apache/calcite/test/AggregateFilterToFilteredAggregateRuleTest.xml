<?xml version="1.0" ?>
<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one or more
  ~ contributor license agreements.  See the NOTICE file distributed with
  ~ this work for additional information regarding copyright ownership.
  ~ The ASF licenses this file to you under the Apache License, Version 2.0
  ~ (the "License"); you may not use this file except in compliance with
  ~ the License.  You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<Root>
  <TestCase name="testAggregateNoSupportingFilter">
    <Resource name="sql">
      <![CDATA[select single_value(sal) from emp where deptno = 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SINGLE_VALUE($5)])
  LogicalFilter(condition=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testMultiAggregates">
    <Resource name="sql">
      <![CDATA[select sum(sal), min(sal), max(sal), count(*) from emp where deptno = 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($5)], EXPR$1=[MIN($5)], EXPR$2=[MAX($5)], EXPR$3=[COUNT()])
  LogicalFilter(condition=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0) FILTER $1], EXPR$1=[MIN($0) FILTER $1], EXPR$2=[MAX($0) FILTER $1], EXPR$3=[COUNT() FILTER $1])
  LogicalProject(SAL=[$5], $f9=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSingleColumnAggregate">
    <Resource name="sql">
      <![CDATA[select sum(sal) from emp where deptno = 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($5)])
  LogicalFilter(condition=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0) FILTER $1])
  LogicalProject(SAL=[$5], $f9=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSingleColumnAggregateWithEmptyGroupBy">
    <Resource name="sql">
      <![CDATA[select sum(sal) from emp where deptno = 10 group by ()]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($5)])
  LogicalFilter(condition=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0) FILTER $1])
  LogicalProject(SAL=[$5], $f9=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSingleColumnAggregateWithEmptyGroupingSets">
    <Resource name="sql">
      <![CDATA[select sum(sal) from emp where deptno = 10 group by grouping sets (())]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($5)])
  LogicalFilter(condition=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0) FILTER $1])
  LogicalProject(SAL=[$5], $f9=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSingleColumnAggregateWithGroupBy">
    <Resource name="sql">
      <![CDATA[select sum(sal) from emp where deptno = 10 group by job]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[$1])
  LogicalAggregate(group=[{2}], EXPR$0=[SUM($5)])
    LogicalFilter(condition=[=($7, 10)])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSingleColumnAggregateWithGroupingSets">
    <Resource name="sql">
      <![CDATA[select sum(sal) from emp where deptno = 10 group by grouping sets ((job), (ename))]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalProject(EXPR$0=[$2])
  LogicalProject(JOB=[$1], ENAME=[$0], EXPR$0=[$2])
    LogicalAggregate(group=[{1, 2}], groups=[[{1}, {2}]], EXPR$0=[SUM($5)])
      LogicalFilter(condition=[=($7, 10)])
        LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSingleColumnFilteredAggregate">
    <Resource name="sql">
      <![CDATA[select sum(sal) filter (where ename = 'Bob') from emp where deptno = 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0) FILTER $2])
  LogicalFilter(condition=[=($1, 10)])
    LogicalProject(SAL=[$5], DEPTNO=[$7], $f2=[=($1, 'Bob')])
      LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[SUM($0) FILTER $1])
  LogicalProject(SAL=[$5], $f3=[AND(=($1, 'Bob'), =($7, 10))])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
  <TestCase name="testSingleStarAggregate">
    <Resource name="sql">
      <![CDATA[select count(*) from emp where deptno = 10]]>
    </Resource>
    <Resource name="planBefore">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
  LogicalFilter(condition=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
    <Resource name="planAfter">
      <![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[COUNT() FILTER $0])
  LogicalProject($f9=[=($7, 10)])
    LogicalTableScan(table=[[CATALOG, SALES, EMP]])
]]>
    </Resource>
  </TestCase>
</Root>
