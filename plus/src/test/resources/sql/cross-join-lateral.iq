# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to you under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
!use CALCITE_AS_ADMIN
!set outputformat mysql

# Checks whether CROSS JOIN LATERAL works
SELECT SC.email EMAIL, TF.TYPE, TF.CODEVALUE
FROM ENHANCED.SIMPLE_CUSTOMER SC
CROSS JOIN LATERAL TABLE(AUX.CODES(SC.email)) TF limit 6;
+-----------------------+----------+------------------------------+
| EMAIL                 | TYPE     | CODEVALUE                    |
+-----------------------+----------+------------------------------+
| leonekohler@surfeu.de | BASE64   | bGVvbmVrb2hsZXJAc3VyZmV1LmRl |
| leonekohler@surfeu.de | HASHCODE | -1984160245                  |
| leonekohler@surfeu.de | ORIGINAL | leonekohler@surfeu.de        |
| luisg@embraer.com.br  | BASE64   | bHVpc2dAZW1icmFlci5jb20uYnI= |
| luisg@embraer.com.br  | HASHCODE | 934160737                    |
| luisg@embraer.com.br  | ORIGINAL | luisg@embraer.com.br         |
+-----------------------+----------+------------------------------+
(6 rows)

!ok

# [CALCITE-2446] Lateral joins not work when saved as custom views
#
# Checks whether CROSS JOIN LATERAL WORK WITH VIEW EXPANSION
SELECT * FROM EXAMPLES.CODED_EMAILS;
+-----------------------+----------+------------------------------+
| EMAIL                 | TYPE     | CODEVALUE                    |
+-----------------------+----------+------------------------------+
| leonekohler@surfeu.de | BASE64   | bGVvbmVrb2hsZXJAc3VyZmV1LmRl |
| leonekohler@surfeu.de | HASHCODE | -1984160245                  |
| leonekohler@surfeu.de | ORIGINAL | leonekohler@surfeu.de        |
| luisg@embraer.com.br  | BASE64   | bHVpc2dAZW1icmFlci5jb20uYnI= |
| luisg@embraer.com.br  | HASHCODE | 934160737                    |
| luisg@embraer.com.br  | ORIGINAL | luisg@embraer.com.br         |
+-----------------------+----------+------------------------------+
(6 rows)

!ok

# Checks whether simple join between table functions and normal table
SELECT SC.email EMAIL, TF.TYPE, TF.CODEVALUE
FROM ENHANCED.SIMPLE_CUSTOMER SC
JOIN TABLE(AUX.CODES('luisg@embraer.com.br')) TF ON TF.CODEVALUE = SC.EMAIL
LIMIT 6;
+----------------------+----------+----------------------+
| EMAIL                | TYPE     | CODEVALUE            |
+----------------------+----------+----------------------+
| luisg@embraer.com.br | ORIGINAL | luisg@embraer.com.br |
+----------------------+----------+----------------------+
(1 row)

!ok

# End cross-join-lateral.iq
